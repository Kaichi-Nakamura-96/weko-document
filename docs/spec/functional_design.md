# 目次

## ユーザ機能

### アイテム検索

[USER-1-1: 簡易検索（全文検索・キーワード検索） 1](./USER_1_1.md)

[USER-1-2: 詳細検索 4](./USER_1_2.md))

[USER-1-3: インデックス検索 11](./USER_1_3.md)

[USER-1-4: ファセット検索 16](./USER_1_4.md)

[USER-1-5: RSS 19](./USER_1_5.md)

### アイテムリスト

[USER-2-1: 一覧形式表示 23](./USER_2_1.md)

[USER-2-2: 目次形式表示 28](./USER_2_2.md)

[USER-2-3: 雑誌情報 32](./USER_2_3.md)

[USER-2-4: アイテム一括出力 38](./USER_2_4.md)

### アイテム詳細

[USER-3-1: メタデータ表示 44](./USER_3_1.md)

[USER-3-2: コンテンツファイル管理 51](./USER_3_2.md)

[USER-3-3: アイテムバージョン管理 63](./USER_3_3.md)

[USER-3-4: 引用情報表示 66](./USER_3_4.md)

[USER-3-5: 統計情報表示 69](./USER_3_5.md)

[USER-3-6: 共有 72](./USER_3_6.md)

[USER-3-7: エクスポート 73](./USER_3_7.md)

[USER-3-8: Google Scholar メタデータ出力 81](./USER_3_8.md)

[USER-3-9: Google Dataset メタデータ出力 83](./USER_3_9.md)

### ワークフロー 85

[USER-4-1: アクティビティ一覧表示 85](./USER_4_1.md)

[USER-4-2: ワークフロー一覧表示 95](./USER_4_2.md)

[USER-4-3: ワークフロー 4](./USER_4_3.md)

[USER-4-4: Item Registration 7](./USER_4_4.md)

[USER-4-5: Item Registration：ファイルアップロード 8](./USER_4_5.md)

[USER-4-6: Item Registration：メタデータ入力 23](./USER_4_6.md)

[USER-4-7: Item Registration：代理投稿 28](./USER_4_7.md)

[USER-4-8: Item Registration：フィードバックメール機能 30](./USER_4_8.md)

[USER-4-9: Item Registration：インデックス指定 34](./USER_4_9.md)

[USER-4-10: Identifier Grant 36](./USER_4_10.md)

[USER-4-11: Item Link 45](./USER_4_11.md)

[USER-4-12: OA Policy Confirmation（現在非対応） 49](./USER_4_12.md)

[USER-4-13: Approval 51](./USER_4_13.md)
 
### コミュニティ 53

[USER-5-1: コミュニティ 53](./USER_5_1.md)

### ランキング 55

[USER-6-1: ランキング 55](./USER_6_1.md)

### 大容量ファイルアップロード 61

[USER-7-1: ファイルアップロード 61](./USER_7_1.md)

### 言語切替 62

[USER-7-2: 言語切替 62](./USER_7_2.md)

### ユーザーアカウント 63

[USER-8-1: サインアップ 63](./USER_8_1.md)

[USER-8-2: ログイン 65](./USER_8_2.md)

[USER-8-3: パスワードリセット 67](./USER_8_3.md)

[USER-8-4: ユーザープロファイル設定 69](./USER_8_4.md)

[USER-8-5: API設定 71](./USER_8_5.md)

### Cookie 75

[USER-9-1: Cookie使用確認画面表示 75](./USER_9_1.md)

## 管理機能

### アイテムタイプ管理

[ADMIN-1-1: メタデータ 76](./ADMIN_1_1.md)

[ADMIN-1-2: マッピング 84](./ADMIN_1_2.md)

[ADMIN-1-3: OAIスキーマ 88](./ADMIN_1_3.md)

[ADMIN-1-4: プロパティ 90](./ADMIN_1_4.md)

### アイテム管理 104

[ADMIN-2-1: 一括更新 104](./ADMIN_2_1.md)

[ADMIN-2-2: 一括削除 108](./ADMIN_2_2.md)

[ADMIN-2-3: 一括エクスポート 110](./ADMIN_2_3.md)

[ADMIN-2-4: インポート 113](./ADMIN_2_4.md)

### 3 インデックスツリー管理 155

[ADMIN-3-1: ツリー編集 155](./ADMIN_3_1.md)

[ADMIN-3-2: 雑誌情報 162](./ADMIN_3_2.md)

[ADMIN-3-3: カスタムソート 165](./ADMIN_3_3.md)

### 4 ウェブデザイン管理 167

[ADMIN-4-1: ウィジェット 167](./ADMIN_4_1.md)

[ADMIN-4-2: ページレイアウト 180](./ADMIN_4_2.md)

### 5 著者DB管理 185

[ADMIN-5-1: 編集 185](./ADMIN_5_1.md)

[ADMIN-5-2: 一括出力 198](./ADMIN_5_2.md)

[ADMIN-5-3: 一括登録 204](./ADMIN_5_3.md)

[ADMIN-5-4: 外部著者ID Prefix](./ADMIN_5_4.md)

### 6 統計 217

[ADMIN-6-1: 運用レポート 217](./ADMIN_6_1.md)

[ADMIN-6-2: フィードバックメール 233](./ADMIN_6_2.md)

[ADMIN-6-3: サイトライセンス 238](./ADMIN_6_3.md)

### 7 ワークフロー管理 242

[ADMIN-7-1: フロー 242](./ADMIN_7_1.md)

[ADMIN-7-2: ワークフロー 253](./ADMIN_7_2.md)

### 8 コミュニティ管理 256

[ADMIN-8-1: コミュニティ 256](./ADMIN_8_1.md)

[ADMIN-8-2: 注目のコミュニティ 261](./ADMIN_8_2.md)

[ADMIN-8-3: 参加リクエスト 264](./ADMIN_8_3.md)

### 9 OAI-PMH 265

[ADMIN-9-1: ハーベスト 265](./ADMIN_9_1.md)

[ADMIN-9-2: Identify 273](#identify)

[ADMIN-9-3: Sets 275](#sets)

### 10 Resource Sync 277

[ADMIN-10-1: Resource List 277](./ADMIN_10_1.md))

[ADMIN-10-2: Change List 283](#change-list)

[ADMIN-10-3: Resync 291](#resync)

### 11 レコード管理 296

[ADMIN-11-1: 永続識別子 296](./ADMIN_11_1.md)

[ADMIN-11-2: レコードメタデータ 299](#レコードメタデータ)

### 12 ファイル管理 302

[ADMIN-12-1: バケット 302](./ADMIN_12_1.md)

[ADMIN-12-2: ファイルインスタンス 306](#ファイルインスタンス)

[ADMIN-12-3: ロケーション 311](#ロケーション)

[ADMIN-12-4: マルチパートオブジェクト 317](#マルチパートオブジェクト)

[ADMIN-12-5: オブジェクトバージョン 320](#オブジェクトバージョン)

> [13 ユーザ管理 324](#ユーザ管理)

[ADMIN-13-1: アクセス\_ロール 324](#アクセス_ロール)

[ADMIN-13-2: アクセス\_システムロール 328](#アクセス_システムロール)

[ADMIN-13-3: アクセス\_ユーザー 329](#アクセス_ユーザー)

[ADMIN-13-4: 連結アカウント識別子 330](#連結アカウント識別子)

[ADMIN-13-5: 連結アカウントトークン 331](#連結アカウントトークン)

[ADMIN-13-6: 連結アカウント 332](#連結アカウント)

[ADMIN-13-7: OAuthアプリケーショントークン 333](#oauthアプリケーショントークン)

[ADMIN-13-8: OAuthアプリケーション 336](#oauthアプリケーション)

[ADMIN-13-9: ロール 339](#ロール)

[ADMIN-13-10: セッションアクティビティ 343](#セッションアクティビティ)

[ADMIN-13-11: ユーザー 345](#ユーザー)

[ADMIN-13-12: ユーザープロファイル 350](#ユーザープロファイル)

> [14 設定 354](#設定)

[ADMIN-14-1: アイテム表示 354](#アイテム表示)

[ADMIN-14-2: インデックスリンク表示 356](#インデックスリンク表示)

[ADMIN-14-3: 言語表示 357](#言語表示)

[ADMIN-14-4: PDFカバーページ表示 361](#pdfカバーページ表示)

[ADMIN-14-5: ランキング表示 364](#ランキング表示)

[ADMIN-14-6: 統計情報表示 367](#統計情報表示-1)

[ADMIN-14-7: 画面背景色 369](#画面背景色)

[ADMIN-14-8: 識別子 370](#識別子)

[ADMIN-14-9: アイテム一括出力 374](#アイテム一括出力-1)

[ADMIN-14-10: ログ解析 375](#ログ解析)

[ADMIN-14-11: 検索設定 380](#検索設定)

[ADMIN-14-12: ファセット検索 385](#ファセット検索-1)

[ADMIN-14-13: サイト情報 395](#サイト情報)

[ADMIN-14-14: サイトライセンス 398](#サイトライセンス-1)

[ADMIN-14-15: サイトマップ 399](#サイトマップ)

[ADMIN-14-16: メール送信 404](#メール送信)

[ADMIN-14-17: WebAPIアカウント 406](#webapiアカウント)

[ADMIN-14-18: ファイルプレビュー 408](#ファイルプレビュー)

[ADMIN-14-19: Shibboleth 410](#shibboleth)

[ADMIN-14-20: 制限公開 412](#制限公開)

[ADMIN-14-21: その他 422](#その他)

> [15 メンテナンス 423](#メンテナンス)

[ADMIN-15-1: Elasticsearchインデックス 423](#elasticsearchインデックス)

[WebAPI 425](#webapi)

[API-1: OAuth2 425](./API_01_Oauth2.md)

[API-2: OAI-PMH 429](#oai-pmh-1)

[API-3: OpenSearch 436](#opensearch)

[API-4: Workflow API 5](#workflow-api)

[API-5: Index操作API 7](./API_05_index_op.md)

[API-6: SWORD API 9](./API_06_sword_api.md)

[API-7: アイテム検索用API 20](#アイテム検索用api)

[API-8: インデックス検索用API 43](./API_08_index_search.md)

[API-9: Render 81](./API_09_render.md)

[API-10: JSON Schema 165](./API_10_JSON_Schema.md)

[API-11: JSON Form 187](./API_11_JSON_Form.md)

[データ構造 328](#データ構造)

> [2 アイテムタイプ 328](#アイテムタイプ)

[SCHEMA-1-1: Render 328](#render-1)

[SCHEMA-1-2: Schema 329](#schema)

> [1 モジュール、ライブラリ 330](#モジュールライブラリ)

[その他 330](#その他-1)

> [2 モジュール、ライブラリ 330](#モジュールライブラリ-1)
> 
> [3 コンフィグ 331](#コンフィグ)
> 
> [4 DB 336](#db)
> 
> [5 elasticsearch 337](./OTHER_elasticsearch.md)
> 
> [6 celery タスク 342](#celery-タスク)
> 
> [7 ログ 345](#ログ)
> 
> [8 セッション管理 357](#セッション管理)
> 
> [9 API Endpoint 358](#api-endpoint)
> 
> [10 Shibboleth対応 359](#shibboleth対応)
> 
> [11 GakuNinRDM連携 362](#gakuninrdm連携)
> 
> [12 ID体系 371](#id体系)
> 
> [13 解析基盤連携 372](#解析基盤連携)
> 
> [14 制限公開機能 373](#制限公開機能)

[その他-13-1: アイテムタイプ管理（制限公開） 373](#アイテムタイプ管理制限公開)

[その他-13-2: アイテム詳細(制限公開) 376](#アイテム詳細制限公開)

[その他-13-3: ワークフロー管理（制限公開） 378](#ワークフロー管理制限公開)

[その他-13-4: メールテンプレート 381](#メールテンプレート)

> [15 ツール 390](#ツール)

[TOOL-1: システムプロパティマッピング 390](#システムプロパティマッピング)

**【　作成履歴　】**

<table>
<tbody>
<tr class="odd">
<td>版数</td>
<td>作成概要</td>
<td><p>作成者</p>
<p>作成日</p></td>
<td><p>承認者</p>
<p>承認日</p></td>
</tr>
<tr class="even">
<td>1.0</td>
<td>新規作成</td>
<td><p>IVIS</p>
<p>20230831</p></td>
<td><p>名前</p>
<p>yyyymmdd</p></td>
</tr>
<tr class="odd">
<td>1.1</td>
<td>V0.9.27</td>
<td>NII</td>
<td>202301111</td>
</tr>
<tr class="even">
<td>1.2</td>
<td><p>W2023-42修正内容を反映</p>
<p>・USER-4‐5：ItemRegistration：ファイルアップロードに、マルチパートアップロードの項目を追加</p>
<p>・USER-3-2：コンテンツファイル管理 に、プレビュー表示閾値、マルチパートダウンロードの項目を追加</p>
<p>・USER-3-2：コンテンツファイル管理のバージョンにマルチパートダウンロードの項目を追加</p>
<p>・3ワークフロー3ワークフローのApprovalの捕捉にマルチパートダウンロードの項目を追加</p>
<p>アイテムリストUSER1-4:アイテム一括出力にて、出力できるファイルのサイズ制限を追加</p>
<p>・ADMIN12‐4マルチパートアップロードの項目・フィルタ・削除について追記</p>
<p>・ADMIN2‐4インポート　大容量アップロードファイルとの紐付け項目、チェックを追加</p>
<p>・６大容量ファイルアップロードを追加</p></td>
<td>IVIS</td>
<td>20231222</td>
</tr>
<tr class="odd">
<td>1.3</td>
<td><p>W2022-14（制限公開機能）修正内容反映</p>
<p>・USER-3-2：コンテンツファイル管理 に、制限公開コンテンツ処理、SecretURLボタンの内容を追加</p>
<p>・ADMIN-7-1: フロー　に制限公開機能について追記</p>
<p>・ADMIN-7-2: ワークフロー　に制限公開機能について</p>
<p>・ADMIN-14-20：制限公開　にSecretURL管理機能を追加</p>
<p>・その他13-3：制限公開（ワークフロー管理） に情報追加</p></td>
<td>NII</td>
<td>20230119</td>
</tr>
<tr class="even">
<td>1.4</td>
<td>V1.0.5対応</td>
<td>NII</td>
<td>20230306</td>
</tr>
</tbody>
</table>






##   

#### ADMIN-5-1-3:Affiliation ID

  - > 目的・用途

本機能は、登録済みの所属機関識別子の編集や、新たな所属機関識別子を追加するための機能である。

  - > 利用方法

【Administration\>著者DB管理（Author Management）\>編集（Edit）】の順で編集画面に遷移し、Affiliation　IDタブを押下する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - > 【Administration\>著者DB管理（Author Management）\>編集（Edit）】でのAffiliation IDタブに登録されている所属機関識別子一覧が表示される。
    
      - 表示項目は以下の通りである。
        
          - 「所属機関識別子（Name）」：所属機関の名前が表示される。
        
          - 「IDスキーマ名（Scheme）」：所属機関のSchemeが表示される。
        
          - 「URL」：所属機関のURLが表示される。
        
          - 「コントロール（Control）」：コントロールのボタンが表示される。  
            コントロールのボタンは［編集（Edit）］、［追加（Add）］である。
    
      - クリーンビルド環境での初期設定値は以下の通りである。
        
          - ISNI (URL: <https://www.isni.org/>isni/\#\#)
        
          - GRID(URL: https://www.grid.ac/institutes/\#\#)
        
          - Ringgold
        
          - Kakenhi
    
      - \[追加（Add）\]ボタンを押すと、入力内容をチェックする。
        
          - 問題があれば、外部著者ID Prefixを追加せず、エラーメッセージを表示する。
            
              - 何かの項目を入力しない場合、またはURL形式が不正場合は以下のメッセージを表示する。  
                エラーメッセージ：「Please enter the correct ＋　項目名」
            
              - 設定されたSchemeを選択する場合は以下のメッセージを表示する。  
                エラーメッセージ：「Specified scheme is already exist.」
        
          - 問題なければ、外部著者ID Prefixを追加し、以下のメッセージを表示する。  
            メッセージ：「Successfully added」
    
      - \[編集（Edit）\]ボタンを押すと、該当のAffiliation ID情報を編集可能とし、コントロールのボタンを該当行の直下に表示する。  
        コントロールのボタン：\[保存 （Save）」、\[キャンセル（Cancel）\]、\[削除（Delete）\]
        
          - 該当の外部著者ID Prefix情報を編集してから、\[保存 （Save）\]ボタンを押すと、編集内容を保存し、以下のメッセージを表示する。  
            メッセージ：「Update completed」
        
          - \[削除（Delete）\]ボタンを押すと、該当の外部著者ID Prefixを削除し、以下のメッセージを表示する  
            メッセージ：「Successfully deleted」
        
          - \[キャンセル（Cancel）\]ボタンを押すと、編集前の状態に戻る。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko-authors

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - > IDスキーマ名（Scheme）プルダウンに表示するScheme一覧の設定をする。

<!-- end list -->

  - > パス：  
    > <https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-authors/weko_authors/config.py#L32>

  - > 設定キー：WEKO\_AUTHORS\_AFFILIATION

  - > 現在の設定値：  
    > WEKO\_AUTHORS\_LIST\_SCHEME\_AFFILIATION = \['ISNI', 'GRID', 'Ringgold', 'kakenhi', 'Other'\]

<!-- end list -->

  - > 「Other」のインデックスを設定する。

<!-- end list -->

  - > パス：  
    > <https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-authors/weko_authors/config.py#L36>

  - > 設定キー：WEKO\_AUTHORS\_IDENTIFIER\_ITEM\_OTHER

  - > 現在の設定値：  
    > WEKO\_AUTHORS\_AFFILIATION\_IDENTIFIER\_ITEM\_OTHER = 4

<!-- end list -->

  - > Affiliation ID画面のテンプレートを設定する。

<!-- end list -->

  - > パス：  
    > [https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-authors/weko\_authors/config.py\#L51](https://github.com/RCOSDP/weko/blob/0.9.22/modules/weko-authors/weko_authors/config.py#L51)

  - > 設定キー：WEKO\_AUTHORS\_ADMIN\_AFFILIATION\_TEMPLATE

  - > 現在の設定値：  
    > WEKO\_AUTHORS\_ADMIN\_AFFILIATION\_TEMPLATE = \\'weko\_authors/admin/affiliation\_list.html'

<!-- end list -->

  - > 【Administration\>著者DB管理(Author Management)\>編集(edit)】からAffiliation IDタブ押下で遷移する初期画面は、Affiliation IDタブ押下時にweko\_authors.views.get\_affiliation\_listが呼び出され、db内のauthors\_affiliation\_settingsテーブルの情報が取り出されて表示される。

  - 編集時は、\[編集（Edit）\]ボタンを押下することで編集が可能となり、内容の変更後に\[保存(Save)\]ボタンを押すことで、weko\_authors.views.update\_affiliationが呼び出されて、db内のauthors\_affiliation\_settingsテーブルの情報が更新される。

  - 削除時は、\[編集（Edit）\]ボタン押下後に出現する\[削除（Delete）\]ボタンを押下することで、weko\_authors.views.delete\_affiliationが呼び出され、db内のauthors\_affiliation\_settingsテーブルから削除対象が削除される。

  - 追加時は、追加したい情報を最下部のテキストボックスに入力後に\[追加（Add）\]ボタンを押すことで、weko\_authors.views.create\_affiliationが呼び出され、db内のauthors\_affiliation\_settingsテーブル内に情報が追加される。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>


##   

##   




##   

9.  ## OAI-PMH
    
    1.  

##   

### Identify

  - > 目的・用途

本機能は、Identifyの作成・編集を行う機能である。Identifyとは、リポジトリに関する情報を検索する場合に使用されるものである。

  - > 利用方法

【Administration＞OAI-PMH＞Identify】の順で画面遷移して利用する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - Identify出力に対してリポジトリの情報を設定可能
    
      - 設定内容
        
          - Output Set：チェックボックス
            
              - チェックボックスにチェックを入れる場合、OAI-PMHリクエストに対して、正常レスポンスを返す。
            
              - チェックボックスにチェックを入れない場合、OAI-PMHリクエストに対して、エラーレスポンスを返す。  
                [エラーと例外状況](https://www.nii.ac.jp/irp/archive/translation/oai-pmh2.0/OpenArchivesProtocol.htm#ErrorConditions)
        
          - Emails：管理者メールアドレスを入れる。
        
          - Repository Name：リポジトリ名を入れる。
        
          - Earliest Datastamp：Identifyの作成時間を自動で入れる。  
            フォーマット：YYYY-MM-DD HH:MM:SS
    
      - \[保存（Save）\]ボタンを押すと、設定された内容をIdentify一覧に追加させ、メッセージをIdentify一覧に表示させる  
        メッセージ：「レコードが正常に作成されました。（Record was successfully saved）」
    
      - \[保存して編集を続ける（Save and Continue Editing）\]ボタンを押すと、メッセージを編集画面での上端に表示させ、作成されたIdentiftyの編集を続けることを可能とする。  
        メッセージ：「レコードが正常に作成されました。（Record was successfully saved）」
    
      - 1つのリポジトリに対して1つしか登録できない。

  - OAI-PMHのIdentify情報を返戻可能

【Admin \> OAI-PMH \> Identify画面】上の設定値に基づき、OAI-PMHのIdentifyリクエスト(verb=Identify)に対してレスポンス可能とする。詳細は[Web-API API-2:OAI-PMH](#_OAI-PMH)を参照。

  - > 関連モジュール

<!-- end list -->

  - > Invenio-oaiserver

<!-- end list -->

  - > 処理概要

> 画面表示について

  - > 一覧タブ  
    > invenio\_oaiserver.admin.IdentifyModelViewが継承しているModelViewからflask\_admin.model.base.index\_viewが呼び出され、db内のoaiserver\_identifyテーブルより情報を取得し画面に表示する。

  - > 編集タブ  
    > \[鉛筆\]ボタン押下時、invenio\_oaiserver.admin.IdentifyModelViewが継承しているModelViewからflask\_admin.model.base.edit\_viewが呼び出され、db内のoaiserver\_identifyテーブルより情報を取得し編集画面へ遷移する。
    
      - > 編集画面で\[保存（Save）\]ボタンもしくは\[保存して編集を続ける（Save and Continue Editing）\]を押下時、flask\_admin.model.base.edit\_viewが呼び出され、編集内容をdb内のoaiserver\_identifyテーブルに保存し、更新する。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

###   
Sets

  - > 目的・用途

本機能は、setの作成・編集・削除を行う機能である。Setとは、選択的ハーベスティングを行う目的でアイテムをグループ化するための任意の構成隊のことを示す。

  - > 利用方法

【Administration＞OAI-PMH＞Sets】の順で画面遷移して利用する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【Administration \> OAI-PMH \> Sets 】：アイテムをグループ化する情報を設定可能。
    
      - 設定内容
        
          - Created、Updated：カレンダーから選択可能。  
            フォーマット：YYYY-MM-DD HH:MM:DD」  
            デフォルト：現在のシステム時刻を自動的に入れる
        
          - Spec：スペックの情報を入れる。ユニークとする。入力必須項目。
        
          - Name：セットの命名を入れる
        
          - Description：セットの説明を入れる
        
          - Search Pattern
    
      - 「保存（Save）」ボタンを押すと、設定されたセット内容をセット一覧に追加させ、メッセージをセット一覧に表示させる  
        メッセージ：「レコードが正常に作成されました。（Record was successfully saved）」
    
      - \[保存してもう一つ追加（Save Add Another）\]ボタンを押すと、設定されたセット内容をセット一覧に追加させ、他のセットを追加設定可能とする。
    
      - \[保存して編集を続ける（Save and Continue Editing）\]ボタンを押すと、設定されたセット内容をセット一覧に追加させ、該当セットの編集を続けることを可能とする。
    
      - Sets一覧は、更新日時降順で表示されている。

  - 使い方
    
      - 【ハーベスト機関元】
        
          - 【Administration \>コミュニティ管理（ Communities） \>コミュニティ（Community）】においてコミュニティを新規作成すると、  
            作成されたコミュニティに対して、【Administration \> OAI-PMH \> Sets】に以下のセットが自動作成される。  
            「Spec」：「user-」+ コミュニティID  
            「Name」：コミュニティID  
            「Updated」、「Created」：セット作成時間
        
          - OAISetにそれぞれのアイテムを登録する際は以下のコマンドを実行する。  
            「community\_id」：該当コミュニティ  
            「record\_id」：アイテムのuuid値

> docker-compose exec web invenio communities request -a community\_id record\_id

  - 【ハーベスト機関先】  
    ハーベスト設定画面での「Set Spec」に該当「Spec」値をいれば、登録アイテムをハーベストできる。

<!-- end list -->

  - 
<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > Invenio\_oaiserver

<!-- end list -->

  - > 処理概要

> 画面表示について

  - > 一覧タブ  
    > invenio\_oaiserver.admin.OAISetModelViewが継承しているModelViewからflask\_admin.model.base.index\_viewが呼び出され、db内のoaiserver\_setテーブルより情報を取得し画面に表示する。

  - > 編集タブ  
    > \[鉛筆\]ボタン押下時、invenio\_oaiserver.admin.OAISetModelViewが継承しているModelViewからflask\_admin.model.base.edit\_viewが呼び出され、db内のoaiserver\_setテーブルより情報を取得し編集画面へ遷移する。
    
      - > 編集画面で\[保存（Save）\]ボタンもしくは\[保存して編集を続ける（Save and Continue Editing）\]を押下時、flask\_admin.model.base.edit\_viewが呼び出され、編集内容をdb内のoaiserver\_setテーブルに保存し、更新する。

  - > 作成タブ  
    > 作成タブに遷移時、invenio\_oaiserver.admin.OAISetModelViewが継承しているModelViewからflask\_admin.model.base.create\_viewが呼び出される。
    
      - > 情報の入力後に\[保存（Save）\]ボタン押下すると、invenio\_oaiserver.admin.OAISetModelViewが継承しているModelViewからflask\_admin.model.base.create\_viewが呼び出され、新しいSetの情報をdb内のoaiserverテーブルに保存する。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

10. ## Resource Sync
    
    1.  

##   

### Change List

  - > 目的・用途

公開インデックスごとに「Change List」、「Change Dump」を出力する

  - > 利用方法

【Administration \> Resource Sync \> Change List画面】で操作を行う

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - Change Listの仕様： <http://www.openarchives.org/rs/1.1/resourcesync#ChangeList>

  - Change Dumpの仕様： <http://www.openarchives.org/rs/1.1/resourcesync#ChangeDump>

  - 【Change List画面】で表示されるタブは、【Resource List画面】と同様である。[ADMIN-10-1: Resource List](\\l)を参照すること

  - 「List」タブにて存在するChange Listを一覧表示する
    
      - 「List」タブを表示するたびに最新の情報を取得する
    
      - 表示項目は以下の通りである
        
          - アクション（編集・削除を表すアイコン）
        
          - Repository
            
              - そのChange Listが対象とするインデックス
            
              - フォーマット：「{インデックスの英語名} \<ID:インデックスID\>」
        
          - Change List Url
            
              - 「Change List」のURLを表示する
        
          - Change Dump Url
            
              - 「Change Dump」のURLを表示する
        
          - Status
            
              - Private/Publish

  - 「Create」タブにて「Change List」、「Change Dump」レコードを作成する
    
      - 入力情報は以下の通りである
        
          - Status
            
              - インデックスのステータスを選択する
            
              - ラジオボタン：Publish、Private
            
              - デフォルト：選択無し
        
          - Repository
            
              - 対象とするインデックスを指定する
        
          - Publish date
            
              - フォーマット：MM/DD/YYYY
            
              - デフォルト：当日
        
          - Max change list
            
              - デフォルト：10000
        
          - Interval by date
            
              - 自動実行する日間隔を設定する
            
              - デフォルト：1
        
          - Change tracking state
            
              - チェックボックス：Created、Updated、Deleted
            
              - デフォルト：すべてのチェックボックスにチェックを入れる
        
          - Change dump manifest
            
              - 「Change Dump」ごとに「manifest.xml」ファイルを出力するかどうかを設定する
            
              - デフォルト：チェック無し
        
          - Change List uri
            
              - 「Repository」で選択しているインデックスに応じて、「Change List」のURIを自動的に表示する
            
              - テンプレートのURL：「https://{weko\_url}/resync/{Index ID}/changelist.xml」
            
              - 変更不可、無効の状態とする
        
          - Change Dump uri
            
              - 「Repository」で選択しているインデックスに応じて、「Change Dump」のURIを自動的に表示する
            
              - テンプレートのURL：「https://{weko\_url}/resync/{Index ID}/changedump.xml」
            
              - 変更不可、無効の状態とする
    
      - ［Create］ボタンを押すと、入力内容をチェックし、問題がなければ、「Change List」のレコードを作成し、「List」タブに移動する
        
          - エラーの場合は以下の通りである
            
              - 既に設定されたインデックスを選択している場合、以下のようなエラーメッセージを表示する  
                エラーメッセージ：「Selected repository has been registered already. Please select another repository.」
        
          - 「Status」がチェックなしのままでレコードを作成する場合は、Privateが設定される
    
      - ［Create and Add Another］ボタンを押すと、［Create］ボタンを押したときと同様の処理によって設定された内容のレコードを作成して、タブを移動せずに他の「Change List」を作成可能とする
    
      - ［Cancel］ボタンを押すと、設定された「Change List」を追加せずに、「List」タブに移動する

  - 公開インデックスごとに「Change List」、「Change Dump」を出力する
    
      - 「Status：Publish」の場合、「Change List」及び「Change Dump」を出力する
        
          - 「Change List」を出力する
            
              - 「List」タブより「Change List Url」列でのURLを押すと、ブラウザで該当する「Change List」を表示する
            
              - 「Change List」の表示項目は以下の通りである
                
                  - 表示フォーマット：XML
                
                  - 「capability.xml」のURL
                
                  - Capabilityのタイプ：changelist
                
                  - 該当インデックスに属される更新済みアイテム一覧の「Change List」
                    
                      - 日ごとにアイテムをまとめる
                    
                      - テンプレートのURL：「https://{weko\_url}/resync/{Index ID}/{YYYYMMDD}/changelist.xml」
                
                  - from-until：「Change List」ごとに対象日
                    
                      - フォーマット：YYYY-MM-DDThh:mm:ssZ
            
              - 「Change List一覧」のサンプル

> **\<urlset** xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:rs="http://www.openarchives.org/rs/terms/"**\>**
> 
> **\<rs:ln** href="https://18.182.214.241:8024/resync/capability.xml" rel="up"**/\>**
> 
> **\<rs:md** capability="changelist"**/\>**
> 
> **\<url\>**
> 
> **\<loc\>**https://18.182.214.241:8024/resync/1594710457918/20200717/changelist.xml**\</loc\>**
> 
> **\<rs:md** capability="changelist" from="2020-07-17T00:00:00Z" until="2020-07-18T00:00:00Z"**/\>**
> 
> **\</url\>**
> 
> **\<url\>**
> 
> **\<loc\>**https://18.182.214.241:8024/resync/1594710457918/20200718/changelist.xml**\</loc\>**
> 
> **\<rs:md** capability="changelist" from="2020-07-18T00:00:00Z" until="2020-07-19T00:00:00Z"**/\>**
> 
> **\</url\>**
> 
> **\<url\>**
> 
> **\<loc\>**https://18.182.214.241:8024/resync/1594710457918/20200719/changelist.xml**\</loc\>**
> 
> **\<rs:md** capability="changelist" from="2020-07-19T00:00:00Z" until="2020-07-20T00:00:00Z"**/\>**
> 
> **\</url\>**
> 
> **\<url\>**
> 
> **\<loc\>**https://18.182.214.241:8024/resync/1594710457918/20200720/changelist.xml**\</loc\>**
> 
> **\<rs:md** capability="changelist" from="2020-07-20T00:00:00Z" until="2020-07-20T08:59:58.606915Z"**/\>**
> 
> **\</url\>**
> 
> **\</urlset\>**

  - 「Change List」を出力する  
    出力された「Change List一覧」より、日ごとの「Change List」を出力する
    
      - 「Change List」に表示項目は以下の通りである
        
          - 表示フォーマット：XML
        
          - 「capability」のURL
        
          - 属される「Change List一覧」のURL
        
          - Capabilityのタイプ：changelist
        
          - アイテムに登録されているファイルのURL
        
          - \<lastmod\>：アイテムの更新日付
        
          - 「change」タイプ：created、updated、deleted
    
      - 「Change List」のサンプル

> **\<urlset** xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:rs="http://www.openarchives.org/rs/terms/"**\>**
> 
> **\<rs:ln** href="https://18.182.214.241:8024/resync/capability.xml" rel="up"**/\>**
> 
> **\<rs:ln** href="https://18.182.214.241:8024/resync/1594710457918/changelist.xml" rel="index"**/\>**
> 
> **\<rs:md** capability="changelist"**/\>**
> 
> **\<url\>**
> 
> **\<loc\>**https://18.182.214.241:8024/resync/1594710457918/records/55**\</loc\>**
> 
> **\<lastmod\>**2020-07-22T01:17:12.177328Z**\</lastmod\>**
> 
> **\<rs:md** at="2020-07-22T01:17:12.177328Z" change="created"**/\>**
> 
> **\</url\>**
> 
> **\</urlset\>**

  - 「Change Dump一覧」を出力する
    
      - 「Change List」の「List」タブより「Change Dump Url」列でのURLを押すと、該当する「Change Dump一覧」にアクセスする
    
      - 「Change Dump一覧」に表示項目は以下の通りである
        
          - 表示フォーマット：XML
        
          - 「capability」のURL
        
          - Capabilityのタイプ：changedump
        
          - 該当インデックスに属されるアイテムのZipパッケージにアクセスできる「Change Dump」
            
              - 日ごとにアイテムをまとめる
            
              - テンプレートのURL：「https://{weko\_url}/resync/{Index ID}/{YYYYMMDD}/changelist.xml」
        
          - from-until：「Change Dump」ごとに対象日
            
              - フォーマット：YYYY-MM-DDThh:mm:ssZ
    
      - 「Change Dump一覧」のサンプル

> **\<urlset** xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:rs="http://www.openarchives.org/rs/terms/"**\>**
> 
> **\<rs:ln** href="https://18.182.214.241:8024/resync/capability.xml" rel="up"**/\>**
> 
> **\<rs:md** capability="changedump"**/\>**
> 
> **\<url\>**
> 
> **\<loc\>**https://18.182.214.241:8024/resync/1594710457918/20200717/changedump.xml**\</loc\>**
> 
> **\<rs:md** capability="changedump" from="2020-07-17T00:00:00Z" until="2020-07-18T00:00:00Z"**/\>**
> 
> **\</url\>**
> 
> **\<url\>**
> 
> **\<loc\>**https://18.182.214.241:8024/resync/1594710457918/20200718/changedump.xml**\</loc\>**
> 
> **\<rs:md** capability="changedump" from="2020-07-18T00:00:00Z" until="2020-07-19T00:00:00Z"**/\>**
> 
> **\</url\>**
> 
> **\<url\>**
> 
> **\<loc\>**https://18.182.214.241:8024/resync/1594710457918/20200719/changedump.xml**\</loc\>**
> 
> **\<rs:md** capability="changedump" from="2020-07-19T00:00:00Z" until="2020-07-20T00:00:00Z"**/\>**
> 
> **\</url\>**
> 
> **\<url\>**
> 
> **\<loc\>**https://18.182.214.241:8024/resync/1594710457918/20200720/changedump.xml**\</loc\>**
> 
> **\<rs:md** capability="changedump" from="2020-07-20T00:00:00Z" until="2020-07-20T09:01:55.926748Z"**/\>**
> 
> **\</url\>**
> 
> **\</urlset\>**

  - 「Change Dump」を出力する  
    出力された「Change Dump一覧」より、日ごとの「Change Dump」を出力する
    
      - 「Change Dump」に表示項目は以下の通りである
        
          - 表示フォーマット：XML
        
          - 「capability」のURL
        
          - 属される「Change Dump一覧」のURL
        
          - Capabilityのタイプ：changedump
        
          - アイテムに登録されているファイルのZipパッケージのURL
        
          - \<lastmod\>：アイテムの更新日付
    
      - 「Change Dump」のサンプル

> **\<urlset** xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:rs="http://www.openarchives.org/rs/terms/"**\>**
> 
> **\<rs:ln** href="https://18.182.214.241:8024/resync/capability.xml" rel="up"**/\>**
> 
> **\<rs:ln** href="https://18.182.214.241:8024/resync/1594710457918/changedump.xml" rel="index"**/\>**
> 
> **\<rs:md** capability="changedump"**/\>**
> 
> **\<url\>**
> 
> **\<loc\>**https://18.182.214.241:8024/resync/1594710457918/49.1/change\_dump\_content.zip**\</loc\>**
> 
> **\<lastmod\>**2020-07-21T03:47:43.254174Z**\</lastmod\>**
> 
> **\<rs:md** from="2020-07-21T03:47:43.254174Z" type="application/zip" until="2020-07-21T05:44:21.697630Z"**/\>**
> 
> **\</url\>**
> 
> **\<url\>**
> 
> **\<loc\>**https://18.182.214.241:8024/resync/1594710457918/50.1/change\_dump\_content.zip**\</loc\>**
> 
> **\<lastmod\>**2020-07-21T05:43:05.066272Z**\</lastmod\>**
> 
> **\<rs:md** from="2020-07-21T05:43:05.066272Z" type="application/zip" until="2020-07-21T05:44:21.698327Z"**/\>**
> 
> **\</url\>**
> 
> **\</urlset\>**

  - 「Status：Private」の場合、、または対象インデックスが「公開しない」と設定する場合、「Change List」及び「Change Dump」を出力すると、以下のようなエラーメッセージを表示する  
    エラーメッセージ：  
    　　　　　　　JP：「ページが見つかりません。」  
    　　　　　　　EN：「Page not found」

<!-- end list -->

  - 「List」タブ各行の鉛筆アイコンをクリックすると、「Edit」タブに移動してその行のレコードを表示し、内容を編集できる
    
      - 入力情報は、「Create」タブと同じである
    
      - ［Save］ボタンを押すと、編集内容を保存して「List」タブに移動する
    
      - ［Cancel］ボタンを押すと、編集内容を保存せず「List」タブに移動する

  - 「List」タブ各行のごみ箱アイコンをクリックすると、確認ダイアログを表示する  
    メッセージ：「Are you sure to delete it ?」
    
      - ［OK］ボタンを押すと、該当レコードを削除する
    
      - ［キャンセル］ボタンを押すと、確認ダイアログを閉じる

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > invenio\_resourcesyncserver

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 本画面では、changelist\_indexesテーブルの情報を閲覧、作成、編集、削除する
    
      - 画面表示時に、invenio\_resourcesyncserver.admin.AdminChangeListView.indexメソッドによってテンプレートを指定する
        
          - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-resourcesyncserver/invenio_resourcesyncserver/config.py#L25>
        
          - 設定キー：INVENIO\_RESOURCESYNC\_CHANGE\_LIST\_ADMIN
    
      - 「List」タブの表示時に、同クラスのget\_listメソッドによってテーブルの情報を全件取得する
        
          - 画面の「Change List Url」と「Change Dump Url」の表示内容は、内容の表示時にchange\_list.js中でそれぞれ「url\_path」フィールドの値に「/changelist.xml」「/changedump.xml」を結合して作成している
        
          - 「status」フィールドは真偽値であるが、内容の表示時にchange\_list.js中でフィールドの値によって「Publish」か「Private」を表示するようにしている
    
      - 「Create」タブで［Create］ボタンを押したとき、同クラスのcreateメソッドによって、テーブルに対象インデックスについてのレコードがない場合に、新たにレコードを作成する
        
          - 対象インデックスについてのレコードがすでにあった場合には、作成せずに以下のコンフィグで指定されたメッセージを返す
            
              - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-resourcesyncserver/invenio_resourcesyncserver/config.py#L44-L45>
            
              - 設定キー：VALIDATE\_MESSAGE
    
      - 「Edit」タブで［Save］ボタンを押したとき、同クラスのupdateメソッドによってレコードを更新する
    
      - 「List」タブでごみ箱アイコンを押したとき、同クラスのdeleteメソッドによってレコードを物理削除する

  - 公開インデックスごとに「Change List」、「Change Dump」を出力する
    
      - 「Change List」を出力する
        
          - 「List」タブにて「Change List Url」列のURLを押すと、invenio\_resourcesyncserver.views. change\_list\_index関数が呼び出される
            
              - この中で、invenio\_resourcesyncserver.api. ChangeListHandler. get\_change\_list\_indexメソッドによってchangelist.xmlを出力する
    
      - 「Change Dump」を出力する
        
          - 「List」タブにて「Change Dump Url」列のURLを押すと、invenio\_resourcesyncserver.views. change\_dump\_index関数が呼び出される
            
              - この中で、invenio\_resourcesyncserver.api. ChangeListHandler. get\_change\_dump\_indexメソッドによってchangedump.xmlを出力する

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### Resync

  - > 目的・用途

resyncを利用して外部機関からデータを収集する

  - > 利用方法

【Administration \> Resource Sync \> Resync画面】にて操作を行う

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - resync: <https://github.com/resync/resync>

  - 【Resync画面】には以下のタブが表示される
    
      - List
    
      - Create
    
      - Edit
        
          - > Listタブ選択中は非表示
        
          - Listタブの操作によって表示される
        
          - EditタブまたはDetailsタブ選択中に表示
    
      - Detail
        
          - > Listタブ選択中は非表示
        
          - Listタブの操作によって表示される
        
          - EditタブまたはDetailタブ選択中に表示

  - 「List」タブにて存在するResync Indexを一覧表示する
    
      - 「List」タブを表示するたびに最新の情報を取得する
    
      - 表示項目は以下の通りである
        
          - アクション（詳細・編集・削除を表すアイコン）
        
          - Repository name
            
              - そのResyncの名前
        
          - Target Index
            
              - そのResyncが対象とするインデックス
            
              - フォーマット：「{インデックスの英語名} \<ID:インデックスID\>」
        
          - Base Url
            
              - データ取得先のURL
        
          - Status
            
              - Manual/ Automatic
        
          - Resync mode
            
              - Baseline/Incremental/Audit
        
          - Saving format
            
              - JPCOAR-XMLのみ

  - 「Create」タブにて「Resync」を作成する
    
      - 入力情報は以下の通りである
        
          - Repository name：データ取得先のリポジトリ名称。必須項目。テキストを入力
        
          - Base Url：データ取得先のURL。必須項目。テキストを入力
        
          - Status
            
              - ラジオボタン：Manual、Automatic
            
              - 「Automatic」を選択する場合、「Interval By Day」の入力エリアを表示する
            
              - デフォルト：Automatic
        
          - Interval By Day：自動実行する間隔
        
          - Statusが「Automatic」の場合のみに表示する
            
              - 入力欄は空にできず、1以上の整数のみ設定可能
            
              - デフォルト：1
        
          - From Date：期間‐開始日時。カレンダーから選択
        
          - Until Date：期間‐開始日時。カレンダーから選択
        
          - Target Index：収集されたアイテムに対して登録先インデックスを指定。必須項目。インデックスツリー一覧から選択
        
          - Resync Mode
            
              - 選択肢：Audit、Baseline、Incremental
                
                  - Baselineの時に、resourcelistのURLのみを「Base URL」に指定できる  
                    ResourceListを使ってその中の日付をベースにデータを取得しているので、From date/Until dateの指定は不要になる
                
                  - Incrementialの時に、changelistのURLのみを「Base URL」に指定できる
                
                  - Auditの時に、Sourceサーバーと実行しているかどうか、  
                    ResourceListの変更があるかどうかチェックする機能なのでImportボタンを表示されない
            
              - デフォルト：Baseline
        
          - Saving format
            
              - 値：JPCOAR-XML
    
      - ［Create］ボタンを押すと、入力内容をチェックし、問題がなければ、「Resync」のレコードを作成し、「List」タブに移動する
        
          - エラーの場合は以下の通りである
            
              - 必須項目を入力しない場合、以下のようなエラーメッセージを表示する  
                エラーメッセージ：「{項目名} is required」
    
      - ［Create and Add Another］ボタンを押すと、［Create］ボタンを押したときと同様の処理によって設定された内容のレコードを作成して、他の「Resync」を作成可能とする
    
      - ［Cancel］ボタンを押すと、設定された「Resync」を追加せずに、「List」タブに移動する

  - 外部機関からデータを「Manual」で収集する
    
      - 「Status：Manual」を設定するresyncに対して「Detail」タブにて、「Action」での「Sync」ボタンを押すと、当該画面上の設定内容を元にデータ収集を実行する
        
          - 以下のメッセージがポップアップで表示される
            
              - データ収集が開始された場合のメッセージ：「Sync Success」
            
              - データ収集が開始されなかった場合のメッセージ：「Error in Sync」
        
          - データ収集が完了した後、「Import」ボタンを押すと、収集されたデータをシステムに登録する
        
          - 以下のメッセージがポップアップで表示される
            
              - 登録が開始された場合のメッセージ：「Import Success」
            
              - 登録が開始されなかった場合のメッセージ：「Error in Import」

  - 外部機関からデータを「Automatic」で収集する
    
      - 「Status：Automatic」を設定するresyncに対して  
        【Admin \> Resource Sync \> Resync画面】での「Detail」タブにて、「Running」で収集処理が自動実行するかどうかを設定する
        
          - ONを表示している場合、設定された実行間隔で収集処理を自動実行する  
            ONを押すと、OFFに変更する
        
          - OFFを表示している場合、収集処理は実行しない  
            OFFを押すと、ONに変更する

  - 収集情報の実行履歴を確認する「Detail」タブにて、「Running logs」エリアに実行履歴を表形式で表示する
    
      - 収集処理が完了するまで、3秒ごとに取得して表示エリアを更新し続ける
    
      - 表示項目は以下の通りである
        
          - \#
            
              - ログ番号
        
          - Start Time
        
          - 収集処理を開始した時点の日時
        
          - End Time
        
          - 収集処理を完了した時点の日時
        
          - Status
            
              - コンフィグ「INVENIO\_RESYNC\_LOGS\_STATUS」で設定されたもの
            
              - Successful
                
                  - Running
                
                  - Failed
        
          - Log Type
            
              - sync
            
              - import
        
          - Processed Items
        
          - Created Items
        
          - Updated Items
        
          - Deleted Items
        
          - Error Items
        
          - Error Message, Url
            
              - 収集処理が異常終了で終了したときにメッセージとリクエストURLが表示される

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > invenio\_resourcesyncclient

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 本画面では、resync\_indexesテーブルの情報を閲覧、作成、編集、削除して、その情報をもとにデータ収集を行う
    
      - 画面表示時に、invenio\_resourcesyncclient.admin. AdminResyncClient.indexメソッドによってテンプレートを指定する
        
          - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-resourcesyncclient/invenio_resourcesyncclient/config.py#L22>
        
          - 設定キー：INVENIO\_RESOURCESYNCCLIENT\_ADMIN\_TEMPLATE
    
      - 「List」タブの表示時に、同クラスのget\_listメソッドによってテーブルの情報をid昇順で取得する
    
      - 「Create」タブで［Create］ボタンを押したとき、同クラスのcreateメソッドによって、テーブルに対象インデックスについてのレコードがない場合に、新たにレコードを作成する
        
          - 「resync\_save\_dir」フィールドの値は、以下のコンフィグで指定する文字列にレコードのidを加えた文字列を設定する
            
              - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-resourcesyncclient/invenio_resourcesyncclient/config.py#L51>
            
              - 設定キー：INVENIO\_RESYNC\_SAVE\_PATH
    
      - 「Edit」タブで［Edit］ボタンを押したとき、同クラスのupdate\_resyncメソッドによってレコードを更新する
    
      - 「List」タブでごみ箱アイコンを押したとき、同クラスのdelete\_resyncメソッドによって該当レコードを物理削除する

  - データ収集は、Sync（データ収集）とImport（データ登録）の２段階で行う
    
      - 以下の場合に、invenio\_resourcesyncclient.tasks. resync\_sync関数が非同期で呼び出される
        
          - Detailタブで、「Action」で［Sync］ボタンを押す
        
          - Detailタブで、「Running」でボタンを［ON］にする
        
          - 「Running」のボタンが［ON］の状態で、前回実行時から（interval\_by\_day）日経過したときにrun\_sync\_auto関数が実行される
    
      - resync\_sync関数の中で、invenio\_resourcesyncclient.utils. process\_sync関数によってSyncを行う
        
          - resync\_sync関数が呼び出されると、画面には200のレスポンスが返却される
        
          - ログのLog Typeは「sync」となる
        
          - 処理が終了したとき、ログのStatusは結果にかかわらず「Successful」となる
        
          - resync\_indexesテーブルで、引数のidと等しいidのレコードの情報を用いる
        
          - 以下の場合に、ValueErrorが発生する
            
              - base\_urlフィールドで指定されたxmlファイルのcapabilityを取得できなかった場合
            
              - resync\_modeが「Baseline」で、取得したcapabilityが「resourcelist」でも「resourcedump」でもない場合
            
              - resync\_modeが「Audit」で、取得したcapabilityが「resourcelist」でも「changelist」でもない場合
        
          - 以下の場合に例外クラスを指定しない例外が発生する
            
              - resync\_modeが「Incremental」で、取得したcapabilityが「changelist」でも「changedump」でもない場合
        
          - resync\_modeが「Baseline」または「Audit」のとき、resyncのbaseline\_or\_audit関数によってデータ収集を行う
            
              - baseline\_or\_audit関数については以下を参照
                
                  - <https://github.com/resync/resync/blob/v1.0.9/resync/client.py#L241-L326>
        
          - resync\_modeが「Incremental」のとき、resyncのincremental関数によってSyncを行う
            
              - incremental関数については以下を参照
                
                  - <https://github.com/resync/resync/blob/v1.0.9/resync/client.py#L328-L474>
    
      - 以下の場合に、invenio\_resourcesyncclient.tasks. run\_sync\_import関数が非同期で呼び出される
        
          - Detailタブで、「Action」で［Import］ボタンを押す
        
          - statusが「Automatic」かつresync\_modeが「Audit」でSyncが終了する
            
              - Sync終了時に呼び出されるfinish関数の中で呼び出す
        
          - 「Running」のボタンが［ON］の状態で、前回実行時から（interval\_by\_day）日経過したときにrun\_sync\_auto関数が実行されるようにceleryタスクに登録される
    
      - run\_sync\_import関数の中で、invenio\_resourcesyncclient.utils. process\_item関数によってImportを行う
        
          - run\_sync\_import関数が呼び出されると、画面には200のレスポンスが返却される
        
          - そのResyncでBase Urlに指定したxmlファイルの情報をもとに登録を行う

  - invenio\_resourcesyncclient.tasks. resync\_sync関数、invenio\_resourcesyncclient.tasks. run\_sync\_import関数の中で、invenio\_resourcesyncclient.tasks. prepare\_log関数によってログを作成する
    
      - 作成したログは、resync\_logsテーブルに保存する

  - Detailタブを表示したとき、および［Sync］ボタンまたは［Import］ボタンを押して200のレスポンスを受け取ったときに、resync\_client.jsのhandleGetLogs関数が呼び出される
    
      - handleGetLogs関数の中で、invenio\_resourcesyncclient.admin. AdminResyncClient. get\_logsメソッドによってresync\_logsテーブルからログを取得する
    
      - 取得したテーブルのend\_timeフィールドが空だった場合には、3000ミリ秒後に再度handleGetLogs関数を実行する

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

11. ## レコード管理
    
    1.  

##   

### レコードメタデータ

  - > 目的・用途

本機能は、レコードメタデータの閲覧、削除、復元の際に用いる機能である

  - > 利用方法

【Administration \> レコード管理（Records） \> レコードメタデータ（Record Metadata）画面】にて操作を行う

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【レコードメタデータ（Record Metadata）画面】には以下のタブが表示される
    
      - 一覧（List）
        
          - このタブの表示中のみ、タブ名の末尾に件数が表示される
    
      - フィルターを追加▼（Add Filter▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 選択▼（With selected▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 詳細（Details）
        
          - 一覧（List）タブ選択中は非表示一覧（List）タブでの操作によって表示される

  - 「一覧」（List）タブにてレコードメタデータを一覧表示する
    
      - 表示項目は以下のとおりである
        
          - アクション（閲覧・削除を表すアイコン）
        
          - UUID
        
          - Status
        
          - Revision
        
          - Updated
        
          - Created
    
      - 「フィルターを追加▼」（Add Filter▼）タブをクリックすると、以下の追加可能なフィルターリストを表示し、フィルター名をクリックすると当該フィルタの入力エリアを追加する
        
          - フィルター名は以下の通りである
            
              - Created
                
                  - フィルター方式の選択肢：等しい（equals）、等しくない（not equal）、より大きい（greater than）、より小さい（smaller than）、間（between）、間ではなく（not between）、空（empty）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - Updated
                
                  - フィルター方式の選択肢：上記のCreatedと同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
        
          - 設定したフィルターは［適用（Apply）］ボタンを押下することで一覧に適用される
        
          - ［フィルターをリセット（Reset filter）］ボタンを押下すると、設定したフィルターがリセットされる
    
      - 「選択▼」（With selected▼）タブをクリックすると、以下の追加可能な機能（現在削除ボタンのみ）を表示する
        
          - レコードにチェックを入れない場合、［削除（Delete）］ボタンを押すと、エラーメッセージを表示する  
            メッセージ：  
            　日本語：「少なくとも1つのレコードを選択してください。」  
            　英語：「Please select at least one record.」
        
          - レコードにチェックを入れる場合、［削除（Delete）］ボタンを押すと、確認ダイアログを表示する  
            メッセージ：  
            　日本語：「選択したレコードを削除してもよろしいですか。」  
            　英語：「Are you sure you want to delete selected records?」
            
              - ［OK］ボタンを押すと、該当レコードメタデータを削除状態に変更し、メッセージを画面上部に表示する  
                メッセージ：  
                　日本語：「レコード数＋レコードが正常に削除されました。」  
                　英語：「Record was successfully deleted.」
            
              - ［キャンセル（Cancel）］ボタンを押すと、確認ダイアログを閉じる
        
          - この操作を行ったレコードは、詳細（Details）タブを表示するとJSONが「null」に変化している
            
              - 一覧（List）タブでも詳細（Details）タブでもStatusは変化しない
    
      - レコードメタデータ行にて目アイコンを押すと、該当レコードメタデータの詳細情報を詳細（Details）タブに表示する
    
      - レコードメタデータ行にてごみ箱アイコンを押すと、該当レコードメタデータを物理削除し、メッセージを画面上部に表示する  
        メッセージ：  
        　日本語：「レコード数＋レコードが正常に削除されました。」  
        　英語：「Record was successfully deleted.」

  - 詳細（Details）タブでは、該当レコードメタデータの詳細情報を表示する
    
      - 表示項目：UUID、Status、Revision、Updated、Created、JSON
    
      - ［削除（Delete）］ボタンは以下のようにふるまう
        
          - このボタンは、StatusがDELETED以外のときに押すことができる
        
          - このボタンを押すと、以下のメッセージがポップアップで表示される
            
              - 日本語：「サーバ内部エラー」
            
              - 英語：「Internal server error」
    
      - ［復元（Restore）］ボタンは以下のようにふるまう
        
          - このボタンは、StatusがDELETEDのときに押すことができる
        
          - このボタンを押すと、ページ未検出エラーの画面に遷移する

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - invenio\_records：画面を定義

  - weko\_records：soft\_delete処理と復元処理を定義

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 本画面は、flaskのModelViewでrecords\_metadataテーブルの内容を閲覧、編集、削除する際に用いる機能である

  - 画面で表示されるstatusはテーブルに含まれない項目で、情報取得時にpidstore\_pidテーブルから以下の条件を満たすレコードのstatusを取得している
    
      - pid\_typeが「recid」
    
      - object\_uuidがrecords\_metadataテーブルでのidと一致する

  - v0.9.22では、詳細（Details）タブでの操作は必ずエラーが発生するようになっている
    
      - ［削除（Delete）］ボタンを押したときには'/soft\_delete/\<string:id\>'の形で、［復元（Restore）］ボタンを押したときには'/restore/\<string:id\>'の形でリクエストのURLを作成するが、適切に作成できていない
        
          - ModelViewでDetailsを表示すると、URL末尾に「\&url=...」が入るようになっている
        
          - リクエストのURLは、ボタンを押したときの画面のURLから「detail」を置換して「id=」を取り除いて作成しており、末尾の「\&url=...」がそのままになっているため不正なidを指定した状態になる
        
          - これによって、soft\_delete関数やrestore関数に到達しない
            
              - テンプレートにて、［削除（Delete）］ボタンを押してエラーが発生した場合にメッセージを表示するようになっているが、［復元（Restore）］ボタンの場合にはエラー発生時の記述がないためページ未検出エラーの画面に遷移する
    
      - DetailsタブのURLから末尾の「\&url=...」を取り除いたものでも同様の画面を表示できるため、その状態でボタンを押すことで各関数に到達することができる

  - 一覧（List）タブにて、レコードをチェックして「選択▼」（With selected▼）タブの［削除（Delete）］ボタンを押すと、チェックしたレコードごとにinvenio\_records.admin. RecordMetadataModelView.delete\_modelメソッドが呼び出される
    
      - 該当レコードのJSONが「null」だった場合は処理を終了する
    
      - invenio\_records.api Record.deleteメソッドによって、該当レコードのJSONを「null」にする

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

12. ## ファイル管理
    
    1. 

##   

### ファイルインスタンス

  - > 目的・用途

本機能は、管理者として、アップロードしているファイルを管理する機能である

  - > 利用方法

【Administration \> ファイル管理（Files） \> ファイルインスタンス（File Instance）画面】からファイルインスタンスを表示する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【ファイルインスタンス(File Instance)画面】には以下のタブが表示される
    
      - 一覧（List）
    
      - フィルターを追加▼（Add Filter▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 選択▼（With selected▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 詳細（Details）
        
          - > 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 詳細（Details）タブ選択中に表示

  - 「一覧」（List）タブにアップロードしているファイルを表示する
    
      - 表示項目は以下の通りである
        
          - チェックボックス
        
          - アクション（閲覧）
        
          - 「ID」：ファイルのID
        
          - 「URI」：ファイルのURI  
            「Location」画面に設定している配置先を元に、ファイルのURIを指定する  
            押下すると一覧のロケーションをソートする。
        
          - 「Storage Class」：S（Standard）、A（Archive）  
            押下すると一覧のロケーションをソートする。
        
          - 「Size」：ファイルの容量値  
            押下すると一覧のロケーションをソートする。
        
          - 「Checksum」  
            押下すると一覧のロケーションをソートする。
        
          - 「Readable」  
            押下すると一覧のロケーションをソートする。
        
          - 「Writable」  
            押下すると一覧のロケーションをソートする。
        
          - 「Fixity」  
            押下すると一覧のロケーションをソートする。
        
          - 「Checked」  
            押下すると一覧のロケーションをソートする。
        
          - 「Created」  
            フォーマット：「YYYY-MM-DD hh:mm:ss.tttttt」  
            押下すると一覧のロケーションをソートする。
        
          - 「Updated」  
            フォーマット：「YYYY-MM-DD hh:mm:ss.tttttt」  
            押下すると一覧のロケーションをソートする。
        
          - 「Objects」リンク  
            リンクをクリックすると、【Administration \> ファイル管理（Files）\>オブジェクトバージョン（Object Version）画面】に移動し、該当オブジェクトバージョンがフィルターされる
    
      - 「フィルターを追加▼」（Add Filter▼）ボタンをクリックすると、以下の追加可能なフィルターリストを表示し、フィルター名をクリックすると当該フィルタの入力エリアを追加する
        
          - フィルター名
            
              - 「ID」
            
              - > フィルター方式の：等しい（equals）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「URI」
            
              - > フィルター方式の選択肢：含む（contains）、含まれていません（not contains）、等しい（equals）、等しくない（not equal）、空（empty）、一覧にある（in list）、一覧にない（not in list）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Storage Class」
            
              - > フィルター方式の選択肢：「URI」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Size」
            
              - > フィルター方式の選択肢：等しい（equals）、等しくない（not equal）、より大きい（greater than）、より小さい（smaller than）、空（empty）、一覧にある（in list）、一覧にない（not in list）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Checksum」
            
              - > フィルター方式の選択肢：「URI」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Readable」
            
              - > フィルター方式の選択肢：等しい（equals）、等しくない（not equal）
                
                  - 選択したフィルター方式に対して「はい」「いいえ」
            
              - 「Writable」
            
              - > フィルター方式の選択肢：「Readable」と同じである
                
                  - 選択したフィルター方式に対して「はい」「いいえ」
            
              - 「Fixity」
            
              - > フィルター方式の選択肢：「Readable」と同じである
                
                  - 選択したフィルター方式に対して「はい」「いいえ」
            
              - 「Checked」
            
              - > フィルター方式の選択肢：等しい（equals）、等しくない（not equal）、より大きい（greater than）、より小さい（smaller than）、間（between）、間ではなく（not between）、空（empty）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Created」
            
              - > フィルター方式の選択肢：「Checked」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Updated」
            
              - > フィルター方式の選択肢：「Checked」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Files Object / Created」
            
              - > フィルター方式の選択肢：「Checked」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Files Object / Updated」
            
              - > フィルター方式の選択肢：「Checked」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Files Object / Key」
            
              - > フィルター方式の選択肢：「URI」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Files Object /Root File id」
                
                  - フィルター方式の選択肢：「ID」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Files Object / Mimetype」
            
              - > フィルター方式の選択肢：「URI」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Files Object / Is Head」
            
              - > フィルター方式の選択肢：「Readable」と同じである
                
                  - 選択したフィルター方式に対して「はい」「いいえ」
            
              - 「Files Object / Created User Id」
            
              - > フィルター方式の選択肢：「Size」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Files Object / Updated User Id」
            
              - > フィルター方式の選択肢：「Size」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Files Object / Is Show」
            
              - > フィルター方式の選択肢：「Readable」と同じである
                
                  - 選択したフィルター方式に対して「はい」「いいえ」
            
              - 「Files Object / Is Thumbail」
            
              - > フィルター方式の選択肢：「Readable」と同じである
                
                  - 選択したフィルター方式に対して「はい」「いいえ」
        
          - 設定したフィルターは「適用」（Apply）ボタンを押下することで一覧に適用される
        
          - 「フィルターをリセット」（Reset Filters）ボタンを押下すると、設定したフィルターがリセットされる
    
      - 「選択▼」（With selected▼）ボタンをクリックすると、以下の追加可能な機能を表示する  
        機能：「Run fixity check」
        
          - レコードにチェックを入れない場合、「Run fixity check」ボタンを押すと、エラーメッセージを表示する  
            メッセージ：  
            　日本語：「少なくとも一つのレコードを選択してください。」  
            　英語：「Please select at least one record.」
        
          - レコードにチェックを入れる場合、「Run fixity check」ボタンを押すと、「checksum」値の確認を行う
            
              - 表示している「checksum」値が実際の「checksum」値と一致する場合
                
                  - 以下のメッセージを画面上部に表示する  
                    メッセージ：「Fixity check(s) sent to queue.」
                
                  - 実行の時間を「Checked」に更新する
            
              - 表示している「checksum」値が実際の「checksum」値と一致しない場合
                
                  - 表示している「checksum」値が空白になる
                
                  - 実行の時間を「Checked」に更新する
    
      - 検索テキストボックスでユーザーを検索する  
        プレースホルダー：「Search: URI, size, checksum」
        
          - 任意テキストを入力し、キーボードでの「Enter」を押すと、ファイルインスタンス検索を行う
        
          - テキストボックスの右端での「X」ボタンを押すと、検索条件がクリアーされる
    
      - ファイルインスタンス左端の行の目アイコンを押すと、該当ファイルインスタンスの詳細情報を「詳細」（Details）タブに表示する
        
          - 表示項目：ID、URIl、Storage Class、Size、Checksum、Readable、Writable、Fixity、Checked、Created、Updated、Objects
        
          - 「Objects」リンクをクリックすると、【Administration \> Files (ファイル管理)\> Object Version(オブジェクトバージョン)画面】に移動し、該当オブジェクトバージョンがフィルターされる

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > invenio-files-rest

<!-- end list -->

  - > 処理概要

> ファイルインスタンス画面の処理について

  - ファイルインスタンス画面を表示すると、invenio\_files\_rest.admin.FileInstanceModelViewが継承したModelViewのBaseModelViewより、flask\_admin.model.base.BaseModelView.index\_viewを呼び出す。このメソッドでfiles\_filesテーブルからバケット情報を取得し、FileInstanceModelView.column\_listのキーに対応する情報を表示する。
    
      - ファイルインスタンス詳細画面を表示する。invenio\_files\_rest.admin.FileInstanceModelViewが継承したModelViewのBaseModelViewよりflask\_admin.model.base.BaseModelView.details\_viewを呼び出す。このメソッド下でfiles\_filesテーブルよりバケット情報を取得し、FileInstancetModelViewのcolumn\_details\_listのキーに対応する情報をdetailsタブ画面に表示する。

> ファイルインスタンスを選択し、【With Selected (選択)】から【Run fixity check】を押下する。invenio\_files\_rest.admin.FileInstanceModelViewが継承したModelViewのBaseModelViewより、flask\_admin.model.base.BaseModelView.action\_viewを呼び出して使用する。invenio\_files\_rest.admin.FileInstanceModelView.action\_verify\_checksumを呼び出す。このメソッド下でinvenio\_files\_rest.tasks.verify\_checksumを呼び出してfiles\_filesテーブルのchecksumの値を確認し、last\_check\_atカラムを更新し、ファイルインスタンス画面のcheckedの欄に実行時間を表示する。
> 
> バケット情報を以下のようなデータベースに保存する

  - > テーブル名：「files\_files」

  - > フィールド名：  
    > ・「id」  
    > ・「uri」  
    > ・「storage\_class」  
    > ・「size」  
    > ・「checksum」  
    > ・「readable」  
    > ・「writable」  
    > ・「last\_check\_at」  
    > ・「last\_check」  
    > ・「created」  
    > ・「updated」

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### ロケーション

  - > 目的・用途

本機能は、管理者として、アップロードしているファイルの配置先及びロケーションごとの使用量の情報を管理する機能である

  - > 利用方法

【Administration \> ファイル管理（Files）\> ロケーション（Location）】から、ロケーションの情報の閲覧、編集、作成をする。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【ロケーション（Location）画面】には以下のタブが表示される
    
      - 一覧（List）
    
      - 作成（Create）
    
      - フィルターを追加▼（Add Filter▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 選択▼（With selected▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 編集（Edit）
        
          - > 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示
    
      - 詳細（Details）
        
          - > 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示

  - 「一覧」（List）タブにロケーション一覧を表示する
    
      - 表示項目は以下の通りである
        
          - チェックボックス
        
          - アクション（閲覧・編集・削除）
        
          - 「Type」：ロケーションタイプ  
            押下すると一覧のロケーションをソートする。
        
          - 「Name」  
            押下すると一覧のロケーションをソートする。
        
          - 「URI」  
            押下すると一覧のロケーションをソートする。
        
          - 「Default」：デフォルトの状態  
            押下すると一覧のロケーションをソートする。
        
          - 「Size」：使用量の情報  
            押下すると一覧のロケーションをソートする。
        
          - 「Quota Size」：ロケーションの使用上限  
            押下すると一覧のロケーションをソートする。
        
          - 「Created」：ロケーションの作成時間  
            フォーマット：「YYYY-MM-DD hh:mm:ss.tttttt」  
            押下すると一覧のロケーションをソートする。
        
          - 「Updated」：ロケーションの更新時間  
            フォーマット：「YYYY-MM-DD hh:mm:ss.tttttt」  
            押下すると一覧のロケーションをソートする。
        
          - 「Buckets」リンク  
            リンクをクリックすると、【Admin \> Files \> Bucket画面】に移動し、当該ロケーションが属するバケット一覧がフィルターされる
    
      - 「フィルターを追加▼」（Add Filter▼）ボタンをクリックすると、以下の追加可能なフィルターリストを表示し、フィルター名をクリックすると当該フィルタの入力エリアを追加する
        
          - フィルター名
            
              - > 「Default」
            
              - > フィルター方式の選択肢：等しい（equals）、等しくない（not equal）
                
                  - 選択したフィルター方式に対して「はい」「いいえ」
            
              - 「Created」
            
              - > フィルター方式の選択肢：等しい（equals）、等しくない（not equal）、より大きい（greater than）、より小さい（smaller than）、間（between）、間ではなく（not between）、空（empty）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Updated」
            
              - > フィルター方式の選択肢：「Created」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
        
          - 設定したフィルターは「適用」（Apply）ボタンを押下することで一覧に適用される
        
          - 「フィルターをリセット」（Reset filter）ボタンを押下すると、設定したフィルターがリセットされる
    
      - 「選択▼」（With selected▼）ボタンをクリックすると、以下の追加可能な機能（現在削除ボタンのみ）を表示する
        
          - レコードにチェックを入れない場合、「削除」（Delete）ボタンを押すと、エラーメッセージを表示する  
            メッセージ：  
            　日本語：「少なくとも一つのレコードを選択してください。」  
            　英語：「Please select at least one record.」
        
          - レコードにチェックを入れる場合、「削除」（Delete）ボタンを押すと、確認ダイヤログを表示する  
            メッセージ：  
            　日本語：「選択したレコードを削除してもよろしいですか。」  
            　英語：「Are you sure you want to delete selected records?」
            
              - 「OK」ボタンを押すと、該当ロールを削除し、メッセージを画面上部に表示する  
                メッセージ：  
                　日本語：「レコード数＋レコードが正常に削除されました。」  
                　英語：「Record was successfully deleted.」
            
              - 「キャンセル」（Cancel）ボタンを押すと、確認ダイヤログを閉じる
    
      - 検索テキストボックスでロケーションを検索する
        
          - プレースホルダー：「Search: URI, name」
        
          - 任意テキストを入力し、キーボードでの「Enter」を押すと、ロケーション検索を行う
        
          - テキストボックスの右端での「X」ボタンを押すと、検索条件がクリアーされる
    
      - ロケーション行に目アイコンを押すと、該当ロケーションの詳細情報を「詳細」（Details）タブに表示する
        
          - 表示項目：Type、Name、URI、Default、Size、Quota Size、Created、Updated、Buckets
        
          - 「Buckets」リンクをクリックすると、【Administration \> Files (ファイル管理) \> Bucket (バケット) 画面】に移動し、当該ロケーションが属するバケット一覧がフィルターされる
    
      - ロケーション行に鉛筆アイコンを押すと、該当ロケーションを「編集」（Edit）タブに表示し、ロケーションの情報が編集できる
    
      - ロケーション行に削除アイコンを押すと、該当ロケーションを削除し、メッセージを画面上部に表示する  
        メッセージ：  
        　日本語：「レコード数＋レコードが正常に削除されました。」  
        　英語：「Record was successfully deleted.」
    
      - 「一覧」（List）から「作成」（Create）タブを押すと、「編集」(edit)タブに移動しロケーションを新規作成できる
        
          - 入力情報：
            
              - 「Name」：必須項目  
                入力パターン：「^\[a-z\]\[a-z0-9-\]+$」
            
              - 「URI」：必須項目
            
              - 「Type」  
                選択肢：Amazon S3
            
              - 「access\_key」  
                「Type」に「Amazon S3」を選択する時表示する
            
              - 「secret\_key」  
                「Type」に「Amazon S3」を選択する時表示する
            
              - 「endpoint\_url」  
                「Type」に「Amazon S3」を選択する時表示する
            
              - > 「send\_file\_directrly」  
                > 「Type」に「Amazon S3」を選択する時表示するチェックボックス  
                > デフォルト：チェックあり
            
              - 「Quote Size」：使用上限
            
              - 「Default」  
                デフォルト：チェックなし
        
          - 「保存」（Save）ボタンを押すと、設定内容をバリデーションチェックし、エラーがない場合、設定されたロケーション内容をロケーション一覧に追加させ、メッセージをロケーション一覧に表示させる  
            メッセージ：  
            　日本語：「レコードが正常に作成されました。」  
            　英語：「Record was successfully created.」
            
              - アクセスコントロールをデータベースに保存する
                
                  - テーブル名：「files\_location」
                
                  - フィールド名：  
                    ・「id」  
                    ・「name」  
                    ・「uri」  
                    ・「default」  
                    ・「type」  
                    ・「access\_key」  
                    ・「secret\_key」  
                    ・「size」  
                    ・「quota\_size」  
                    ・「max\_file\_size」
        
          - エラーメッセージは以下の通りである
            
              - 必須項目を指定しない場合、エラーメッセージを該当テキストボックスの下に表示する  
                メッセージ：  
                　日本語：「このフィールドは必須です。」  
                　英語：「This field is required.」
            
              - 「Name」のフォーマットが不正の場合、エラーメッセージを「Name」テキストボックスの下に表示する  
                メッセージ：「Invalid location name.」
        
          - 「保存してもう一つ追加」（Save and Add Another）ボタンを押すと、設定されたロケーション内容をロケーション一覧に追加させ、他のロケーションを追加設定可能とする  
            メッセージを画面上部に表示させる  
            メッセージ：  
            　日本語：「レコードが正常に作成されました。」  
            　英語：「Record was successfully created.」
        
          - 「保存して編集を続ける」（Save and Continute Editing）ボタンを押すと、設定されたロケーション内容をロケーション一覧に追加させ、該当ロケーションの編集を続けることを可能とする  
            メッセージを画面上部に表示させる  
            メッセージ：  
            　日本語：「レコードが正常に作成されました。」  
            　英語：「Record was successfully created.」
        
          - 「キャンセル」（Cancel）ボタンを押すと、設定されたロケーション内容をロール一覧に追加せず、「一覧」（List）タブに戻る

  - ロケーションごとの使用量（Size）を確認できる
    
      - 「一覧」（List）タブ及び「詳細」（Detail）タブに確認できる
    
      - 「Size」の値について
        
          - 当該ロケーション配下に登録されているコンテンツファイルのサイズ合計
        
          - 使用量の合計はコンテンツアップロード時に集計する
        
          - 以下のファイルはシステムで自動削除し、使用量に集計されないようにする
            
              - ワークフローで強制終了したアクティビティに登録していたファイル
            
              - アイテム登録後に削除したファイル
        
          - ファイルアップロード時に Quota Size を越えるときの判定条件として利用する  
            Location で表⽰される Size ＋ アップロードした Size ＞ Quota Size で判定する

  - 設定キー：「update\_location\_size」

  - 合計された「Size」の値はデータベースに保存し、表示の際はデータベースに保存した値をつかう

  - リポジトリ管理者として、ストレージ使用状況をメール通知で確認できる  
    ロケーションの「Size」が指定された閾値を超えていた場合、当該ロケーションが属する機関のリポジトリ管理者にメール通知を行う
    
      - メール通知は定期実行とし、実行頻度はコンフィグファイルに変更可能とする
        
          - 設定キー：「storage\_check\_settings」
        
          - デフォルトは週次とする
    
      - ロケーションの「Size」が指定する閾値を超えた場合メール通知の対象する
    
      - ロケーションの「Quota Size」が設定されていない場合は処理の対象としない
    
      - 閾値はコンフィグファイルに指定する
        
          - 設定キー：「storage\_check\_settings」
        
          - デフォルトは、Quota Sizeに対して「80％」とする
    
      - 通知先は「リポジトリ管理者」ロールを持つユーザーとする
    
      - メール本文は以下の資料を参照する  
        別紙「ディスク容量メールひな形.docx」を参照。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > invenio-files-rest

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - ロケーション画面の処理
    
      - ロケーション画面を表示した際に、invenio\_files\_rest.admin.LocationModelViewが継承したModelViewよりflask\_admin.model.base.index\_viewメソッドが呼び出される。このメソッドでfiles\_locationテーブルより情報を取得し、LocationModelViewのcolumn\_listにあるキーに対応する情報を画面に表示する。
        
          - 目アイコンを押下してロケーション詳細情報を表示する際に、invenio\_files\_rest.admin.LocationModelViewが継承したModelViewよりflask\_admin.model.base.details\_viewメソッドを呼び出す。このメソッド下でfiles\_locationテーブルより情報を取得し、LocationModelViewのcolumn\_details\_listにあるキーに対応する情報を画面に表示する。
        
          - 鉛筆アイコンを押下して編集画面を表示する際に、invenio\_files\_rest.admin.LocationModelViewが継承したModelViewよりflask\_admin.model.base.edit\_viewメソッドをGETで呼び出す。このメソッドでidを用いて、files\_locationテーブルより情報を取得し、表示する。
            
              - 編集画面で「保存」ボタンを押下する。そうすると、flask\_admin.model.base.edit\_viewメソッドをPOSTで呼び出す。このメソッド下で、get\_save\_return\_urlメソッドが呼ばれ、編集内容をfiles\_locationテーブルに保存し、更新する。
        
          - 削除アイコンを押下した際に、invenio\_files\_rest.admin.LocationModelViewが継承したModelViewよりflask\_admin.model.base.delete\_viewメソッドをGETで呼び出してfiles\_locationテーブルから削除する。
    
      - 作成タブを押下した際に、invenio\_files\_rest.admin.LocationModelViewが継承したModelViewよりflask\_admin.model.base.create\_viewメソッドをGETで呼び出す。LocationModelViewのform\_columnsの項目の入力欄を表示する。
        
          - 入力欄に入力後「保存」ボタンを押下する。そうすると、invenio\_files\_rest.admin.LocationModelViewが継承したModelViewよりflask\_admin.model.base.create\_viewメソッドをPOSTで呼び出す。このメソッド下でget\_save\_return\_urlメソッドが呼ばれ、新しいバケットの情報をfiles\_bucketテーブルに保存する。

  - ロケーションの使用量合計はコンテンツアップロード時に集計する
    
      - パス：  
        <https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-files-rest/invenio_files_rest/utils.py#L123-L131>

  - メール通知の定期実行を設定する
    
      - パス:   
        <https://github.com/RCOSDP/weko/blob/v0.9.22/scripts/populate-instance.sh#L460-L462>
    
      - 設定キー：「storage\_check\_settings」
    
      - 現在の設定値：

> ${INVENIO\_WEB\_INSTANCE} admin\_settings create\_settings \\
> 
> 2 "storage\_check\_settings" \\
> 
> "{'threshold\_rate': 80, 'cycle': 'weekly', 'day': 0}"

  - バケットごとでの使用上限（QUOTA\_SIZE）を設定する
    
      - パス：   
        [o https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-deposit/weko\_deposit/config.py\#L27](file:///C:\\Users\\masah\\Documents\\機能仕様書\\o%09https:\\github.com\\RCOSDP\\weko\\blob\\v0.9.22\\modules\\weko-deposit\\weko_deposit\\config.py#L27)
    
      - 設定キー：「WEKO\_BUCKET\_QUOTA\_SIZE」
    
      - 現在の設定値：

> WEKO\_BUCKET\_QUOTA\_SIZE = 50 \* 1024 \* 1024 \* 1024 \# 50 GB

  - 一つのファイルの最大容量を設定する
    
      - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-deposit/weko_deposit/config.py#L30>
    
      - 設定キー：「WEKO\_MAX\_FILE\_SIZE」
    
      - 現在の設定値：

> WEKO\_MAX\_FILE\_SIZE = WEKO\_BUCKET\_QUOTA\_SIZE

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### マルチパートオブジェクト

  - > 目的・用途

本機能は、マルチパートアップロードが使用されているオブジェクトを閲覧する機能である。

※invenioデフォルト機能を使用

  - > 利用方法

【Administration \> ファイル管理(Files) \> マルチパートオブジェクト(Multipart Object)画面】を表示する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【ファイルインスタンス(File Instance)画面】には以下のタブが表示される
    
      - 一覧（List）
    
      - フィルターを追加▼（Add Filter▼）
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 選択（With selected）
    
      - 詳細（Details）
        
          - > 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 詳細（Details）タブ選択中に表示

  - 「一覧」（List）タブにマルチパートオブジェクト一覧を表示する。
    
      - 表示項目は以下の通りである。
        
          - アクセス（閲覧）
            
              - 目のマークを押すと「詳細」タブに遷移する。
        
          - 「Upload Id」
        
          - 「Complete」
        
          - 「Created」：アイテムの登録時間  
            フォーマット：YYYY-MM-DDThh:mm:ss.tttttt
        
          - 「Updated」アイテムの編集時間  
            フォーマット：YYYY-MM-DDThh:mm:ss.tttttt
        
          - 「Key」：ファイル名
        
          - 「Size」：ファイルサイズ
        
          - 「Created By」：ファイルアップロードしたユーザのメールアドレス
        
          - 「File」リンク
            
              - リンクをクリックすると、【Administration \> ファイル管理(Files) \> ファイルインスタンス(File Instance画面)】に移動し、該当ファイルがフィルターされる。RepositoryAdminはリンクではなくラベル。
            
              - フィルター条件：  
                「ID」：該当ファイルID
        
          - Item Bucket
            
              - 「Item Bucket（紐付済）」リンクをクリックすると【Administration \> ファイル管理(Files) \> バケット（Bucket）】に移動し、該当バケットがフィルタされる。RepositoryAdminの場合は、リンクではなくラベル。バケット未設定の場合は、「Unbind（未紐付）」ラベル表記される。
    
      - 「フィルターを追加▼」（Add Filter▼）ボタンをクリックすると、以下の追加可能なフィルターリストを表示し、フィルター名をクリックすると当該フィルタの入力エリアを追加する。
        
          - フィルター名
            
              - 「Upload Id」
                
                  - フィルター方式の選択肢：等しい(equals)
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「completed」
                
                  - フィルター方式の選択肢：等しい(equals)、等しくない(not equal)
                
                  - 選択したフィルター方式に対して「はい」「いいえ」
            
              - 「Created」
                
                  - フィルター方式の選択肢：等しい（equals）、等しくない（not equal）、より大きい（greater than）、より小さい（smaller than）、間（between）、間ではなく（not between）、空（empty）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Updated」
                
                  - フィルター方式の選択肢：「Created」と同じである。
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Item Bucket」
                
                  - フィルター方式の選択肢：「is Unbind」
                
                  - 入力された文字列は使わず、Unbind（未紐付）のレコードだけ
        
          - 設定したフィルターは「適用」（Apply）ボタンを押下することで一覧に適用される。
        
          - 「フィルターをリセット」（Reset filter）ボタンを押下すると、設定したフィルターがリセットされる。
    
      - 選択（With selected）ボタンをクリックすると、以下の一括処理可能な処理リストを表示し、処理をクリックすると選択したレコードに対して一括で処理を行う
        
          - 処理名
            
              - 削除（Delete）
    
      - 左端の目アイコンを押すと、該当オブジェクトバージョンの詳細情報を「詳細」（Details）タブに表示する
        
          - 表示項目は一覧タブで表示されたものと同じである。
    
      - 左端のゴミ箱アイコンを押すと、該当オブジェクトバージョンを削除する
    
      - 「完了済みかつ紐付先あり」または、レコードが排他中の場合は削除エラーとなる。「File」リンクをクリックすると、【Administration \> ファイル管理(Files) \> ファイルインスタンス(File Instance)画面】に移動し、該当ファイルがフィルターされる。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > Invenio\_files\_rest

  - > flask-admin:  
    > <https://github.com/flask-admin/flask-admin/blob/e764f6f0be3facbefb2b4d30b5c3f2f2c630d530/flask_admin/model/base.py>

<!-- end list -->

  - > 処理概要

> マルチパートオブジェクト画面の処理について

  - マルチパートオブジェクト画面を表示する。この操作によって、invenio\_files\_rest.admin. MultipartObjectModelViewが継承したModelViewよりflask\_admin.model.base.index\_viewメソッドを呼び出す。このメソッドでfiles\_multipartobjectテーブルよりバケット情報を取得し、MultipartObjectModelViewのcolumn\_listにあるキーに対応する情報を画面に表示する。
    
      - マルチパートオブジェクト詳細画面を表示する。この操作によって、invenio\_files\_rest.admin. MultipartObjectModelViewが継承したModelViewよりflask\_admin.model.base.details\_viewメソッドを呼び出す。このメソッド下でfiles\_multipartobjectテーブルよりマルチパートオブジェクト情報を取得し、MultipartObjectModelViewのcolumn\_details\_listにあるキーに対応する情報を画面に表示する。

> オブジェクトバージョンの情報は以下のようなデータベースに保存する

  - テーブル名：「files\_multipartobject」

> フィールド名：  
> ・「created」  
> ・「updated」  
> ・「upload\_id」  
> ・「bucket\_id」  
> ・「key」  
> ・「file\_id」  
> ・「chunk\_size」  
> ・「size」  
> ・「comleted」

  - > ・「created\_by\_id」更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
<tr class="even">
<td>2023/12/22</td>
<td>4ec162bf3bdcf843df23863fbf7d5bb36ba875e4</td>
<td>W2023-42</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

##   

### オブジェクトバージョン

  - > 目的・用途

本機能は、管理者として、アップロードしているアイテムのファイルバージョンを管理する機能である。

  - > 利用方法

【Administration \> ファイル管理(Files) \>オブジェクトバージョン(Object Version)画面】を表示する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【オブジェクトバージョン(Object Version)画面】には以下のタブが表示される
    
      - 一覧（List）
    
      - フィルターを追加▼（Add Filter▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 詳細（Details）
        
          - > 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 詳細（Details）タブ選択中に表示

  - 「一覧」（List）タブにアイテムにアップロードしているファイルバージョンを表示する。
    
      - 表示項目は以下の通りである
        
          - アクセス（閲覧）
            
              - 目のマークを押すと「詳細」タブに遷移する。
        
          - 「Bucket」：該当バケットのID値
        
          - 「Key」：ファイル名
        
          - 「Version」：ファイルのバージョン
        
          - 「URI」：ファイルのURI
        
          - 「Is Head」：True、False  
            True：最終版の場合
        
          - 「Deleted」：削除状態
        
          - 「Size」：ファイルの容量値
        
          - 「Created」：ファイルの作成時間  
            フォーマット：「YYYY-MM-DD hh:mm:ss.tttttt」
        
          - 「Updated」：ファイルの更新時間  
            フォーマット：「YYYY-MM-DD hh:mm:ss.tttttt」
        
          - 「Versions」リンク
            
              - リンクをクリックすると、該当オブジェクトバージョンがフィルターされる。
            
              - フィルター条件：
                
                  - 「bucket / Files Bucket / Id」：該当のバケット値
                
                  - 「key」：該当のファイル名
        
          - 「Objects」リンク
            
              - リンクをクリックすると、該当オブジェクトバージョンがフィルターされる。
            
              - フィルター条件：
                
                  - 「bucket / Files Bucket / Id」：該当のバケット値
                
                  - 「Is Head」：Yes
        
          - 「File」リンク
            
              - リンクをクリックすると、【Administration \> ファイル管理(Files) \> ファイルインスタンス(File Instance)画面】に移動し、該当ファイルがフィルターされる。
            
              - フィルター条件：  
                「ID」：該当ファイルID
    
      - 「フィルターを追加▼」（Add Filter▼）ボタンをクリックすると、以下の追加可能なフィルターリストを表示し、フィルター名をクリックすると当該フィルタの入力エリアを追加する。
        
          - フィルター名
            
              - 「bucket / Files Bucket / Id」
                
                  - フィルター方式の選択肢：等しい（equals）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「bucket / Files Bucket / Locked」
                
                  - フィルター方式の選択肢：等しい（equals）、等しくない（not equal）
                
                  - 選択したフィルター方式に対して「はい」「いいえ」
            
              - 「bucket / Files Bucket / Deleted」
                
                  - フィルター方式の選択肢：「bucket / Files Bucket / Locked」と同じである。
                
                  - 選択したフィルター方式に対して「はい」「いいえ」
            
              - 「bucket / Files Bucket / Name」
                
                  - フィルター方式の選択肢：含む（contains）、含まれていません（not contains）、等しい（equals）、等しくない（not equal）、空（empty）、一覧にある（in list）、一覧にない（not in list）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「File UUID」
                
                  - フィルター方式の選択肢：「bucket / Files Bucket / Locked」と同じである。
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Checksum」
                
                  - フィルター方式の選択肢：「bucket / Files Bucket / Name」と同じである。
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Storage Class」
                
                  - フィルター方式の選択肢：「bucket / Files Bucket / Name」と同じである。
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Readable」
                
                  - フィルター方式の選択肢：「bucket / Files Bucket / Locked」と同じである。
                
                  - 選択したフィルター方式に対して「はい」「いいえ」
            
              - 「Key」
                
                  - フィルター方式の選択肢：「bucket / Files Bucket / Name」と同じである。
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Version」
                
                  - フィルター方式の選択肢：「bucket / Files Bucket / Id」と同じである。
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Is Head」
                
                  - フィルター方式の選択肢：「bucket / Files Bucket / Locked」と同じである。
                
                  - 選択したフィルター方式に対して「はい」「いいえ」
            
              - 「Size」
                
                  - フィルター方式の選択肢：等しい（equals）、等しくない（not equal）、より大きい（greater than）、より小さい（smaller than）、間（between）、間ではなく（not between）、空（empty）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - > 「Created」
                
                  - フィルター方式の選択肢：「Size」と同じである。
                
                  - > 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Updated」
                
                  - フィルター方式の選択肢：「Size」と同じである。
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
        
          - 設定したフィルターは「適用」（Apply）ボタンを押下することで一覧に適用される。
        
          - 「フィルターをリセット」（Reset filter）ボタンを押下すると、設定したフィルターがリセットされる。
    
      - 検索テキストボックス検索する  
        プレースホルダー：「Search: key」
        
          - 任意テキストを入力し、キーボードでの「Enter」を押すと、部分一致検索を行う。
        
          - テキストボックスの右端での「X」ボタンを押すと、検索条件がクリアーされる。
    
      - 左端行の目アイコンを押すと、該当オブジェクトバージョンの詳細情報を「詳細」（Details）タブに表示する。
        
          - 表示項目：Bucket、Key、Version、File UUID、URI、Checksum、Size、Storage class、Is Head、Deleted、Created、Updated、File、Versions
        
          - 「File」リンクをクリックすると、【Administration \> ファイル管理(Files) \> ファイルインスタンス(File Instance)画面】に移動し、該当ファイルがフィルターされる。
        
          - 「Versions」リンクをクリックすると、該当オブジェクトバージョンがフィルターされる。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > invenio-files-rest

  - > flask-admin:  
    > <https://github.com/flask-admin/flask-admin/blob/e764f6f0be3facbefb2b4d30b5c3f2f2c630d530/flask_admin/model/base.py>

<!-- end list -->

  - > 処理概要

> オブジェクトバージョン画面の処理について

  - オブジェクトバージョン画面を表示する。この操作によって、invenio\_files\_rest.admin. ObjectModelViewが継承したModelViewよりflask\_admin.model.base.index\_viewメソッドを呼び出す。このメソッドでfiles\_objectテーブルよりバケット情報を取得し、ObjectModelViewのcolumn\_listにあるキーに対応する情報を画面に表示する。
    
      - オブジェクトバージョン詳細画面を表示する。この操作によって、invenio\_files\_rest.admin.ObjectModelViewが継承したModelViewよりflask\_admin.model.base.details\_viewメソッドを呼び出す。このメソッド下でfiles\_objectテーブルよりオブジェクトバージョン情報を取得し、ObjectModelViewのcolumn\_details\_listにあるキーに対応する情報を画面に表示する。

> オブジェクトバージョンの情報は以下のようなデータベースに保存する

  - テーブル名：「files\_object」

<!-- end list -->

  - > フィールド名：  
    > ・「version\_id」  
    > ・「key」  
    > ・「bucket\_id」  
    > ・「file\_id」  
    > ・「root\_file\_id」  
    > ・「\_mimetype」  
    > ・「is\_head」  
    > ・「created\_user\_id」  
    > ・「updated\_user\_id」  
    > ・「bucket」  
    > ・「is\_show」  
    > ・「is\_thumbnail」  
    > ・「created」  
    > ・「updated」

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

13. ## ユーザ管理
    
    1.  ### アクセス\_ロール

<!-- end list -->

  - > 目的・用途

本機能は、各ロールのシステムでのアクセスコントロールを管理する際に使用する機能である。

  - > 利用方法

【Administration \> ユーザー管理（User Management） \> アクセス：ロール（Access: Roles）画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【アクセス：ロール（Access: Roles）画面】には以下のタブが表示される
    
      - 一覧（List）
    
      - 作成（Create）
    
      - フィルターを追加▼（Add Filter▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 選択▼（With selected▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 編集（Edit）
        
          - 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示
    
      - 詳細（Details）
        
          - 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示

  - 「一覧」（List）タブにて現在のシステムでのアクセスコントロールを表示する
    
      - 表示項目は以下の通りである
        
          - チェックボックス
        
          - アクション（閲覧・編集・削除を表すアイコン）
        
          - 「Role Name」
        
          - 「Action」
        
          - 「Argument」
        
          - 「Deny」
    
      - 「フィルターを追加▼」（Add Filter▼）ボタンをクリックすると、以下の追加可能なフィルターリストを表示し、フィルター名をクリックすると当該フィルタの入力エリアを追加する
        
          - フィルター名は以下の通りである
            
              - 「Role Name」
                
                  - フィルター方式の選択肢：含む（contains）、含まれていません（not contains）、等しい（equals）、等しくない（not equal）、空（empty）、一覧にある（in list）、一覧にない（not in list）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Action」
            
              - フィルター方式の選択肢：上記の「Role Name」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Argument」
                
                  - フィルター方式の選択肢：上記の「Role Name」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Deny」
                
                  - フィルター方式の選択肢：等しい（equals）、等しくない（not equal）
                
                  - 入力エリアではなく選択肢「はい」「いいえ」を使い、「はい」ならアクセス許可のコントロール、「いいえ」ならアクセス拒否のコントロールを絞り込む
        
          - 設定したフィルターは「適用」（Apply）ボタンを押下することで一覧に適用される
        
          - 「フィルターをリセット」（Reset filter）ボタンを押下すると、設定したフィルターがリセットされる
    
      - 「選択▼」（With selected▼）ボタンをクリックすると、以下の追加可能な機能（現在削除ボタンのみ）を表示する
        
          - レコードにチェックを入れない場合、「削除」（Delete）ボタンを押すと、エラーメッセージを表示する  
            メッセージ：  
            　日本語：「少なくとも一つのレコードを選択してください。」  
            　英語：「Please select at least one record.」
        
          - レコードにチェックを入れる場合、「削除」（Delete）ボタンを押すと、確認ダイアログを表示する  
            メッセージ：  
            　日本語：「選択したレコードを削除してもよろしいですか。」  
            　英語：「Are you sure you want to delete selected records?」
            
              - 「OK」ボタンを押すと、該当ロールを削除し、メッセージを画面上部に表示する  
                メッセージ：  
                　日本語：「レコード数＋レコードが正常に削除されました。」  
                　英語：「Record was successfully deleted.」
            
              - 「キャンセル」（Cancel）ボタンを押すと、確認ダイアログを閉じる
    
      - アクセスコントロール行にて目アイコンを押すと、該当アクセスコントロールの詳細情報を「詳細」（Details）タブに表示する
        
          - 表示項目：Role、Action、Deny、Argument
        
          - 「移動」（Filter）テキストボックスにテキストを入力すると、入力値が項目名またはその値に含まれている項目に絞り込んで表示する
    
      - アクセスコントロール行にて鉛筆アイコンを押すと、該当アクセスコントロールを「編集」（Edit）タブに表示し、アクセスコントロールの情報が編集できる
        
          - 入力情報とボタン操作は、後述の「作成」（Create）タブと同じである
    
      - アクセスコントロール行にて削除アイコンを押すと、該当アクセスコントロールを削除し、メッセージを画面上部に表示する  
        メッセージ：  
        　日本語：「レコード数＋レコードが正常に削除されました。」  
        　英語：「Record was successfully deleted.」

  - 「一覧」（List）から「作成」（Create）タブを押すと、「作成」（Create）タブに移動し、アクセスコントロールを新規作成できる
    
      - 入力情報は以下の通りである
        
          - 「Role」：必須項目  
            選択肢：システムに作成されたロール一覧
        
          - 「Action」：必須項目ではないがプルダウンメニューによって必ず１つ選択される  
            選択肢：「access\_actionsroles.action」から取得されている一覧
        
          - 「Argument」  
            255文字までの自由入力  
            255文字を超えると以下のエラーメッセージが表示される  
            メッセージ：  
            日本語：「フィールドは 255 文字を超えることはできません。」  
            英語：「Field cannot be longer than 255 characters.」
        
          - 「Deny」
    
      - 「保存」（Save）ボタンを押すと、設定されたアクセスコントロール内容をアクセスコントロール一覧に追加させ、メッセージをアクセスコントロール一覧に表示させる  
        メッセージ：  
        　日本語：「レコードが正常に作成されました。」  
        　英語：「Record was successfully created.」
        
          - アクセスコントロールをデータベースに保存する
            
              - テーブル名：「access\_actionsroles」
            
              - フィールド名：  
                ・「id」  
                ・「action」  
                ・「exclude」  
                ・「argument」  
                ・「role\_id」
    
      - ［保存してもう一つ追加（Save and Add Another）］ボタンを押すと、設定されたアクセスコントロール内容をロール一覧に追加させ、他のアクセスコントロールを追加設定可能とする  
        メッセージを画面上部に表示させる  
        メッセージ：  
        　日本語：「レコードが正常に作成されました。」  
        　英語：「Record was successfully created.」
    
      - ［保存して編集を続ける（Save and Continue Editing）］ボタンを押すと、設定されたアクセスコントロール内容をアクセスコントロール一覧に追加させ、該当アクセスコントロールの編集を続けることを可能とする  
        メッセージを画面上部に表示させる  
        メッセージ：  
        　日本語：「レコードが正常に作成されました。」  
        　英語：「Record was successfully created.」
    
      - ［キャンセル（Cancel）］ボタンを押すと、設定されたアクセスコントロール内容をアクセスコントロール一覧に追加せず、「一覧」（List）タブに戻る

  - v0.9.22でのデフォルトアクセスコントロールは以下の通りである
    
      - パス： <https://github.com/RCOSDP/weko/blob/v0.9.22/scripts/populate-instance.sh#L241-L338>

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - invenio\_access（WEKOソース内にforkされていない）

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 本画面は、flask\_adminのModelViewを使っている。

  - 画面の設定をもとに、以下のようにaccess\_actionsrolesテーブルに保存する。
    
      - 「id」フィールド：画面上の入力によらない
    
      - 「action」フィールド：画面上の「Action」で選択されたもの
    
      - 「exclude」フィールド：画面上の「Deny」にチェックが入っていたらTrue、そうでなければFalse
    
      - 「argument」フィールド：画面上の「Argument」の入力値
    
      - 「role\_id」フィールド：accounts\_roleテーブルで、画面上の「Role」で選択されたものと「name」が一致するレコードの「id」フィールド

  - 各actionは、関数へのアノテーションでアクセス制御に利用する。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### アクセス\_システムロール

  - > 目的・用途

本機能は、全ユーザーに一括付与する権限を管理する機能である。

  - > 利用方法

【Administration \> ユーザー管理（User Management） \> アクセス：システムロール（Access: System Roles）画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 画面の主な構成と操作方法は、【アクセス：ロール（Access: Roles）画面】と同様である。[ADMIN-13-1: アクセス\_ロール](\\l)を参照すること。
    
      - 一覧（List）タブでは、【アクセス：ロール（Access: Roles）画面】の「Role」と異なり「System Role」が表示される。
    
      - 「作成」（Create）タブでは、【アクセス：ロール（Access: Roles）画面】の「Role」と異なり「System Role」を選択する。
        
          - 「System Role」の選択肢は以下の通りである。
            
              - 「any\_user」：ゲストを含むすべての操作者を対象とする。
            
              - 「authenticated\_user」：ログインしているすべての操作者を対象とする。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - invenio\_access（WEKOソース内にforkされていない）

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 画面の設定をもとに、以下のようにaccess\_actionssystemrolesテーブルに保存する。
    
      - 「id」フィールド：画面上の入力によらない
    
      - 「action」フィールド：画面上の「Action」で選択されたもの
    
      - 「exclude」フィールド：画面上の「Deny」にチェックが入っていたらTrue、そうでなければFalse
    
      - 「argument」フィールド：画面上の「Argument」の入力値
    
      - 「role」フィールド：画面上の「System Role」で選択されたもの

  - 各actionは、関数へのアノテーションでアクセス制御に利用する。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### アクセス\_ユーザー

  - > 目的・用途

本機能は、個別のユーザーに付与する権限を管理する機能である。

  - > 利用方法

【Administration \> ユーザー管理（User Management） \> アクセス：ユーザー（Access: Users）画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 画面の主な構成と操作方法は、【アクセス：ロール（Access: Roles）画面】と同様である。[ADMIN-13-1: アクセス\_ロール](\\l)を参照すること。
    
      - 一覧（List）タブでは、【アクセス：ロール（Access: Roles）画面】の「Role」と異なり「User ID」と「Email」が表示される。
        
          - 「User ID」と「Email」には、accounts\_userテーブルの「id」「email」フィールドの値が表示される。
    
      - 「作成」（Create）タブでは、【アクセス：ロール（Access: Roles）画面】の「Role」と異なり「User」を選択する。
        
          - 「User」の選択肢として、accounts\_userテーブルに登録されたユーザーが表示される。
        
          - 各選択肢は、「User\<id=(レコードのid), email=(レコードのemail)\>」の形で表示される。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - invenio\_access（WEKOソース内にforkされていない）

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 画面の設定をもとに、以下のようにaccess\_actionsusersテーブルに保存する。
    
      - 「id」フィールド：画面上の入力によらない
    
      - 「action」フィールド：画面上の「Action」で選択されたもの
    
      - 「exclude」フィールド：画面上の「Deny」にチェックが入っていたらTrue、そうでなければFalse
    
      - 「argument」フィールド：画面上の「Argument」の入力値
    
      - 「user\_id」フィールド：画面上の「User」で選択されたユーザーのid

  - 各actionは、関数へのアノテーションでアクセス制御に利用する。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### 連結アカウント識別子

  - > 目的・用途

本機能は、invenioデフォルト機能を使用してaccounts\_useridentityテーブルをメンテナンスする際に使用する機能であるが、WEKO v0.9.22ではこのテーブルを使用していない。

  - > 利用方法

【Administration \> ユーザー管理（User Management） \> 連結アカウント識別子（Linked account identities）画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 
<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - invenio\_accounts（関連するソースはWEKOにフォークされてない）

<!-- end list -->

  - > 処理概要

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2022/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### 連結アカウントトークン

  - > 目的・用途

本機能は、invenioデフォルト機能を使用してoauthclient\_remotetokenテーブルをメンテナンスする際に使用する機能であるが、WEKO v0.9.22ではこのテーブルを使用していない。

  - > 利用方法

【Administration \> ユーザー管理（User Management） \> 連結アカウントトークン（Linked account tokens）画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 
<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - invenio\_oauthclient（WEKOソース内にforkされていない）

<!-- end list -->

  - > 処理概要

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### 連結アカウント

  - > 目的・用途

本機能は、invenioデフォルト機能を使用してoauthclient\_remotetokenテーブルをメンテナンスする際に使用する機能であるが、WEKO v0.9.22ではこのテーブルを使用していない。

  - > 利用方法

【Administration \> ユーザー管理（User Management） \> 連結アカウント（Linked accounts）画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 
<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - invenio\_oauthclient（WEKOソース内にforkされていない）

<!-- end list -->

  - > 処理概要

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### OAuthアプリケーショントークン

  - > 目的・用途

本機能は、管理者として登録されているOAuthアプリケーショントークンを閲覧、編集、削除する機能である。

※invenioデフォルト機能を使用

  - > 利用方法

【Administration \> ユーザー管理(User Management) \> OAuthアプリケーショントークン(OAuth Application Tokens)】を表示する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【OAuthアプリケーショントークン(OAuth Application Tokens)画面】には以下のタブが表示される
    
      - 一覧（List）
    
      - 作成（Create）
    
      - 選択▼（With selected▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 編集（Edit）
        
          - > 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示
    
      - 詳細（Details）
        
          - > 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示

  - 「一覧」（List）タブにトークン一覧を表示する。
    
      - 表示項目は以下の通りである。
        
          - チェックボックス
        
          - アクセス（閲覧・編集・削除）
            
              - 目のマークを押すと「詳細」タブに遷移する。
            
              - 鉛筆のマークを押すと「編集」タブに遷移する。
            
              - ゴミ箱のマークを押すとその行のトークンは削除される。  
                なお、oauth2server\_tokenテーブルからは削除されるがoauth2server\_clientテーブルの対応したものは削除されない。
        
          - 「Id」：トークンのID
        
          - 「Client Id」：OAuthアプリケーション側のID
        
          - 「User Id」：接続するユーザーID
        
          - 「Token Type」：bearerのみ
        
          - 「Expires」：有効期限
    
      - 左から2列目にある目アイコンを押すと、該当トークンの詳細情報を「詳細」（Details）タブに表示する
        
          - 表示項目：Id, Client id, User Id', Token Type, Expires
    
      - 左から２列目にある鉛筆アイコンを押すと、「編集」（Edit）タブに表示し、ユーザーの情報が編集できる
        
          - 編集可能な項目は以下の通りである
            
              - 「Client」
                
                  - 選択肢：OAuthアプリケーションにて登録されているものからプルダウンで選択する。
                
                  - 部分一致検索ができる。
                
                  - 必須項目である。
            
              - 「User」
                
                  - 選択肢：登録されているユーザーから選択する。
                
                  - 部分一致検索ができる。
            
              - 「Token Type」:対応しているものはbearerのみである。  
                ただし、編集、保存する際は自由記述
            
              - 「Expires」:カレンダーから指定できる。
            
              - 「Is Personal」：個人用
            
              - 「Is Internal」：内部用
        
          - 「保存」（Save）ボタンを押すと、編集内容を保存し、メッセージを一覧画面の上部に表示する  
            メッセージ：  
            　日本語：「レコードが正常に保存されました。」  
            　英語：「Record was successfully saved.」
    
      - 複数のトークンを一度に削除する。
        
          - 左端のチェックボックスにチェックを入れ、選択タブから「削除」を選ぶと、削除するかの確認アラートが表示される、
            
              - OKを押すとチェックボックスにチェックを入れた行のトークンは削除される。
            
              - キャンセルを押すとキャンセルできる。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > invenio\_oauth2server

  - > flask\_admin:  
    > <https://github.com/flask-admin/flask-admin/blob/e764f6f0be3facbefb2b4d30b5c3f2f2c630d530/flask_admin/model/base.py>

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - OAuthアプリケーショントークン画面の処理について（以下トークン画面とする）
    
      - トークン画面を表示する。この操作によって、invenio\_oauth2server.admin.TokenViewが継承したModelViewよりflask\_admin.model.base.index\_viewメソッドを呼び出す。このメソッドでoauth2server\_tokenテーブルよりトークン情報を取得し、TokenViewcolumn\_listにあるキーに対応する情報を画面に表示する。
        
          - トークン詳細画面を表示する。この操作によって、invenio\_files\_rest.admin.TokenViewが継承したModelViewよりflask\_admin.model.base.details\_viewメソッドを呼び出す。このメソッド下でoauth2server\_tokenテーブルよりトークン情報を取得し、TokenViewのcolumn\_details\_listにあるキーに対応する情報を画面に表示する。
    
      - トークン編集画面を表示する。この操作によって、invenio\_files\_rest.admin.TokenViewが継承したModelViewよりflask\_admin.model.base.edit\_viewメソッドをGETで呼び出す。このメソッド下で開いたid列を用いて、oauth2server\_tokenテーブルよりトークン情報を取得し、表示する。
        
          - トークン編集画面で「保存」ボタンを押下する。この操作によって、flask\_admin.model.base.edit\_viewメソッドをPOSTで呼び出す。このメソッド下で、get\_save\_return\_urlメソッドが呼ばれ、編集内容をoauth2server\_tokenテーブルに保存し、更新する。
    
      - トークン画面に表示される表の左から２列目のゴミ箱マークを押下する。この操作によって、invenio\_files\_rest.admin.TokenViewが継承したModelViewよりflask\_admin.model.base.delete\_viewメソッドを呼び出す。このメソッド下でdelete\_modelメソッドが呼ばれ、押下したゴミ箱の行のトークンをoauth2server\_tokenテーブルから削除する。
    
      - トークン画面に表示される表の左端のチェックボックスにチェックを入れ、選択タブから「削除」を押下する。この操作によってinvenio\_files\_rest.admin.TokenViewが継承したModelViewよりflask\_admin.model.base.action\_viewメソッドを呼び出す。ここでDeleteRowActionが呼ばれ、チェックを入れた行のトークンをoauth2server\_tokenテーブルから削除する。

> トークン情報は以下のようなデータベースに保存する。

  - テーブル名：「oauth2server\_token」

  - > フィールド名：  
    > ・「id」  
    > ・「client\_id」  
    > ・「user\_id」  
    > ・「token\_type」  
    > ・「access\_token」  
    > ・「refresh\_token」  
    > ・「expires」  
    > ・「\_scopes」  
    > ・「is\_personal」  
    > ・「is\_internal」

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### OAuthアプリケーション

  - > 目的・用途

本機能は、管理者として登録されているOAuthアプリケーション情報を閲覧、編集、削除する機能である。  
※invenioデフォルト機能を使用

  - > 利用方法

【Administration \> ユーザー管理(User Management) \> OAuthアプリケーション(OAuth Applications)】を表示する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【OAuthアプリケーション (OAuth Applications)画面】には以下のタブが表示される
    
      - 一覧（List）
    
      - 作成（Create）
    
      - 選択▼（With selected▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 編集（Edit）
        
          - > 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示
    
      - 詳細（Details）
        
          - > 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示

  - 「一覧」（List）タブにOAuthアプリケーション一覧を表示する。
    
      - 表示項目は以下の通りである。
        
          - チェックボックス
        
          - アクセス（閲覧・編集・削除）
            
              - 目のマークを押すと「詳細」タブに遷移する。
            
              - 鉛筆のマークを押すと「編集」タブに遷移する。
            
              - ゴミ箱のマークを押すとその行のレコードは削除される。  
                なお、そのレコードのClient Idを使用しているトークンはoauth2server\_ tokenテーブルから削除される。
        
          - 「Name」：OAuth表示名
        
          - 「Description」：説明、備考
        
          - 「Website」：URL
        
          - 「User Id」：ユーザー側のＩＤ
        
          - 「Client Id」：クライアント側のＩＤ
    
      - 左から2列目にある目アイコンを押すと、該当OAuthの詳細情報を「詳細」（Details）タブに表示する
        
          - 表示項目：Name, Description, Website, User Id, Client id
    
      - 左から２列目にある鉛筆アイコンを押すと、「編集」（Edit）タブに表示し、ユーザーの情報が編集できる
        
          - 編集可能な項目は以下の通りである。
            
              - 「User」
                
                  - 選択肢：登録されているユーザーから選択する。
                
                  - 部分一致検索ができる。
            
              - 「Name」：自由記述
            
              - 「Description」：自由記述
            
              - 「Client Secret」:必須項目である。Client Idとは別のものである。自由記述
            
              - 「Is Confidential」：機密であるかどうか
            
              - 「Is Internal」：内部用
            
              - 「Oauth2Tokens」
                
                  - 選択肢：登録されているトークンから複数選択する。
                
                  - 部分一致検索ができる。ただし、トークンのIDでの検索となる。
        
          - 「保存」（Save）ボタンを押すと、編集内容を保存し、メッセージを一覧画面の上部に表示する  
            メッセージ：  
            　日本語：「レコードが正常に保存されました。」  
            　英語：「Record was successfully saved.」
    
      - 複数のOAuth情報を一度に削除する。
        
          - 左端のチェックボックスにチェックを入れ、選択タブから「削除」を選ぶと、削除するかの確認アラートが表示される、
            
              - OKを押すとチェックボックスにチェックを入れた行のトークンは削除される。
            
              - キャンセルを押すとキャンセルできる。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > invenio\_oauth2server

  - > flask\_admin:  
    > <https://github.com/flask-admin/flask-admin/blob/e764f6f0be3facbefb2b4d30b5c3f2f2c630d530/flask_admin/model/base.py>

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - OAuthアプリケーション画面の処理について
    
      - OAuthアプリケーション画面を表示する。その場合、invenio\_oauth2server.admin.ClientViewが継承したModelViewよりflask\_admin.model.base.index\_viewメソッドを呼び出す。このメソッドでoauth2server\_clientテーブルよりOAuth情報を取得し、ClientViewのcolumn\_listにあるキーに対応する情報を画面に表示する。
        
          - OAuthアプリケーション詳細画面を表示する。この操作によって、invenio\_files\_rest.admin.ClientViewが継承したModelViewよりflask\_admin.model.base.details\_viewメソッドを呼び出す。このメソッド下でoauth2server\_clientテーブルよりOAuth情報を取得し、ClientViewのcolumn\_details\_listにあるキーに対応する情報を画面に表示する。
    
      - OAuthアプリケーション編集画面を表示する。この操作によって、invenio\_files\_rest.admin.ClientViewが継承したModelViewよりflask\_admin.model.base.edit\_viewメソッドをGETで呼び出す。このメソッド下で開いたoauth2server\_clientテーブルよりOAuth情報を取得し、表示する。
        
          - OAuthアプリケーション編集画面で「保存」ボタンを押下する。この操作によって、flask\_admin.model.base.edit\_viewメソッドをPOSTで呼び出す。このメソッド下で、get\_save\_return\_urlメソッドが呼ばれ、編集内容をoauth2server\_clientテーブルに保存し、更新する。
    
      - > OAuthアプリケーション画面に表示される表の左から２列目のゴミ箱マークを押下する。この操作によって、invenio\_files\_rest.admin.ClientViewが継承したModelViewよりflask\_admin.model.base.delete\_viewメソッドを呼び出す。このメソッド下でdelete\_modelメソッドが呼ばれ、押下したゴミ箱の行のトークンをoauth2server\_clientテーブルから削除する。
    
      - OAuthアプリケーション画面に表示される表の左端のチェックボックスにチェックを入れ、選択タブから「削除」を押下し、OKを押下する。この操作によって、invenio\_files\_rest.admin.ClientViewが継承したModelViewよりflask\_admin.model.base.action\_viewメソッドを呼び出す。ここでDeleteRowActionが呼ばれ、チェックを入れた行のトークンをoauth2server\_clientテーブルから削除する。

> OAuth情報は以下のようなデータベースに保存する。

  - テーブル名：「oauth2server\_client」

  - > フィールド名：  
    > ・「name」  
    > ・「description」  
    > ・「website」  
    > ・「user\_id」  
    > ・「client\_id」  
    > ・「client\_secret」  
    > ・「is\_confidential」  
    > ・「is\_internal」  
    > ・「\_redirect\_uris」  
    > ・「\_default\_scopes」

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### ロール

  - > 目的・用途

本機能は、システムのロールを管理（追加・編集・削除）する際に使用する機能である。

  - > 利用方法

【Administration \> ユーザー管理（User Management） \> ロール（Role）画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【ロール（Role）画面】には以下のタブが表示される
    
      - 一覧（List）
    
      - 作成（Create）
    
      - フィルターを追加▼（Add Filter▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 選択▼（With selected▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 編集（Edit）
        
          - 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示
    
      - 詳細（Details）
        
          - 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示

  - 「一覧」（List）タブに現在のシステムのロールを表示する
    
      - 表示項目は以下の通りである
        
          - チェックボックス
        
          - アクション（閲覧・編集・削除を表すアイコン）
        
          - 「Id」
        
          - 「Name」
        
          - 「Description」
    
      - 「フィルターを追加▼」（Add Filter▼）ボタンをクリックすると、以下の追加可能なフィルターリストを表示し、フィルター名をクリックすると当該フィルタの入力エリアを追加する
        
          - フィルター名
            
              - 「Id」
                
                  - フィルター方式の選択肢：等しい（equals）、等しくない（not equal）、より大きい（greater than）、より小さい（smaller than）、空（empty）、一覧にある（in list）、一覧にない（not in list）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Name」
                
                  - フィルター方式の選択肢：含む（contains）、含まれていません（not contains）、等しい（equals）、等しくない（not equal）、空（empty）、一覧にある（in list）、一覧にない（not in list）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Description」
                
                  - フィルター方式の選択肢：上記の「Name」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
        
          - 設定したフィルターは「適用」（Apply）ボタンを押下することで一覧に適用される
        
          - 「フィルターをリセット」（Reset filter）ボタンを押下すると、設定したフィルターがリセットされる
    
      - 「選択▼」（With selected▼）ボタンをクリックすると、以下の追加可能な機能（現在削除ボタンのみ）を表示する
        
          - レコードにチェックを入れない場合、「削除」（Delete）ボタンを押すと、エラーメッセージを表示する  
            メッセージ：  
            　日本語：「少なくとも一つのレコードを選択してください。」  
            　英語：「Please select at least one record.」
        
          - レコードにチェックを入れる場合、「削除」（Delete）ボタンを押すと、確認ダイアログを表示する  
            メッセージ：  
            　日本語：「選択したレコードを削除してもよろしいですか。」  
            　英語：「Are you sure you want to delete selected records?」
            
              - 「OK」ボタンを押すと、該当ロールを削除し、メッセージを画面上部に表示する  
                メッセージ：  
                　日本語：「レコード数＋レコードが正常に削除されました。」  
                　英語：「Record was successfully deleted.」
            
              - 「キャンセル」（Cancel）ボタンを押すと、確認ダイアログを閉じる
    
      - 検索テキストボックスでロールを検索する
        
          - プレースホルダー：「Search: id, name, description」
        
          - 任意テキストを入力し、キーボードでの「Enter」を押すと、Id、ロール名、説明での検索を行う
        
          - テキストボックスの右端での「X」ボタンを押すと、検索条件がクリアーされる
    
      - ロール行にて目アイコンを押すと、該当ロールの詳細情報を「詳細」（Details）タブに表示する
        
          - 表示項目：ID、ロール名、説明
    
      - ロール行にて鉛筆アイコンを押すと、該当ロールを「編集」（Edit）タブに表示し、ロールの情報が編集できる
    
      - ロール行にて削除アイコンを押すと、該当ロールを削除し、メッセージを画面上部に表示する  
        メッセージ：  
        　日本語：「レコード数＋レコードが正常に削除されました。」  
        　英語：「Record was successfully deleted.」

  - 「一覧」（List）から「作成」（Create）タブを押すと、「作成」（Create）タブに移動し、ロールを新規作成できる
    
      - 入力情報：「Name」（ロール名）、「Description」（ロールの説明）、「Users」
        
          - NameとDescriptionは自由入力
        
          - Usersは、Emailを選択する
    
      - ［保存（Save）］ボタンを押すと、設定されたロール内容をロール一覧に追加させ、メッセージをロール一覧に表示させる  
        メッセージ：  
        　日本語：「レコードが正常に作成されました。」  
        　英語：「Record was successfully created.」
        
          - ロールをデータベースに保存する
            
              - テーブル名：「accounts\_role」
            
              - フィールド名：  
                ・「id」  
                ・「name」  
                ・「description」
    
      - ［保存してもう一つ追加（Save and Add Another）］ボタンを押すと、設定されたロール内容をロール一覧に追加させ、他のロールを追加設定可能とする  
        メッセージを画面上部に表示させる  
        メッセージ：  
        　日本語：「レコードが正常に作成されました。」  
        　英語：「Record was successfully created.」
    
      - ［保存して編集を続ける（Save and Continue Editing）］ボタンを押すと、設定されたロール内容をロール一覧に追加させ、該当ロールの編集を続けることを可能とする  
        メッセージを画面上部に表示させる  
        メッセージ：  
        　日本語：「レコードが正常に作成されました。」  
        　英語：「Record was successfully created.」
    
      - ［キャンセル（Cancel）］ボタンを押すと、設定されたロール内容をロール一覧に追加せず、「一覧」（List）タブに戻る
    
      - 新規作成時、コンフィグでACCOUNTS\_WORKFLOW\_ROLE\_HIDE\_FILTER=Trueだった場合には、そのロールのユーザーでは各ワークフローが表示されないように設定される
        
          - そのロールで操作するときは、ワークフロー一覧に表示されず、アクティビティ作成時にそのワークフローを選択できない
        
          - 詳細は[ADMIN-7-2: ワークフロー](\\l)を参照

  - v0.9.22でのデフォルトロールは以下の通りである
    
      - パス： <https://github.com/RCOSDP/weko/blob/v0.9.22/scripts/populate-instance.sh#L228-L231>
    
      - ロール：
        
          - 「System Administrator」
        
          - 「Repository Administrator」
        
          - 「Community Administrator」
        
          - 「Contributor」

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - invenio\_accounts

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 環境構築時にpopulate-instance.shで初期データを登録することで、デフォルトロールの作成と、各ロールへの権限付与が行われる。
    
      - 各デフォルトロールの名前は、作成時に環境変数で設定される
        
          - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/docker-compose.yml#L57-L60>

  - 本画面では、accounts\_roleテーブルのデータを作成、編集、削除する。
    
      - 作成、編集時は、画面の設定をもとに、以下のようにaccess\_actionssystemrolesテーブルに保存する。
        
          - 「id」フィールド：画面上の入力によらない
        
          - 「name」フィールド：画面上の「Name」で入力されたもの
        
          - 「description」フィールド：画面上の「Description」で入力されたもの

  - ロールを作成、編集したとき、invenio\_accounts.admin.RoleView.after\_model\_changeメソッドが呼び出される。分岐によって、以下の場合のみ処理を行う。
    
      - ロールを新規作成したとき、コンフィグのACCOUNTS\_WORKFLOW\_ROLE\_HIDE\_FILTERがTrueである場合にのみ、workflow\_userroleテーブルにレコードが作成される。
        
          - コンフィグは以下を参照する。
            
              - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-accounts/invenio_accounts/config.py#L227>
            
              - キー：ACCOUNTS\_WORKFLOW\_ROLE\_HIDE\_FILTER
        
          - 作成前にworkflow\_workflowテーブルを参照して、is\_deletedがfalseであるレコードを取得する。その数だけworkflow\_userroleテーブルにレコードを作成する。
        
          - 作成するレコードでは、フィールドを以下のように設定する。
            
              - 「workflow\_id」：workflow\_workflowテーブルから取得した各レコードの「id」フィールドの値。１レコードにつき１idを設定する。
            
              - 「role\_id」：それぞれのレコードに、accounts\_roleテーブルに新規作成したレコードの「id」フィールドの値を設定する。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### セッションアクティビティ

  - > 目的・用途

本機能は、活動セッションを確認する際に使用する機能である。

  - > 利用方法

【Administration \> ユーザー管理（User Management） \> セッションアクティビティ（Session Activity）画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【セッションアクティビティ（Session Activity）画面】には以下のタブが表示される
    
      - 一覧（List）
    
      - フィルターを追加▼（Add Filter▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 選択▼（With selected▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー

  - 「一覧」（List）タブでの表示項目は以下の通りである
    
      - チェックボックス
    
      - アクション（削除を表すアイコン）
    
      - 「User ID」
    
      - 「Email」
    
      - 「Session ID」
    
      - 「Created」  
        フォーマット：「YYYY-MM-DDThh:mm:ss.tttttt」

  - 「フィルターを追加▼」（Add Filter▼）ボタンをクリックすると、以下の追加可能なフィルターリストを表示し、フィルター名をクリックすると当該フィルタの入力エリアを追加する
    
      - フィルター名
        
          - 「User ID」
            
              - フィルター方式の選択肢：等しい（equals）、等しくない（not equal）、より大きい（greater than）、より小さい（smaller than）、空（empty）、一覧にある（in list）、一覧にない（not in list）
        
          - 「Email」
            
              - フィルター方式の選択肢：含む（contains）、含まれていません（not contains）、等しい（equals）、等しくない（not equal）、空（empty）、一覧にある（in list）、一覧にない（not in list）
        
          - 「Session ID」
            
              - フィルター方式の選択肢：上記の「Email」と同じである
        
          - 「Created」
            
              - フィルター方式の選択肢：等しい（equals）、等しくない（not equal）、より大きい（greater than）、より小さい（smaller than）、間（between）、間ではなく（not between）、空（empty）
            
              - フォーマット：「YYYY-MM-DD hh:mm:ss」
    
      - 設定したフィルターは「適用」（Apply）ボタンを押下することで一覧に適用される
    
      - 「フィルターをリセット」（Reset filter）ボタンを押下すると、設定したフィルターがリセットされる

  - 「選択▼」（With selected▼）ボタンをクリックすると、以下の追加可能な機能（「Delete selected sessions」ボタン）を表示する
    
      - レコードにチェックを入れない場合、「Delete selected sessions」ボタンを押すと、エラーメッセージを表示する  
        メッセージ：  
        　日本語：「少なくとも一つのレコードを選択してください。」  
        　英語：「Please select at least one record.」
    
      - レコードにチェックを入れる場合、「Delete selected sessions」ボタンを押すと、確認ダイアログを表示する  
        メッセージ：「Are you sure you want to delete selected sessions?」
        
          - 「OK」ボタンを押すと、該当活動セッションを削除する
            
              - チェックを入れていたレコードに現在のセッションを指すレコードが含まれていた場合、削除されずに以下のエラーメッセージが表示される  
                エラーメッセージ：「You could not remove your current session」
        
          - 「キャンセル」（Cancel）ボタンを押すと、確認ダイアログを閉じる

  - 活動セッション行にて削除アイコンを押すと、該当活動セッションを削除する
    
      - 現在のセッションを指す行では、削除されずに以下のエラーメッセージが表示される  
        エラーメッセージ：「You could not remove your current session」

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - invenio\_accounts

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - ごみ箱ボタンによってレコードを削除する場合は、invenio\_accounts.admin.SessionActivityView. delete\_modelメソッドが呼び出される
    
      - 現在のログインのセッションのID（session.sid\_s）と対象レコードのSession IDとを比較して、同じだった場合には削除せずエラーメッセージを表示する

  - 「Delete selected sessions」によってレコードを削除する場合は、invenio\_accounts.admin.SessionActivityView.action\_deleteメソッドが呼び出される
    
      - 現在のセッションのID（session.sid\_s）と選択した各レコードのSession IDとを比較して、同じであるレコードがあった場合には削除せずエラーメッセージを表示する

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### ユーザー

  - > 目的・用途

本機能は、ユーザーの新規作成、編集、削除を行う際に使用する機能である。

  - > 利用方法

【Administration \> ユーザー管理（User Management） \> ユーザー（User）画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【ユーザー（User）画面】には以下のタブが表示される
    
      - 一覧（List）
    
      - 作成（Create）
    
      - フィルターを追加▼（Add Filter▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 選択▼（With selected▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 編集（Edit）
        
          - 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示
    
      - 詳細（Details）
        
          - 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示

  - 「一覧」（List）タブに登録されているユーザーを表示する
    
      - 表示項目は以下の通りである
        
          - チェックボックス
        
          - アクション（閲覧・編集・削除を表すアイコン）
        
          - 「Id」
        
          - 「Email」
        
          - 「Active」
        
          - 「Confirmed At」
        
          - 「Last Login At」  
            フォーマット：「YYYY-MM-DDThh:mm:ss.tttttt」
        
          - 「Current Login At」  
            フォーマット：「YYYY-MM-DDThh:mm:ss.tttttt」
        
          - 「Last Login IP」
        
          - 「Current Login IP」
        
          - 「Login Count」
    
      - 表示内容は、accounts\_userテーブル、accounts\_userroleテーブルから取得した情報である
    
      - 「フィルターを追加▼」（Add Filter▼）ボタンをクリックすると、以下の追加可能なフィルターリストを表示し、フィルター名をクリックすると当該フィルターの入力エリアを追加する
        
          - フィルター名
            
              - 「Id」
                
                  - フィルター方式の選択肢：フィルター方式の選択肢：等しい（equals）、等しくない（not equal）、より大きい（greater than）、より小さい（smaller than）、空（empty）、一覧にある（in list）、一覧にない（not in list）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Email」
                
                  - フィルター方式の選択肢：含む（contains）、含まれていません（not contains）、等しい（equals）、等しくない（not equal）、空（empty）、一覧にある（in list）、一覧にない（not in list）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「Active」
                
                  - フィルター方式の選択肢：等しい（equals）、等しくない（not equal）
                
                  - 入力エリアではなく選択肢「はい」「いいえ」を使い、「はい」ならアクティブなユーザー、「いいえ」ならそうでないユーザーを絞り込む
            
              - 「Confirmed At」
                
                  - フィルター方式の選択肢：等しい（equals）、等しくない（not equal）、より大きい（greater than）、より小さい（smaller than）、間（between）、間ではなく（not between）、空（empty）
                
                  - 入力エリアをクリックするとカレンダーが表示されるので、日時を選択して［Apply］押下することで絞り込む日時を設定する（入力することもできる）
                
                  - 日時を設定しなかった場合は現在日時を設定する
            
              - 「Last Login At」
                
                  - フィルター方式の選択肢：上記の「Confirmed At」と同じである
            
              - 「Current Login At」
                
                  - フィルター方式の選択肢：上記の「Confirmed At」と同じである
            
              - 「Login Count」
                
                  - フィルター方式の選択肢：上記の「Id」と同じである
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
        
          - 設定したフィルターは［適用（Apply）］ボタンを押下することで一覧に適用される
        
          - ［フィルターをリセット（Reset filter）］ボタンを押下すると、設定したフィルターがリセットされる
    
      - 「選択▼」（With selected▼）ボタンをクリックすると、以下の追加可能な機能（削除、Activate、Inactivateボタン）を表示する
        
          - 機能：Activate、Inactivate
            
              - レコードにチェックを入れない場合、「Activate」「Inactivate」または「削除」ボタンを押すと、エラーメッセージを表示する  
                メッセージ：  
                　日本語：「少なくとも一つのレコードを選択してください。」  
                　英語：「Please select at least one record.」
            
              - レコードにチェックを入れて「Activate」ボタンを押すと、確認ダイアログを表示する  
                メッセージ：「Are you sure you want to activate selected users?」
                
                  - ［OK］ボタンを押すと、該当ユーザーを活動化する  
                    メッセージ：  
                    　日本語：「ユーザーを無効化しました」  
                    　英語：「User(s) were successfully inactivated.」
                
                  - ［キャンセル（Cancel）］ボタンを押すと、確認ダイアログを閉じる
            
              - レコードにチェックを入れて「Inactivate」ボタンを押すと、確認ダイアログを表示する  
                メッセージ：「Are you sure you want to inactivate selected users?」
                
                  - ［OK］ボタンを押すと、該当ユーザーを無効化し、メッセージを画面上部に表示する  
                    メッセージ：  
                    　日本語：「ユーザーを無効化しました」  
                    　英語：「User(s) were successfully inactivated.」
                
                  - ［キャンセル（Cancel）］ボタンを押すと、確認ダイアログを閉じる
        
          - 機能：削除
            
              - レコードにチェックを入れない場合、「削除」（Delete）ボタンを押すと、エラーメッセージを表示する  
                メッセージ：  
                　日本語：「少なくとも一つのレコードを選択してください。」  
                　英語：「Please select at least one record.」
            
              - レコードにチェックを入れる場合、「削除」（Delete）ボタンを押すと、確認ダイアログを表示する  
                メッセージ：  
                　日本語：「選択したレコードを削除してもよろしいですか。」  
                　英語：「Are you sure you want to delete selected records?」
                
                  - ［OK］ボタンを押すと、該当ロールを削除し、メッセージを画面上部に表示する  
                    メッセージ：  
                    　日本語：「レコード数＋レコードが正常に削除されました。」  
                    　英語：「Record was successfully deleted.」
                
                  - ［キャンセル（Cancel）］ボタンを押すと、確認ダイアログを閉じる
    
      - 検索テキストボックスでユーザーを検索する
        
          - プレースホルダー：「Search: id, email, active, confirmed\_at, last\_login\_at, current\_login\_at, Last Login IP, Current Login IP, login\_count」
        
          - 任意のテキストを入力し、キーボードでの「Enter」を押すと、ユーザー検索を行う
        
          - テキストボックスの右端での［X］ボタンを押すと、検索条件がクリアーされる
    
      - ユーザー行にて目アイコンを押すと、該当ユーザーの詳細情報を「詳細」（Details）タブに表示する
        
          - 表示項目：Id、Email、Active、Confirmed At、Last Login At、Current Login At、Last Login IP、Current Login IP、Login Count
    
      - ユーザー行にて鉛筆アイコンを押すと、該当ユーザーを「編集」（Edit）タブに表示し、ユーザーの情報が編集できる
        
          - 入力情報は以下の通りである
            
              - 「Email」：必須項目
            
              - 「Password」  
                デフォルト値：その都度ランダムなパスワードが生成される
            
              - 「Active」  
                デフォルト：チェックなし
            
              - 「Roles」  
                デフォルト：空白  
                選択肢：【Administration \> ユーザー管理（User Management） \> ロール（Role）画面】に登録されているロール一覧  
                ※選択肢にあるもの以外は設定できない
            
              - 「Send User Notification」：登録されているアカウント情報をメールに送信する  
                デフォルト：チェックなし
        
          - ［保存（Save）］ボタンを押すと、設定された内容をユーザー一覧に追加して、メッセージをユーザー一覧に表示させる  
            メッセージ：  
            　日本語：「レコードが正常に作成されました。」  
            　英語：「Record was successfully created.」
        
          - ［保存してもう一つ追加（Save and Add Another）］ボタンを押すと、設定された内容をユーザー一覧に追加して、他のユーザーを追加設定可能とする  
            メッセージを画面上部に表示させる  
            メッセージ：  
            　日本語：「レコードが正常に作成されました。」  
            　英語：「Record was successfully created.」
        
          - ［保存して編集を続ける（Save and Continute Editing）］ボタンを押すと、設定された内容をユーザー一覧に追加して、該当ユーザーの編集を続けることを可能とする  
            メッセージを画面上部に表示させる  
            メッセージ：  
            　日本語：「レコードが正常に作成されました。」  
            　英語：「Record was successfully created.」
        
          - ［キャンセル（Cancel）］ボタンを押すと、設定された内容をユーザー一覧に追加せず、「一覧」（List）タブに戻る
        
          - 表示内容は、accounts\_userテーブル、accounts\_userroleテーブルから取得した情報である
        
          - 「Password」については、暗号化された状態で表示される

  - 「一覧」（List）から「作成」（Create）タブを押すと、「作成」（Create）タブに移動し、ユーザーを新規作成できる
    
      - 入力情報とボタン操作は、編集タブと同じである

  - 「編集」（Edit）、「作成」（Create）ともに、［保存（Save）］ボタンや［保存してもう一つ追加（Save and Add Another）］すると、パスワードが入力されていた場合はハッシュ化される
    
      - 「Password」に全角文字を入力していると、以下のエラーメッセージが表示されて保存されない
        
          - エラーメッセージ：  
            日本語：「レコードの更新に失敗しました。'ascii' codec can't decode byte 0xe3 in position 0: ordinal not in range(128)」  
            英語：「 to update record. 'ascii' codec can't decode byte 0xe3 in position 0: ordinal not in range(128)」
    
      - ハッシュ化されたパスワードがさらにハッシュ化されることはない

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - invenio\_accounts（WEKOソース内にforkされていない箇所がある）

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 編集タブで［保存（Save）］ボタンを押すと、以下の内容でフォームデータが送信される
    
      - 「email」：画面上の「Email」で入力されたもの
    
      - 「password」：画面上の「Password」で入力されたもの
    
      - 「active」：画面上の「Active」がチェックされていた場合のみ、「y」が設定される  
        チェックされていなかった場合はフォームデータに含まれない
    
      - 「roles」：画面上の「Roles」でロールが選択されていた場合のみ、  
        チェックされていなかった場合はフォームデータに含まれない
    
      - 「notification」：画面上の「Send User Notification」がチェックされていた場合のみ、「y」が設定される  
        チェックされていなかった場合はフォームデータに含まれない

  - パスワードはflask\_security.utils. hash\_passwordメソッドでハッシュ化している
    
      - 全角文字を設定していると、この中のasciiでデコードする段階で失敗する

  - 送信されたフォームデータによって、accounts\_userテーブルとaccounts\_userroleテーブルの内容が更新される

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### ユーザープロファイル

  - > 目的・用途

本機能は、ユーザーのユーザー名、タイムゾーン、言語を個別に設定する際に用いる機能である。

  - > 利用方法

【Administration \> ユーザー管理（User Management） \> ユーザープロファイル（User Profile）画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【ユーザープロファイル（User Profile）画面】には以下のタブが表示される
    
      - 一覧（List）
    
      - フィルターを追加▼（Add Filter▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 選択▼（With selected▼）
        
          - 一覧（List）タブ選択中のみ表示
        
          - 外観はタブだが機能としてはプルダウンメニュー
    
      - 編集（Edit）
        
          - 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示
    
      - 詳細（Details）
        
          - 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示

  - 「一覧」（List）タブに登録されているユーザーを表示する
    
      - 表示項目は以下の通りである
        
          - チェックボックス
        
          - アクション（閲覧・編集・削除を表すアイコン）
        
          - 「User Id」
        
          - 「ユーザー名（Username）」
        
          - 「タイムゾーン（Timezone）」
        
          - 「言語（Language）」
    
      - 表示内容は、userprofiles\_userprofileテーブルから取得した情報である
    
      - 「フィルターを追加▼」（Add Filter▼）ボタンをクリックすると、以下の追加可能なフィルターリストを表示し、フィルター名をクリックすると当該フィルターの入力エリアを追加する
        
          - フィルター名
            
              - 「User Id」
                
                  - フィルター方式の選択肢：フィルター方式の選択肢：等しい（equals）、等しくない（not equal）、より大きい（greater than）、より小さい（smaller than）、空（empty）、一覧にある（in list）、一覧にない（not in list）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「ユーザー名（Username）」
                
                  - フィルター方式の選択肢：含む（contains）、含まれていません（not contains）、等しい（equals）、等しくない（not equal）、空（empty）、一覧にある（in list）、一覧にない（not in list）
                
                  - 入力された文字列を使い、選択したフィルター方式で絞り込む
            
              - 「タイムゾーン（Timezone）」
                
                  - フィルター方式の選択肢：上記の「ユーザー名」と同じである
                
                  - プルダウンメニューからタイムゾーンを選択して、選択したフィルター方式で絞り込む
            
              - 「言語（Language）」
                
                  - フィルター方式の選択肢：上記の「ユーザー名」と同じである
                
                  - プルダウンメニューから言語を選択して、選択したフィルター方式で絞り込む
                
                  - 選択肢は、「自動（Automatic）」「日本語（Japanese）」「英語（English）」
        
          - 設定したフィルターは［適用（Apply）］ボタンを押下することで一覧に適用される
        
          - ［フィルターをリセット（Reset filter）］ボタンを押下すると、設定したフィルターがリセットされる
    
      - 「選択▼」（With selected▼）ボタンをクリックすると、以下の追加可能な機能（現在削除ボタンのみ）を表示する
        
          - レコードにチェックを入れない場合、「削除」（Delete）ボタンを押すと、エラーメッセージを表示する  
            メッセージ：  
            　日本語：「少なくとも一つのレコードを選択してください。」  
            　英語：「Please select at least one record.」
        
          - レコードにチェックを入れる場合、「削除」（Delete）ボタンを押すと、確認ダイアログを表示する  
            メッセージ：  
            　日本語：「選択したレコードを削除してもよろしいですか。」  
            　英語：「Are you sure you want to delete selected records?」
            
              - ［OK］ボタンを押すと、該当ロールを削除し、メッセージを画面上部に表示する  
                メッセージ：  
                　日本語：「レコード数＋レコードが正常に削除されました。」  
                　英語：「Record was successfully deleted.」
            
              - ［キャンセル（Cancel）］ボタンを押すと、確認ダイアログを閉じる
    
      - 検索テキストボックスでユーザーを検索する
        
          - プレースホルダー：「Search」
        
          - 任意のテキストを入力し、キーボードでの「Enter」を押すと、ユーザープロファイル検索を行う
        
          - テキストボックスの右端での［X］ボタンを押すと、検索条件がクリアーされる
    
      - ユーザープロファイル行にて目アイコンを押すと、該当ユーザーの詳細情報を「詳細」（Details）タブに表示する
        
          - 表示項目：User Id、Username、Fullname、Timezone、Language
            
              - それぞれ、userprofiles\_userprofileテーブルのuser\_id、username、fullname、timezone、languageフィールドに対応している
        
          - UsernameとFullnameは、設定できる画面がWEKOにないため、userprofiles\_userprofileテーブルを直接編集しない限り空欄となる
            
              - WEKO内では使用する箇所もない
        
          - 一覧タブや編集タブ、各ユーザーが個別に表示するユーザープロフィール画面で表示や編集を行う「ユーザー名（username）」は、userprofiles\_userprofileテーブルではdisplaynameである
    
      - ユーザー行にて鉛筆アイコンを押すと、該当ユーザーを「編集」（Edit）タブに表示し、ユーザーの情報が編集できる
        
          - 編集項目： Username、Timezone、Language
            
              - それぞれ、userprofiles\_userprofileテーブルのdisplayname、timezone、languageフィールドに対応している

  - 関連コンフィグ
    
      - WEKO\_USERPROFILES\_ROLES:
        
          - JGSS専用のコンフィグです。  
            JGSSの4つロール（管理者、一般、院生、学部生）を指定するものです。
    
      - WEKO\_USERPROFILES\_POSITION\_LIST\_GRADUATED\_STUDENT:
        
          - JGSS専用のコンフィグです。  
            JGSSでは、ユーザーの役割を選択した場合、その役割に該当するロールを自動設定するものです。  
            例：役割一覧は以下のコンフィグに定義されています。  
            <https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-user-profiles/weko_user_profiles/config.py#L113-L121>  
            この役割一覧の１つを選択した場合、該当するロールに「学院性」ロールが自動設定されます。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - weko\_user\_profiles

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 一覧タブ表示時は、weko\_user\_profiles.admin.UserProfileView.index\_viewメソッドで情報を取得している

  - 一覧タブの表示内容は、以下のコンフィグで決定している
    
      - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-user-profiles/weko_user_profiles/config.py#L168-L169>
    
      - 設定キー：WEKO\_USERPROFILES\_FORM\_COLUMN
    
      - 以下の表示候補の中から、このコンフィグにあるものを表示している
        
          - User Id
        
          - ユーザー名（Username）
        
          - 氏名（Fullname）
        
          - タイムゾーン（Timezone）
        
          - 言語（Language）
        
          - 大学・機関（University/Institution）
        
          - 所属部局・部署（Affiliated Division/Department）
        
          - 役職（Position）
        
          - 役職（その他）（Position (Others)）
        
          - 電話番号（Phone number）
        
          - 所属学会名（Affiliated Academic Society）
        
          - 所属学会役職（Affiliated Academic Society Position）
            
              - 所属学会名と所属学会役職は最大５つまで設定可能

  - 編集タブ表示時は、UserProfileView\_edit\_viewメソッドで情報の取得、更新を行う
    
      - 「Timezone」の選択肢は、以下のコンフィグで設定している
        
          - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-user-profiles/weko_user_profiles/config.py#L46-L83>
        
          - キー：USERPROFILES\_TIMEZONE\_LIST
    
      - ［保存（Save）］ボタンを押すと、以下の内容でフォームデータが送信される
        
          - 「displayname」：画面上の「ユーザー名（Username）」で入力されたもの
        
          - 「timezone」：画面上の「Timezone」で選択されたもの
        
          - 「language」：画面上の「Language」で選択されたもの
    
      - 送信されたフォームデータによって、userprofiles\_userprofileテーブルの内容が更新される

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

14. ## 設定
    
    1.  ### アイテム表示

<!-- end list -->

  - > 目的・用途

本機能は、アイテム表示・検索に関する設定機能である

  - > 利用方法

【Administration \> Setting (設定) \> Item (アイテム表示)】からアイテム表示における条件の設定を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

使用している画面

  - > 【Administration \> Setting (設定) \> Items（アイテム表示）画面】アイテム表示・検索に関する機能を設定する画面である

E-mailの表示/非表示を設定する

  - > 【Administration \> Setting (設定) \> Items (アイテム表示) 画面】の「Display Email」エリアにてE-Mailの表示（Display Email ）/非表示（Hide Email）を設定することができる。本設定によりアイテム詳細画面、ADMIN14-4 PDFカバーページ および <https://redmine.devops.rcos.nii.ac.jp/projects/weko-dev-doc/wiki/JSON>USER3-7 Export(JSON) 機能 におけるE-Mail出力を制御する。
    
      - Display Email が設定されている場合、アイテム詳細画面、PDFカバーページおよびJSON Export機能にてメールアドレスを表示する。
    
      - Hide Email が設定されている場合、アイテム詳細画面、PDFカバーページおよびJSON Export機能にてメールアドレスを表示しない。
    
      - 「保存」（Save）ボタンを押すと、設定内容を保存する

<!-- end list -->

  - 【Administration \> Setting (設定)\> Items(アイテム表示) 画面】でのOpen Dateエリアにファイルの公開日の表示/非表示を設定する
    
      - 「表示」（Display）を設定する場合、すべてのユーザにはアイテムリスト、アイテム詳細画面に公開日を表示とする
    
      - 「非表示」（Hide Open Date）を設定する場合、ゲストユーザにはアイテムリスト、アイテム詳細画面に公開日を非表示とする
    
      - デフォルト：「表示」（Display）
    
      - 「保存」（Save）ボタンを押すと、設定内容を保存する

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko-records-ui

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - > 【Save (保存)】を押下した際に、weko\_records\_ui.admin.ItemSettingView.indexを呼び出して使用する。
    
      - > weko\_admin.models.AdminSettingを呼び出し、admin\_settingsテーブルを更新する。

  - > weko-records-ui.utils.is\_show\_email\_of\_creator
    
      - <https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-records-ui/weko_records_ui/utils.py#L578-L624>
    
      - 当該アイテムタイプについて、E-Mail表示する場合はTrueを返す。

<!-- end list -->

  - ファイルの公開日の表示/非表示を設定する
    
      - デフォルト状態の設定：
        
          - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-records-ui/weko_records_ui/config.py#L68>
        
          - 設定キー： OPEN\_DATE\_DISPLAY\_FLG
        
          - 現在の設定値：

> OPEN\_DATE\_DISPLAY\_FLG = True

  - > 表示/非表示状態の値を設定する
    
      - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-records-ui/weko_records_ui/config.py#L69-L70>
    
      - 設定キー：OPEN\_DATE\_DISPLAY\_VALUE、OPEN\_DATE\_HIDE\_VALUE
    
      - 現在の設定値：

> OPEN\_DATE\_DISPLAY\_VALUE = '1'
> 
> OPEN\_DATE\_HIDE\_VALUE = '0'

  - > E-mailの表示/非表示を設定する
    
      - デフォルト状態の設定：
        
          - パス：   
            <https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-records-ui/weko_records_ui/config.py#L65>
        
          - 設定キー： EMAIL\_DISPLAY\_FLG
        
          - 現在の設定値：

<!-- end list -->

  - > EMAIL\_DISPLAY\_FLG = True更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### インデックスリンク表示

  - > 目的・用途

この機能はweko上でインデックスリンクを表示するか否かを設定するためのものである。

  - > 利用方法

【Administration \> 設定【Setting】 \> インデックスリンク表示(Index Link)画面】を開き、設定した後、「更新」ボタンを押下する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>〇</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

1\. インデックスリンクエリアの表示/非表示を設定する

  - > 【Administration \> 設定(Setting) \> インデックスリンク表示(Index Link)画面】にインデックスリンクエリアの表示/非表示を設定する
    
      - 「Enable」を選択する場合、インデックスリンクエリアを表示する。
    
      - 「Disable」を選択する場合、 インデックスリンクエリアを表示しない。
    
      - デフォルト：「Disable」

2\. インデックスごとにインデックスリンクの表示/非表示を設定する

  - > 【Administration \> インデックスツリー管理(index tree) \> ツリー編集(Edit Tree)画面】にインデックスごとにインデックスリンクの表示/非表示を設定できる。  
    > また、インデックスごとにインデックスリンクの”表示名”を設定できる。

  - > 設定方法の詳細は[ADMIN-3-1 ツリー編集](\\l)を参照すること。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko\_index\_tree

<!-- end list -->

  - > 処理概要

> インデックスリンク表示設定画面の表示

  - > 【administration \> 設定 \> インデックスリンク表示】画面を開く。この操作によって、weko\_index\_tree.admin.IndexLinkSettingView.indexメソッドがGETで呼び出され、現在のインデックスリンク表示設定をindex\_styleテーブルの列「index\_link\_enabled」から取得し、画面に表示する。  
    > デフォルトでは無効に設定されている。

> インデックスリンク表示設定について

  - > 「更新」ボタンを押下すると、weko\_index\_tree.admin.IndexLinkSettingView.indexメソッドがPOSTで呼び出され、ウェブ上で選択した「有効」または「無効」に応じて、  
    > index\_styleテーブルの列「index\_link\_enabled」を設定する。成功したらweb上側に「IndexLink flag was updated」と表示する。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### 言語表示

  - > 目的・用途

本機能は、リポジトリ管理者として、ユーザーが選択可能な表示言語を設定できる機能である

  - > 利用方法

【Administration \> 設定（Setting） \> 言語設定（Language）画面】にて操作を行う

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

使用している画面

  - 【Administration \> 設定（Setting） \> 言語設定（Language）画面】にて表示言語を設定する
    
      - 「対象言語」(Target language）に設定可能な表示言語をリスト表示する  
        デフォルトリストは以下とする（ ただし、言語実装は日本語、英語のみとする ）
        
          - 日本語\[Japanese ja\]
        
          - 英語(米)\[English en\]
        
          - 中国簡体\[Chinese zh\]
        
          - インドネシア語\[Indonesian id\]
        
          - ベトナム語\[Vietnamese vi\]
        
          - マレー語\[Malay ms\]
        
          - タガログ語\[Filipino (Pilipinas) fil\]
        
          - タイ語\[Thai th\]
        
          - ヒンディー語\[Hindi hi\]
    
      - 言語リストから表示言語とする言語を選択して、\[\>\]ボタンを押すと、「登録言語」（Registered language）に選択言語の表示が移る  
        選択肢は同時に複数選択可能とする
    
      - 選択言語リストから任意言語を選択して、\[\<\]ボタンを押すと、「登録言語」（Registered language）から「対象言語」(Target language）に表示が移る
    
      - 登録言語リストから任意言語を選択しない場合、\[↟\]、\[ʌ\]、\[ⅴ\]、\[↡\]ボタンを無効とする
    
      - 登録言語リストから任意言語を選択している場合
        
          - \[↟\]ボタンを押すと、登録言語リストの上頭に表示が移る
        
          - \[ʌ\]ボタンを押すと、登録言語リストの１つ上言語に表示が移る
        
          - \[ⅴ\]ボタンを押すと、登録言語リストの１つ下言語に表示が移る
        
          - \[↡\]ボタンを押すと、登録言語リストの下頭に表示が移る
    
      - 登録言語リストが空である間は、［保存（Save）］ボタンは非活性になる
    
      - ［保存（Save）］ボタンを押すと、「登録言語」（Registered language）の対象が表示言語として設定され、メッセージを画面上部に表示される
        
          - メッセージ：「Update languages action successfully」
        
          - 変更された内容をデータベースに保存する
            
              - テーブル名：admin\_lang\_settings
            
              - カラム名：  
                ・lang\_code  
                ・lang\_name  
                ・is\_registered  
                ・sequence  
                ・is\_active

  - 【言語設定（Language）画面】で設定した表示言語は、ユーザ側の表示言語選択プルダウンから使用可能となる
    
      - 【言語設定（Language）画面】で設定した順番でプルダウン表示する
    
      - 【言語設定（Language）画面】で設定した順番の一番上の言語をデフォルト表示とする

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - weko\_admin

<!-- end list -->

  - > 処理概要

1\. 設定

  - 言語一覧のデフォルトを設定する
    
      - パス： <https://github.com/RCOSDP/weko/blob/v0.9.22/scripts/populate-instance.sh#L343-L368>  
        ※「登録言語」に対して、以下の設定を追加する  
        ・「--registered」をステータス後に追加する  
        ・表示位置を最後の属性で設定する
    
      - 現在の設定：

> ${INVENIO\_WEB\_INSTANCE} language create \\
> 
> \--active --registered "en" "English" 001
> 
> ${INVENIO\_WEB\_INSTANCE} language create \\
> 
> \--active "zh" "中文" 000
> 
> ${INVENIO\_WEB\_INSTANCE} language create \\
> 
> \--active "id" "Indonesia" 000
> 
> ${INVENIO\_WEB\_INSTANCE} language create \\
> 
> \--active "vi" "Tiếng Việt" 000
> 
> ${INVENIO\_WEB\_INSTANCE} language create \\
> 
> \--active "ms" "Bahasa Melayu" 000
> 
> ${INVENIO\_WEB\_INSTANCE} language create \\
> 
> \--active "fil" "Filipino (Pilipinas)" 000
> 
> ${INVENIO\_WEB\_INSTANCE} language create \\
> 
> \--active "th" "ไทย" 000
> 
> ${INVENIO\_WEB\_INSTANCE} language create \\
> 
> \--active "hi" "हिन्दी" 000
> 
> ${INVENIO\_WEB\_INSTANCE} language create \\
> 
> \--active --registered "ja" "日本語" 002
> 
> 対象言語一覧に言語を追加する場合、以下のコマンドを実施する
> 
> docker-compose exec web invenio language create --active "言語コード" "言語名" 000

2\. 画面操作にともなう処理

  - 画面表示時に、weko\_admin.views. get\_lang\_list関数が呼び出される
    
      - レスポンスとして、admin\_lang\_settingsテーブルから「is\_active」フィールドがtrueであるレコードを「sequence」昇順で受け取る
    
      - 各レコードの言語は、「is\_registered」フィールドがtrueなら登録言語リストに、falseなら対象言語リストに配置する

  - ［保存（Save）］ボタンを押すと、.views.save\_lang\_list関数が呼び出される
    
      - リクエストのペイロードとして、要素が以下の内容であるJSON配列を送り、配列要素ごとにadmin\_lang\_settingsテーブルの「lang\_code」フィールドが配列要素の「lang\_code」に一致するレコードをその配列要素の内容で更新する。
        
          - is\_registered：登録言語にある場合はtrue、そうでなければfalse
        
          - lang\_code：言語コード
        
          - lang\_name：言語名
        
          - sequence：表示順（対象言語リストにある場合は0固定）

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### PDFカバーページ表示

  - > 目的・用途

本機能は、PDFカバーページについて設定する際に使用する機能である。

  - > 利用方法

【Administration \> 設定（Setting） \> PDFカバーページ表示（PDF Cover Page）画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - インデックス全体のPDFカバーページについて設定する
    
      - 「PDF Cover Page」エリアにてPDFカバーページの有効/無効を設定する
        
          - 「ON/OFF」：利用可否設定
            
              - 「Enable」を選択する場合、PDFカバーページ機能を有効とする
            
              - 「Disable」を選択する場合、PDFカバーページ機能を無効とする（デフォルト）
    
      - 「Header Settings」エリアにてヘッダのカバーページを設定する
        
          - 「Header Display Setting」：ヘッダ表示設定
            
              - 「String」：文字列表示（デフォルト）
            
              - 「Image」：画像表示
        
          - 「Header Output String Setting」：ヘッダ出力文字列設定  
            ※文字列表示の場合に使用する。操作自体はヘッダ表示設定にかかわらず可能
            
              - 半角100文字/全角50文字以内の文字列を入力する
        
          - 「Header Output Image Setting」：ヘッダ出力画像設定  
            ※画像表示の場合に使用する。操作自体はヘッダ表示設定にかかわらず可能
            
              - jpg,png,gifが設定可能
                
                  - すべての種類のファイルが設定できるが、上記以外のファイルを選択するとPDFファイルのダウンロード時にサーバ内部エラーが発生する
            
              - ［ファイルを選択（Choose File）］ボタンを押してファイルを選択する
                
                  - 設定済みかどうかにかかわらず、画面表示後に選択されていない場合はボタンの右側に以下のメッセージが表示される  
                    メッセージ：  
                    日本語：「選択されていません」  
                    英語：「No file chosen」
            
              - ファイルが設定されていない状態では、［ファイルを選択（Choose File）］ボタン上部にメッセージが表示される  
                メッセージ：「No header image set」
            
              - 画像ファイルが設定済みの状態では、［ファイルを選択（Choose File）］ボタン上部にその画像が表示される
            
              - 画像ファイルが選択された状態では、［ファイルを選択（Choose File）］ボタン下部にその画像が表示される
        
          - 「Header Display Position Setting」：ヘッダ表示位置設定
            
              - 「Left justified」：右寄り
            
              - 「Center justified」：中央寄せ（デフォルト）
            
              - 「Right justified」：左寄せ

  - ［保存（Save）］ボタンを押すと、各エリアの設定値が保存される
    
      - 「Header Output Image Setting」でファイルを選択していた場合、ヘッダ出力画像は選択したものに置き換えられる

  - インデックスごとにカバーページの有効/無効を設定する
    
      - 詳細は[ADMIN-3-1: ツリー編集](#ツリー編集)参照

  - ここで設定したPDFカバーページ設定は、PDFファイルのダウンロード時に参照する
    
      - 画像表示の場合、カバーページでは高さが30mmかつ縦横比は元画像と同じになるように拡大、縮小して表示される
    
      - 目的のPDFファイルがパスワードによって暗号化されていた場合は、カバーページをつけずにダウンロードする
    
      - カバーページをつけたPDFファイルは、ファイル名を「CV\_yyyymmdd\_もともとのファイル名.pdf」となる

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - weko\_records\_ui

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 画面表示時に、pdfcoverpage\_setテーブルから「id」フィールドが「1」であるレコードを取得する
    
      - 取得できなかった場合は、以下の処理を行う
        
          - 各フィールドを以下のように設定してレコードを作成する
            
              - 「id」：自動採番
            
              - 「avail」：disable
            
              - 「header\_display\_type」：なし（テーブルのデフォルト値のstringが入る）
            
              - 「header\_output\_string」：なし
            
              - 「header\_output\_image」：なし
            
              - 「header\_display\_position」：なし（テーブルのデフォルト値のcenterが入る）
        
          - 作成後に再度「id」フィールドが「1」であるレコードを取得する
            
              - そこで取得できなかった場合は、サーバ内部エラーが発生する
    
      - 取得した情報を表示情報とする
        
          - 「header\_output\_image」フィールドの情報は、テンプレートのimg要素のソースとなる

  - ［保存（Save）］ボタンを押すと、pdfcoverpage\_setテーブルの「id」が「1」であるレコードを以下のように更新する
    
      - 「avail」：「ON/OFF」で選択したもの
    
      - 「header\_display\_type」：「Header Display Setting」で選択したもの
    
      - 「header\_output\_string」：「Header Output String Setting」の入力値
    
      - 「header\_output\_image」：以下の２通り
        
          - ファイルが選択されていなかった場合、そのまま
        
          - ファイルが選択されていた場合、システムにそのファイルを保存して、ファイルのパスを設定する
    
      - 「header\_display\_position」：「Header Display Position Setting」で選択したもの

  - 「Header Output Image Setting」でファイルを選択したとき、そのファイルをFileReader.readAsDataURLメソッドによってBase64でエンコードする
    
      - このメソッドは、テンプレートに記述されている
    
      - エンコードした文字列を、ボタン下部のimage要素のsrc属性に設定する
    
      - 大きなファイルをエンコードする場合は、エンコード後の文字列がjavascriptの変数に入りきらずにエラーとなることがある

  - ここで設定したPDFカバーページ設定は、PDFファイルのダウンロード時に参照する
    
      - weko\_records\_ui.fd.\_download\_file関数で条件を確認して、以下のいずれかの場合には、カバーページをつけずにダウンロードする
        
          - ファイルのmimetypeがPDFでない
        
          - pdfcoverpage\_setテーブルに「id」が「1」であるレコードが存在しない
        
          - レコードで「avail」がdisableである
        
          - 対象アイテムが属するインデックスで、PDFカバーページ設定が無効である
        
          - オリジナルのPDFファイルをダウンロードできる権限がある状態で、そうする操作である
    
      - そうでない場合は、 weko\_records\_ui.pdf.make\_combined\_pdf関数を呼び出してカバーページ付きのPDFファイルを作成して、そのファイルをダウンロードする
        
          - カバーページ付きのPDFファイルは、以下の場所に作成される
            
              - tempfile.gettempdir関数の返り値+「/comb\_pdfs/」

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### ランキング表示

  - > 目的・用途

本機能は、アイテムの閲覧回数やファイルのダウンロード回数やアイテムの作成ユーザーなどのランキングを閲覧を設定する機能である。

  - > 利用方法

【Administration \> Setting (設定) \> Ranking (ランキング表示)からランキングの機能を設定する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - リポジトリ管理者として、【Administration \> Setting (設定) \> Ranking(ランキング表示) 画面】にランキングの機能に対して設定を実行する
    
      - 設定項目は以下の通りである

<table>
<thead>
<tr class="header">
<th>#</th>
<th>設定項目</th>
<th>設定方法</th>
<th>デフォルト</th>
<th>概要</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>「ランキングの表示/非表示」（Show/Hide Ranking）</td>
<td>・「オン」（On）</td>
<td>「オフ」（Off）</td>
<td>Web画面でランキングタブの表示可否を設定する</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>・「オフ」（Off）</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>2</td>
<td>「新着アイテムとして判断する期間」（Period To Judge As New Item）</td>
<td>N日（Day）</td>
<td>14日</td>
<td>新規に登録されたアイテムとして判断する期間。アイテム登録日からの経過日数を指定する。ただし、設定できる範囲は1日～30日とする</td>
</tr>
<tr class="even">
<td>3</td>
<td>「統計期間」（Statistical Period）</td>
<td>N日（Day）</td>
<td>365日</td>
<td>ランキングとして表示する期間。本日から何日前までを集計期間とするかを指定する。ただし、設定できる範囲は1~3650日とする</td>
</tr>
<tr class="odd">
<td>4</td>
<td>「表示する順位」（Display Rank）</td>
<td>N位</td>
<td>10位</td>
<td>ランキングとして表示する順位を指定する.最大値を100位までとする</td>
</tr>
<tr class="even">
<td>5</td>
<td>「ランキング」（Rankings）</td>
<td>・「最も閲覧されたアイテム」（The Most Viewed Items）</td>
<td>チェックボックスの<br />
チェックなし</td>
<td>Web画面で表示するランキングの種類を設定する。チェックボックス方式で、複数選択可能とする。<br />
チェックの付いた項目をWeb画面のランキングタブに表示する。</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>・「最もダウンロードされたアイテム」（Most Downloaded Items）</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>・「最もアイテムを作成したユーザー」（User Who Created The Most Items）</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>・「最も検索されたキーワード」（Most Searched Keywords）</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>・「新着アイテム」（New Items）</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - 「保存」（Save）ボタンを押すと、画面上の設定情報を保存し、メッセージを画面上部に表示する  
    メッセージ：  
    日本語：「設定を変更しました」  
    英語：「Successfully Changed Settings.」

  - 以下のエラー条件に１つでも当てはまる場合、「保存」（Save）ボタンを押すと、エラーメッセージを画面上部に表示する  
    エラー条件：  
    ・「新着アイテムとして判断する期間」で1～30以外の自然数を設定した場合  
    ・「統計期間」で1\~3650以外の自然数を設定した場合  
    ・「表示する順位」で1\~100以外の自然数を設定した場合  
    エラーメッセージ：  
    日本語：「設定変更に失敗しました」  
    英語：「Failurely Changed Settings.」

  - 「新着アイテムとして判断する期間」「統計期間」「表示する順位」で文字列や小数、負の値、０など、上記のエラー条件以外の値を入れた場合、「指定されている形式で入力してください」というポップアップを表示する

  - 「削除」（Delete）ボタンを押すと、入力中の値が破棄され、入力前の保存された設定情報を表示する

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko\_items\_ui

  - > invenio\_stats

  - > weko\_admin

<!-- end list -->

  - > 処理概要

> 【Administration \>Setting (設定) \>Ranking (ランキング表示)】 からランキングの条件を入力し、【保存(Save)】を押下すると、weko\_admin.models.RankingSettings.updateが呼び出される。ranking\_settingテーブルを入力された情報をもとに更新する。
> 
> \[Administration \>Setting (設定) \>Ranking (ランキング表示)\] からランキングの条件を入力したあと【削除(Delete)】を押下すると、weko\_admin.models.RankingSettings.deleteが呼び出され、ranking\_settingテーブルから入力中の値を削除し、入力前の保存された設定情報を取得する。

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### 統計情報表示

  - > 目的・用途

本機能は、アイテムの利用統計情報を閲覧を設定する機能である

  - > 利用方法

【Administration \> Setting (設定) \> Stats (統計情報表示) 画面】から、アイテムの統計情報の表示/非表示を設定する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

使用している画面

  - 【Administration \> Setting (設定) \> Stats (統計情報表示) 画面】：アイテムの利用統計情報の表示/非表示を設定する画面である

  - 【アイテム詳細画面】：利用統計情報を表示する画面である

  - 【ファイル詳細画面 (information)】：コンテンツファイル単位の統計情報を表示する画面である

1\. アイテムの利用統計情報を表示する

  - アイテムの利用統計情報の表示/非表示を設定する
    
      - 【Administration \> Setting (設定) \> Stats (統計情報表示) 画面】での「統計設定」における「レコード統計の表示/非表示」（Show/Hide Record Stats）エリアにアイテムの利用統計情報の表示/非表示を設定する
        
          - 「オン」（On）にすると、アイテム詳細表示画面に利用統計エリア\[Stats\]を表示する
        
          - 「オフ」（Off）にすると、アイテム詳細表示画面に利用統計エリア\[Stats\]を非表示とする
        
          - デフォルト：「オン」（On）
        
          - 「保存」（Save）ボタンを押すと、設定内容を保存し、メッセージを画面上部に表示する  
            メッセージ：  
            　日本語：「設定を変更しました」  
            　英語：「Successfully Changed Settings.」

  - アイテムの利用統計情報を表示する
    
      - アイテム単位の閲覧回数は、【アイテム詳細画面】での「Views」エリアに表示する
    
      - 閲覧回数は、 invenio-statsにてログ集計した値とする
    
      - 閲覧回数は、全ドメインと各ドメイン毎（トップレベルドメイン毎）で集計値を表示する
        
          - 各ドメイン毎（トップレベルドメイン毎）はデフォルト表示は"非表示"とし、「詳細を確認」（See details）リンクを押すことで表示する
            
              - 確定できないドメインに対して、「UNKNOWN」として表示する
    
      - 閲覧回数は、集計機関プルダウン「Period」より年月を選択することで指定期間の数値を表示する
        
          - デフォルトは全期間の数値（total）とする

2\. コンテンツファイル単位の統計情報を表示する

  - 【ファイル詳細画面 (Information)】での「統計」（Stats）タブにコンテンツファイル単位の統計情報を表示する
    
      - 表示項目は以下の通りである
        
          - ダウンロード回数は、「ダウンロード数」（Downloads）エリアに表示する
        
          - 再生回数は、「再生回数」（Plays）エリアに表示する
    
      - ダウンロード回数と再生回数は、invenio-statsにてログ集計した値とする
        
          - 統計情報は、全ドメインと各ドメイン毎（トップレベルドメイン毎）で集計値を表示する
        
          - 各ドメイン毎（トップレベルドメイン毎）はデフォルト表示は"非表示"とし、「詳細を確認」（See details）リンクを押すことで表示する
            
              - 確定できないドメインに対して、「UNKNOWN」として表示する
        
          - 統計情報は、集計機関プルダウン「Period」より年月を選択することで指定期間の数値を表示する
            
              - デフォルトは全期間の数値 (total) とする

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko\_admin

  - > weko\_records\_ui

  - > invenio\_stats

<!-- end list -->

  - > 処理概要

> 【Administration \> Setting (設定) \> Stats (統計情報表示)】において、統計情報の表示/非表示を選択して【Save (保存)】を押下すると、weko\_admin.StatsSettingsView.indexを呼び出して使用する。

  - > weko\_admin.models.AdminSettings.updateを呼び出して、admin\_settingsテーブルから、「display\_stats\_settings」カラムを更新する。

> weko\_admin.models.AdminSettings.getで「display\_stats\_settings」を取得して、  
> 「WEKO\_ADMIN\_STATS\_SETTINGS\_TEMPLATE」に沿って、  
> flask\_admin.base.BaseView.renderで更新した状態の統計情報表示設定画面を表示する。「WEKO\_ADMIN\_STATS\_SETTINGS\_TEMPLATE」：weko\_admin.config

  - > 'weko\_admin/admin/stats\_settings.html'

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### 画面背景色

  - > 目的・用途

本機能は、画面背景色表示を設定する機能である

  - > 利用方法

【Administration \> 設定(Setting) \> 画面背景色(Style)画面】を開き、色を選択後「保存」ボタンを押下する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>〇</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

画面背景色表示を設定する

  - > 【Administration \> 設定(Setting) \> 画面背景色(Style)画面】に画面背景色表示を設定する。
    
      - 現在選択している色を表示する。
    
      - 背景１の下にある四角をクリックすると、背景色を設定できる。
    
      - 画面背景色表示の設定は、背景色をカラーピッカーから選択できる。
        
          - また、背景色をカラーモデルで指定できる。  
            対応しているカラーモデル：RGB、HSL、HEX
    
      - 「保存」（Save）ボタンを押すと、設定内容を保存し、メッセージを画面上部に表示する。  
        メッセージ：「Successfully update color.」

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - 
  - > weko\_theme

<!-- end list -->

  - > 処理概要

> 画面背景色表示について

  - > 【Administration \> 設定 \> 画面背景色】画面を開く。この操作によって、weko\_admin.templates.weko\_admin.admin.block\_styleにてweko\_admin.admin.StyleSettingView.indexがGETで呼び出され、変数WEKO\_THEME\_INSTANCE\_DATA\_DIRに保存されているディレクトリの\_variables.scssより現在の色設定を取得し、画面に表示する。

> 画面背景色設定

  - > 背景１下の四角を押下した時、weko\_admin.templates.weko\_admin.admin.block\_style.htmlよりカラーピッカーが表示される。このとき表示される色は現在設定されている色で表示される。

  - > 色を選択し、「保存」ボタンを押下する。この操作によって、weko\_admin.admin.StyleSettingView.indexがPUTで呼び出され、背景１で選択されている色の数値を変数WEKO\_THEME\_INSTANCE\_DATA\_DIRに保存されているディレクトリの\_variables.scssに保存する。

  - > なお、変数WEKO\_THEME\_INSTANCE\_DATA\_DIRはweko\_theme.config.pyに保存されている変数である。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

### 識別子

  - > 目的・用途

本機能は、ワークフロー中でアイテムに付与するための識別子を作成、編集する際に使用する機能である。

  - > 利用方法

【Administration \> 設定（Setting） \> 識別子（Identifier）画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【識別子（Identifier）画面】には以下のタブが表示される
    
      - 一覧（List）
    
      - 作成（Create）
    
      - 編集（Edit）
        
          - 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示
    
      - 詳細（Details）
        
          - 一覧（List）タブ選択中は非表示
        
          - 一覧（List）タブの操作によって表示される
        
          - 編集（Edit）タブまたは詳細（Details）タブ選択中に表示

  - 「一覧」（List）タブにて識別子情報を表示する
    
      - 表示項目は以下の通りである
        
          - アクション（閲覧・編集を表すアイコン）
        
          - 「Repository」
        
          - 「JaLC DOI」
        
          - 「JaLC CrossRef DOI」
        
          - 「JaLC DataCite DOI」
        
          - 「NDL JaLC DOI」
        
          - 「Semi-automatic Suffix」
        
          - 「Jalc Flag」
        
          - 「Jalc Crossref Flag」
        
          - 「Jalc Datacite Flag」
        
          - 「Ndl Jalc Flag」
    
      - 識別子行にて目アイコンを押すと、該当識別子の詳細情報を「詳細」（Details）タブに表示する
        
          - 表示項目：Repository、JaLC DOI、JaLC CrossRef DOI、JaLC DataCite DOI、NDL JaLC DOI、Semi-automatic Suffix、Created Userid、Created Date、Updated Userid、Updated Date
        
          - 「移動」（Filter）テキストボックスにテキストを入力すると、入力値が項目名またはその値に含まれている項目に絞り込んで表示する
    
      - 識別子行にて鉛筆アイコンを押すと、該当識別子を「編集」（Edit）タブに表示し、編集できる

  - 「作成」（Create）タブにて新規作成、または「編集」（Edit）タブにて既存の情報を編集する
    
      - 「Prefix」領域の入力値により、テナント別に各DOI発行機関のプレフィックス情報を設定
        
          - プレフィックス設定項目は以下の通り
            
              - Reposiitory(必須)：プルダウン
                
                  - 「Root Index」または「communities\_community」テーブルの各レコードのidを選択肢とする
            
              - JaLC DOI：自由入力。100字まで入力可能
            
              - JaLC CrossRef DOI：自由入力。100字まで入力可能
            
              - JaLC DataCite DOI：自由入力。100字まで入力可能
            
              - NDL JaLC DOI：自由入力。100字まで入力可能
    
      - 「Suffix」領域の設定値の入力値により、テナント別にサフィックスの前半部分を設定
        
          - サフィックス設定項目は以下の通り
            
              - Semi-automatic suffix：自由入力
    
      - 「Enable/Disable」領域の設定により、テナント別に各DOI発行機関の利用可否を設定
        
          - Disableに設定されているDOIは、入力欄が非活性化する
    
      - ［保存（Save）］ボタンを押すと、入力値のエラーチェックを行う
        
          - 「Repository」の選択値について、作成時に登録済みのリポジトリを選択したか、編集時に登録済みの他のリポジトリに変更した場合、画面上部に以下のエラーメッセージが表示される
            
              - エラーメッセージ：  
                日本語：「指定したリポジトリが既に登録されています。」  
                英語：「Specified repository is already registered.」
        
          - 各プレフィックスの入力欄と、サフィックスの入力欄では、全角文字が入力されていると、該当する入力欄の下にエラーメッセージが表示される
            
              - エラーメッセージ：「Only allow half with 1-bytes character in input」
        
          - エラーが発生した場合、保存されず、画面の「Repository」の選択値が「Root Index」に変わる
        
          - エラーチェックを通過すると、「doi\_identifier」テーブルを更新する。その後、設定された内容を反映した「一覧」（List）タブに移動して、メッセージを画面上部に表示する
            
              - メッセージ：  
                　日本語：「レコードが正常に作成されました。」  
                　英語：「Record was successfully created.」
    
      - ［保存してもう一つ追加（Save and Add Another）］ボタンを押すと、［保存（Save）］ボタンによるものと同様の処理を行い、チェック通過時には「一覧」（List）タブのかわりに「作成」（Create）タブに移動して、同様のメッセージを画面上部に表示する
    
      - ［保存して編集を続ける（Save and Continute Editing）］ボタンを押すと、［保存（Save）］ボタンによるものと同様の処理を行い、チェック通過時には他のタブに移動せずに、同様のメッセージを画面上部に表示する
    
      - ［キャンセル（Cancel）］ボタンを押すと、設定された内容を反映せず、「一覧」（List）タブに戻る

  - 作成した情報は、以下の画面で利用する
    
      - 【Administration \> ワークフロー管理（WorkFlow） \> フロー（Flow List） \> Create Flow画面】
        
          - フローにて「Item Registration」のアクション後に「Identifier Grant」のアクションを定義
        
          - 詳細は[ADMIN-7-1: フロー](#フロー)参照
    
      - 【Administration \> ワークフロー管理（WorkFlow） \> ワークフロー（WorkFlow List） \> Create WorkFlow画面】
        
          - 「Identifier Grant」がフローに含まれるワークフローを定義
        
          - 詳細は[ADMIN-7-2: ワークフロー](#ワークフロー-2)参照

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - weko\_admin

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 「作成」（Create）タブの表示時には、weko\_admin.admin.IdentifierSettingView.create\_formメソッドから同クラスの\_use\_append\_repositoryメソッド、そこから同クラスの\_get\_community\_listメソッドを呼び出して、communities\_communityテーブルの情報を取得する

  - 「編集」（Edit）タブの表示時には、weko\_admin.admin.IdentifierSettingView.edit\_formメソッドから同クラスの\_use\_append\_repository\_editメソッド、そこから同クラスの\_get\_community\_listメソッドを呼び出して、communities\_communityテーブルの情報を取得する

  - 入力値のバリデーションチェックは、weko\_admin.admin.IdentifierSettingView.validate\_formメソッドの中で、同クラスの\_validator\_halfwidth\_inputメソッドで行う

  - 「doi\_identifier」テーブルの更新時にweko\_admin.admin.IdentifierSettingView. on\_model\_changeメソッドが呼び出されて、以下の設定値を作成する
    
      - 「created\_userId」（作成時のみ）：操作しているユーザのid
    
      - 「created\_date」（作成時のみ）：現在の日時を取得して、マイクロ秒部分を0に置き換える
    
      - 「updated\_userId」：操作しているユーザのid
    
      - 「updated\_date」：現在の日時を取得して、マイクロ秒部分を0に置き換える
    
      - 「repository」：「Repository」プルダウンで選択したもののid

  - 「doi\_identifier」テーブルのレコードは、以下のように更新する
    
      - 「id」：作成時に自動採番
    
      - 「repository」：上述のon\_model\_changeメソッドで作成したもの
    
      - 「jalc\_flag」：「Enable/Disable」領域での設定
    
      - 「jalc\_crossref\_flag」：「Enable/Disable」領域での設定
    
      - 「jalc\_datacite\_flag」：「Enable/Disable」領域での設定
    
      - 「ndl\_jalc\_flag」：「Enable/Disable」領域での設定
    
      - 「jalc\_doi」：「JaLC DOI」入力欄の入力値
    
      - 「jalc\_crossref\_doi」：「JaLC CrossRef DOI」入力欄の入力値
    
      - 「jalc\_datacite\_doi」：「JaLC DataCite DOI」入力欄の入力値
    
      - 「ndl\_jalc\_doi」：「NDL JaLC DOI」入力欄の入力値
    
      - 「suffix」：「Semi-automatic Suffix」入力欄の入力値
    
      - 「created\_userId」：上述のon\_model\_changeメソッドで作成したもの
    
      - 「created\_date」：上述のon\_model\_changeメソッドで作成したもの
    
      - 「updated\_userId」：上述のon\_model\_changeメソッドで作成したもの
    
      - 「updated\_date」：上述のon\_model\_changeメソッドで作成したもの

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### アイテム一括出力

  - > 目的・用途

この機能は、USER-2-4の機能であるアイテム一括出力の可否を設定するものである。

  - > 利用方法

【Administration \> 設定(Setting) \> アイテム一括出力(Item Export)画面】を開き、設定後「保存」ボタンを押下する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【Administration \> 設定(Setting) \> アイテム一括出力(Item Export)画面】にアイテムの一括出力を設定する。
    
      - アイテムの一括出力可否（Allow/Disallow Item Exporting）  
        　アイテムの一括出力の機能を「設定する／設定しない」を設定する。
        
          - オン(On)：アイテム一括出力の機能を有効にする。
        
          - オフ(Off)：アイテム一括出力の機能を無効にする。
    
      - コンテンツファイルの出力可否（Export File Contents）  
        　アイテムの一括出力をする際に、コンテンツファイルを含めて「出力する／出力しない」を設定する。
        
          - オン(On)：コンテンツファイルを含めて出力するように設定する。
        
          - オフ(Off)：コンテンツファイルは含めずに出力するように設定する。
    
      - 一括出力できる最大アイテム数はconfigで設定する。デフォルトは最大100件とする。
    
      - 「保存」（Save）ボタンを押すと、設定情報をデータベースに格納する。

  - アイテム一括出力の仕方の詳細は[USER-2-4アイテム一括出力](\\l)を参照すること。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko\_admin

<!-- end list -->

  - > 処理概要

> アイテム一括出力画面の表示

  - > 【Administration \> 設定 \> アイテム一括出力】画面を開く。この操作によって、weko\_admin.admin.ItemExportSettingView.indexメソッドがGETで呼び出され、\_get\_current\_settingsメソッドでadmin\_settingテーブルのキーitem\_export\_settingsより現在の設定を取得後画面に表示する。

> アイテム一括出力の設定

  - > 任意の設定をした後、「保存」ボタンを押下する。この操作によって、weko\_admin.admin.ItemExportSettingView.indexメソッドがPUTで呼び出され、AdminSettings.updateでadmin\_settingテーブルのキーitem\_export\_settingsに設定が保存される。そして、更新された設定と"Successfully Changed Settings"を画面に表示する。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### ログ解析

  - > 目的・用途

本機能は、リポジトリ管理者として、利用統計の集計除外とするIPアドレスとユーザエージェントを設定できる機能である

  - > 利用方法

【Administration \> 設定（Setting） \> ログ解析（Log Analysis）画面】にて操作を行う

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 利用統計の集計除外とするIPアドレスとユーザエージェントを設定する
    
      - 「フィルタリングするIPアドレスの入力」（Enter the IP Addresses to Filter）
        
          - ログ解析から除外するIPアドレスを指定する
        
          - 各入力欄は、半角数字以外の入力は自動的に削除するようになっている
        
          - IPアドレスは複数入力可能とし、［+］ボタンを押すと、IPアドレスを入力するエリアを追加する
        
          - ［x］ボタンを押すと、該当入力エリアを削除する
        
          - ［+］、［x］ボタンは、一番下の行にのみ表示される
    
      - 「共有クローラーリスト」（Shared Crawler Lists）
        
          - ログ解析から除外するIPアドレス、ユーザエージェントの部分一致キーワードリストを定義し、ネットワークを介して取得、設定する
        
          - デフォルトは以下の通りである
            
              - IPアドレスリスト  
                <https://bitbucket.org/niijp/jairo-crawler-list/raw/master/JAIRO_Crawler-List_ip_blacklist.txt>
            
              - ユーザエージェントリスト  
                <https://bitbucket.org/niijp/jairo-crawler-list/raw/master/JAIRO_Crawler-List_useragent.txt>
            
              - 共用クローラーリストの使用可否は、チェックボックスで設定できる
    
      - ［保存（Save）］ボタンを押下すると、削除してよいかの確認用のモーダルを表示する  
        メッセージ：  
        　日本語：「与えられたアドレスをブロックしてもよろしいですか？」  
        　英語：「Are you sure you want to block the given addresses?」
        
          - ［保存（Save）］：
            
              - 除外対象アドレスおよび共用クローラーリストが、画面の設定内容で更新される
            
              - 画面上部に以下のメッセージが表示される  
                メッセージ：  
                　日本語：「設定を変更しました」  
                　英語：「Successfully Changed Settings.」
        
          - ［閉じる（Close）］：
            
              - モーダルを閉じて、設定画面に戻る

  - ブロックの処理
    
      - 利用統計等の集計時に参照するアクセスログに対し、除外対象アドレスおよび共用クローラーリストから、指定されたIPアドレス、ユーザエージェントを持つアクセスログが集計されないようになる
    
      - 除外されるアクセスログは、画面上で設定したIPアドレスおよび共用クローラーリストに記載されているIPアドレスを持つアクセスログと、共用クローラーリストに記載されている文字列に部分一致するユーザエージェントを持つアクセスログとする
        
          - weko\_admin.config.WEKO\_ADMIN\_USE\_REGEX\_IN\_CRAWLER\_LIST = True とすると正規表現を利用することができる
    
      - 除外されるアクセスログは、ESへ「is\_restricted」がtrueとして登録される
        
          - 通常はfalseとして登録される
        
          - 登録済みのアクセスログには影響しない

  - 設定による影響
    
      - 影響を受ける集計結果は以下のものとする
        
          - ランキング
        
          - 利用統計
        
          - サイトライセンスフィードバックメール送信
        
          - 利用統計フィードバックメール送信
        
          - 定型レポート
        
          - カスタムレポート
    
      - 設定した情報は、IPアドレスについてはloganalysis\_restricted\_ip\_addressテーブルに、共有クローラーリストについてはloganalysis\_restricted\_crawler\_listテーブルに保存される
        
          - 共有クローラーリストのURLの参照先の情報はRedisに保存される
    
      - 画面にてIPアドレスを削除、または共用クローラーリストを有効から無効に変更しても、一度除外されたアクセスログは集計されない

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > invenio-stats：register\_events 関数にて、各インデックスに対する処理クラス、前処理を設定している

  - > weko-admin：画面表示と集計除外処理を定義する

  - > weko-redis：集計除外処理中で、Redisとの接続を管理する

<!-- end list -->

  - > 処理概要

1\. 画面表示

  - 画面表示時には、weko\_admin.admin.LogAnalysisSettings.indexメソッドをGETで呼び出して以下の情報を取得する
    
      - loganalysis\_restricted\_ip\_addressテーブルの全件
    
      - loganalysis\_restricted\_crawler\_listテーブルの全件
        
          - loganalysis\_restricted\_crawler\_listテーブルが空だった場合は、以下のコンフィグからデフォルトの共有クローラーリストのURLを取得してテーブルに追加して、再度全件取得する
            
              - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-admin/weko_admin/config.py#L120-L122>
            
              - 設定キー：WEKO\_ADMIN\_DEFAULT\_CRAWLER\_LISTS

  - 画面側では、IPアドレスと共有クローラーリストそれぞれについて、レコードの数だけ入力欄を表示する
    
      - loganalysis\_restricted\_ip\_addressテーブルから取得した情報は、IPアドレスの入力欄に設定する
        
          - IPアドレスの行ごとに、0始まりの行番号を設定する
        
          - 行ごとに、hiddenのinput要素を配置して、以下のnameとvalueを設定する
            
              - name：ip\_address\_行番号\_id
            
              - value：レコードのid
        
          - 行ごとに、入力欄の各input要素に「address\_list\_行番号」の形のname属性が設定される
        
          - 情報が0件だった場合は、入力欄を1行だけ表示する
    
      - loganalysis\_restricted\_ crawler\_listテーブルから取得した情報は、共有クローラーリストの入力欄に設定する
        
          - 共有クローラーリストの行ごとに、0始まりの行番号を設定する
        
          - 行ごとに、hiddenのinput要素を配置して、以下のnameとvalueを設定する
            
              - name：shared\_crawler\_行番号\_id
            
              - value：レコードのid
        
          - 行ごとに、入力欄の各input要素に「shared\_crawler\_行番号」の形のname属性が設定される
        
          - 情報が0件だった場合は、入力欄を2行だけ表示する

2\. 設定の保存

  - 保存時には、weko\_admin.admin.LogAnalysisSettings.indexメソッドをPOSTで呼び出す
    
      - loganalysis\_restricted\_ip\_addressテーブルへの保存時には、すべてのレコードを物理削除して、画面の各IPアドレスの行の入力内容からレコードを作成する
        
          - 「id」：自動採番
        
          - 「ip\_address」：nameが「shared\_crawler\_行番号」であるinputの各入力値を「.」で連結したもの
    
      - loganalysis\_restricted\_crawler\_listテーブルへの保存時には、以下の処理を行う
        
          - 共有クローラーリストの入力ごとに、レコードから、idが「shared\_crawler\_行番号\_id」の値と等しいものを取得する
            
              - 該当するレコードがあったら、それを入力内容で更新する
            
              - 該当するレコードがなかったら、入力内容で新たにレコードを作成する
    
      - その後、GETで呼び出されたときと同様の処理を行う

3\. イベントログ処理

  - modules/invenio-stats/invenio\_stats/contrib/registrations.py の register\_events 関数で初期化

  - 下記、register\_events 関数にて、各インデックスに対する処理クラス、前処理を設定している。  
    ログ解析機能を利用して設定された情報は flag\_restricted 関数内で利用されている。

> 〜省略〜
> 
> def register\_events():
> 
> """Register sample events."""
> 
> return \[
> 
> dict(
> 
> event\_type='celery-task',
> 
> templates='invenio\_stats.contrib.celery\_task',
> 
> processor\_class=EventsIndexer,
> 
> processor\_config=dict(
> 
> preprocessors=\[
> 
> flag\_restricted,
> 
> flag\_robots,
> 
> anonymize\_user,
> 
> build\_celery\_task\_unique\_id
> 
> \],
> 
> suffix="%Y",
> 
> )),
> 
> 〜省略〜

  - 上記のflag\_restricted関数内でweko\_admin.api.is\_restricted\_user関数を呼び出して対象のログが除外対象かどうかのチェックを行う
    
      - 除外対象となるログは、「is\_restricted」がtrueとなる
    
      - ログの「ip\_address」と「user\_agent」についてチェックを行い、どちらかで除外対象に含まれていればそのログは集計除外となる
        
          - 「ip\_address」について、loganalysis\_restricted\_ip\_addressテーブルにip\_addressフィールドと「ip\_address」とが一致するものがあった場合は除外対象となる
        
          - 「ip\_address」と「user\_agent」について、weko\_admin.api.\_is\_crawler関数を呼び出してチェックを行う
            
              - 以下のコンフィグで、共有クローラーリストによるチェックで正規表現を使用するかどうかを制御する
                
                  - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-admin/weko_admin/config.py#L1278>
                
                  - 設定キー：WEKO\_ADMIN\_USE\_REGEX\_IN\_CRAWLER\_LIST
            
              - 以下のコンフィグで定めたRedisデータベースに接続する
                
                  - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/scripts/instance.cfg#L43>
                
                  - 設定キー：CRAWLER\_REDIS\_DB
            
              - loganalysis\_restricted\_crawler\_listテーブルのアクティブな各レコードから取得した「list\_url」をキーとして、接続したRedisデータベースから共有クローラーリストを取得する
                
                  - 正規表現を使用する場合は文字列、そうでなければset型で取得する
                
                  - 取得できなかった場合は、「list\_url」を使ってインターネット上から共有クローラーリストを取得して、内容を加工したものをRedisデータベースに保存する
                    
                      - キーは「list\_url」の値とする
                    
                      - 内容は以下のように加工する
                        
                          - 正規表現を使用する場合は、「\#」で始まる行を除いた各行の内容を「|」で結合した文字列
                        
                          - 正規表現を使用しない場合は「\#」で始まる行を除いた各行の内容
                    
                      - 保存するデータには、以下のコンフィグで定めたTTLを設定する
                        
                          - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/scripts/instance.cfg#L44>
                        
                          - 設定キー：CRAWLER\_REDIS\_TTL
                    
                      - インターネット接続に失敗した場合、例外となって処理が終了する
                
                  - 「ip\_address」と「user\_agent」を、Redisデータベースに保存されていた、または保存した情報の中から探して、どちらか片方でも存在していたら除外対象に含める
                    
                      - 「is\_restricted」に、is\_restricted\_user関数が返却する真偽値を設定する

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### 検索設定

  - > 目的・用途

本機能は、管理者として、デフォルトで表示する検索結果表示及び使用可能な詳細検索条件について設定できる機能である。

  - > 利用方法

【Administration\>設定（Setting）\>検索設定（Search）】の順でSearch画面に遷移し、検索条件を設定し画面最下部右下にある\[保存(Save)\]ボタンを押下することで設定を反映させる。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

使用している画面

  - 【Administration\>設定（Setting）\>検索設定（Search）】：使用可能な詳細検索条件およびデフォルトで表示する検索結果表示を設定する画面である。

(1)Search Author Setting

  - アイテム詳細画面より、著者のリンクを押下後に表示されるポップアップ内にある"Search repository"リンクを押下した時の検索方法を設定する機能。

  - 以下のいずれかを設定する。初期値は「Search by Author Name」である。
    
      - 著者名で検索（Search by Author Name）:　著者の名前で検索をする。
    
      - 著者名IDで検索（Search by Author ID）:　著者のWEKO IDで検索をする。

  - > (2) 検索結果表示設定デフォルトで表示する検索結果表示及び使用可能な詳細検索条件について設定する。

  - デフォルトで表示する検索結果表示の設定について
    
      - ソート条件利⽤可否で設定できるソート項⽬は、以下とする。
        
          - Title(asc/desc)：タイトル（昇順／降順）
        
          - Creator(asc/desc)：登録者（昇順／降順）
        
          - Item Type(asc/desc)：アイテムタイプ（昇順／降順）
        
          - ID (asc/desc)：ID（昇順／降順）
        
          - Update(asc/desc)：更新⽇時（昇順／降順）
        
          - Create(asc/desc)：作成⽇時（昇順／降順）
        
          - Date Of Issued(asc/desc)：出版年（昇順／降順）
        
          - Custom(asc/desc)：カスタム（昇順／降順）
        
          - Relevance(asc/desc)
        
          - Temporal(asc/desc)
    
      - 設定内容は以下とする。
        
          - 「検索結果表示設定」（Search Results Setting）
            
              - 「デフォルト表示件数」（Default Display Number）
                
                  - 選択肢：20、50、75、100
                
                  - デフォルト：20
            
              - 「デフォルトソート条件（インデックス検索）」（Default Display Sort (Index Search)）
                
                  - 選択肢：すべてのソート項⽬
                
                  - デフォルト：ID (asc)
            
              - 「デフォルトソート条件（キーワード検索）」（Default Display Sort (Keywords Search)）
                
                  - 選択肢：すべてのソート項⽬
                
                  - デフォルト：Create(desc)
            
              - 「一覧に表示するソート条件を設定してください」（Please set the sort of search results .）
                
                  - デフォルト：すべてのソート項⽬が利用可能として「表示する」（Allow）エリアに表示する。
                
                  - 「表示する」（Allow）エリアに表示している任意項目を選択し、\[→\]ボタンを押すと、選択項目を利用不可の項目とし、「表示しない」(Deny)エリアに移動する。
                
                  - 「表示しない」（Deny）エリアに表示している任意項目を選択肢、\[←\]ボタンを押すと、選択項目を利用可能の項目とし、「表示する」エリアに移動する。

(3) 使用可能な詳細検索条件の設定について

  - 詳細検索条件設定（Detail Search Conditions Setting）  
    検索条件に使⽤するメタデータ項⽬を選択する。
    
      - 表示内容及び設定内容は以下の通りである。
        
          - 項目（Search Item）
        
          - 使用項目（Useable Item）  
            詳細検索で利用可能な条件を設定する。
            
              - チェックボックスにチェックを入れる場合、利用可能な条件とする。
            
              - チェックボックスにチェックを入れない場合、利用不可な条件とする。
        
          - 検索条件（Condition Name）  
            項目のラベルを表示する。
        
          - JPCOARマッピング（JPCOAR Mapping）  
            該当するJPCOARマッピングの項目を表示する。
        
          - 初期選択（Initial Condition）  
            詳細検索の初期画面で表示する項目を設定する。
            
              - チェックボックスにチェックを入れる場合、該当項目を詳細検索の初期画面で表示する。
            
              - チェックボックスにチェックを入れない場合、該当項目を詳細検索の初期画面で表示しない。
        
          - 検索項目設定（Search item setting）  
            検索項目設定押下時に、検索項目設定画面をモーダル表示する。  
            詳細検索条件に指定できないメタデータの検索を行う際に使用する。ESにマッピングされているメタデータに関連づいたアイテムの検索を可能としている。  
            検索項目設定画面では、アイテムタイプをプルダウン形式で選択できる。検索したいメタデータ名をテキスト（text）1\~10、integer\_JA\_1\~5、float\_JA\_1\~5、date\_JA\_1\~5、geopoint\_JA\_1、geoshape\_JA\_1のいずれかにあらかじめ設定しておき、検索項目設定画面にて選択する。その後、検索したいマッピングの指定についての条件を画面中央下部に設定し\[保存（Save）\]ボタン押下で設定する。
            
              - メタデータ名の設定は検索したいメタデータの検索方式に応じて使い分ける。  
                テキスト（text）1\~10：文字列での検索が可能。形式はjsonもしくはxml。  
                integer\_JA\_1\~5：整数値での範囲検索が可能。形式はjsonもしくはxml。  
                float\_JA\_1\~5：小数値での範囲検索が可能。形式はjsonもしくはxml。  
                date\_JA\_1\~5：日付での範囲検索が可能。形式はjsonもしくはxml。  
                geopoint\_JA\_1：緯度，経度を指定して検索が可能。形式はjsonもしくはxml。  
                geoshape\_JA\_1：タイプと座標を指定して検索が可能。形式はjsonもしくはxml。
            
              - 上記の項目を設定し\[保存（Save）\]ボタン押下で、入力内容がdb内のsearch\_managementテーブルのsearch\_conditionsの内容が変更され、検索に反映される。
            
              - 要求された入力形式以外の文字列も入力し\[保存（Save）\]ボタンを押すことは可能であるが、入力形式に誤りがある場合は、db内のsearch\_managementテーブルのsearch\_conditionsは変更されず、検索結果にも影響を及ぼさない。

(4) インデックスツリー／ファセット検索設定

  - インデックスツリーの表示有無と、表示時の横幅と縦幅を設定する。
    
      - 「Display」：チェックボックスにチェックを入れた場合に、Web側のTop画面（メインウィジェット）の左側にインデックスツリーを表示する。  
        チェックを入れない場合はインデックスツリーは表示されない。初期値はチェックボックスにチェックを入れている（インデックスツリーを表示する）状態である。  
        インデックスツリーを表示する設定の場合、以下の設定を変更することができる。  
        ※インデックスツリーを表示しない設定の場合も変更はできるが、Top画面にインデックスツリーは表示されないため、画面上では確認できない。
        
          - 「Width」：プルダウンより横幅の値を選択する。
            
              - 選択肢：1～11　（初期値は「3」）
            
              - 単位：Grid
        
          - 「Height」：縦幅の値をテキストボックスに入力する。　（初期値は「空欄」）
            
              - 単位：pixel  
                ※縦幅の値を入力しない場合や数値以外を入力した場合、インデックスツリーの縦幅はインデックスツリーの中身に応じて自動調整とする

  - ファセット検索の表示有無を設定する。
    
      - 「Display」：チェックボックスにチェックを入れた場合、Web側のTop画面（メインウィジェット）の左側にファセット検索を表示する。  
        チェックを入れない場合、ファセット検索は表示されない。  
        初期値はチェックボックスにチェックを入れていない（ファセット検索を表示しない）状態である。  
        インデックスツリーを表示する設定の場合、ファセット検索はインデックスツリーの下側に表示される。

  - ファセット検索の詳細設定は【Administration\>設定（Setting）\>ファセット検索】で行うことができる。詳しくは[ADMIN14-12:ファセット検索](\\l)を参考。

  - コミュニティの表示有無を決定する。
    
      - 「Display」 :チェックボックスにチェックを入れた場合に、ワークフロー(Workflow)タブの横にコミュニティ(Communities)タブを表示する。タブ選択後の設定については[8 コミュニティ管理](\\l)を参照。

(5)初期表示設定(Main Screen Initial Display Setting )

  - > 初期表示画面設定：「インデックスの検索結果を表示する(Index search result)」「ランキングを表示する(Ranking)」「コミュニティを表示する(Communities)」の中から選択し設定する。設定内容は以下のようになる。
    
      - > 「インデックスの検索結果を表示する(Index search result)」：初期画面中央部にインデックスリストを一つ表示し、その下に表示しているインデックスリスト内のアイテムリストを表示する。  
        > （表示されるインデックスリストは「初期表示インデックス表示方法(Default Index to Display)」を設定することで変更可能。詳しくは後述。）
    
      - > 「ランキングを表示する(Ranking)」：初期画面中央部にランキングを表示する。詳細な表示設定については[ADMIN14-5:ランキング表示](#ランキング表示)を参照。
    
      - > 「コミュニティ一覧を表示する(Communities)」：初期画面中央部にコミュニティをリスト表示する。リスト最上部に検索用テキストボックスがあり、コミュニティ名の部分一致検索を可能としている。テキストボックスに入力後にエンターキー押下で検索をする。

<!-- end list -->

  - > 初期表示インデックス表示方法(Default Index to Display)：「最も新しい公開アイテムの属するインデックス(Index of the newest item registered)」「インデックス指定(Specific index)」のどちらかを選択し設定する。  
    > このテキストボックスは初期表示画面設定を「インデックス検索結果を表示する(Index search result)」を選択しているときのみ操作可能であり、それ以外では非活性となる。

  - > 「最も新しい公開アイテムの属するインデックス(Index of the newest item registered)」：publicなインデックスツリーの中で、最も公開日の新しいアイテムを持つインデックスが初期画面で表示される。（公開日が未来に設定されているものは除く。）

  - > 「インデックス指定(Specific index)」：選択すると、新たに「初期表示インデックス(Initial Display Index)」という項目が表示され、そこで選択したインデックスが初期表示画面に表示される。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko\_admin

<!-- end list -->

  - > 処理概要

> 検索設定を一度も行っていない状態では、weko\_admin.config内のWEKO\_ADMINMANAGEMENT\_OPTIONSで設定された値がデフォルト表示されている。
> 
> Search Author Settingのラジオボタンを変更すると、weko\_admin.admin.SearchSettingsView.indexが呼び出され、設定の変更が反映される。
> 
> 検索設定の変更はweko\_admin.models.SearchManagement.updateを呼び出してDB上に反映され、それ以降の画面表示はDBの値を参照するものとする。  
> (weko\_admin.config内の設定値はDB内に設定されていない時のみ参照されている。)
> 
> 検索結果表示設定の変更は「search\_management」テーブルの以下のレコードが更新される。

  - > 「default\_dis\_num」：デフォルト表示件数変更時に更新

  - > 「default\_dis\_sort\_index」：デフォルトソート条件（インデックス検索）変更時に更新

  - > 「default\_dis\_sort\_keyword」：デフォルトソート条件（キーワード検索）変更時に更新

  - > 「sort\_setting」：表示するソート条件の変更時に更新

> 詳細検索条件設定の変更は「search\_management」テーブル内の以下のレコードが更新される。

  - > 「search\_conditions」：詳細検索条件変更時に更新

> インデックスツリー/ファセット表示設定の変更は「search\_management」テーブル内の以下のレコードが更新される。

  - > 「display\_control」：\[display\]ラジオボタン変更時に更新

> インデックスツリーの「Width」と「Height」の設定の変更は「index\_style」テーブル内のそれぞれ同名のレコードが更新される。
> 
> 初期表示設定の変更はsearch\_managementテーブル内のinit\_disp\_settingレコードが更新される。
> 
> 検索項目設定から新規の検索項目を作成した場合は、search\_managementテーブルのsearch\_conditionsが変更される。

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### ファセット検索

  - > 目的・用途

本機能は、ファセット検索機能を詳細に設定できる機能である。

  - > 利用方法

管理者は本画面でファセット検索として表示する項目を設定できる。

設定された項目をもとに、システムが集計を行い、Web側で各ファセット項目と該当するアイテムをグルーピングし、そのカウントした値を表示する。

利用者は各ファセット項目の中にあるグルーピングされた値を選択することで、絞り込まれたアイテムがアイテムリストに表示される。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

(1) ファセット検索の一覧画面

  - 【Administration \> 設定（Setting） \> ファセット検索（Faceted Search）】を選択すると表示される。

  - 画面構成は以下の通り
    
      - 一覧（List）タブ
        
          - 設定されているファセット検索の項目のリストを表示する。メニューからファセット検索（Faceted Search）を選択すると本タブが表示される。一覧（List）の横にファセット項目数を（）表記する。
    
      - 作成（Create）タブ
        
          - ファセット検索する項目を作成する。　　…詳細は(3)に記載
    
      - フィルターを追加（Add Filter）
        
          - 一覧（List）タブにあるファセット検索の項目のリストを絞り込んで表示する。
    
      - 選択（With selected）
        
          - 一覧（List）タブにあるファセット検索の項目のリストについて、選択したファセット検索の項目を削除する。
    
      - Searchテキストボックス
        
          - キーワードを入力すると、一覧（List）タブにあるファセット検索の項目のリストから検索して表示する。

  - 一覧（List）タブ
    
      - 設定されているファセット検索の項目のリストを表示する。表の構成は以下の通り
        
          - チェックボックス
            
              - ファセット項目を選択できる。選択した項目に対して削除が可能（※選択（With selected）を参照）
        
          - \[目\]マーク
            
              - 選択することで該当のファセット項目の詳細画面に遷移する。　　  
                …詳細は(2)に記載
        
          - \[鉛筆\]マーク
            
              - 選択することで該当のファセット項目の編集画面に遷移する。　　  
                …詳細は(3)に記載
        
          - \[ゴミ箱\]マーク
            
              - 選択することで該当のファセット項目の削除画面に遷移する。　　  
                …詳細は(4)に記載
        
          - ID
            
              - ファセット項目を一意に決定するID。1から順に付与され、初期値としてID 1～7のファセット項目を用意している。
        
          - Item Name(EN)
            
              - ファセット項目の英語の名称
        
          - Item Name(JP)
            
              - ファセット項目の日本語の名称
        
          - UI
        
          - ファセット検索時のUI。
        
          - Mapping
            
              - ファセット項目で集計対象としているマッピングの設定
        
          - Active
            
              - Web画面上にファセット項目を表示しているかどうかを表す。\[レ\]マークが表示、\[－\]マークが非表示を表す。
    
      - 初期値としてファセット項目を用意している。詳細は以下の通り

| ID | Item Name(EN) | Item Name(JP) | Mapping                      | UI        | Active |
| -- | ------------- | ------------- | ---------------------------- | --------- | ------ |
| 1  | Data Language | デ一タの言語        | language                     | SelectBox | \[レ\]  |
| 2  | Access        | アクセス制限        | accessRights                 | SelectBox | \[レ\]  |
| 3  | Location      | 地域            | geoLocation.geoLocationPlace | SelectBox | \[レ\]  |
| 4  | Temporal      | 時間的範囲         | temporal                     | SelectBox | \[レ\]  |
| 5  | Topic         | トピック          | subject.value                | SelectBox | \[レ\]  |
| 6  | Distributor   | 配布者           | contributor.contributorName  | SelectBox | \[レ\]  |
| 7  | Data Type     | デ一タタイプ        | description.value            | SelectBox | \[レ\]  |

　　　　　　　※\[レ\]マークは、Web画面上にファセット項目を表示する設定になっていることを表す。

  - フィルターを追加（Add Filter）
    
      - クリックすると、以下のフィルターリストを表示する。フィルターリストからフィルターをクリックすると、当該フィルターの入力エリアが画面上に追加される。
        
          - ID
            
              - ファセット項目のIDでフィルターを行う。
            
              - 選択できる条件は以下の通り
                
                  - 等しい（equals）　　※初期値
                
                  - 等しくない（not equal）
                
                  - より大きい（greater than）
                
                  - より小さい（smaller than）
                
                  - 空（empty）
                
                  - 一覧にある（in list）
                
                  - 一覧にない（not in list）
        
          - Item Name(EN)
            
              - ファセット項目の英語の名称でフィルターを行う
            
              - 選択できる条件は以下の通り
                
                  - 含む（contains）　　※初期値
                
                  - 含まれていません（not contains）
                
                  - 等しい（equals）
                
                  - 等しくない（not equal）
                
                  - 空（empty）
                
                  - 一覧にある（in list）
                
                  - 一覧にない（not in list）
        
          - Item Name(JP)
            
              - ファセット項目の日本語の名称でフィルターを行う
            
              - 選択できる条件は以下の通り
                
                  - 含む（contains）　　※初期値
                
                  - 含まれていません（not contains）
                
                  - 等しい（equals）
                
                  - 等しくない（not equal）
                
                  - 空（empty）
                
                  - 一覧にある（in list）
                
                  - 一覧にない（not in list）
        
          - Mapping
            
              - ファセット項目のマッピングの設定でフィルターを行う
            
              - 選択できる条件は以下の通り
                
                  - 含む（contains）　　※初期値
                
                  - 含まれていません（not contains）
                
                  - 等しい（equals）
                
                  - 等しくない（not equal）
                
                  - 空（empty）
                
                  - 一覧にある（in list）
                
                  - 一覧にない（not in list）
        
          - UI
            
              - UIの設定でフィルターを行う。
            
              - 選択できる項目は以下の通り。
                
                  - 含む（contains）　　※初期値
                
                  - 含まれていません（not contains）
                
                  - 等しい（equals）
                
                  - 等しくない（not equal）
                
                  - 空（empty）
                
                  - 一覧にある（in list）
                
                  - 一覧にない（not in list）
        
          - Active
            
              - ファセット項目の表示／非表示でフィルターを行う
            
              - 選択できる条件は以下の通り
                
                  - 等しい（equals）　　※初期値
                
                  - 等しくない（not equal）
            
              - 設定できる値は以下の通り
                
                  - はい（Yes）
                
                  - いいえ（No）
    
      - 各フィルターでキーワードを入力後、"Enter"キーもしくは\[適用（Apply）\]ボタンを押下すると、各フィルターの条件で絞り込み検索が行われ、検索結果が画面上に表示される。  
        ※検索結果が無い場合は「表にはアイテムがありません。（There are no items in the table.）」と画面上に表示される
    
      - フィルターによる絞り込み後、\[フィルターをリセット（Reset Filters）\]ボタンを表示すると全ての絞り込みが解除され、最初の一覧（List）タブの状態となる。
    
      - 各フィルターは\[×\]ボタンで入力エリアから削除される。

  - 選択（With selected）
    
      - クリックすると、以下のリストを表示する。リストから削除（Delete）をクリックすると、削除処理を実行確認画面がポップアップする。
        
          - 削除（Delete）
            
              - 選択したファセット項目について削除処理を実行してよいかのメッセージをポップアップで表示する。
                
                  - ポップアップのメッセージ：　「選択したレコードを削除してもよろしいですか。（Are you sure you want to delete selected records?）」  
                    　\[OK\]:　選択したファセット項目を削除する。  
                    　\[キャンセル\]:　削除せずに一覧画面へ戻る。
            
              - ファセット項目を選択していない場合は、ファセット項目のリストから選択をする旨のメッセージをポップアップで表示する。
                
                  - ポップアップのメッセージ：　「少なくとも1つのレコードを選択してください。（Please select at least one record.）」  
                    　\[OK\]:　一覧画面へ戻る。

  - Searchテキストボックス
    
      - キーワードを入力して"Enter"キーを押下すると、入力したキーワードで絞り込み検索が行われ、検索結果が画面上に表示される。  
        ※検索結果が無い場合は「表にはアイテムがありません。（There are no items in the table.）」と画面上に表示される
    
      - キーワードに対し、すべての表の項目に対して部分一致検索を行う。
    
      - キーワードを入力して検索をした後、Searchエリア欄の\[×\]ボタンを表示すると全ての絞り込みが解除され、最初の一覧（List）タブの状態となる。

  - 一覧（List）タブを表示している場合は、登録されている（表示／非表示に関わらず）ファセット項目の数を、タブ上のカッコ内の数値で表示する  
    例えば、ファセット項目が９つ登録されている場合、タブには「一覧(9)」, 「List(9)」のように表示する。

  - 一覧（List）タブの順序は更新順(降順)となる。最後に更新をしたファセット項目はリストの一番下に表示される。

(2) ファセット検索の詳細画面

  - 一覧（List）タブにある各ファセット項目の\[目\]マークを選択することで、選択したファセット項目の詳細画面に遷移する。

  - 選択したファセット項目の詳細画面は 詳細（Details）タブ に表示される。

  - 詳細画面では以下の情報を表示する。
    
      - 項目名(英)（Item Name(EN)）
        
          - 選択したファセット項目の英語名称を表示する。
    
      - 項目名(日)（Item Name(JP)）
        
          - 選択したファセット項目の日本語名称を表示する。
    
      - マッピング（Mapping）
        
          - 選択したファセット項目で集計対象として設定されているマッピング情報を表示する。
    
      - カスタム集計（Custom Aggregations）
        
          - 選択したファセット項目で独自に集計対象として設定したマッピング情報を表示する。  
            表示方法は編集画面にある「Aggregations List」の形とする。
    
      - 表示/非表示（Display/Hide）
        
          - 選択したファセット項目がWeb画面上に表示されているかどうかの設定を表示する。  
            表示の場合は「表示（Display）」, 非表示の場合は「非表示（Hide）」と表示する。
    
      - 開閉状態
        
          - 選択したファセット項目のUIが開かれているかの設定を表示する。

(3) ファセット検索の新規作成・編集画面このセクションを編集

新規作成

  - 一覧（List）タブと並んでいる 作成（Create）タブ を選択することで、新規にファセット項目を作成する。

  - 入力できる内容は以下の通り
    
      - 項目名(英)（Item Name(EN)）
        
          - ファセット項目の英語名称を入力する。テキスト形式で必須項目である。  
            Web画面で日本語以外のページを表示した際に本項目の名称が表示される。
    
      - 項目名(日)（Item Name(JP)）
        
          - ファセット項目の日本語名称を表示する。テキスト形式で必須項目である。  
            Web画面で日本語ページを表示した際に本項目の名称が表示される。
    
      - マッピング（Mapping）
        
          - ファセット項目で集計対象とするマッピング情報を選択する。プルダウン形式(いずれか１つを選択)で必須項目である。  
            プルダウンで選択できるリストは、JPCOARの索引定義（/weko-schema-ui/weko\_schema\_ui/mappings/v6/weko/item-v1.0.0.json）に従う。
    
      - UI
        
          - ファセット検索時のUIを選択する。CheckboxList、SelectBox、RangeSliderの３種から選択する。ただし、RangeSliderについてはマッピングでtemporalを選択した時のみ選択可能となる。
    
      - 表示件数（Display Number）
        
          - UIがCheckboxList時のファセット内の選択肢を設定する数値。1\~99内の整数を入力する。範囲外の整数や整数ではない数、数字以外を入力した場合、「表示件数は1以上99以下の整数値で入力する必要があります。（Display Number must be an integer value from 1 to 99.）」というメッセージがポップアップ表示される。
    
      - カスタム集計（Custom Aggregations）
        
          - ファセット項目で独自に集計対象としてマッピング情報を設定する。設定内容は以下の通り
            
              - 集計一覧（Aggregations List）
                
                  - 独自に集計対象として設定したマッピング情報を「集計マッピング（Aggregation Mapping） - 集計値（Aggregation Value）」の形でリスト形式で表示する。リストの中の行を選択すると、集計マッピング（Aggregation Mapping）と集計値（Aggregation Value）が連動して、選択した行のマッピング情報を表示する。  
                    カスタム集計を設定する際は、集計マッピング（Aggregation Mapping）と集計値（Aggregation Value）は両方とも設定しなければならない。
            
              - 集計マッピング（Aggregation Mapping）
                
                  - 独自に集計対象とするマッピング情報を選択する。プルダウン形式(いずれか１つを選択)であり、プルダウンで選択できるリストは、"item-v1.0.0.json"に従う。
            
              - 集計値（Aggregation Value）
                
                  - 独自に集計対象とするマッピング情報の集計値を設定する。テキスト形式である。

> 【使い方】
> 
> 例１
> 
> 　集計マッピング（Aggregation Mapping）に"publish\_status"を、集計値（Aggregation Value）に"0"を設定した場合、
> 
> 　該当のファセット項目は、マッピングで選択した値　かつ　"publish\_status"が"0"　となっているアイテムを集計します。
> 
> 例２
> 
> 　集計マッピング（Aggregation Mapping）に"title"を、集計値（Aggregation Value）に"テスト"を設定した場合、
> 
> 　該当のファセット項目は、マッピングで選択した値　かつ　"title"が"テスト"(完全一致)　となっているアイテムを集計します。

  - 独自の集計対象として設定したマッピング情報は、以下のボタンで追加／削除ができる。
    
      - \[追加（Add）\]ボタン
        
          - 設定した集計マッピング（Aggregation Mapping）と集計値（Aggregation Value）を集計一覧（Aggregations List）に登録する。
    
    <!-- end list -->
    
      - \[削除（Delete）\]ボタン
        
          - 集計一覧（Aggregations List）のリストの行を選択後、ボタン押下で該当のマッピング情報を削除する。

<!-- end list -->

  - 表示/非表示（Display/Hide）
    
      - 対象のファセット項目をWeb画面上に表示するかどうかを設定する。  
        表示の場合は「表示（Display）」, 非表示の場合は「非表示（Hide）」のラジオボタンを選択する。初期値は「表示（Display）」である。

<!-- end list -->

  - 入力した内容で登録・更新する際は以下のボタンを押下する。
    
      - \[保存（Save）\]ボタン
        
          - 入力した内容を保存し、一覧（List）タブに遷移する。  
            新規に登録した場合は、一覧（List）タブのリストの一番下に表示される。既存のファセット項目を更新した場合は、更新した内容が一覧（List）タブのリストに表示される。
    
      - \[キャンセル（Cancel）\]ボタン
        
          - 入力中の内容を破棄し、一覧（List）タブに遷移する。

編集

  - 一覧（List）タブにある各ファセット項目の\[鉛筆\]マークを選択することで、選択したファセット項目の編集画面に遷移する

  - 編集画面は 編集（Edit）タブ に表示される

  - 画面構成は 作成（Create）タブ と同様。  
    画面遷移すると、選択したファセット項目に登録されている内容が各エリアに表示される

  - 入力できる内容やボタン押下時の動作は 新規作成 の記載内容を参照

エラーメッセージ

  - ファセット登録・編集時において、\[保存（Save）\]ボタン押下時にエラーチェックを行い、不適切なデータ登録をしないように制御を行う。

  - エラーメッセージはポップアップで画面上に表示される。  
    ポップアップ上の\[キャンセル（Cancel）\]ボタンを押下すると、ポップアップは消えて自画面を表示する（修正箇所は赤枠等で表示はされない）

  - 本画面でチェックしているエラー内容は以下の通り。

| エラー発生条件                                           | 表示されるエラーメッセージ                                                                                                                   |
| ------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| 必須項目が入力されていない状態で保存しようとした場合                        | 必須項目は全て入力して下さい。（Please input all required item.）                                                                                |
| アイテム編集時、必須項目の中で既に存在している名称やマッピング情報がある状態で保存しようとした場合 | 既に存在する項目名・マッピングです。別のファセット項目名・マッピングを入力してください。（The item name/mapping is already exists. Please input other faceted item/mapping.） |
| 予期せぬエラーが発生した場合                                    | サーバエラーのため、作成に失敗しました（Failed to create due to server error.）                                                                      |

(4) ファセット検索の削除画面

  - 一覧（List）タブにある各ファセット項目の\[ゴミ箱\]マークを選択することで、選択したファセット項目の削除画面に遷移する

  - 削除画面は 削除（Delete）タブ に表示される

  - 画面遷移すると、選択したファセット項目に登録されている内容が表示される

  - 削除画面では以下の内容を表示する
    
      - 項目名(英)（Item Name(EN)）
        
          - 選択したファセット項目の英語名称を表示する
    
      - 項目名(日)（Item Name(JP)）
        
          - 選択したファセット項目の日本語名称を表示する
    
      - マッピング（Mapping）
        
          - 選択したファセット項目で集計対象として設定されているマッピング情報を表示する
    
      - カスタム集計（Custom Aggregations）
        
          - 選択したファセット項目で独自に集計対象として設定したマッピング情報を表示する  
            表示方法は編集画面にある「Aggregations List」の形とする
    
      - 表示/非表示（Display/Hide）
        
          - 選択したファセット項目がWeb画面上に表示されているかどうかを表示する  
            表示の場合は「表示（Display）」, 非表示の場合は「非表示（Hide）」と表示する

  - 削除画面では削除をする際は以下のボタンを押下する
    
      - \[削除（Delete）\]ボタン
        
          - ボタンを押下すると、選択したファセット項目について削除処理を実行してよいかのメッセージをポップアップで表示する。
            
              - ポップアップのメッセージ：　「選択したレコードを削除してもよろしいですか。（Are you sure you want to delete selected records?）」  
                　\[OK\]:　選択したファセット項目を削除する  
                　\[キャンセル\]:　削除せずに削除画面へ戻る
    
      - \[キャンセル（Cancel）\]ボタン
        
          - ボタンを押下すると、一覧（List）タブへ戻る

  - 予期せぬエラーが発生した場合、「サーバエラーのため、削除に失敗しました（Failed to delete due to server error.）」のポップアップを表示する  
    \[キャンセル（Cancel）\]ボタンを押下すると、自画面へ戻る

(5) その他

  - 表示している画面のタブから他のタブへ遷移できるもののリストは以下の通り

<table>
<thead>
<tr class="header">
<th>現在のタブ</th>
<th>→</th>
<th>遷移できるタブ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>一覧（List）</td>
<td>→</td>
<td>作成（Create）</td>
</tr>
<tr class="even">
<td>作成（Create）</td>
<td></td>
<td>一覧（List）</td>
</tr>
<tr class="odd">
<td>編集（Edit）</td>
<td></td>
<td>一覧（List）<br />
作成（Create）<br />
詳細（Details）　※編集（Edit）タブで表示しているファセット項目の詳細画面を表示する<br />
削除（Delete）　※編集（Edit）タブで表示しているファセット項目の削除画面を表示する</td>
</tr>
<tr class="even">
<td>詳細（Details）</td>
<td></td>
<td>一覧（List）<br />
作成（Create）<br />
編集（Edit）　　※詳細（Details）タブで表示しているファセット項目の編集画面を表示する<br />
削除（Delete）　※詳細（Details）タブで表示しているファセット項目の削除画面を表示する</td>
</tr>
<tr class="odd">
<td>削除（Delete）</td>
<td></td>
<td>一覧（List）<br />
作成（Create）<br />
編集（Edit）　　※削除（Delete）タブで表示しているファセット項目の編集画面を表示する<br />
詳細（Details）　※削除（Delete）タブで表示しているファセット項目の詳細画面を表示する</td>
</tr>
</tbody>
</table>

  - ファセット項目を表示する設定としているが、カスタム集計の集計マッピングが未入力のときに、Web画面でインデックスリストの選択と検索ができないため注意  
    (ファセットの表示設定ON/OFFに限らず発生)

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko\_admin

<!-- end list -->

  - > 処理概要

> 一覧表示

  - > weko\_admin.model.FacetSearchSetting.get\_allが呼び出され、db内のfacet\_search\_settingテーブルの全情報が取り出され表示されている。

  - > 任意のファセット項目の目のマークを押下すると、weko\_admin.admin.FacatSearchView.details\_viewが呼び出され、クリックしたファセット項目の詳細情報が、db内のfacet\_search\_settingテーブルから取り出され表示される。

  - > 任意のファセット項目の鉛筆マークを押下すると、weko\_admin.admin.FacatSearchView.edit\_viewが呼び出され編集画面へ移行し、\[保存(Save)\]ボタンを押下すると、 weko\_admin.views.save\_facet\_searchが呼び出され、編集内容に問題がなければ、db内のfacet\_search\_settingテーブルの情報が変更される。

  - > 任意のファセット項目のゴミ箱マークを押下すると、weko\_admin.admin.FacetSearchSettingView.deleteが呼び出され削除画面へ移行し、「削除（delete）」ボタンが押下されるとweko\_admin.views.remove\_facet\_searchが呼び出され、db内のfacet\_search\_settingテーブルから選択したファセット項目が削除される。

> 作成

  - > 作成タブを押下すると、weko\_admin.admin.FacetSearchSettingView.create\_viewが呼び出され、作成画面へ移行する。各種項目に作成するファセット項目の情報を入力し\[保存（Save）\]ボタンを押下すると、weko\_admin.views.save\_facet\_searchが呼び出され、入力項目に問題がなければ、db内のfacet\_search\_settingテーブルに入力情報が追加される。入力項目の規制については、上記の「(3) ファセット検索の新規作成・編集画面このセクションを編集」に示した通りである。

> 選択

  - > 一つ以上のファセット項目を選択した状態で、選択タブから削除を選択することで、weko\_gridlayout.admin.WidgetSettingView.action\_deleteが呼び出され、db内のfacet\_search\_settingテーブルから選択した情報が削除される。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### サイト情報

  - > 目的・用途

リポジトリ管理者として、サイトの情報を登録する機能である。また、サイト名は多言語対応できる

  - > 利用方法

【Administration＞設定（Setting）＞サイト情報（Site Info）】の順でSite Info画面へ遷移して利用する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【Admin \> Setting \> Site Info】：サイトの情報を登録する。
    
      - 登録項目は以下通りである。
        
          - 「サイト名」（Site Name）
            
              - サイト名称を入力するテキストエリア
            
              - デフォルト値は、「サイト名未設定」（Site name is not set）とする。
            
              - 「サイト名の追加」（Add site name）ボタン及び言語プルダウンを設ける。
                
                  - 「サイト名の追加」（Add site name）ボタンを押すと、「サイト名」および「言語」の入力欄を最下段に1行追加表示する。
                
                  - 言語プルダウンの選択肢は【Administration \>設定（ Setting）\> 言語表示（Language）】での「登録言語」に登録されている言語一覧とする。デフォルト値は「登録言語」の1番目の言語とする。
                
                  - 入力欄がシステム言語の数と同数になったら、このボタンは不活性とする。
                
                  - 同一言語に一つサイト名のみを設定できる。
        
          - 「ファビコン」（Favicon）
            
              - 「アイコンファイルの選択」（Select icon file）ボタンを設ける。
            
              - デフォルトは、JAIRO Cloudのアイコンを設定しておく。
            
              - 押下するとファイル選択ダイアログが表示される。
            
              - 選択ダイアログはアイコンファイルのみ選択可能とする。
            
              - ファイル選択が完了すると、ファイル名表示欄に選択ファイル名を、アイコンプレビュー表示欄にプレビューを表示する。
        
          - 「著作権」（CopyRight）
            
              - このサイトの著作権を設定する。ここで入力された項目は、htmlの\<head\>\<meta\>のname="copyright\>属性に出力する。
            
              - デフォルト：空白
        
          - 「記述」（Description）
            
              - このサイトの概要を設定する。ここで入力された項目は、htmlの\<head\>\<meta\>のname="Description"属性に出力する。
            
              - デフォルト：空白
        
          - 「キーワード」（Keyword）
            
              - このサイトの概要を設定する。ここで入力された項目は、htmlの\<head\>\<meta\>のname="keyword"属性に出力する
            
              - デフォルト：空白
        
          - 「トラッキングID」（Tracking ID）
            
              - Google AnalyticsのトラッキングIDを設定する。Admin画面で設定した値は GOOGLE\_TRACKING\_ID\_USER として admin\_setting テーブルに保存する。
            
              - デフォルト：空白
        
          - 「AddThis ID」（AddThis ID）
            
              - AddThisのトラッキングIDを設定する。Admin画面で設定した値は ADDTHIS\_USER\_ID として site\_infoテーブルに保存する。
            
              - デフォルト：ra-5d8af23e9a3a2633
        
          - 「OGPイメージ」（OGP Image）
            
              - og:imageへ設定するための画像アップロード機能を追加する。ファイル形式は JPG, PNG, WEBP, GIF フォーマット、ファイルサイズは 5MB 未満とする。  
                アップロードしたファイルの保存ディレクトリは Files \> Location で設定しているディレクトリに統一する。  
                本画面で設定した画像ファイルは、WEKO3のWeb画面のheadタブ内にあるmetaタグのcontentにファイルのフルパスで表示する。  
                ※OGP Imageに画像をアップロードしていない場合: content="" となる。
            
              - デフォルト：空白
    
      - 「保存」（Save）ボタンを押すと、
        
          - バリデーションを実施し、問題がなければデータベースに設定値を保存し、メッセージを画面の上部に表示する  
            メッセージ：  
            日本語：「サイト情報が正常に保存されました。」  
            英語：「Site info is saved successfully.」
        
          - データベースには、設定された値を記録する。
        
          - バリデーションエラーが発生したら、エラーダイアログを表示後、入力画面に戻る。
        
          - エラーダイアログにはバリデーションエラー内容を表示する。
    
      - バリデーション及びエラーメッセージ
        
          - サイト名が一つも設定されていないとき  
            エラーメッセージ：  
            日本語：「サイト名は少くとも１つ設定する必要があります。」  
            英語：「Must set at least 1 site name.」
        
          - サイト名を複数設定する際に、同一言語を選択したとき  
            エラーメッセージ：  
            日本語：「同一言語を複数のサイト名に設定されています。」  
            英語：「The same language is set for many site names.」
        
          - トリミングしたサイト名が空文字であるとき  
            エラーメッセージ：  
            日本語：「×サイト情報を空のフィールドに入力してください。」  
            英語：「Please input site information for empty field.」
        
          - 選択していた言語が登録言語から削除されたとき  
            エラーメッセージ：  
            日本語：「削除された言語は利用できません」  
            英語：「Language is deleted from Registered Language of system」
        
          - サイト名はトリミングした入力値を保存すること  
            ※サイト名をHTMLとして埋め込む際はエンコード処理を実施するなど配慮すること

  - 設定されたサイト名及びファビコン表示について
    
      - サイト名表示
        
          - 設定されたサイト名は、全ての画面で\<title\>タグの値に設定する。
        
          - \<title\>に設定する値は、システムの言語設定に合わせた言語のサイト名を表示する  
            なお、システム言語にマッチするサイト名が設定されていない場合は、英語、もしくは最上位の言語のサイト名を表示する。
    
      - ファビコン表示
        
          - 設定されたアイコンをシステムのfaviconとして設定する。

  - OGP対応
    
      - サイト情報をOGP(Open Graph protocol)で出力する。
    
      - meta要素としてog:titleを出力する。
    
      - meta要素としてog:urlを出力する。
    
      - meta要素としてog:imageを出力する。
    
      - meta要素としてog:descriptionを出力する。
    
      - meta要素としてog:localeを出力する。。値としてリポジトリサイトのデフォルトロケールを出力すること
    
      - meta要素としてog:locale:alternateを出力する。値としてリポジトリサイトが対応するデフォルト以外のロケールを出力すること

  - Admin/setting/site info の「サイト名」に入力された値をフィードバックメールの件名、本文内に反映する。
    
      - 日本語メールには日本語サイト名を、英語メールには英語サイト名をセットする。
    
      - 空欄のサイト名の場合は「No Site Name」と表示する。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko-admin

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - > 登録するサイト情報を入力後に\[保存（Save）\]ボタン押下すると、weko\_admin.views.update\_site\_infoが呼び出され、その中でweko\_admin.utils.validation\_site\_infoを使用し、入力値のエラーチェックを行う。  
    > 入力値に問題がなければ、db内のsite\_infoテーブルに情報が保存される。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### サイトライセンス

  - > 目的・用途

<!-- end list -->

  - > 本機能は、サイトライセンスの設定を行う機能である。利用方法

【Administration＞設定（Setting）＞サイトライセンス（Site License）】の順でSite License画面へ遷移して利用する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容
    
      - > 【Administration\>設定（Setting）\>サイトライセンス（Site Licsnse）】の順で、Site License画面へ遷移しサイトライセンスの設定を行う。設定できる項目を以下に示す。  
        > 以下の項目の設定後、画面最下部の\[保存（Save）\]ボタン押下で、変更が適応される。「ログインせずにコンテンツをダウンロードできるIPアドレスの範囲を指定してください(Please specify range of IP address which allow users can download contents without login.)」：初期状態では、\[その他の入力行（More Inpit Row）\]ボタンのみがあり、押下することで以下のテキストボックスが現れ、設定を可能とする。
        
          - > 機関名（Organization Name）：機関名を設定するテキストボックス。初期値はなし。
        
          - > メールアドレス（E-Mail Address）：メールアドレスを設定するテキストボックス。初期値はなし。
        
          - > ドメイン名（Domain Name）：ドメイン名を設定するテキストボックス。初期値はなし。
        
          - > IPアドレスの範囲（IP Address Range）（from-to）：半角数字のみ受け付けるテキストボックス。初期値はなし。入力必須項目であり、半角数字以外を入力すると「正しい数値を入力してください（Please input a correct number）」と表示される。また、\[その他の入力行（More Input Row）\]ボタンが直下に追加され、押下することで、複数のＩＰアドレスの範囲を指定することができる。
        
          - > \[削除（delete）\]ボタンを押下することで、テキストボックスを削除することができる。
    
      - > 「サイトライセンスから除外できるアイテムタイプを指定してください（Please specify item type to be excluded from the site license）」:サイトライセンスから除外するアイテムタイプの設定を行う。初期状態では、登録されているアイテムタイプのすべてが「表示する（Allow）」リストに格納されており、除外したいアイテムタイプを選択し、\[→\]ボタンを押下することで「表示しない（Deny）」リストへ移動させる。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko-admin

<!-- end list -->

  - > 処理概要

> 任意の設定値入力後、\[保存（Save）\]ボタンを押下することで、weko\_admin.admin.SiteLicenseView.indexが呼び出され、そこで入力項目に問題がなければdb内のsitelicense\_infoに入力した情報と更新時間（最初の一回は作成時間）が保存され、「Site license was successfully updated」というメッセージが上部に表示され、入力内容を保持した画面に遷移する。

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

###   

### サイトマップ

  - > 目的・用途

本機能は、サイトマップを作成しキャッシュに保存する機能である。サイトマップを作成することで、クローラビリティが向上するメリットがある。

  - > 利用方法

【Administration\>設定（Setting）\>サイトマップ（Site Map）】の順で画面遷移し、\[実行（Run）\]ボタンを押下することでサイトマップの作成が可能。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

1\. システムのフォーマットでサイトマップを生成できる

  - 【Administration \> 設定（Setting） \> サイトマップ（Sitemap）】にサイトマップの生成を実行する。
    
      - \[実行（Run）\]ボタンを押すと、サイトマップの生成が実行される。
    
      - 実行された後、以下のような生成情報をSitemap画面に表示する。
        
          - 開始時間（Start Time）  
            フォーマット：YYYY-MM-DDThh:mm:ss
        
          - 終了時間（End Time）  
            フォーマット：YYYY-MM-DDThh:mm:ss
        
          - Records Processed
        
          - ステータス（status）：SUCCESS、ERROR
    
      - 出力ファイルは以下の通りである
        
          - sitemap\_\*\*\*\*.xml.gz  
            「\*\*\*\*」は対象アイテム数により10000件ごとに1ずつインクリメンタルされる（0001,0002・・・）
            
              - 1つのqzファイルの中に10000件ごとのXML（sitemap\_\*\*\*\*.xml）が一つのファイルに格納される
            
              - XMLには一つのアイテムに対して以下のような情報を出力する
                
                  - アイテム詳細URL
                
                  - lastmod  
                    フォーマット：YYYY-MM-DDThh:mm:ss.sTZD  
                    例：2019-03-07T16:36:27+09:00
            
              - アイテム詳細URLがアイテムID順に出力される
            
              - ダウンロードアドレス：「ホスト」/weko/sitemaps/sitemap\_\*\*\*\*.xml.gz
        
          - sitemapindex.xml  
            上記のsitemap\_\*\*\*\*.xml.gzを全て出力する
            
              - ダウンロードアドレス：「ホスト」/weko/sitemaps/sitemapindex.xml

2\. サイトマップ生成の定期実行を可能

  - 設定した時刻にサイトマップ更新を定期実行する。  
    （更新するタイミングの設定については、以下の処理概要に記載）

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko-sitemap

<!-- end list -->

  - > 処理概要

1\. 設定

  - Sitemap画面のテンプレートURLを設定する
    
      - パス：https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-sitemap/weko\_sitemap/config.py\#L13
    
      - 設定キー：WEKO\_SITEMAP\_ADMIN\_TEMPLATE  
        現在の設定値:

> WEKO\_SITEMAP\_ADMIN\_TEMPLATE = 'weko\_sitemap/sitemap.html'

  - データベースから取得するアイテムの上限レコード数を設定する
    
      - パス：https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-sitemap/weko\_sitemap/config.py\#L16 
    
    <!-- end list -->
    
      - 設定キー：WEKO\_SITEMAP\_TOTAL\_MAX\_URL\_COUNT  
        現在の設定値:

> WEKO\_SITEMAP\_TOTAL\_MAX\_URL\_COUNT = 10000000

  - キャッシュのタイムアウト時間を設定する
    
      - パス：https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-sitemap/weko\_sitemap/config.py\#L24 
    
      - 設定キー：WEKO\_SITEMAP\_CACHE\_TIMEOUT  
        現在の設定値:

> WEKO\_SITEMAP\_CACHE\_TIMEOUT = 60 \* 60 \* 24 \* 3
> 
> URLのプレフィックスを設定する

  - パス：https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-sitemap/weko\_sitemap/config.py\#L30

  - 設定キー：SITEMAP\_BLUEPRINT\_URL\_PREFIX  
    現在の設定値:

<!-- end list -->

  - SITEMAP\_BLUEPRINT\_URL\_PREFIX = '/weko/sitemaps'

> 「sitemapindex」URLのエンドポイントを設定する

  - パス：https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-sitemap/weko\_sitemap/config.py\#L32 

  - 設定キー：SITEMAP\_ENDPOINT\_URL  
    現在の設定値:

> SITEMAP\_ENDPOINT\_URL = '/sitemapindex.xml'
> 
> 各ページURLのエンドポイントを設定する

  - パス：https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-sitemap/weko\_sitemap/config.py\#L34 

  - 設定キー：SITEMAP\_ENDPOINT\_PAGE\_URL  
    現在の設定値:

> SITEMAP\_ENDPOINT\_PAGE\_URL = '/sitemap\_\<int:page\>.xml.gz'
> 
> Sitemapの上限URL数を設定する

  - パス：https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-sitemap/weko\_sitemap/config.py\#L36

  - 設定キー：SITEMAP\_MAX\_URL\_COUNT  
    現在の設定値:

> SITEMAP\_MAX\_URL\_COUNT = 10000
> 
> 自動更新タイミングを設定する

  - パス：https://github.com/RCOSDP/weko/blob/v0.9.22/scripts/instance.cfg\#L119

  - 設定キー：update\_sitemap

  - 設定値：days、minutes、hours  
    現在の設定値：

> 'update\_sitemap': {
> 
> 'task': 'weko\_sitemap.tasks.update\_sitemap',
> 
> 'schedule': timedelta(days=3, minutes=0, hours=0),
> 
> 'args': \[\],
> 
> },

2\. 実装方法

  - 【Administration \> Setting（設定） \> Sitemap】を以下のテンプレートで表示する
    
      - 設定キー：WEKO\_SITEMAP\_ADMIN\_TEMPLATE
    
      - パス：https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-sitemap/weko\_sitemap/templates/weko\_sitemap/sitemap.html

  - Sitemapを更新する処理
    
      - 【Administration \> （設定）Setting \> Sitemap】の順でサイトマップ画面へ遷移し\[実行（Run）」ボタンを押すと、weko\_sitemap.admin.update\_sitemapが呼び出され、sitemapの情報を以下のように取得する。
        
          - データベースからの値：pidstore\_pid.pid\_value、records\_metadata.updated
        
        <!-- end list -->
        
          - 条件：「pidstore\_pid.status = 'R' (registered)」AND「pidstore\_pid.pid\_type = 'recid'」
        
          - 上限レコード数：「WEKO\_SITEMAP\_TOTAL\_MAX\_URL\_COUNT」の値
        
          - 取得されたデータをファイルに分ける  
            1つのファイルに格納される上限URL数：「SITEMAP\_MAX\_URL\_COUNT」の値
    
      - 取得されたデータから、Sitemapの情報を以下のように作成する
        
          - アイテム詳細のURLは以下のように構築される

> {
> 
> loc: \<invenio\_records\_ui.recidのURL\> + pidstore\_pid.pid\_value,
> 
> lastmod: records\_metadata.updated
> 
> }

  - Sitemapの情報をキャッシュに保存する
    
      - sitemap\_\<page\>.xml.gz

> 'sitemap\_' + page\_number: {
> 
> lastmod: \<現在のシステム日時\>,
> 
> page: \<アイテム詳細のURL\>
> 
> }

  - sitemapindex.xml

> sitemap\_page\_keys: \[
> 
> 'sitemap\_' + page\_number,
> 
> ...
> 
> \]

  - Sitemap情報をキャッシュから自動的に削除される処理
    
      - キャッシュのタイムアウト時間を以下のコンフィグで設定する  
        設定キー：WEKO\_SITEMAP\_CACHE\_TIMEOUT
    
      - 「page\_number」及び「sitemap\_page\_keys」キャッシュに対してweko\_sitemap.ext.set\_cache\_pageでタイムアウト時間を指定している

<!-- end list -->

  - 「sitemapindex」URL及び各ページURLを構築する
    
      - 「sitemapindex」URL

> WEKO\_SITEMAP\_URL\_SCHEME + \<ホスト\> + SITEMAP\_BLUEPRINT\_URL\_PREFIX + SITEMAP\_ENDPOINT\_URL

  - 各ページURL

> WEKO\_SITEMAP\_URL\_SCHEME + \<ホスト\> + SITEMAP\_BLUEPRINT\_URL\_PREFIX + SITEMAP\_ENDPOINT\_PAGE\_URL

  - Sitemap情報をダウンロードする処理
    
      - sitemapindex.xmlweko\_sitemap.ext.get\_cache\_pageで 上記の「sitemap\_page\_keys」からのデータを取得し、weko\_sitemap.ext.sitemapで以下のように出力する。

> \[
> 
> {
> 
> loc: \<ファイルのURL\>,
> 
> lastmod: 'sitemap\_ + page\_number'.lastmod
> 
> },
> 
> ...
> 
> \]

  - sitemap\_\<page\>.xml.gz  
    weko\_sitemap.ext.pageでURLに入力しているページ番号に応じて、該当「page\_number」から取得するデータを出力、weko\_sitemap.ext.gzip\_responseでデータを「gz」ファイルに圧力する。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### メール送信

  - > 目的・用途

本機能は、送信元の情報を設定する機能である

  - > 利用方法

【Administration \> 設定（Setting） \> メール送信（Mail）画面】に送信元の情報を設定する

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 「Mail Setting」にてメールサーバの設定をする
    
      - 設定項目は以下の通りである
        
          - 「SMTPサーバ（Server）」：メールサーバ
            
              - デフォルト：「localhost」
        
          - 「ポート（Port）」：メールポート
            
              - デフォルト：「25」
        
          - 「TLSを使用する（Use TLS）」
            
              - デフォルト：チェックなし
        
          - 「SSLを使用する（Use SSL）」
            
              - デフォルト：チェックなし
        
          - 「ユーザー名（Username）」
            
              - デフォルト：空白
        
          - 「パスワード（Password）」
            
              - デフォルト：空白
        
          - 「ドメイン（Domain）」
            
              - デフォルト：空白
        
          - 「デフォルト送信元（Default sender）」
            
              - デフォルト：空白
    
      - ［更新（Update）］ボタンを押すと、入力内容を確認し、エラーなしの場合、設定内容を保存し、メッセージを画面上部に表示する  
        　メッセージ：  
        　日本語：「メールの設定を更新しました」  
        　英語：「Mail settings have been updated.」
    
      - エラーの場合は以下の通りである
        
          - 「Server」に入力しない場合  
            エラーメッセージ：「Mail server can't be empty.」
        
          - 「Port」に入力しない場合  
            エラーメッセージ：「Mail port can't be empty.」
        
          - 「Default sender」に入力しない場合  
            エラーメッセージ：「Mail default sender can't be empty.」

  - 「Send Test Mail」にてテストメール送信を行う
    
      - 設定項目は以下の通りである
        
          - 「送信先（Recipient）」
        
          - 「主題（Subject）」
        
          - 「本文（Body）」
    
      - ［送信（Enable）］ボタンを押すと、設定内容でメールの送信を行う
        
          - 送信が成功の場合、以下のメッセージを画面上部に表示する  
            　メッセージ：  
            　日本語：「テストメールを送信しました。」  
            　英語：「Test mail sent.」
        
          - 送信が失敗の場合、以下のメッセージ及びエラーコードを画面上部に表示する  
            メッセージ：「Failed to send mail.」

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - invenio-mail

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 画面表示時は、invenio\_mail.admin.MailSettingVIew.indexメソッドがGETで呼び出される
    
      - このとき、mail\_configテーブルからメールサーバの設定を取得する
        
          - invenio\_mail.models.MailConfig.get\_configメソッドの中で、設定が取得できなかった場合は、デフォルトの内容のレコードを作成してからそれを取得する
    
      - 「Mail Setting」の内容を取得したもの、「Send Test Mail」の内容を空欄として表示する

  - ［更新（Update）］ボタンを押すと、invenio\_mail.admin.MailSettingVIew.indexメソッドがPOSTで呼び出される
    
      - エラーチェックを通過した場合、mail\_configテーブルのレコードを更新する
        
          - invenio\_mail.models.MailConfig.set\_configメソッドによって、１つのレコードを更新する
    
      - その後、「Mail Setting」の内容を画面で入力したもの、「Send Test Mail」の内容を空欄として画面に表示する

  - ［送信（Enable）］ボタンを押すと、invenio\_mail.admin.MailSettingVIew.send\_test\_mailメソッドが呼び出される
    
      - mail\_configテーブルから取得した情報をメールサーバの各種設定として、「Send Test Mail」の各入力欄に入力したものをメッセージとしてcurrent\_app.extensions\['mail'\]に設定して、送信する
    
      - その後、「Mail Setting」の内容をテーブルから取得したもの、「Send Test Mail」の内容を空欄として画面に表示する

  - 「ドメイン（Domain）」の値を持ちいて送信元ドメインを設定する。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
<tr class="even">
<td><blockquote>
<p>2023/11/11</p>
</blockquote></td>
<td>V0.9.23</td>
<td></td>
</tr>
</tbody>
</table>

##   

### WebAPIアカウント

  - > 目的・用途

本機能は、アイテムメタデータ自動入力機能におけるAPIアカウント認証で使用する情報を設定する機能である

  - > 利用方法

【Administration \> 設定（Setting） \> WebAPIアカウント（WebAPI Account）画面】にてアイテムメタデータ自動入力機能で連携するWeb APIのアカウント情報を設定する

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - v0.9.22では、CrossRefのみ対応している

  - 設定項目は以下とする
    
      - 「入力タイプ」（Input Type） ：タイプを選択する
        
          - 画面表示時の選択値は、「入力タイプを選択してください」（Please selected the input type）
    
      - 各種APIに必要なアカウント設定フィールド
        
          - 入力タイプで "CrossRef" を選択した場合は、以下の入力フィールドを表示する  
            「CrossRefクエリサービスアカウント」（CrossRef Query Services Account）

  - ［保存（Save）］ボタンを押すと入力内容のチェックを行い、エラーがなければ設定情報が保存される
    
      - 「入力タイプ」（Input Type）の選択値が「入力タイプを選択してください」（Please selected the input type）である間、［保存（Save）］ボタンは非活性である
    
      - 「CrossRefクエリサービスアカウント」（CrossRef Query Services Account）が空の状態でボタンを押すと、保存されずに以下のエラーメッセージがポップアップで表示される  
        エラーメッセージ：「Account information is invalid. Please check again.」
    
      - 「CrossRefクエリサービスアカウント」（CrossRef Query Services Account）に入力値がある場合は、その内容を使って接続の確認を行い、正常に接続できなかった場合は、保存されずに保存されずに以下のエラーメッセージがポップアップで表示される  
        エラーメッセージ：  
        　日本語：「アカウント情報が無効です。再度確認してください」  
        　英語：「Account information is invalid. Please check again.」
    
      - エラーが発生しなかった場合は、以下のメッセージが表示される  
        メッセージ：「Account info has been saved successfully.」

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - weko\_admin

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 画面表示時は、weko\_admin.admin.WebApiAccount.indexメソッドがGETで呼び出される
    
      - テーブルから情報を取得するなどの処理は行わない

  - 「入力タイプ」（Input Type）でタイプを選択すると、weko\_admin.views. get\_curr\_api\_cert関数が呼び出される
    
      - この中では、weko\_admin.utils.get\_current\_api\_certification関数で、api\_certificateテーブルから「入力タイプ」（Input Type）の選択値のvalueと「api\_code」フィールドが一致するレコードを取得する
    
      - 取得した値を、「CrossRefクエリサービスアカウント」（CrossRef Query Services Account）入力フィールドに設定する

  - ［保存（Save）］ボタンを押すと、web\_api\_account.jsで入力値のチェックを行い、エラーがなければweko\_admin.views. save\_api\_cert\_data関数がajaxで呼び出される
    
      - 「CrossRefクエリサービスアカウント」（CrossRef Query Services Account）が空だった場合のチェックはweb\_api\_account.jsで行う
    
      - save\_api\_cert\_data関数の中で、weko\_admin.utils.calidate\_certification関数によって接続確認を行う
    
      - 接続確認に成功した場合に、api\_certificateテーブルに「入力タイプ」（Input Type）の選択値のvalueと「api\_code」フィールドが一致するレコードがあるかどうか確認して、あった場合にそのレコードを更新する

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### ファイルプレビュー

  - > 目的・用途

本機能は、Microsoft Officeファイルをプレビュー表示する際に、PDFファイルへ指定されたファイルの変換に設定する機能である

  - > 利用方法

【Administration \> 設定（Setting） \> ファイルプレビュー（File Preview）画面】にてPDFファイルの保存先パス及び保存期間を設定する

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 画面表示時に、各設定値を取得して入力エリアに表示する
    
      - 「PDF Save Path」：サーバー側で変換したPDFファイルの保存先パスを設定する
        
          - デフォルトの値：「/tmp」
    
      - 「PDF TTL」：PDFファイルの保存期間を設定する
        
          - デフォルトの値：「3600」
        
          - 単位：秒
    
      - ［保存（Save）］ボタンを押すと、設定内容を保存し、メッセージを画面上部に表示する  
        メッセージ：  
        　日本語：「設定を変更しました」  
        　英語：「Successfully Changed Settings.」
        
          - 「PDF Save Path」の入力値が「/」であるか、どちらかの入力欄が空である場合、設定内容を保存せずに、エラーメッセージを画面上部に表示して、画面を再表示する  
            エラーメッセージ：  
            　日本語：「設定変更に失敗しました」  
            　英語：「Failurely Changed Settings.」
        
          - 「PDF Save Path」の入力値の末尾が「/」である場合、末尾の「/」を除いた内容が保存される
        
          - 「PDF Save Path」が変更される場合、もともとのパスにあったファイルは削除される

  - ここで設定した値を使用して、保存時間を過ぎたPDFファイルを削除する処理を定期的に実行する

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - invenio\_files\_rest：各デフォルト値をコンフィグで定義している

  - weko\_admin：画面表示のクラスと、設定を保存するDBを定義している

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 画面表示時は、weko\_admin.admin. FilePreviewSettingsView.indexメソッドがGETで呼び出される
    
      - このとき、admin\_settingsテーブルからnameが「convert\_pdf\_settings」であるレコードを取得する
        
          - 取得できなかった場合は、以下のコンフィグからデフォルトの内容を取得する
            
              - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-files-rest/invenio_files_rest/config.py#L128-L131>
            
              - 設定キー：
                
                  - FILES\_REST\_DEFAULT\_PDF\_SAVE\_PATH
                
                  - FILES\_REST\_DEFAULT\_PDF\_TTL
    
      - 取得した情報を各入力欄に設定して画面表示する

  - ［保存（Save）］ボタンを押すと、weko\_admin.admin. FilePreviewSettingsView.indexメソッドがPOSTで呼び出される
    
      - admin\_settingsテーブルに、以下の内容で保存する  
        ※nameが同じレコードがなかった場合は新規作成、あった場合は更新する
        
          - name：「convert\_pdf\_settings」
        
          - settings：「{"path":「PDF Save Path」の入力値, "pdf\_ttl":「PDF TTL」の入力値}」
    
      - その後、GETで呼び出されたときと同様の処理を行い、画面表示する

  - ここで設定した値は、invenio\_files\_rest.tasks.check\_file\_storage\_time関数で使用する
    
      - この関数は、celeryタスクで定期的に実行する
    
    <!-- end list -->
    
      - > admi）："の場所にある各ファイルについて、最終更新日時から（"pdf\_ttl"の値）秒以上経過していた場合に、invenio\_files\_rest.storage.pyfs. remove\_dir\_with\_file関数によって削除する

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### Shibboleth

  - > 目的・用途

本機能は、システム利用者がログインする際のシボレスユーザーの許可/拒否を設定する機能である。

  - > 利用方法

【Administration \> 設定（Setting） \> Shibboleth画面】にて操作を行う。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 画面には以下の選択肢を持つラジオボタンがあり、現在の許可/拒否設定を反映して表示される
    
      - 「Shibbolethを有効にする」(Enable Shibboleth Authentication)
        
          - シボレスユーザーを許可とし、「Shibboleth User」ボタンをログイン画面に表示させる設定
    
      - 「Shibbolethを無効にする」（Disable Shibboleth Authentication）
        
          - シボレスユーザーを拒否とし、「Shibboleth User」ボタンをログイン画面に表示させない設定

  - ［保存（Save）］ボタンを押すと、設定内容を保存し、以下のメッセージを画面上部に表示する  
    JP：「Shibboleth設定を更新しました」  
    EN：「Updated Shibboleth settings」

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - weko\_accounts

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 画面表示時に、weko\_accounts.admin.ShibSettingView.indexメソッドをGETで呼び出して、instance.cfgまたはweko-accountsで以下のコンフィグからShibbolethの許可設定を読み込む。両方で設定されている場合、instance.cfgの設定が優先される。また、画面で設定を変更した場合は、その変更が最優先される。
    
      - パス（instance.cfg）：  
        <https://github.com/RCOSDP/weko/blob/v0.9.22/scripts/instance.cfg#L436>
    
      - パス（config.py）：  
        <https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-accounts/weko_accounts/config.py#L29>
    
      - 設定キー：WEKO\_ACCOUNTS\_SHIB\_LOGIN\_ENABLED

  - ［保存（Save）］ボタンを押すと、weko\_accounts.admin.ShibSettingView.indexメソッドをPOSTで呼び出して、以下のようにしてコンテキストに設定を保存する。

> \_app = LocalProxy(lambda: current\_app.extensions\['weko-admin'\].app)
> 
> ※上記はShibSettingViewクラスの外で定義
> 
> shib\_flg = request.form.get('shibbolethRadios', '0')
> 
> if shib\_flg == '1':
> 
> \_app.config\['WEKO\_ACCOUNTS\_SHIB\_LOGIN\_ENABLED'\] = True
> 
> else:
> 
> \_app.config\['WEKO\_ACCOUNTS\_SHIB\_LOGIN\_ENABLED'\] = False

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### 制限公開

  - > 目的・用途

本機能は、制限公開に関する機能を設定し、利用報告督促メールを送付する機能である

  - > 利用方法

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 使用している画面：【Admin \> Setting \> Restricted Access画面】：制限公開に関する機能を設定し、利用報告督促メールを送付する画面である

１．シークレットURLのダウンロードについて設定する

  - 「シークレットURLダウンロード」(Secret URL Download)エリアに、機能有効化、有効期限日数とダウンロード回数を設定する
    
      - 設定内容は以下とする
        
          - 「機能有効化」（Enable）
            
              - 初期値はチェック無しとする
            
              - チェックありで保存されている場合、シークレットURLボタンの表示機能が有効となる。
            
              - チェックなしの場合、「有効期限日数」（Expiration Date）「ダウンロード回数」（Download Limit）の各項目はすべて非活性となる。（他の活性条件に優先する）
        
        <!-- end list -->
        
          - 「有効期限日数」（Expiration Date）
            
              - 「有効期限日数」（Expiration Date）テキストボックス
                
                  - 初期値は30日とする
                
                  - 1以上の整数を入力する制御とする。不正な値を入力する場合、「保存」（Save）ボタンを押すと、エラーメッセージが表示される  
                    エラーメッセージ：  
                    日本語：「{}は1以上の整数を設定する必要があります。」  
                    英語：「Must set a positive integer for {}. 」
            
              - 「無期限にする」(Unlimited)チェックボックス
                
                  - チェックを入れる場合、パラメータ値を9999999日に設定することとする
                
                  - チェックを入れると、「有効期限日数」（Expiration Date）テキストボックスが非活性とする
            
              - 各シークレットURLの有効期限はURL発行時点で設定される
            
              - 未設定かつ「無期限にする」チェックボックスをチェックしていない場合、「保存」（Save）ボタンを押すと、エラーメッセージが表示される  
                エラーメッセージ：  
                日本語：「{}を設定してください。」  
                英語：「Please set {}.」
        
          - 「ダウンロード回数」（Download Limit）
            
              - 「ダウンロード回数」（Download Limit）テキストボックス
                
                  - 初期値は10回とする
                
                  - 1以上の整数を入力する制御とする。不正な値を入力する場合、「保存」（Save）ボタンを押すと、エラーメッセージが表示される  
                    エラーメッセージ：  
                    日本語：「{}は1以上の整数を設定する必要があります。」  
                    英語：「Must set a positive integer for {}. 」
            
              - 「無期限にする」(Unlimited)チェックボックス
                
                  - チェックを入れる場合、パラメータ値を9999999日に設定することとする
                
                  - チェックを入れると、「ダウンロード回数」（Download Limit）テキストボックスが非活性とする
            
              - ダウンロードが途中で失敗した場合でも、1回のダウンロードとしてカウントする（サーバー側でダウンロードの成功有無は確認できないため）
            
              - 各シークレットURLのダウンロード回数はURL発行時点で設定される
            
              - 「保存」（Save）ボタンを押すと、設定内容を保存し、メッセージを表示する  
                メッセージ：  
                日本語：「制限公開の設定を変更しました。」  
                英語：「Restricted Access was successfully updated.」
            
              - 未設定かつ「無期限にする」チェックボックスをチェックしていない場合、「保存」（Save）ボタンを押すと、エラーメッセージが表示される  
                エラーメッセージ：  
                日本語：「{}を設定してください。」  
                英語：「Please set {}.」

２. コンテンツファイルのダウンロードについて設定する

  - 「コンテンツファイルのダウンロード」(Content File Download)エリアに、有効期限日数とダウンロード回数を設定する
    
      - 設定内容は以下とする
        
          - 「有効期限日数」（Expiration Date）
            
              - 「有効期限日数」（Expiration Date）テキストボックス
                
                  - 初期値は30日とする
                
                  - 1以上の整数を入力する制御とする。不正な値を入力する場合、「保存」（Save）ボタンを押すと、エラーメッセージが表示される  
                    エラーメッセージ：  
                    日本語：「{}は1以上の整数を設定する必要があります。」  
                    英語：「Must set a positive integer for {}. 」
            
              - 「無期限にする」(Unlimited)チェックボックス
                
                  - チェックを入れる場合、パラメータ値を9999999日に設定することとする
                
                  - チェックを入れると、「有効期限日数」（Expiration Date）テキストボックスが非活性とする
            
              - ダウンロードリンクの有効期限は承認者が承認した時点で設定されること
            
              - 未設定かつ「無期限にする」チェックボックスをチェックしていない場合、「保存」（Save）ボタンを押すと、エラーメッセージが表示される  
                エラーメッセージ：  
                日本語：「{}を設定してください。」  
                英語：「Please set {}.」
        
          - 「ダウンロード回数」（Download Limit）
            
              - 「ダウンロード回数」（Download Limit）テキストボックス
                
                  - 初期値は10回とする
                
                  - 1以上の整数を入力する制御とする。不正な値を入力する場合、「保存」（Save）ボタンを押すと、エラーメッセージが表示される  
                    エラーメッセージ：  
                    日本語：「{}は1以上の整数を設定する必要があります。」  
                    英語：「Must set a positive integer for {}. 」
            
              - 「無期限にする」(Unlimited)チェックボックス
                
                  - チェックを入れる場合、パラメータ値を9999999日に設定することとする
                
                  - チェックを入れると、「ダウンロード回数」（Download Limit）テキストボックスが非活性とする
            
              - ダウンロードが途中で失敗した場合でも、1回のダウンロードとしてカウントする（サーバー側でダウンロードの成功有無は確認できないため）
            
              - 「保存」（Save）ボタンを押すと、設定内容を保存し、メッセージを表示する  
                メッセージ：  
                日本語：「制限公開の設定を変更しました。」  
                英語：「Restricted Access was successfully updated.」
            
              - 未設定かつ「無期限にする」チェックボックスをチェックしていない場合、「保存」（Save）ボタンを押すと、エラーメッセージが表示される  
                エラーメッセージ：  
                日本語：「{}を設定してください。」  
                英語：「Please set {}.」

３. 利用報告ワークフローへのアクセスについて設定する

  - 「利用報告ワークフローへのアクセス」(Usage Report Workflow Access)エリアに、有効期限日数を設定する
    
      - 設定内容は以下とする
        
          - 「有効期限日数」（Expiration Date）テキストボックス
            
              - 初期値は500日とする
            
              - 1以上の整数を入力する制御とする。不正な値を入力する場合、「保存」（Save）ボタンを押すと、エラーメッセージが表示される  
                エラーメッセージ：  
                日本語：「{}は1以上の整数を設定する必要があります。」  
                英語：「Must set a positive integer for {}. 」
        
          - 「無期限にする」(Unlimited)チェックボックス
            
              - チェックを入れる場合、パラメータ値を9999999日に設定することとする
            
              - チェックを入れると、「有効期限日数」（Expiration Date）テキストボックスが非活性とする
        
          - 
          - 「保存」（Save）ボタンを押すと、設定内容を保存し、メッセージを表示する  
            メッセージ：  
            日本語：「制限公開の設定を変更しました。」  
            英語：「Restricted Access was successfully updated.」
        
          - 未設定かつ「無期限にする」チェックボックスをチェックしていない場合、「保存」（Save）ボタンを押すと、エラーメッセージが表示される  
            エラーメッセージ：  
            日本語：「{}を設定してください。」  
            英語：「Please set {}.」

４. 利用規約について設定する

  - 設定内容は以下の通りです。
    
      - 利用規約名一覧
        
          - 英語の利用規約名を表示する
        
          - 利用規約名の右端に「×」を設け、押下すると削除対象とする。削除は「保存」ボタン押下時に確定する
        
          - 末尾には「追加」（Add）を表示し、選択時は利用規約を新規登録する
    
      - 日本語利用規約名入力エリア
        
          - 日本語の利用規約名を設定するテキストボックス
        
          - アイテム登録時にWEKO3の表示言語設定が日本語の場合、選択肢として表示する項目
    
      - 日本語利用規約文言入力エリア
        
          - 登録する利用規約（日本語）の文言を入力するテキストエリア
        
          - 文字数上限は設けない
    
      - 英語利用規約名入力エリア
        
          - 英語の利用規約名を設定するテキストボックス。必須項目とする
        
          - アイテム登録時にWEKO3の表示言語設定が日本語以外の場合、選択肢として表示する項目
    
      - 英語利用規約文言入力エリア
        
          - 登録する利用規約（英語）の文言を入力するテキストエリア。必須項目とする
        
          - 文字数上限は設けない

  - 設定した後、「保存」（Save）ボタンを押すことで、設定している利用規約を利用規約名一覧に追加し、メッセージを表示する  
    メッセージ：  
    日本語：「制限公開の設定を変更しました。」  
    英語：「Restricted Access was successfully updated.」

  - 英語利用規約名、または英語利用規約文言を入力しない状態で、「保存」（Save）ボタンを押すと、エラーメッセージが表示される  
    エラーメッセージ：  
    日本語：「英語の利用規約を入力してください。」  
    英語：「Please input the Terms and Conditions in English.」

５. 利用報告督促メールを送付する

  - 「利用報告督促メール」（Usage Report Reminder Email）エリアには、利用報告督促メールの送信対象となるアクティビティの情報を一覧で表示する

  - 表示項目は以下の通りである
    
      - 一覧にはActivityの「No」「Activity」「Item」「Workflow」「Status」「User」を表示し、メール通知対象を選択するためのチェックボックスを設ける
    
      - 一覧の下に通知対象を確認させるため「確認」ボタンを設ける
    
      - 当該ボタンを押下するとモーダル画面開き、一覧でチェックボタンを選択した対象のみを表示す
    
      - 　 モーダル画面の「送信」ボタンを押下すると、メールが送信される。メールの送信が完了したらメッセージを表示する

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko\_admin

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - 設定内容をデータベースに保存する
    
      - テーブル：「admin\_settings」
    
      - フィールド：'name'="restricted\_access"  
        例：

> {"terms\_and\_conditions": \[{"key": "161699201191", "content": {"en": {"title": "Terms 1", "content": "Terms and Conditions Description"}, "ja": {"title": "利用規約1", "content": ""}}, "existed": true}\], "content\_file\_download": {"download\_limit": 10, "expiration\_date": 9999999, "download\_limit\_unlimited\_chk": false, "expiration\_date\_unlimited\_chk": true}, "usage\_report\_workflow\_access": {"expiration\_date\_access": 500, "expiration\_date\_access\_unlimited\_chk": false}}

  - > ゲストユーザーに対して、アクティビティ画面を表示する関数（"display\_guest\_activity"）には"record\_after\_update"変数を設定する

<!-- end list -->

  - > メール本文について

<!-- end list -->

  - メール名：利用申請WFの通知メール

> Subject: 利用申請登録のご案内／Register Application for Use
> 
> 【リポジトリ名（日本語）】です。
> 
> 下記のリンクにアクセスしていただき、利用申請の登録を行ってください。
> 
> 【ゲストユーザ向けの利用申請WFへのアクセスリンク】
> 
> このメールは自動送信されているので返信しないでください。
> 
> お問い合わせは下記までお願いします。また、このメールに心当たりのない方は、【リポジトリ名（日本語）】までご連絡ください。
> 
> 【リポジトリ名（日本語）】：【リポジトリURL】
> 
> 問い合わせ窓口：【リポジトリメールアドレス】
> 
> \----------------------------------------------------------------------------------
> 
> This is a message from 【リポジトリ名（英語）】.
> 
> Please access the link below and register your Application.
> 
> 【ゲストユーザ向けの利用申請WFへのアクセスリンク】
> 
> Please do not reply to this email as it has been sent automatically.
> 
> Please direct all inquiries to the following address.
> 
> Also, if you received this message in error, please notify 【リポジトリ名（英語）】.
> 
> 【リポジトリ名（英語）】：【URL】
> 
> E-mail：【リポジトリメールアドレス】

  - メール名：利用報告WFの通知メール

> Subject: 利用報告の登録のお願い／Request for register Data Usage Report
> 
> 【リポジトリ名（日本語）】です。
> 
> 下記で申請いただいデータについてダウンロードされたことを確認しました。
> 
> 申請番号：【申請番号】
> 
> 登録者名：【申請者名前】
> 
> メールアドレス：【申請者メールアドレス】
> 
> 所属機関：【申請者所属機関】
> 
> 研究題目：【研究題目】
> 
> 申請データ：【データ名】
> 
> 申請年月日：【申請年月日】
> 
> ダウンロードしたデータについて、下記のリンクから利用報告の登録をお願いします。
> 
> 【利用報告WFへのアクセスリンク】
> 
> このメールは自動送信されているので返信しないでください。
> 
> お問い合わせは下記までお願いします。また、このメールに心当たりのない方は、【リポジトリ名（日本語）】までご連絡ください。
> 
> 【リポジトリ名（日本語）】：【リポジトリURL】
> 
> 問い合わせ窓口：【リポジトリメールアドレス】
> 
> \----------------------------------------------------------------------------------
> 
> This is a message from 【リポジトリ名（英語）】.
> 
> We have confirmed that the dataset which you registered at below has been downloaded.
> 
> Application No.：【申請番号】
> 
> Name：【申請者名前】
> 
> E-mail：【メールアドレス】
> 
> Affiliation：【申請者所属機関】
> 
> Title of research：【研究題目】
> 
> Dataset requested ：【データ名】
> 
> Application date：【申請年月日】
> 
> For the downloaded data, please register the Data Usage Report by the link below.
> 
> 【利用報告WFへのアクセスリンク】
> 
> Please do not reply to this email as it has been sent automatically.
> 
> Please direct all inquiries to the following address.
> 
> Also, if you received this message in error, please notify 【リポジトリ名（英語）】.
> 
> 【リポジトリ名（英語）】：【URL】
> 
> E-mail：【リポジトリメールアドレス】

  - メール名：利用報告督促メール

> Subject: 利用報告の登録のお願い／Request for register Data Usage Report
> 
> 【リポジトリ名（日本語）】です。
> 
> 現時点で、下記の利用報告が登録されていません
> 
> 報告番号：【報告番号】
> 
> 登録者名：【報告-申請者名前】
> 
> メールアドレス：【報告-申請者メールアドレス】
> 
> 所属機関：【報告-申請者所属機関】
> 
> 利用データ：【報告-データ名】
> 
> データダウンロード日：【報告-WF起票日】
> 
> 下記のリンクから利用報告の登録をお願いします。
> 
> 【利用報告WFへのアクセスリンク】
> 
> このメールは自動送信されているので返信しないでください。
> 
> お問い合わせは下記までお願いします。また、このメールに心当たりのない方は、【リポジトリ名（日本語）】までご連絡ください。
> 
> 【リポジトリ名（日本語）】：【リポジトリURL】
> 
> 問い合わせ窓口：【リポジトリメールアドレス】
> 
> \----------------------------------------------------------------------------------
> 
> This is a message from 【リポジトリ名（英語）】.
> 
> At this time, the Data Usage Report below has not been registered.
> 
> Usage Report No.：【報告番号】
> 
> Name：【報告-申請者名前】
> 
> E-mail：【報告-申請者メールアドレス】
> 
> Affiliation：【報告-申請者所属機関】
> 
> Usage Dataset：【報告-データ名】
> 
> Download date：【報告-WF起票日】
> 
> Please register the Data Usage Report from the link below.
> 
> 【利用報告WFへのアクセスリンク】
> 
> Please do not reply to this email as it has been sent automatically.
> 
> Please direct all inquiries to the following address.
> 
> Also, if you received this message in error, please notify 【リポジトリ名（英語）】.
> 
> 【リポジトリ名（英語）】：【URL】
> 
> E-mail：【リポジトリメールアドレス】

埋め込み文字の整理

  - 【リポジトリ名（日本語）】：Admin\>Settings\>Site Info に設定されている日本語のSite Name

  - 【リポジトリ名（英語）】：Admin\>Setting\>Site Info に設定されている英語のSite Name

  - 【ゲストユーザ向けの利用申請WFへのアクセスリンク】： \#24088 で対応したテンポラリリンク

  - 【リポジトリURL】：「THEME\_SITEURL」 に設定されているURL

  - 【リポジトリメールアドレス】：Admin\>Setting\>Mail のDefault sender

  - 【申請番号】：対象となる利用申請のアクティビティID

  - 【申請者名前】：利用申請アイテムタイプ項目の申請者・名前の設定値

  - 【申請者メールアドレス】：利用申請アイテムタイプ項目の申請者・メールアドレスの設定値

  - 【申請者所属機関】：利用申請アイテムタイプ項目の申請者・所属機関の設定値

  - 【研究題目】：利用申請アイテムタイプ項目の研究題目の設定値

  - 【データ名】利用申請アイテムタイプ項目のデータ名の設定値

  - 【申請年月日】利用申請アイテムタイプ項目の申請日の設定値

  - 【ダウンロードリンク】： \#24088 で対応したテンポラリリンク

  - 【データのダウンロード期限日】：利用申請アイテムタイプ項目の承認日からAdmin\>Setting\>Restricted AccessのExpiration Date経過した日付

  - 【利用報告WFへのアクセスリンク】： \#24327 で対応したアクセスリンク

  - 【報告番号】：対象となる利用報告のアクティビティID

  - 【報告-申請者名前】：利用報告アイテムタイプ項目の申請者・名前の設定値

  - 【報告-申請者メールアドレス】：利用報告アイテムタイプ項目の申請者・メールアドレスの設定値

  - 【報告-申請者所属機関】：利用報告アイテムタイプ項目の申請者・所属機関の設定値

  - 【報告-データ名】：利用報告アイテムタイプ項目のデータ名の設定値

  - 【報告-WF起票日】：利用報告アイテムタイプ項目のWF起票日の設定値

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2024/01/19</td>
<td><strong>8c312e8cb1db9c6479b86d1443a38720079838b0</strong></td>
<td>シークレットURL機能追加</td>
</tr>
<tr class="even">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### その他

  - > 目的・用途

本機能は、その他の運用設定を設定する機能である

  - > 利用方法

【Administration \> Setting (設定) \> Others (その他)】において、機関名を入力し、【Save (保存)】を押下することで、GoogleScholar向けメタデータのひとつの「学位授与機関名」として入力した機関名を付与する。

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 【Administration \> Setting (設定)\> Others (その他) 画面】での「Institution Name」エリアに機関名を設定する  
    ※設定された機関名がGoogleScholar向けにアイテムメタデータとあわせて、「学位授与機関名」として出力される
    
      - デフォルト：空白
    
      - 「機関名」（Institution Name）テキストボックスに機関名を入力してから、「保存」（Save）ボタンを押すと、設定内容を保存し、メッセージを画面上部に表示する  
        メッセージ：「Institution Name was updated.」

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko\_records\_ui

<!-- end list -->

  - > 処理概要

> 機関名を入力し、【Save (保存)】を押下した際に、weko\_records\_ui.admin.InstitutionNameSettingが呼び出される。

  - > weko\_records\_ui.models.InstitutionName.set\_institution\_nameが呼び出され、  
    > 入力した機関名をinstitution\_nameテーブルに設定する。

> 「INSTITUTION\_NAME\_SETTING\_TEMPLATE」：weko\_records\_ui.config

  - > 'weko\_records\_ui/admin/institution\_name\_setting.html'

> Google Scholar向けメタデータの出力の際は、weko\_records\_ui.utils.get\_google\_scholar\_metaからweko\_records\_ui.models.InstitutionName.get\_institution\_nameを呼び出して  
> intitution\_nameテーブルから機関名を取得する。

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

15. ## メンテナンス
    
    1.  ### Elasticsearchインデックス

<!-- end list -->

  - > 目的・用途

Elasticsearchのマッピング変更や検索設定の変更を反映するために、

管理画面からWEKOに登録されたアイテムの再インデックスを可能にする機能を提供する画面。

  - > 利用方法

管理画面の「メンテナンス機能」にある「Elasticsearchインデックス」メニューから、「アイテムインデックスの再作成」「アイテムの再インデックス」を実行できる。  
本機能の利用は、メンテナンス期間中に限られる。また、本機能にて万が一障害が発生した場合は、下記の方法での対応を想定している。

  - 障害原因の調査
    
      - 原因特定のためにまず確認すべきと想定される情報ソースを下記に記載します。
        
          - 画面上部の赤帯に記載のエラーメッセージ
        
          - ※同様のERRORがログに記載されているはずなので必須ではありませんが、原因特定にかかる時間を短縮できます
        
          - アプリケーションログ
        
          - Celery taskの実行ログ
        
          - ElasticSearchの起動状況
        
          - RabbitMQの起動状況
        
          - ElasticSearchのアイテムインデックス（\*-weko-item-\*）と本処理の一時保管用のインデックスElasticSearchのアイテムインデックス（\*-weko-item-\*-tmp）の、ドキュメント・Mappings・Settings・Aliasの情報

  - 障害原因の解消およびデータの修正
    
      - ケースバイケースとなるため、省略します。

  - 実行制御の解除
    
      - エラーが発生した際に、画面からの処理実行ができないように制御がされているので、これを下記の方法で解除します。
        
          - データベースのadmin\_settingsテーブルのelastic\_reindex\_settingsという名のレコードのsettingsが{"has\_errored": true}となっているため、これを{"has\_errored": false}に変更します。

<!-- end list -->

  - > 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - > 機能内容

<!-- end list -->

  - 「アイテムインデックスの再作成」の実行機能
    
      - マッピング・セッティング定義を初期状態にリセットして、現在のElasticSearchのアイテムインデックスをもとに再度ElasticSearchのアイテム・インデックスツリーの情報を作成しなおす機能。

  - 「アイテムの再インデックス」の実行機能
    
      - マッピング・セッティング定義を初期状態にリセットした後、DataBaseにある情報をもとにElasticSearchのアイテム・インデックスツリーの情報を作成しなおす機能。

  - 同時実行を制限する機能
    
      - 二重実行や、「アイテムインデックスの再作成」と「アイテムの再インデックス」の同時実行を防ぐ機能。

  - エラー発生時、再実行を禁止する機能
    
      - 障害原因の解消とデータメンテナンスが完了するまでは再実行禁止する運用前提。

  - 実行前に、処理に時間がかかる旨を確認する機能
    
      - 「アイテムインデックスの再作成」「アイテムの再インデックス」どちらの場合も確認を行う。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > weko\_admin

<!-- end list -->

  - > 処理概要

> 対応しているViewクラス：admin.py:: ReindexElasticSearchView
> 
> 「アイテムの再インデックス」でのDBからElasticSearchへ登録する機能は、既存実装を呼び出す形で行っている。レコードメタデータにある値をElasticSearchの検索フィールドにマッピングは、Signalから呼び出される処理を利用して達成している。
> 
> エラー発生の情報はDBで管理する

  - テーブル：「admin\_settings」

  - フィールド：'name'="elastic\_reindex\_settings"

例：

> {"has\_errored": false}

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

# WebAPI 


##   

### OAI-PMH 

  - > 目的・用途

<!-- end list -->

  - > OAI-PMHとは、データベース内のメタデータを様々な指定をして受け渡すことを可能とするプロトコルである。OAI-PMHを用いることによって様々なスキーマでメタデータの提供を可能としている。利用方法

OAI-PMHのリクエストURLは以下のようになる。以下の「値」と「verbのパラメータ」に任意の値を指定することで、メタデータを取得することができる。指定できる値については後述。

https://\[host\]/oai?verb=「値」&「verbのパラメータ」=「値」&「 verbのパラメータ」=「値」&...

  - > 機能内容

<!-- end list -->

  - Verbに指定できる値は、以下の6種類となる。
    
      - GetRecord  
        リポジトリから個別のメタデータレコードを検索するためのverb。  
        追加で指定するパラメータは次の2つになる。  
        １．identifier：レコードの抽出元となるリポジトリのアイテムの固有識別子を指定する引数。必須項目。  
        ２．metadataPrefix：返却レコードのメタデータ部に含まれるフォーマットを指定する引数。必須項目。
        
          - 以下に応答例を示す。

\<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"\>

\<responseDate\>yyyy-mm-ddThh:mm:ssZ\</responseDate\>

\<request metadataPrefix="○○○○" verb="GetRecord" identifier="○○○○"\>https://\[host\]/oai\</request\>

\<GetRecord\>

\<record\>

\<header\>

\<identifier\>○○○○\</identifier\>

\<datestamp\>yyyy-mm-ddThh:mm:ssZ\</datestamp\>

\<setSpec\>○○○○\</setSpec\>

\</header\>

\<metadata\>

\<指定したアイテムのメタデータがここに記載される\>

\</metadata\>

\</record\>

\</GetRecord\>

\</OAI-PMH\>

  - Identify  
    リポジトリについての情報を検索する際に使用するverb。  
    追加で指定する引数はなし。
    
      - 以下に応答例を示す。

\<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"\>

\<responseDate\>yyyy-mm-ddThh:mm:ssZ\</responseDate\>

\<request verb="Identify"\>https://\[host\] /oai\</request\>

\<Identify\>

\<repositoryName\>○○○○\</repositoryName\>

\<adminEmail\>○○○○\</adminEmail\>

\<baseURL\>https://\[host\] /oai\</baseURL\>

\<protocolVersion\>2.0\</protocolVersion\>

\<earliestDatestamp\> yyyy-mm-ddThh:mm:ssZ \</earliestDatestamp\>

\<deletedRecord\>transient\</deletedRecord\>

\<granularity\>YYYY-MM-DDThh:mm:ssZ\</granularity\>

\</Identify\>

\</OAI-PMH\>

  - ListIdentifiers  
    任意の引数を指定し、ヘッダの検索する際に使用するverb。  
    追加で指定可能な引数は次の5つとなる。  
    １．from：UTCdatetimeの任意の引数。日付による選択的ハーベスティングの下限を設定する。  
    ２．until：UTCdatetimeの任意の引数。日付による選択的ハーベスティングの上限を設定する。  
    ３．metadataPrefix：返却レコードのメタデータ部に含まれるフォーマットを指定する引数。必須項目。  
    ４．set：Spec値を持つ任意の引数。選択的ハーベスティングを行う際のセットの基準を指定する。  
    ５. resumptionToken：リポジトリが応答する際に不完全リストとセットになっている要素。この要素を指定して検索を行うことで完全リストの検索を可能とする任意の引数。
    
      - 以下に応答例を示す。

\<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"\>

\<responseDate\>YYYY-MM-DDThh:mm:ssZ\</responseDate\>

\<request verb="ListIdentifiers" metadataPrefix="○○○○"\>https://\[host\]/oai\</request\>

\<ListIdentifiers\>

\<header\>

\<指定したヘッダの情報\>

\</header\>

\</ListIdentifiers\>

\</OAI-PMH\>

  - ListMetadataFormats  
    リポジトリから入手可能なメタデータフォーマットを検索する際に使用するverb。  
    指定可能な引数を以下に示す。  
    identifier：アイテムに利用可能なメタデータフォーマットが要求されている場合に、そのアイテムの固有識別子を指定する任意の引数。
    
      - 以下に応答例を示す。

\<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"\>

\<responseDate\>YYYY-MM-DDThh:mm:ssZ\</responseDate\>

\<ListMetadataFormats\>

\<metadataFormat\>

\<metadataPrefix\>jpcoar\</metadataPrefix\>

\<schema\>https://github.com/JPCOAR/schema/blob/master/2.0/jpcoar\_scm.xsd\</schema\>

\<metadataNamespace\>https://github.com/JPCOAR/schema/blob/master/2.0/\</metadataNamespace\>

\</metadataFormat\>

\<metadataFormat\>

\<metadataPrefix\>jpcoar\_1.0\</metadataPrefix\>

\<schema\>https://irdb.nii.ac.jp/schema/jpcoar/1.0/jpcoar\_scm.xsd\</schema\>

\<metadataNamespace\>https://irdb.nii.ac.jp/schema/jpcoar/1.0/\</metadataNamespace\>

\</metadataFormat\>

\<metadataFormat\>

\<metadataPrefix\>jpcoar\_2.0\</metadataPrefix\>

\<schema\>https://irdb.nii.ac.jp/schema/jpcoar/2.0/jpcoar\_scm.xsd\</schema\>

\<metadataNamespace\>https://irdb.nii.ac.jp/schema/jpcoar/2.0/\</metadataNamespace\>

\</metadataFormat\>

\<metadataFormat\>

\<metadataPrefix\>oai\_dc\</metadataPrefix\>

\<schema\>http://www.openarchives.org/OAI/2.0/oai\_dc/ http://www.openarchives.org/OAI/2.0/oai\_dc.xsd\</schema\>

\<metadataNamespace\>http://www.w3.org/2001/XMLSchema\</metadataNamespace\>

\</metadataFormat\>

\<metadataFormat\>

\<metadataPrefix\>ddi\</metadataPrefix\>

\<schema\>https://ddialliance.org/Specification/DDI-Codebook/2.5/XMLSchema/codebook.xsd\</schema\>

\<metadataNamespace\>ddi:codebook:2\_5\</metadataNamespace\>

\</metadataFormat\>

\<metadataFormat\>

\<metadataPrefix\>jpcoar\_v1\</metadataPrefix\>

\<schema\>https://github.com/JPCOAR/schema/blob/master/1.0/jpcoar\_scm.xsd\</schema\>

\<metadataNamespace\>https://github.com//schema/blob/master/1.0/\</metadataNamespace\>

\</metadataFormat\>

\<metadataFormat\>

\<metadataPrefix\>lom\</metadataPrefix\>

\<schema\>http://www.lido-schema.org http://www.lido-schema.org/schema/v1.0/lido-v1.0.xsd\</schema\>

\<metadataNamespace\>http://ltsc.ieee.org/xsd/LOM\</metadataNamespace\>

\</metadataFormat\>

\</ListMetadataFormats\>

\</OAI-PMH\>

  - ListRecord  
    リポジトリからレコードを収集する際に使用するverb。  
    追加で指定可能な引数は次の5つとなる。  
    １．from：UTCdatetimeの任意の引数。日付による選択的ハーベスティングの下限を設定する。  
    ２．until：UTCdatetimeの任意の引数。日付による選択的ハーベスティングの上限を設定する。  
    ３．metadataPrefix：返却レコードのメタデータ部に含まれるフォーマットを指定する引数。必須項目。  
    ４．set：Spec値を持つ任意の引数。選択的ハーベスティングを行う際のセットの基準を指定する。  
    ５. resumptionToken：リポジトリが応答する際に不完全リストとセットになっている要素。この要素を指定して検索を行うことで完全リストの検索を可能とする任意の引数。
    
      - 以下に応答例を示す。

> \<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"\>
> 
> \<responseDate\>YYYY-MM-DDThh:mm:ssZ\</responseDate\>
> 
> \<request verb="ListRecords" metadataPrefix="○○○○"\>https://\[host\]/oai\</request\>
> 
> \<ListRecords\>
> 
> \<record\>
> 
> \<header\>
> 
> \<指定したレコードの情報\>
> 
> \</header\>
> 
> \</record\>
> 
> \</ListRecords\>
> 
> \</OAI-PMH\>

  - ListSets  
    リポジトリのセット構成を検索する際に使用するverb。  
    使用可能となる引数は次のものである。  
    resumptionToken：リポジトリが応答する際に不完全リストとセットになっている要素。この要素を指定して検索を行うことで完全リストの検索を可能とする任意の引数。
    
      - 以下に応答例を示す。

> \<OAI-PMH xmlns="http://www.openarchives.org/OAI/2.0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd"\>
> 
> \<responseDate\>YYYY-MM-DDThh:mm:ssZ\</responseDate\>
> 
> \<request verb="ListSets"\>https://\[host\]/oai\</request\>
> 
> \<ListSets\>
> 
> \<set\>
> 
> \<セット構成の情報\>
> 
> \</ListSets\>
> 
> \</OAI-PMH\>
> 
> \</OAI-PMH\>\</OAI-PMH\>

  - > リクエストに不備がある場合は以下のエラーのいずれかがOAI-PMH出力の本文内に記載される。
    
      - > badArgument：不正な引数があるか、必須となる引数がない場合。
    
      - > cannotDisseminateFormat：metadataPrefixの値がidentifierにより指定されたアイテムでサポートされていない場合。
    
      - > idDoesNotExist：リポジトリでidentiferの値が不明であるか、不正なものである場合。
    
      - > badResumptionToken：resumptionTokenの値が無効であるか期限切れである場合。
    
      - > noRecordsMatch：from、until、setの値を組み合わせると空のリストになる場合。
    
      - > noSetHierarchy：リポジトリがセットをサポートしていない場合。
    
      - > noMetadataFormats：指定したアイテムで利用可能なメタデータフォーマットではない場合。

<!-- end list -->

  - > 関連モジュール

<!-- end list -->

  - > Invenio\_oaiserver

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### OpenSearch

  - 目的・用途

アイテムの検索に利用できる。

  - 利用方法

以下の形のURLを使用して検索ができる

https://\[host\]/ api/opensearch/search?クエリパラメータ=値&クエリパラメータ値&...

<table>
<thead>
<tr class="header">
<th><strong>Method</strong></th>
<th><strong>HTTP request</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>weko_search_ui.<br />
views.opensearch_description</td>
<td><strong>GET /api/opensearch/description.xml</strong></td>
<td></td>
</tr>
<tr class="even">
<td>weko_search_ui.<br />
query.opensearch_factory※</td>
<td><strong>GET /api/opensearch/search</strong></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

※ modules/weko-search-ui/weko\_search\_ui/config.py のRECORDS\_REST\_ENDPOINTS\["opensearch"\]にて設定

クエリパラメータ

<table>
<thead>
<tr class="header">
<th><strong>GET /api/opensearch/search</strong></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>パラメータ</td>
<td>必須</td>
<td>値</td>
<td>説明</td>
</tr>
<tr class="even">
<td>format</td>
<td></td>
<td><ul>
<li><p>atom</p></li>
<li><p>rss</p></li>
<li><p>jpcoar</p></li>
</ul></td>
<td><p>レスポンス結果のフォーマット</p>
<p>デフォルトはjson形式。</p></td>
</tr>
<tr class="odd">
<td>size</td>
<td></td>
<td>int</td>
<td>レスポンスに含めるフィード件数</td>
</tr>
<tr class="even">
<td>page</td>
<td></td>
<td>Int</td>
<td>表示するページ番号</td>
</tr>
<tr class="odd">
<td>以下は設定ファイルやアイテムタイプマッピングにより定義が変化する</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>title</td>
<td></td>
<td>string</td>
<td>dc:titleにマッピングされた項目の検索</td>
</tr>
<tr class="odd">
<td>des</td>
<td></td>
<td>strin</td>
<td>datacite:descriptionにマッピングされた項目の検索</td>
</tr>
<tr class="even">
<td>type</td>
<td></td>
<td>string</td>
<td>dc:typeにマッピングされた項目の検索</td>
</tr>
<tr class="odd">
<td>wid</td>
<td></td>
<td>Int</td>
<td>アイテムIDを指定して検索</td>
</tr>
<tr class="even">
<td>Iid</td>
<td></td>
<td>Int</td>
<td>インデックスIDを指定して検索</td>
</tr>
</tbody>
</table>

レスポンス例：

<table>
<thead>
<tr class="header">
<th><strong>レスポンス例：format: atom</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>/api/opensearch/search?title=nooai&amp;format=atom&amp;size=1</strong></td>
</tr>
<tr class="even">
<td><p>&lt;feed xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:opensearch="http://a9.com/-/spec/opensearch/1.1/" xmlns:prism="http://prismstandard.org/namespaces/basic/2.0/" xmlns="http://www.w3.org/2005/Atom" xml:lang="en"&gt;</p>
<p>&lt;id&gt;https://dev.ir.rcos.nii.ac.jp/api/opensearch/search?title=nooai&amp;amp;format=atom&amp;amp;size=1&lt;/id&gt;</p>
<p>&lt;title&gt;WEKO OpenSearch: &lt;/title&gt;</p>
<p>&lt;updated&gt;2023-11-14T23:47:46.452823+00:00&lt;/updated&gt;</p>
<p>&lt;link href="https://dev.ir.rcos.nii.ac.jp/api/opensearch/search?title=nooai&amp;amp;format=atom&amp;amp;size=1"/&gt;</p>
<p>&lt;generator uri="http://lkiesow.github.io/python-feedgen" version="0.7.0"&gt;python-feedgen&lt;/generator&gt;</p>
<p>&lt;opensearch:totalResults&gt;9&lt;/opensearch:totalResults&gt;</p>
<p>&lt;opensearch:startIndex&gt;1&lt;/opensearch:startIndex&gt;</p>
<p>&lt;opensearch:itemsPerPage&gt;1&lt;/opensearch:itemsPerPage&gt;</p>
<p>&lt;entry&gt;</p>
<p>&lt;id&gt;https://dev.ir.rcos.nii.ac.jp/oai?verb=GetRecord&amp;amp;metadataPrefix=jpcoar&amp;amp;identifier=oai:weko3.example.org:00000035&lt;/id&gt;</p>
<p>&lt;title&gt;public-item-2-public-nooai-guest-35-ja&lt;/title&gt;</p>
<p>&lt;updated&gt;2023-11-06T05:45:01.746520+00:00&lt;/updated&gt;</p>
<p>&lt;content xml:lang="ja"&gt;概要</p>
<p>概要</p>
<p>概要</p>
<p>概要&lt;/content&gt;</p>
<p>&lt;link href="https://dev.ir.rcos.nii.ac.jp/records/35"/&gt;</p>
<p>&lt;link href="https://dev.ir.rcos.nii.ac.jp/oai?verb=GetRecord&amp;amp;metadataPrefix=jpcoar&amp;amp;identifier=oai:weko3.example.org:00000035"/&gt;</p>
<p>&lt;dc:publisher xml:lang="en"&gt;Publisher&lt;/dc:publisher&gt;</p>
<p>&lt;dc:subject&gt;2-public-nooai-guest-35-ja&lt;/dc:subject&gt;</p>
<p>&lt;dc:type&gt;デフォルトアイテムタイプ（フル）&lt;/dc:type&gt;</p>
<p>&lt;dc:format&gt;text/plain&lt;/dc:format&gt;</p>
<p>&lt;dc:identifier&gt;35&lt;/dc:identifier&gt;</p>
<p>&lt;dc:identifier&gt;https://weko3.example.org/record/35/files/1KB.pdf&lt;/dc:identifier&gt;</p>
<p>&lt;prism:aggregationType&gt;conference paper&lt;/prism:aggregationType&gt;</p>
<p>&lt;prism:issn&gt;xxxx-xxxx-xxxx&lt;/prism:issn&gt;</p>
<p>&lt;prism:creationDate&gt;2023-11-06T05:44:59.220388+00:00&lt;/prism:creationDate&gt;</p>
<p>&lt;prism:modificationDate&gt;2023-11-06T05:45:01.746520+00:00&lt;/prism:modificationDate&gt;</p>
<p>&lt;/entry&gt;</p>
<p>&lt;/feed&gt;</p></td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr class="header">
<th><strong>レスポンス例：format: rss</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>/api/opensearch/search?title=nooai&amp;format=rss&amp;size=1</strong></td>
</tr>
<tr class="even">
<td><p>&lt;?xml version='1.0' encoding='UTF-8'?&gt;</p>
<p>&lt;rdf:RDF xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:opensearch="http://a9.com/-/spec/opensearch/1.1/" xmlns:prism="http://prismstandard.org/namespaces/basic/2.0/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#" xmlns="http://purl.org/rss/1.0/" xml:lang="en"&gt;</p>
<p>&lt;channel rdf:about="https://dev.ir.rcos.nii.ac.jp/api/opensearch/search?title=nooai&amp;amp;format=rss&amp;amp;size=1"&gt;</p>
<p>&lt;title&gt;WEKO OpenSearch: &lt;/title&gt;</p>
<p>&lt;link&gt;https://dev.ir.rcos.nii.ac.jp/api/opensearch/search?title=nooai&amp;amp;format=rss&amp;amp;size=1&lt;/link&gt;</p>
<p>&lt;docs&gt;http://www.rssboard.org/rss-specification&lt;/docs&gt;</p>
<p>&lt;generator&gt;python-feedgen&lt;/generator&gt;</p>
<p>&lt;language&gt;en&lt;/language&gt;</p>
<p>&lt;items&gt;</p>
<p>&lt;rdf:Seq&gt;</p>
<p>&lt;rdf:li rdf:resource="https://dev.ir.rcos.nii.ac.jp/records/35"/&gt;</p>
<p>&lt;/rdf:Seq&gt;</p>
<p>&lt;/items&gt;</p>
<p>&lt;lastBuildDate&gt;Tue, 14 Nov 2023 23:48:47 +0000&lt;/lastBuildDate&gt;</p>
<p>&lt;dc:date&gt;2023-11-14 23:48:47.221230+00:00&lt;/dc:date&gt;</p>
<p>&lt;opensearch:totalResults&gt;9&lt;/opensearch:totalResults&gt;</p>
<p>&lt;opensearch:startIndex&gt;1&lt;/opensearch:startIndex&gt;</p>
<p>&lt;opensearch:itemsPerPage&gt;1&lt;/opensearch:itemsPerPage&gt;</p>
<p>&lt;/channel&gt;</p>
<p>&lt;item rdf:about="https://dev.ir.rcos.nii.ac.jp/records/35"&gt;</p>
<p>&lt;title&gt;public-item-2-public-nooai-guest-35-ja&lt;/title&gt;</p>
<p>&lt;link&gt;https://dev.ir.rcos.nii.ac.jp/records/35&lt;/link&gt;</p>
<p>&lt;rdfs:seeAlso rdf:resource="https://dev.ir.rcos.nii.ac.jp/oai?verb=GetRecord&amp;amp;metadataPrefix=jpcoar&amp;amp;identifier=oai:weko3.example.org:00000035"/&gt;</p>
<p>&lt;description&gt;概要</p>
<p>概要</p>
<p>概要</p>
<p>概要&lt;/description&gt;</p>
<p>&lt;dc:date&gt;2023-11-14 23:48:47.276148+00:00&lt;/dc:date&gt;</p>
<p>&lt;dc:publisher xml:lang="en"&gt;Publisher&lt;/dc:publisher&gt;</p>
<p>&lt;dc:subject&gt;2-public-nooai-guest-35-ja&lt;/dc:subject&gt;</p>
<p>&lt;dc:type&gt;デフォルトアイテムタイプ（フル）&lt;/dc:type&gt;</p>
<p>&lt;dc:format&gt;text/plain&lt;/dc:format&gt;</p>
<p>&lt;dc:identifier&gt;35&lt;/dc:identifier&gt;</p>
<p>&lt;dc:identifier&gt;https://weko3.example.org/record/35/files/1KB.pdf&lt;/dc:identifier&gt;</p>
<p>&lt;prism:aggregationType&gt;conference paper&lt;/prism:aggregationType&gt;</p>
<p>&lt;prism:creationDate&gt;2023-11-06T05:44:59.220388+00:00&lt;/prism:creationDate&gt;</p>
<p>&lt;prism:modificationDate&gt;2023-11-06T05:45:01.746520+00:00&lt;/prism:modificationDate&gt;</p>
<p>&lt;prism:url&gt;https://dev.ir.rcos.nii.ac.jp/records/35&lt;/prism:url&gt;</p>
<p>&lt;/item&gt;</p>
<p>&lt;/rdf:RDF&gt;</p></td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr class="header">
<th>レスポンス例：format: jpcoar</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>/api/opensearch/search?title=nooai&amp;format=jpcoar&amp;size=1</strong></td>
</tr>
<tr class="even">
<td><p>This XML file does not appear to have any style information associated with it. The document tree is shown below.</p>
<p>&lt;rdf:RDF xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:opensearch="http://a9.com/-/spec/opensearch/1.1/" xmlns:prism="http://prismstandard.org/namespaces/basic/2.0/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;</p>
<p>&lt;header&gt;</p>
<p>&lt;opensearch:totalResults&gt;9&lt;/opensearch:totalResults&gt;</p>
<p>&lt;opensearch:startIndex&gt;1&lt;/opensearch:startIndex&gt;</p>
<p>&lt;opensearch:itemsPerPage&gt;1&lt;/opensearch:itemsPerPage&gt;</p>
<p>&lt;/header&gt;</p>
<p>&lt;items&gt;</p>
<p>&lt;rdf:Description rdf:about="https://dev.ir.rcos.nii.ac.jp/records/35"&gt;</p>
<p>&lt;jpcoar:jpcoar xmlns:datacite="https://schema.datacite.org/meta/kernel-4/" xmlns:dcndl="http://ndl.go.jp/dcndl/terms/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:jpcoar="https://github.com/JPCOAR/schema/blob/master/2.0/" xmlns:oaire="http://namespace.openaire.eu/schema/oaire/" xmlns:rioxxterms="http://www.rioxx.net/schema/v2.0/rioxxterms/" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="https://github.com/JPCOAR/schema/blob/master/2.0/" xsi:schemaLocation="https://github.com/JPCOAR/schema/blob/master/2.0/jpcoar_scm.xsd"&gt;</p>
<p>&lt;dc:title xml:lang="ja"&gt;public-item-2-public-nooai-guest-35-ja&lt;/dc:title&gt;</p>
<p>&lt;dc:title xml:lang="en"&gt;public-item-2-public-nooai-guest-35-en&lt;/dc:title&gt;</p>
<p>&lt;dcterms:alternative xml:lang="en"&gt;Alternative Title&lt;/dcterms:alternative&gt;</p>
<p>&lt;dcterms:alternative xml:lang="ja"&gt;Alternative Title&lt;/dcterms:alternative&gt;</p>
<p>&lt;jpcoar:creator&gt;</p>
<p>&lt;jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/" nameIdentifierScheme="ORCID"&gt;xxxxxxx&lt;/jpcoar:nameIdentifier&gt;</p>
<p>&lt;jpcoar:creatorName xml:lang="ja"&gt;情報, 太郎&lt;/jpcoar:creatorName&gt;</p>
<p>&lt;jpcoar:creatorName xml:lang="ja-Kana"&gt;ジョウホウ タロウ&lt;/jpcoar:creatorName&gt;</p>
<p>&lt;jpcoar:creatorName xml:lang="en"&gt;Joho Taro&lt;/jpcoar:creatorName&gt;</p>
<p>&lt;jpcoar:familyName xml:lang="ja"&gt;情報&lt;/jpcoar:familyName&gt;</p>
<p>&lt;jpcoar:familyName xml:lang="ja-Kana"&gt;ジョウホウ&lt;/jpcoar:familyName&gt;</p>
<p>&lt;jpcoar:familyName xml:lang="en"&gt;Joho&lt;/jpcoar:familyName&gt;</p>
<p>&lt;jpcoar:givenName xml:lang="ja"&gt;太郎&lt;/jpcoar:givenName&gt;</p>
<p>&lt;jpcoar:givenName xml:lang="ja-Kana"&gt;タロウ&lt;/jpcoar:givenName&gt;</p>
<p>&lt;jpcoar:givenName xml:lang="en"&gt;Taro&lt;/jpcoar:givenName&gt;</p>
<p>&lt;jpcoar:affiliation&gt;</p>
<p>&lt;jpcoar:nameIdentifier nameIdentifierURI="http://isni.org/isni/0000000121691048" nameIdentifierScheme="ISNI"&gt;0000000121691048&lt;/jpcoar:nameIdentifier&gt;</p>
<p>&lt;jpcoar:affiliationName xml:lang="en"&gt;University&lt;/jpcoar:affiliationName&gt;</p>
<p>&lt;/jpcoar:affiliation&gt;</p>
<p>&lt;/jpcoar:creator&gt;</p>
<p>&lt;jpcoar:creator&gt;</p>
<p>&lt;jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/" nameIdentifierScheme="ORCID"&gt;xxxxxxx&lt;/jpcoar:nameIdentifier&gt;</p>
<p>&lt;jpcoar:creatorName xml:lang="ja"&gt;情報, 太郎&lt;/jpcoar:creatorName&gt;</p>
<p>&lt;jpcoar:creatorName xml:lang="ja-Kana"&gt;ジョウホウ タロウ&lt;/jpcoar:creatorName&gt;</p>
<p>&lt;jpcoar:creatorName xml:lang="en"&gt;Joho Taro&lt;/jpcoar:creatorName&gt;</p>
<p>&lt;jpcoar:familyName xml:lang="ja"&gt;情報&lt;/jpcoar:familyName&gt;</p>
<p>&lt;jpcoar:familyName xml:lang="ja-Kana"&gt;ジョウホウ&lt;/jpcoar:familyName&gt;</p>
<p>&lt;jpcoar:familyName xml:lang="en"&gt;Joho&lt;/jpcoar:familyName&gt;</p>
<p>&lt;jpcoar:givenName xml:lang="ja"&gt;太郎&lt;/jpcoar:givenName&gt;</p>
<p>&lt;jpcoar:givenName xml:lang="ja-Kana"&gt;タロウ&lt;/jpcoar:givenName&gt;</p>
<p>&lt;jpcoar:givenName xml:lang="en"&gt;Taro&lt;/jpcoar:givenName&gt;</p>
<p>&lt;/jpcoar:creator&gt;</p>
<p>&lt;jpcoar:creator&gt;</p>
<p>&lt;jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/" nameIdentifierScheme="ORCID"&gt;xxxxxxx&lt;/jpcoar:nameIdentifier&gt;</p>
<p>&lt;jpcoar:creatorName xml:lang="ja"&gt;情報, 太郎&lt;/jpcoar:creatorName&gt;</p>
<p>&lt;jpcoar:creatorName xml:lang="ja-Kana"&gt;ジョウホウ タロウ&lt;/jpcoar:creatorName&gt;</p>
<p>&lt;jpcoar:creatorName xml:lang="en"&gt;Joho Taro&lt;/jpcoar:creatorName&gt;</p>
<p>&lt;jpcoar:familyName xml:lang="ja"&gt;情報&lt;/jpcoar:familyName&gt;</p>
<p>&lt;jpcoar:familyName xml:lang="ja-Kana"&gt;ジョウホウ&lt;/jpcoar:familyName&gt;</p>
<p>&lt;jpcoar:familyName xml:lang="en"&gt;Joho&lt;/jpcoar:familyName&gt;</p>
<p>&lt;jpcoar:givenName xml:lang="ja"&gt;太郎&lt;/jpcoar:givenName&gt;</p>
<p>&lt;jpcoar:givenName xml:lang="ja-Kana"&gt;タロウ&lt;/jpcoar:givenName&gt;</p>
<p>&lt;jpcoar:givenName xml:lang="en"&gt;Taro&lt;/jpcoar:givenName&gt;</p>
<p>&lt;/jpcoar:creator&gt;</p>
<p>&lt;jpcoar:contributor contributorType="ContactPerson"&gt;</p>
<p>&lt;jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/" nameIdentifierScheme="ORCID"&gt;xxxxxxx&lt;/jpcoar:nameIdentifier&gt;</p>
<p>&lt;jpcoar:contributorName xml:lang="ja"&gt;情報, 太郎&lt;/jpcoar:contributorName&gt;</p>
<p>&lt;jpcoar:contributorName xml:lang="ja-Kana"&gt;ジョウホウ タロウ&lt;/jpcoar:contributorName&gt;</p>
<p>&lt;jpcoar:contributorName xml:lang="en"&gt;Joho Taro&lt;/jpcoar:contributorName&gt;</p>
<p>&lt;jpcoar:familyName xml:lang="ja"&gt;情報&lt;/jpcoar:familyName&gt;</p>
<p>&lt;jpcoar:familyName xml:lang="ja-Kana"&gt;ジョウホウ&lt;/jpcoar:familyName&gt;</p>
<p>&lt;jpcoar:familyName xml:lang="en"&gt;Joho&lt;/jpcoar:familyName&gt;</p>
<p>&lt;jpcoar:givenName xml:lang="ja"&gt;太郎&lt;/jpcoar:givenName&gt;</p>
<p>&lt;jpcoar:givenName xml:lang="ja-Kana"&gt;タロウ&lt;/jpcoar:givenName&gt;</p>
<p>&lt;jpcoar:givenName xml:lang="en"&gt;Taro&lt;/jpcoar:givenName&gt;</p>
<p>&lt;/jpcoar:contributor&gt;</p>
<p>&lt;dcterms:accessRights rdf:resource="http://purl.org/coar/access_right/c_abf2"&gt;open access&lt;/dcterms:accessRights&gt;</p>
<p>&lt;dc:rights xml:lang="ja" rdf:resource="http://localhost"&gt;Rights Information&lt;/dc:rights&gt;</p>
<p>&lt;jpcoar:rightsHolder&gt;</p>
<p>&lt;jpcoar:nameIdentifier nameIdentifierURI="https://orcid.org/" nameIdentifierScheme="ORCID"&gt;xxxxxx&lt;/jpcoar:nameIdentifier&gt;</p>
<p>&lt;jpcoar:rightsHolderName xml:lang="ja"&gt;Right Holder Name&lt;/jpcoar:rightsHolderName&gt;</p>
<p>&lt;/jpcoar:rightsHolder&gt;</p>
<p>&lt;jpcoar:subject xml:lang="ja" subjectURI="http://localhost/" subjectScheme="Other"&gt;Sibject1&lt;/jpcoar:subject&gt;</p>
<p>&lt;datacite:description xml:lang="en" descriptionType="Abstract"&gt;Description Description Description&lt;/datacite:description&gt;</p>
<p>&lt;datacite:description xml:lang="ja" descriptionType="Abstract"&gt;概要 概要 概要 概要&lt;/datacite:description&gt;</p>
<p>&lt;dc:publisher xml:lang="en"&gt;Publisher&lt;/dc:publisher&gt;</p>
<p>&lt;datacite:date dateType="Available"&gt;2021-06-30&lt;/datacite:date&gt;</p>
<p>&lt;dc:language&gt;jpn&lt;/dc:language&gt;</p>
<p>&lt;dc:type rdf:resource="http://purl.org/coar/resource_type/c_5794"&gt;conference paper&lt;/dc:type&gt;</p>
<p>&lt;datacite:version&gt;Version&lt;/datacite:version&gt;</p>
<p>&lt;oaire:version rdf:resource="http://purl.org/coar/version/c_b1a7d7d4d402bcce"&gt;AO&lt;/oaire:version&gt;</p>
<p>&lt;jpcoar:identifier identifierType="URI"&gt;http://localhost&lt;/jpcoar:identifier&gt;</p>
<p>&lt;jpcoar:relation relationType="isVersionOf"&gt;</p>
<p>&lt;jpcoar:relatedIdentifier identifierType="arXiv"&gt;xxxxx&lt;/jpcoar:relatedIdentifier&gt;</p>
<p>&lt;jpcoar:relatedTitle xml:lang="en"&gt;Related Title&lt;/jpcoar:relatedTitle&gt;</p>
<p>&lt;/jpcoar:relation&gt;</p>
<p>&lt;dcterms:temporal xml:lang="en"&gt;Temporal&lt;/dcterms:temporal&gt;</p>
<p>&lt;datacite:geoLocation&gt;</p>
<p>&lt;datacite:geoLocationPlace&gt;Japan&lt;/datacite:geoLocationPlace&gt;</p>
<p>&lt;/datacite:geoLocation&gt;</p>
<p>&lt;jpcoar:fundingReference&gt;</p>
<p>&lt;jpcoar:funderIdentifier funderIdentifierType="ISNI"&gt;http://xxx&lt;/jpcoar:funderIdentifier&gt;</p>
<p>&lt;jpcoar:funderName xml:lang="en"&gt;Funder Name&lt;/jpcoar:funderName&gt;</p>
<p>&lt;jpcoar:awardNumber awardURI="Award URI"&gt;Award Number&lt;/jpcoar:awardNumber&gt;</p>
<p>&lt;jpcoar:awardTitle xml:lang="en"&gt;Award Title&lt;/jpcoar:awardTitle&gt;</p>
<p>&lt;/jpcoar:fundingReference&gt;</p>
<p>&lt;jpcoar:sourceIdentifier identifierType="ISSN"&gt;xxxx-xxxx-xxxx&lt;/jpcoar:sourceIdentifier&gt;</p>
<p>&lt;jpcoar:sourceTitle xml:lang="en"&gt;Source Title&lt;/jpcoar:sourceTitle&gt;</p>
<p>&lt;jpcoar:volume&gt;1&lt;/jpcoar:volume&gt;</p>
<p>&lt;jpcoar:issue&gt;111&lt;/jpcoar:issue&gt;</p>
<p>&lt;jpcoar:numPages&gt;12&lt;/jpcoar:numPages&gt;</p>
<p>&lt;jpcoar:pageStart&gt;1&lt;/jpcoar:pageStart&gt;</p>
<p>&lt;jpcoar:pageEnd&gt;3&lt;/jpcoar:pageEnd&gt;</p>
<p>&lt;dcndl:degreeName xml:lang="en"&gt;Degree Name&lt;/dcndl:degreeName&gt;</p>
<p>&lt;dcndl:dateGranted&gt;2021-06-30&lt;/dcndl:dateGranted&gt;</p>
<p>&lt;jpcoar:degreeGrantor&gt;</p>
<p>&lt;jpcoar:nameIdentifier nameIdentifierScheme="kakenhi"&gt;xxxxxx&lt;/jpcoar:nameIdentifier&gt;</p>
<p>&lt;jpcoar:degreeGrantorName xml:lang="en"&gt;Degree Grantor Name&lt;/jpcoar:degreeGrantorName&gt;</p>
<p>&lt;/jpcoar:degreeGrantor&gt;</p>
<p>&lt;jpcoar:conference&gt;</p>
<p>&lt;jpcoar:conferenceName xml:lang="ja"&gt;Conference Name&lt;/jpcoar:conferenceName&gt;</p>
<p>&lt;jpcoar:conferenceSequence&gt;1&lt;/jpcoar:conferenceSequence&gt;</p>
<p>&lt;jpcoar:conferenceSponsor xml:lang="ja"&gt;Sponsor&lt;/jpcoar:conferenceSponsor&gt;</p>
<p>&lt;jpcoar:conferenceDate endDay="1" endYear="2020" endMonth="12" startDay="1" xml:lang="ja" startYear="2000" startMonth="12"&gt;2020/12/11&lt;/jpcoar:conferenceDate&gt;</p>
<p>&lt;jpcoar:conferenceVenue xml:lang="ja"&gt;Conference Venue&lt;/jpcoar:conferenceVenue&gt;</p>
<p>&lt;jpcoar:conferenceCountry&gt;JPN&lt;/jpcoar:conferenceCountry&gt;</p>
<p>&lt;/jpcoar:conference&gt;</p>
<p>&lt;jpcoar:file&gt;</p>
<p>&lt;jpcoar:URI&gt;https://weko3.example.org/record/35/files/1KB.pdf&lt;/jpcoar:URI&gt;</p>
<p>&lt;jpcoar:mimeType&gt;text/plain&lt;/jpcoar:mimeType&gt;</p>
<p>&lt;jpcoar:extent&gt;1 KB&lt;/jpcoar:extent&gt;</p>
<p>&lt;/jpcoar:file&gt;</p>
<p>&lt;system_file/&gt;</p>
<p>&lt;/jpcoar:jpcoar&gt;</p>
<p>&lt;/rdf:Description&gt;</p>
<p>&lt;/items&gt;</p>
<p>&lt;/rdf:RDF&gt;</p></td>
</tr>
</tbody>
</table>

  - 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
</tr>
</tbody>
</table>

  - 機能内容

**Opensearch API記述（opensearch/description.xml)　2022/10/28 opensearch api の description.xml は修正の必要性がある。**

  - /api/opensearch/description.xml

> 例：
> 
> **\<OpenSearchDescription** xmlns="http://a9.com/-/spec/opensearch/1.1/"**\>**
> 
> **\<ShortName\>**WEKO**\</ShortName\>**
> 
> **\<Description\>**WEKO - NII Scholarly and Academic Information Navigator**\</Description\>**
> 
> **\<Image** height="16" type="image/x-icon" width="16"**\>**https://localhost:8443/static/favicon.ico**\</Image\>**
> 
> **\<Url** template="https://localhost:8443/api/opensearch/search?q={searchTerms}" type="application/atom+xml"**/\>**
> 
> **\<Url** template="https://localhost:8443/api/opensearch/search?q={searchTerms}**\&amp;**format=atom" type="application/atom+xml"**/\>**
> 
> **\</OpenSearchDescription\>**

**/api/opensearch/search**

クエリパラメータ

  - 利用できるクエリパラメータは以下を参照
    
      - パス：https://github.com/RCOSDP/weko/blob/adbdfd55ce1d9a289e1dd0af8e4383663f6eddaf/modules/weko-search-ui/weko\_search\_ui/config.py\#L245
    
      - 設定キー：WEKO\_SEARCH\_KEYWORDS\_DICT

レスポンス

**format:rss**

> \<?xml version='1.0' encoding='UTF-8'?\>
> 
> \<rdf:RDF xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:opensearch="http://a9.com/-/spec/opensearch/1.1/" xmlns:prism="http://prismstandard.org/namespaces/basic/2.0/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns\#" xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema\#" xmlns="http://purl.org/rss/1.0/" xml:lang="en"\>
> 
> \<channel rdf:about="https://weko3.ir.rcos.nii.ac.jp/api/opensearch/search?format=rss\&amp;title=アブ\&amp;list\_view\_num=1"\>
> 
> \<title\>WEKO OpenSearch: \</title\>
> 
> \<link\>https://weko3.ir.rcos.nii.ac.jp/api/opensearch/search?format=rss\&amp;title=アブ\&amp;list\_view\_num=1\</link\>
> 
> \<docs\>http://www.rssboard.org/rss-specification\</docs\>
> 
> \<generator\>python-feedgen\</generator\>
> 
> \<language\>en\</language\>
> 
> \<items\>
> 
> \<rdf:Seq\>
> 
> \<rdf:li rdf:resource="https://weko3.ir.rcos.nii.ac.jp/records/88854"/\>
> 
> \</rdf:Seq\>
> 
> \</items\>
> 
> \<lastBuildDate\>Fri, 28 Oct 2022 05:22:20 +0000\</lastBuildDate\>
> 
> \<dc:date\>2022-10-28 05:22:20.844292+00:00\</dc:date\>
> 
> \<opensearch:totalResults\>8\</opensearch:totalResults\>
> 
> \<opensearch:startIndex\>1\</opensearch:startIndex\>
> 
> \<opensearch:itemsPerPage\>1\</opensearch:itemsPerPage\>
> 
> \</channel\>
> 
> \<item rdf:about="https://weko3.ir.rcos.nii.ac.jp/records/88854"\>
> 
> \<title\>宮古島のピンザアブ洞の後期更新世堆積物より発見されたヘビ類化石の分類学的帰属とその歴史生物地理学的意義\</title\>
> 
> \<link\>https://weko3.ir.rcos.nii.ac.jp/records/88854\</link\>
> 
> \<rdfs:seeAlso rdf:resource="https://weko3.ir.rcos.nii.ac.jp/oai?verb=GetRecord\&amp;metadataPrefix=jpcoar\&amp;identifier=oai:weko3.ir.rcos.nii.ac.jp:00088854"/\>
> 
> \<dc:date\>2022-10-28 05:22:20.856008+00:00\</dc:date\>
> 
> \<dc:publisher xml:lang="ja"\>琉球大学21世紀プログラム\</dc:publisher\>
> 
> \<dc:subject\>ja\_Index B-5-1\</dc:subject\>
> 
> \<dc:type\>Multiple\</dc:type\>
> 
> \<dc:identifier\>88854\</dc:identifier\>
> 
> \<dc:identifier\>https://u-ryukyu.repo.nii.ac.jp/record/2001096/files/2006PS-22.pdf\</dc:identifier\>
> 
> \<prism:aggregationType\>research report\</prism:aggregationType\>
> 
> \<prism:publicationName\>琉球大学21世紀プログラム「サンゴ礁島嶼系の生物多様性の総合解析」平成18年度成果発表会\</prism:publicationName\>
> 
> \<prism:creationDate\>2022-03-22T05:56:28.569325+00:00\</prism:creationDate\>
> 
> \<prism:modificationDate\>2022-03-22T05:56:29.259651+00:00\</prism:modificationDate\>
> 
> \<prism:url\>https://weko3.ir.rcos.nii.ac.jp/records/88854\</prism:url\>
> 
> \</item\>
> 
> \</rdf:RDF\>

**format:atom**

> \<?xml version='1.0' encoding='UTF-8'?\>
> 
> \<feed xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:opensearch="http://a9.com/-/spec/opensearch/1.1/" xmlns:prism="http://prismstandard.org/namespaces/basic/2.0/" xmlns="http://www.w3.org/2005/Atom" xml:lang="en"\>
> 
> \<id\>https://weko3.ir.rcos.nii.ac.jp/api/opensearch/search?format=atom\&amp;title=アブ\&amp;list\_view\_num=1\</id\>
> 
> \<title\>WEKO OpenSearch: \</title\>
> 
> \<updated\>2022-10-28T05:15:02.121033+00:00\</updated\>
> 
> \<link href="https://weko3.ir.rcos.nii.ac.jp/api/opensearch/search?format=atom\&amp;title=アブ\&amp;list\_view\_num=1"/\>
> 
> \<generator uri="http://lkiesow.github.io/python-feedgen" version="0.7.0"\>python-feedgen\</generator\>
> 
> \<opensearch:totalResults\>8\</opensearch:totalResults\>
> 
> \<opensearch:startIndex\>1\</opensearch:startIndex\>
> 
> \<opensearch:itemsPerPage\>1\</opensearch:itemsPerPage\>
> 
> \<entry\>
> 
> \<id\>https://weko3.ir.rcos.nii.ac.jp/oai?verb=GetRecord\&amp;metadataPrefix=jpcoar\&amp;identifier=oai:weko3.ir.rcos.nii.ac.jp:00088854\</id\>
> 
> \<title\>宮古島のピンザアブ洞の後期更新世堆積物より発見されたヘビ類化石の分類学的帰属とその歴史生物地理学的意義\</title\>
> 
> \<updated\>2022-03-22T05:56:29.259651+00:00\</updated\>
> 
> \<link href="https://weko3.ir.rcos.nii.ac.jp/records/88854"/\>
> 
> \<link href="https://weko3.ir.rcos.nii.ac.jp/oai?verb=GetRecord\&amp;metadataPrefix=jpcoar\&amp;identifier=oai:weko3.ir.rcos.nii.ac.jp:00088854"/\>
> 
> \<dc:publisher xml:lang="ja"\>琉球大学21世紀プログラム\</dc:publisher\>
> 
> \<dc:subject\>ja\_Index B-5-1\</dc:subject\>
> 
> \<dc:type\>Multiple\</dc:type\>
> 
> \<dc:identifier\>88854\</dc:identifier\>
> 
> \<dc:identifier\>https://u-ryukyu.repo.nii.ac.jp/record/2001096/files/2006PS-22.pdf\</dc:identifier\>
> 
> \<prism:aggregationType\>research report\</prism:aggregationType\>
> 
> \<prism:publicationName\>琉球大学21世紀プログラム「サンゴ礁島嶼系の生物多様性の総合解析」平成18年度成果発表会\</prism:publicationName\>
> 
> \<prism:creationDate\>2022-03-22T05:56:28.569325+00:00\</prism:creationDate\>
> 
> \<prism:modificationDate\>2022-03-22T05:56:29.259651+00:00\</prism:modificationDate\>
> 
> \</entry\>
> 
> \</feed\>

  - 
設定

> \# Opensearch description
> 
> WEKO\_OPENSEARCH\_SYSTEM\_SHORTNAME = 'WEKO'
> 
> WEKO\_OPENSEARCH\_SYSTEM\_DESCRIPTION = 'WEKO - NII Scholarly and Academic Information Navigator'
> 
> WEKO\_OPENSEARCH\_IMAGE\_URL = 'static/favicon.ico'

  - > 関連モジュール

<!-- end list -->

  - invenio\_records\_rest：検索を行いその結果を返すモジュール

  - weko\_records：返却値を作成するモジュール

  - weko\_search\_ui：OpenSearch Descriptionファイルを定義するモジュール

<!-- end list -->

  - > 処理概要

<!-- end list -->

  - パラメータの追加
    
      - modules/invenio-records-rest/invenio\_records\_rest/views.py

  - format変換：
    
      - modules/invenio-records-rest/invenio\_records\_rest/serializers/json.py
    
      - weko\_search\_ui/views.py
        
          - <https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-search-ui/weko_search_ui/views.py#L310>

<!-- end list -->

  - weko\_search\_ui.views. opensearch\_description関数でOpenSearch Descriptionファイルを作成している
    
      - > invenio\_records\_rest.views.RecordsListResource.getメソッドで検索を行う
    
    <!-- end list -->
    
      - 検索自体は、ユーザ画面の詳細検索と同様にElasticSearchで行う
    
      - RecordsListResourceクラスはWEKOのソースにforkされていないinvenio\_rest.views. ContentNegotiatedMethodViewクラスのサブクラスであり、スーパークラスのmake\_responseメソッドを使用してgetメソッドの返却値を作成する
    
      - make\_responseメソッドの中でシリアライザを呼び出す。これによってweko\_records.serializers.opensearchresponse.opensearch\_responsify関数が呼び出される
    
      - その中で呼び出すOpenSearchSerializer.serialize\_searchメソッドの中でformatを確認して、内容によって異なるレスポンス作成処理を呼び出す
        
          - formatの指定が「rss」「atom」「jpcoar」「それ以外」で分岐する
        
          - 「rss」「atom」の場合は、weko\_records.serializers.utils. OpenSearchDetailDataクラスのインスタンスをoutput\_type=（指定したformatを表す値）として作成して、output\_open\_search\_detail\_dataメソッドによってレスポンスを作成する
        
          - 「それ以外」の場合は、json形式のレスポンスを作成する

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
<tr class="even">
<td><blockquote>
<p>2023/11/14</p>
</blockquote></td>
<td>V0.9.27</td>
<td></td>
</tr>
</tbody>
</table>

##   

### Workflow API

  - 目的・用途

GakuNinRDMと連携してアイテムを登録する際に使用するAPIである

  - 利用方法

scopeに「user:activity」をもつアクセストークンを使用してAPIを呼び出す

<table>
<thead>
<tr class="header">
<th><strong>Method</strong></th>
<th><strong>HTTP request</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ActivityActionResource.post</td>
<td><p>POST</p>
<p>/api/depositactivity</p></td>
<td>ワークフローを作成する</td>
</tr>
<tr class="even">
<td>ActivityActionResource.get</td>
<td><p>GET</p>
<p>/api/depositactivity/&lt;string:activity_id&gt;</p></td>
<td>アクティビティの状態を取得する</td>
</tr>
<tr class="odd">
<td>ActivityActionResource.delete</td>
<td><p>DELETE</p>
<p>/api/depositactivity/&lt;string:activity_id&gt;</p></td>
<td>アクティビティを中断する</td>
</tr>
</tbody>
</table>

curlによるGETのリクエスト例

|                                                                                     |
| ----------------------------------------------------------------------------------- |
| curl <https://ホスト/api/depositactivity/>アクティビティID -H "Authorization:Bearer アクセストークン" |

  - 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td></td>
</tr>
</tbody>
</table>

  - 機能内容

<!-- end list -->

  - 使用方法については、[その他-10: GakuNinRDM連携](#gakuninrdm連携)を参照

<!-- end list -->

  - 関連モジュール

<!-- end list -->

  - weko\_workflow

<!-- end list -->

  - 処理概要

<!-- end list -->

  - Scope:
    
      - /weko-workflow/weko\_workflow/scopes.py

  - API:
    
      - /weko-workflow/weko\_workflow/views.py

  - ActivityActionResourceクラスのメソッドで処理を行う

  - POSTの場合、フォームからの送信としてリクエストに以下の情報を含める必要がある
    
      - アイテムタイプID
    
      - ファイル

  - POST、GETの場合は、返却値はactivity\_informationメソッドで作成する

  - POSTでは、以下の場合にInvalidInputRESTErrorが発生する
    
      - アイテムタイプIDまたはファイルがリクエストに含まれない場合
    
      - ファイルの形式が不正だった場合
    
      - ファイルの内容が不正だった場合
    
      - アクティビティを作成または取得できなかった場合

  - GETでは、以下の場合にActivityBaseRESTErrorが発生する
    
      - ActivityBaseRESTError：
        
          - > アクティビティIDが指定されていない場合
    
      - ActivityNotFoundRESTError：
        
          - > 指定のアクティビティIDでアクティビティを取得できなかった場合

  - DELETEでは、以下の場合にエラーが発生する
    
      - ActivityBaseRESTError：
        
          - > アクティビティIDが指定されていない場合
    
      - RegisteredActivityNotFoundRESTError：
        
          - > 指定のアクティビティIDでアクティビティを取得できなかった場合
    
      - DeleteActivityFailedRESTError：
        
          - > 取得したアクティビティのactibity\_statusがdoingでない場合
        
          - > 強制終了に失敗した場合

  - エラー発生時にはloging\_errorメソッドを呼び出して、ログレベルをINFOとしてログを出力する

<!-- end list -->

  - 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

##   


### アイテム検索用API

  - 目的・用途

アイテム検索機能を提供する。

  - 利用方法

| **Method** | **HTTP request**     | **Description** |
| ---------- | -------------------- | --------------- |
|            | **GET /api/records** | アイテムを検索する       |

クエリパラメータ

<table>
<thead>
<tr class="header">
<th><strong>GET /api/opensearch/search</strong></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>パラメータ</td>
<td>必須</td>
<td>値</td>
<td>説明</td>
</tr>
<tr class="even">
<td>search_type</td>
<td></td>
<td><ul>
<li><p>0:フルテキスト</p></li>
<li><p>1:キーワード</p></li>
</ul></td>
<td><p>フルテキストを指定した場合は本文ファイルから抽出されたテキストも検索対象とする。</p>
<p>キーワードを指定した場合はメタデータ項目のみを検索対象とする。</p></td>
</tr>
<tr class="odd">
<td>q</td>
<td></td>
<td>string</td>
<td>検索キーワードを指定する。</td>
</tr>
<tr class="even">
<td>size</td>
<td></td>
<td>int</td>
<td>検索結果の件数を指定する</td>
</tr>
<tr class="odd">
<td>page</td>
<td></td>
<td>Int</td>
<td>検索結果で表示するページ番号を指定する。</td>
</tr>
<tr class="even">
<td>Sort</td>
<td></td>
<td><ul>
<li><p>+controlnumber</p></li>
<li><p>-controlnumber</p></li>
<li><p>+wtl</p></li>
<li><p>+wtl</p></li>
<li><p>+itemType</p></li>
<li><p>-itemType</p></li>
</ul>
<p>他</p></td>
<td>ソートキーを指定する。接頭辞「+」は昇順、「-」は降順となる。</td>
</tr>
<tr class="odd">
<td>以下は設定ファイルやアイテムタイプマッピングにより定義が変化する</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>title</td>
<td></td>
<td>string</td>
<td>dc:titleにマッピングされた項目の検索</td>
</tr>
<tr class="odd">
<td>des</td>
<td></td>
<td>strin</td>
<td>datacite:descriptionにマッピングされた項目の検索</td>
</tr>
<tr class="even">
<td>type</td>
<td></td>
<td>string</td>
<td>dc:typeにマッピングされた項目の検索</td>
</tr>
<tr class="odd">
<td>wid</td>
<td></td>
<td>Int</td>
<td>アイテムIDを指定して検索</td>
</tr>
<tr class="even">
<td>Iid</td>
<td></td>
<td>Int</td>
<td>インデックスIDを指定して検索</td>
</tr>
<tr class="odd">
<td><p>date_range1_from</p>
<p>date_range1_to</p></td>
<td></td>
<td>yyymmdd</td>
<td>dte_range1 に対して期間の範囲を指定して検索</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

レスポンス例：

<table>
<thead>
<tr class="header">
<th><strong>レスポンス例</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>/api/records/?page=1&amp;size=1&amp;sort=controlnumber&amp;search_type=0&amp;q=%E6%A6%82%E8%A6%81</strong></td>
</tr>
<tr class="even">
<td><p>{</p>
<p>"aggregations": {</p>
<p>"Access": {</p>
<p>"buckets": [</p>
<p>{</p>
<p>"doc_count": 1761,</p>
<p>"key": "open access"</p>
<p>}</p>
<p>],</p>
<p>"doc_count_error_upper_bound": 0,</p>
<p>"sum_other_doc_count": 0</p>
<p>},</p>
<p>"Data Language": {</p>
<p>"buckets": [</p>
<p>{</p>
<p>"doc_count": 1761,</p>
<p>"key": "jpn"</p>
<p>}</p>
<p>],</p>
<p>"doc_count_error_upper_bound": 0,</p>
<p>"sum_other_doc_count": 0</p>
<p>},</p>
<p>"Data Type": {</p>
<p>"Data Type": {</p>
<p>"buckets": [],</p>
<p>"doc_count_error_upper_bound": 0,</p>
<p>"sum_other_doc_count": 0</p>
<p>},</p>
<p>"doc_count": 0</p>
<p>},</p>
<p>"Distributor": {</p>
<p>"Distributor": {</p>
<p>"buckets": [],</p>
<p>"doc_count_error_upper_bound": 0,</p>
<p>"sum_other_doc_count": 0</p>
<p>},</p>
<p>"doc_count": 0</p>
<p>},</p>
<p>"Location": {</p>
<p>"buckets": [</p>
<p>{</p>
<p>"doc_count": 1761,</p>
<p>"key": "Japan"</p>
<p>}</p>
<p>],</p>
<p>"doc_count_error_upper_bound": 0,</p>
<p>"sum_other_doc_count": 0</p>
<p>},</p>
<p>"Temporal": {</p>
<p>"buckets": [</p>
<p>{</p>
<p>"doc_count": 1761,</p>
<p>"key": "Temporal"</p>
<p>}</p>
<p>],</p>
<p>"doc_count_error_upper_bound": 0,</p>
<p>"sum_other_doc_count": 0</p>
<p>},</p>
<p>"Topic": {</p>
<p>"buckets": [</p>
<p>{</p>
<p>"doc_count": 1761,</p>
<p>"key": "Sibject1"</p>
<p>}</p>
<p>],</p>
<p>"doc_count_error_upper_bound": 0,</p>
<p>"sum_other_doc_count": 0</p>
<p>},</p>
<p>"path": {</p>
<p>"buckets": [],</p>
<p>"doc_count_error_upper_bound": "0",</p>
<p>"sum_order_doc_count": "0"</p>
<p>}</p>
<p>},</p>
<p>"hits": {</p>
<p>"hits": [</p>
<p>{</p>
<p>"created": "2023-11-06T05:43:58.044449+00:00",</p>
<p>"id": 1,</p>
<p>"links": {</p>
<p>"self": "https://dev.ir.rcos.nii.ac.jp/api/records/1"</p>
<p>},</p>
<p>"metadata": {</p>
<p>"_comment": [</p>
<p>"public-item-0-public-oai-guest-1-en",</p>
<p>"Source Title,1,111,12,1,3,en,2021-06-30",</p>
<p>"Conference Name",</p>
<p>"1",</p>
<p>"JPN",</p>
<p>"Sponsor",</p>
<p>"Conference Venue",</p>
<p>"Conference Place"</p>
<p>],</p>
<p>"_creator_info": [</p>
<p>{</p>
<p>"creatorAffiliations": [</p>
<p>{</p>
<p>"affiliationNameIdentifiers": [</p>
<p>{</p>
<p>"affiliationNameIdentifier": "0000000121691048",</p>
<p>"affiliationNameIdentifierScheme": "ISNI",</p>
<p>"affiliationNameIdentifierURI": "http://isni.org/isni/0000000121691048"</p>
<p>}</p>
<p>],</p>
<p>"affiliationNames": [</p>
<p>{</p>
<p>"affiliationName": "University",</p>
<p>"affiliationNameLang": "en"</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>],</p>
<p>"creatorMails": [</p>
<p>{</p>
<p>"creatorMail": "wekosoftware@nii.ac.jp"</p>
<p>}</p>
<p>],</p>
<p>"creatorNames": {</p>
<p>"creatorName": "Joho\t Taro",</p>
<p>"creatorNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"familyNames": {</p>
<p>"familyName": "Joho",</p>
<p>"familyNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"givenNames": {</p>
<p>"givenName": "Taro",</p>
<p>"givenNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"nameIdentifiers": [</p>
<p>{</p>
<p>"nameIdentifier": "4",</p>
<p>"nameIdentifierScheme": "WEKO"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "ORCID",</p>
<p>"nameIdentifierURI": "https://orcid.org/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "CiNii",</p>
<p>"nameIdentifierURI": "https://ci.nii.ac.jp/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "zzzzzzz",</p>
<p>"nameIdentifierScheme": "KAKEN2",</p>
<p>"nameIdentifierURI": "https://kaken.nii.ac.jp/"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>{</p>
<p>"creatorMails": [</p>
<p>{</p>
<p>"creatorMail": "wekosoftware@nii.ac.jp"</p>
<p>}</p>
<p>],</p>
<p>"creatorNames": {</p>
<p>"creatorName": "Joho\t Taro",</p>
<p>"creatorNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"familyNames": {</p>
<p>"familyName": "Joho",</p>
<p>"familyNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"givenNames": {</p>
<p>"givenName": "Taro",</p>
<p>"givenNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"nameIdentifiers": [</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "ORCID",</p>
<p>"nameIdentifierURI": "https://orcid.org/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "CiNii",</p>
<p>"nameIdentifierURI": "https://ci.nii.ac.jp/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "zzzzzzz",</p>
<p>"nameIdentifierScheme": "KAKEN2",</p>
<p>"nameIdentifierURI": "https://kaken.nii.ac.jp/"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>{</p>
<p>"creatorMails": [</p>
<p>{</p>
<p>"creatorMail": "wekosoftware@nii.ac.jp"</p>
<p>}</p>
<p>],</p>
<p>"creatorNames": {</p>
<p>"creatorName": "Joho\t Taro",</p>
<p>"creatorNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"familyNames": {</p>
<p>"familyName": "Joho",</p>
<p>"familyNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"givenNames": {</p>
<p>"givenName": "Taro",</p>
<p>"givenNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"nameIdentifiers": [</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "ORCID",</p>
<p>"nameIdentifierURI": "https://orcid.org/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "CiNii",</p>
<p>"nameIdentifierURI": "https://ci.nii.ac.jp/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "zzzzzzz",</p>
<p>"nameIdentifierScheme": "KAKEN2",</p>
<p>"nameIdentifierURI": "https://kaken.nii.ac.jp/"</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>],</p>
<p>"_files_info": [</p>
<p>{</p>
<p>"extention": "pdf",</p>
<p>"label": "1KB.pdf",</p>
<p>"url": "https://weko3.example.org/record/1/files/1KB.pdf"</p>
<p>}</p>
<p>],</p>
<p>"_item_metadata": {</p>
<p>"author_link": [</p>
<p>"4"</p>
<p>],</p>
<p>"control_number": "1",</p>
<p>"item_1617186331708": {</p>
<p>"attribute_name": "Title",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_title": "public-item-0-public-oai-guest-1-ja",</p>
<p>"subitem_title_language": "ja"</p>
<p>},</p>
<p>{</p>
<p>"subitem_title": "public-item-0-public-oai-guest-1-en",</p>
<p>"subitem_title_language": "en"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186385884": {</p>
<p>"attribute_name": "Alternative Title",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_alternative_title": "Alternative Title",</p>
<p>"subitem_alternative_title_language": "en"</p>
<p>},</p>
<p>{</p>
<p>"subitem_alternative_title": "Alternative Title",</p>
<p>"subitem_alternative_title_language": "ja"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186419668": {</p>
<p>"attribute_name": "Creator",</p>
<p>"attribute_type": "creator",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"creatorAffiliations": [</p>
<p>{</p>
<p>"affiliationNameIdentifiers": [</p>
<p>{</p>
<p>"affiliationNameIdentifier": "0000000121691048",</p>
<p>"affiliationNameIdentifierScheme": "ISNI",</p>
<p>"affiliationNameIdentifierURI": "http://isni.org/isni/0000000121691048"</p>
<p>}</p>
<p>],</p>
<p>"affiliationNames": [</p>
<p>{</p>
<p>"affiliationName": "University",</p>
<p>"affiliationNameLang": "en"</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>],</p>
<p>"creatorMails": [</p>
<p>{</p>
<p>"creatorMail": "wekosoftware@nii.ac.jp"</p>
<p>}</p>
<p>],</p>
<p>"creatorNames": {</p>
<p>"creatorName": "Joho\t Taro",</p>
<p>"creatorNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"familyNames": {</p>
<p>"familyName": "Joho",</p>
<p>"familyNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"givenNames": {</p>
<p>"givenName": "Taro",</p>
<p>"givenNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"nameIdentifiers": [</p>
<p>{</p>
<p>"nameIdentifier": "4",</p>
<p>"nameIdentifierScheme": "WEKO"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "ORCID",</p>
<p>"nameIdentifierURI": "https://orcid.org/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "CiNii",</p>
<p>"nameIdentifierURI": "https://ci.nii.ac.jp/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "zzzzzzz",</p>
<p>"nameIdentifierScheme": "KAKEN2",</p>
<p>"nameIdentifierURI": "https://kaken.nii.ac.jp/"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>{</p>
<p>"creatorMails": [</p>
<p>{</p>
<p>"creatorMail": "wekosoftware@nii.ac.jp"</p>
<p>}</p>
<p>],</p>
<p>"creatorNames": {</p>
<p>"creatorName": "Joho\t Taro",</p>
<p>"creatorNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"familyNames": {</p>
<p>"familyName": "Joho",</p>
<p>"familyNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"givenNames": {</p>
<p>"givenName": "Taro",</p>
<p>"givenNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"nameIdentifiers": [</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "ORCID",</p>
<p>"nameIdentifierURI": "https://orcid.org/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "CiNii",</p>
<p>"nameIdentifierURI": "https://ci.nii.ac.jp/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "zzzzzzz",</p>
<p>"nameIdentifierScheme": "KAKEN2",</p>
<p>"nameIdentifierURI": "https://kaken.nii.ac.jp/"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>{</p>
<p>"creatorMails": [</p>
<p>{</p>
<p>"creatorMail": "wekosoftware@nii.ac.jp"</p>
<p>}</p>
<p>],</p>
<p>"creatorNames": {</p>
<p>"creatorName": "Joho\t Taro",</p>
<p>"creatorNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"familyNames": {</p>
<p>"familyName": "Joho",</p>
<p>"familyNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"givenNames": {</p>
<p>"givenName": "Taro",</p>
<p>"givenNameLang": "en",</p>
<p>"idx": 2</p>
<p>},</p>
<p>"nameIdentifiers": [</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "ORCID",</p>
<p>"nameIdentifierURI": "https://orcid.org/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "CiNii",</p>
<p>"nameIdentifierURI": "https://ci.nii.ac.jp/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "zzzzzzz",</p>
<p>"nameIdentifierScheme": "KAKEN2",</p>
<p>"nameIdentifierURI": "https://kaken.nii.ac.jp/"</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186476635": {</p>
<p>"attribute_name": "Access Rights",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_access_right": "open access",</p>
<p>"subitem_access_right_uri": "http://purl.org/coar/access_right/c_abf2"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186499011": {</p>
<p>"attribute_name": "Rights",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_rights": "Rights Information",</p>
<p>"subitem_rights_language": "ja",</p>
<p>"subitem_rights_resource": "http://localhost"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186609386": {</p>
<p>"attribute_name": "Subject",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_subject": "Sibject1",</p>
<p>"subitem_subject_language": "ja",</p>
<p>"subitem_subject_scheme": "Other",</p>
<p>"subitem_subject_uri": "http://localhost/"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186626617": {</p>
<p>"attribute_name": "Description",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_description": "Description\nDescription\nDescription",</p>
<p>"subitem_description_language": "en",</p>
<p>"subitem_description_type": "Abstract"</p>
<p>},</p>
<p>{</p>
<p>"subitem_description": "概要\n概要\n概要\n概要",</p>
<p>"subitem_description_language": "ja",</p>
<p>"subitem_description_type": "Abstract"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186643794": {</p>
<p>"attribute_name": "Publisher",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_publisher": "en",</p>
<p>"subitem_publisher_languag": "Publisher"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186660861": {</p>
<p>"attribute_name": "Date",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_date_issued_datetime": "2021-06-30",</p>
<p>"subitem_date_issued_type": "Available"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186702042": {</p>
<p>"attribute_name": "Language",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_language": "jpn"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186783814": {</p>
<p>"attribute_name": "Identifier",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_identifier_type": "URI",</p>
<p>"subitem_identifier_uri": "http://localhost"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186859717": {</p>
<p>"attribute_name": "Temporal",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_temporal_languag": "en",</p>
<p>"subitem_temporal_text": "Temporal"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186882738": {</p>
<p>"attribute_name": "Geo Location",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_geolocation_place": [</p>
<p>{</p>
<p>"subitem_geolocation_place_text": "Japan"</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186901218": {</p>
<p>"attribute_name": "Funding Reference",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_award_numbers": {</p>
<p>"subitem_award_number": "Award Number",</p>
<p>"subitem_award_uri": "Award URI"</p>
<p>},</p>
<p>"subitem_award_titles": [</p>
<p>{</p>
<p>"subitem_award_title": "Award Title",</p>
<p>"subitem_award_title_language": "en"</p>
<p>}</p>
<p>],</p>
<p>"subitem_funder_identifiers": {</p>
<p>"subitem_funder_identifier": "http://xxx",</p>
<p>"subitem_funder_identifier_type": "ISNI"</p>
<p>},</p>
<p>"subitem_funder_names": [</p>
<p>{</p>
<p>"subitem_funder_name": "Funder Name",</p>
<p>"subitem_funder_name_language": "en"</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186920753": {</p>
<p>"attribute_name": "Source Identifier",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_source_identifier": "xxxx-xxxx-xxxx",</p>
<p>"subitem_source_identifier_type": "ISSN"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186941041": {</p>
<p>"attribute_name": "Source Title",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_record_name": "Source Title",</p>
<p>"subitem_record_name_languag": "en"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186959569": {</p>
<p>"attribute_name": "Volume Number",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_volume": "1"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186981471": {</p>
<p>"attribute_name": "Issue Number",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_issue": "111"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617186994930": {</p>
<p>"attribute_name": "Number of Pages",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_number_of_pages": "12"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617187024783": {</p>
<p>"attribute_name": "Page Start",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_start_page": "1"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617187045071": {</p>
<p>"attribute_name": "Page End",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_end_page": "3"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617187112279": {</p>
<p>"attribute_name": "Degree Name",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_degreename": "en",</p>
<p>"subitem_issue": "Degree Name"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617187136212": {</p>
<p>"attribute_name": "Date Granted",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_dategranted": "2021-06-30"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617187187528": {</p>
<p>"attribute_name": "Conference",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_conference_country": "JPN",</p>
<p>"subitem_conference_date": {</p>
<p>"subitem_conference_date_language": "ja",</p>
<p>"subitem_conference_end_day": "1",</p>
<p>"subitem_conference_end_month": "12",</p>
<p>"subitem_conference_end_year": "2020",</p>
<p>"subitem_conference_period": "2020/12/11",</p>
<p>"subitem_conference_start_day": "1",</p>
<p>"subitem_conference_start_month": "12",</p>
<p>"subitem_conference_start_year": "2000"</p>
<p>},</p>
<p>"subitem_conference_names": [</p>
<p>{</p>
<p>"subitem_conference_name": "Conference Name",</p>
<p>"subitem_conference_name_language": "ja"</p>
<p>}</p>
<p>],</p>
<p>"subitem_conference_places": [</p>
<p>{</p>
<p>"subitem_conference_place": "Conference Place",</p>
<p>"subitem_conference_place_language": "ja"</p>
<p>}</p>
<p>],</p>
<p>"subitem_conference_sequence": "1",</p>
<p>"subitem_conference_sponsors": [</p>
<p>{</p>
<p>"subitem_conference_sponsor": "Sponsor",</p>
<p>"subitem_conference_sponsor_language": "ja"</p>
<p>}</p>
<p>],</p>
<p>"subitem_conference_venues": [</p>
<p>{</p>
<p>"subitem_conference_venue": "Conference Venue",</p>
<p>"subitem_conference_venue_language": "ja"</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617258105262": {</p>
<p>"attribute_name": "Resource Type",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"resourcetype": "conference paper",</p>
<p>"resourceuri": "http://purl.org/coar/resource_type/c_5794"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617265215918": {</p>
<p>"attribute_name": "Version Type",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_version_resource": "http://purl.org/coar/version/c_b1a7d7d4d402bcce",</p>
<p>"subitem_version_type": "AO"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617349709064": {</p>
<p>"attribute_name": "Contributor",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"contributorMails": [</p>
<p>{</p>
<p>"contributorMail": "wekosoftware@nii.ac.jp"</p>
<p>}</p>
<p>],</p>
<p>"contributorNames": [</p>
<p>{</p>
<p>"contributorName": "情報, 太郎",</p>
<p>"lang": "ja"</p>
<p>},</p>
<p>{</p>
<p>"contributorName": "ジョウホウ\t タロウ",</p>
<p>"lang": "ja-Kana"</p>
<p>},</p>
<p>{</p>
<p>"contributorName": "Joho\t Taro",</p>
<p>"lang": "en"</p>
<p>}</p>
<p>],</p>
<p>"contributorType": "ContactPerson",</p>
<p>"familyNames": [</p>
<p>{</p>
<p>"familyName": "情報",</p>
<p>"familyNameLang": "ja"</p>
<p>},</p>
<p>{</p>
<p>"familyName": "ジョウホウ",</p>
<p>"familyNameLang": "ja-Kana"</p>
<p>},</p>
<p>{</p>
<p>"familyName": "Joho",</p>
<p>"familyNameLang": "en"</p>
<p>}</p>
<p>],</p>
<p>"givenNames": [</p>
<p>{</p>
<p>"givenName": "太郎",</p>
<p>"givenNameLang": "ja"</p>
<p>},</p>
<p>{</p>
<p>"givenName": "タロウ",</p>
<p>"givenNameLang": "ja-Kana"</p>
<p>},</p>
<p>{</p>
<p>"givenName": "Taro",</p>
<p>"givenNameLang": "en"</p>
<p>}</p>
<p>],</p>
<p>"nameIdentifiers": [</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "ORCID",</p>
<p>"nameIdentifierURI": "https://orcid.org/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "CiNii",</p>
<p>"nameIdentifierURI": "https://ci.nii.ac.jp/"</p>
<p>},</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxxx",</p>
<p>"nameIdentifierScheme": "KAKEN2",</p>
<p>"nameIdentifierURI": "https://kaken.nii.ac.jp/"</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617349808926": {</p>
<p>"attribute_name": "Version",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_version": "Version"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617351524846": {</p>
<p>"attribute_name": "APC",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_apc": "Unknown"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617353299429": {</p>
<p>"attribute_name": "Relation",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_relation_name": [</p>
<p>{</p>
<p>"subitem_relation_name_language": "en",</p>
<p>"subitem_relation_name_text": "Related Title"</p>
<p>}</p>
<p>],</p>
<p>"subitem_relation_type": "isVersionOf",</p>
<p>"subitem_relation_type_id": {</p>
<p>"subitem_relation_type_id_text": "xxxxx",</p>
<p>"subitem_relation_type_select": "arXiv"</p>
<p>}</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617605131499": {</p>
<p>"attribute_name": "File",</p>
<p>"attribute_type": "file",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"accessrole": "open_access",</p>
<p>"date": [</p>
<p>{</p>
<p>"dateType": "Available",</p>
<p>"dateValue": "2021-07-12"</p>
<p>}</p>
<p>],</p>
<p>"displaytype": "simple",</p>
<p>"filename": "1KB.pdf",</p>
<p>"filesize": [</p>
<p>{</p>
<p>"value": "1 KB"</p>
<p>}</p>
<p>],</p>
<p>"format": "text/plain",</p>
<p>"mimetype": "application/pdf",</p>
<p>"url": {</p>
<p>"url": "https://dev.ir.rcos.nii.ac.jp/record/1/files/1KB.pdf"</p>
<p>},</p>
<p>"version_id": "b1a73fe7-5325-4819-953b-722518118e3d"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617610673286": {</p>
<p>"attribute_name": "Rights Holder",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"nameIdentifiers": [</p>
<p>{</p>
<p>"nameIdentifier": "xxxxxx",</p>
<p>"nameIdentifierScheme": "ORCID",</p>
<p>"nameIdentifierURI": "https://orcid.org/"</p>
<p>}</p>
<p>],</p>
<p>"rightHolderNames": [</p>
<p>{</p>
<p>"rightHolderLanguage": "ja",</p>
<p>"rightHolderName": "Right Holder Name"</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617620223087": {</p>
<p>"attribute_name": "Heading",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_heading_banner_headline": "Banner Headline",</p>
<p>"subitem_heading_headline": "Subheading",</p>
<p>"subitem_heading_language": "ja"</p>
<p>},</p>
<p>{</p>
<p>"subitem_heading_banner_headline": "Banner Headline",</p>
<p>"subitem_heading_headline": "Subheding",</p>
<p>"subitem_heading_language": "en"</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_1617944105607": {</p>
<p>"attribute_name": "Degree Grantor",</p>
<p>"attribute_value_mlt": [</p>
<p>{</p>
<p>"subitem_degreegrantor": [</p>
<p>{</p>
<p>"subitem_degreegrantor_language": "en",</p>
<p>"subitem_degreegrantor_name": "Degree Grantor Name"</p>
<p>}</p>
<p>],</p>
<p>"subitem_degreegrantor_identifie": [</p>
<p>{</p>
<p>"subitem_degreegrantor_identifier_name": "xxxxxx",</p>
<p>"subitem_degreegrantor_identifier_scheme": "kakenhi"</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>"item_title": "public-item-0-public-oai-guest-1-ja",</p>
<p>"item_type_id": "15",</p>
<p>"owner": "1",</p>
<p>"path": [</p>
<p>"1"</p>
<p>],</p>
<p>"pubdate": {</p>
<p>"attribute_name": "PubDate",</p>
<p>"attribute_value": "2021-11-20"</p>
<p>},</p>
<p>"publish_date": "2021-11-20",</p>
<p>"publish_status": "0",</p>
<p>"relation_version_is_last": true,</p>
<p>"title": [</p>
<p>"public-item-0-public-oai-guest-1-ja"</p>
<p>],</p>
<p>"weko_shared_id": -1</p>
<p>},</p>
<p>"_oai": {</p>
<p>"id": "oai:weko3.example.org:00000001",</p>
<p>"sets": [</p>
<p>"1"</p>
<p>]</p>
<p>},</p>
<p>"accessRights": [</p>
<p>"open access"</p>
<p>],</p>
<p>"alternative": [</p>
<p>"Alternative Title",</p>
<p>"Alternative Title"</p>
<p>],</p>
<p>"apc": [</p>
<p>"Unknown"</p>
<p>],</p>
<p>"author_link": [</p>
<p>"4"</p>
<p>],</p>
<p>"conference": {</p>
<p>"conferenceCountry": [</p>
<p>"JPN"</p>
<p>],</p>
<p>"conferenceDate": [</p>
<p>"2020/12/11"</p>
<p>],</p>
<p>"conferenceName": [</p>
<p>"Conference Name"</p>
<p>],</p>
<p>"conferenceSequence": [</p>
<p>"1"</p>
<p>],</p>
<p>"conferenceSponsor": [</p>
<p>"Sponsor"</p>
<p>],</p>
<p>"conferenceVenue": [</p>
<p>"Conference Venue"</p>
<p>]</p>
<p>},</p>
<p>"contributor": {</p>
<p>"@attributes": {</p>
<p>"contributorType": [</p>
<p>[</p>
<p>"ContactPerson"</p>
<p>]</p>
<p>]</p>
<p>},</p>
<p>"affiliation": {</p>
<p>"affiliationName": [],</p>
<p>"nameIdentifier": []</p>
<p>},</p>
<p>"contributorAlternative": [],</p>
<p>"contributorName": [</p>
<p>"情報, 太郎",</p>
<p>"ジョウホウ\t タロウ",</p>
<p>"Joho\t Taro"</p>
<p>],</p>
<p>"familyName": [</p>
<p>"情報",</p>
<p>"ジョウホウ",</p>
<p>"Joho"</p>
<p>],</p>
<p>"givenName": [</p>
<p>"太郎",</p>
<p>"タロウ",</p>
<p>"Taro"</p>
<p>],</p>
<p>"nameIdentifier": [</p>
<p>"xxxxxxx",</p>
<p>"xxxxxxx",</p>
<p>"xxxxxxx"</p>
<p>]</p>
<p>},</p>
<p>"control_number": "1",</p>
<p>"creator": {</p>
<p>"affiliation": {</p>
<p>"affiliationName": [</p>
<p>"University"</p>
<p>],</p>
<p>"nameIdentifier": [</p>
<p>"0000000121691048"</p>
<p>]</p>
<p>},</p>
<p>"creatorAlternative": [],</p>
<p>"creatorName": [</p>
<p>"情報, 太郎",</p>
<p>"ジョウホウ\t タロウ",</p>
<p>"Joho\t Taro",</p>
<p>"情報, 太郎",</p>
<p>"ジョウホウ\t タロウ",</p>
<p>"Joho\t Taro",</p>
<p>"情報, 太郎",</p>
<p>"ジョウホウ\t タロウ",</p>
<p>"Joho\t Taro"</p>
<p>],</p>
<p>"familyName": [</p>
<p>"情報",</p>
<p>"ジョウホウ",</p>
<p>"Joho",</p>
<p>"情報",</p>
<p>"ジョウホウ",</p>
<p>"Joho",</p>
<p>"情報",</p>
<p>"ジョウホウ",</p>
<p>"Joho"</p>
<p>],</p>
<p>"givenName": [</p>
<p>"太郎",</p>
<p>"タロウ",</p>
<p>"Taro",</p>
<p>"太郎",</p>
<p>"タロウ",</p>
<p>"Taro",</p>
<p>"太郎",</p>
<p>"タロウ",</p>
<p>"Taro"</p>
<p>],</p>
<p>"nameIdentifier": [</p>
<p>"4",</p>
<p>"xxxxxxx",</p>
<p>"xxxxxxx",</p>
<p>"zzzzzzz",</p>
<p>"xxxxxxx",</p>
<p>"xxxxxxx",</p>
<p>"zzzzzzz",</p>
<p>"xxxxxxx",</p>
<p>"xxxxxxx",</p>
<p>"zzzzzzz"</p>
<p>]</p>
<p>},</p>
<p>"date": [</p>
<p>{</p>
<p>"dateType": "Available",</p>
<p>"value": "2021-06-30"</p>
<p>}</p>
<p>],</p>
<p>"dateGranted": [</p>
<p>"2021-06-30"</p>
<p>],</p>
<p>"degreeGrantor": {</p>
<p>"degreeGrantorName": [</p>
<p>"Degree Grantor Name"</p>
<p>],</p>
<p>"nameIdentifier": [</p>
<p>"xxxxxx"</p>
<p>]</p>
<p>},</p>
<p>"degreeName": [</p>
<p>"en"</p>
<p>],</p>
<p>"description": [</p>
<p>{</p>
<p>"descriptionType": "Abstract",</p>
<p>"value": "Description\nDescription\nDescription"</p>
<p>},</p>
<p>{</p>
<p>"descriptionType": "Abstract",</p>
<p>"value": "概要\n概要\n概要\n概要"</p>
<p>}</p>
<p>],</p>
<p>"feedback_mail_list": [</p>
<p>{</p>
<p>"author_id": "",</p>
<p>"email": "wekosoftware@nii.ac.jp"</p>
<p>}</p>
<p>],</p>
<p>"fundingReference": {</p>
<p>"awardNumber": [</p>
<p>"Award Number"</p>
<p>],</p>
<p>"awardTitle": [</p>
<p>"Award Title"</p>
<p>],</p>
<p>"funderIdentifier": [</p>
<p>"http://xxx"</p>
<p>],</p>
<p>"funderName": [</p>
<p>"Funder Name"</p>
<p>]</p>
<p>},</p>
<p>"geoLocation": {</p>
<p>"geoLocationPlace": [</p>
<p>"Japan"</p>
<p>]</p>
<p>},</p>
<p>"identifier": [</p>
<p>{</p>
<p>"identifierType": "URI",</p>
<p>"value": "http://localhost"</p>
<p>}</p>
<p>],</p>
<p>"issue": [</p>
<p>"111"</p>
<p>],</p>
<p>"itemtype": "デフォルトアイテムタイプ（フル）",</p>
<p>"language": [</p>
<p>"jpn"</p>
<p>],</p>
<p>"numPages": [</p>
<p>"12"</p>
<p>],</p>
<p>"pageEnd": [</p>
<p>"3"</p>
<p>],</p>
<p>"pageStart": [</p>
<p>"1"</p>
<p>],</p>
<p>"path": [</p>
<p>"1"</p>
<p>],</p>
<p>"publish_date": "2021-11-20",</p>
<p>"publish_status": "0",</p>
<p>"publisher": [</p>
<p>"Publisher"</p>
<p>],</p>
<p>"relation": {</p>
<p>"@attributes": {</p>
<p>"relationType": [</p>
<p>[</p>
<p>"isVersionOf"</p>
<p>]</p>
<p>]</p>
<p>},</p>
<p>"relatedIdentifier": [</p>
<p>{</p>
<p>"identifierType": "arXiv",</p>
<p>"value": "xxxxx"</p>
<p>}</p>
<p>],</p>
<p>"relatedTitle": [</p>
<p>"Related Title"</p>
<p>]</p>
<p>},</p>
<p>"relation_version_is_last": true,</p>
<p>"rights": [</p>
<p>"Rights Information"</p>
<p>],</p>
<p>"rightsHolder": {</p>
<p>"nameIdentifier": [</p>
<p>"xxxxxx"</p>
<p>],</p>
<p>"rightsHolderName": [</p>
<p>"Right Holder Name"</p>
<p>]</p>
<p>},</p>
<p>"sourceIdentifier": [</p>
<p>{</p>
<p>"identifierType": "ISSN",</p>
<p>"value": "xxxx-xxxx-xxxx"</p>
<p>}</p>
<p>],</p>
<p>"sourceTitle": [</p>
<p>"Source Title"</p>
<p>],</p>
<p>"subject": [</p>
<p>{</p>
<p>"subjectScheme": "Other",</p>
<p>"value": "Sibject1"</p>
<p>}</p>
<p>],</p>
<p>"temporal": [</p>
<p>"Temporal"</p>
<p>],</p>
<p>"title": [</p>
<p>"public-item-0-public-oai-guest-1-en",</p>
<p>"public-item-0-public-oai-guest-1-ja"</p>
<p>],</p>
<p>"type": [</p>
<p>"conference paper"</p>
<p>],</p>
<p>"version": [</p>
<p>"Version"</p>
<p>],</p>
<p>"versiontype": [</p>
<p>"AO"</p>
<p>],</p>
<p>"volume": [</p>
<p>"1"</p>
<p>],</p>
<p>"weko_creator_id": "1",</p>
<p>"weko_shared_id": -1</p>
<p>},</p>
<p>"updated": "2023-11-15T02:46:32.217662+00:00"</p>
<p>}</p>
<p>],</p>
<p>"total": 1761</p>
<p>},</p>
<p>"links": {</p>
<p>"next": "https://dev.ir.rcos.nii.ac.jp/api/records/?page=2&amp;q=%E6%A6%82%E8%A6%81&amp;size=1",</p>
<p>"self": "https://dev.ir.rcos.nii.ac.jp/api/records/?page=1&amp;q=%E6%A6%82%E8%A6%81&amp;size=1"</p>
<p>}</p>
<p>}</p></td>
</tr>
</tbody>
</table>

  - 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>〇</td>
<td>〇</td>
<td>〇</td>
<td>〇</td>
<td>〇</td>
<td>〇</td>
</tr>
</tbody>
</table>

  - 機能内容

  - 関連モジュール

  - 処理概要

  - 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/11/14</p>
</blockquote></td>
<td>V0.9.27</td>
<td>初版作成</td>
</tr>
</tbody>
</table>


### Render

  - 目的・用途

インデックスIDを指定しての検索機能を提供する。

  - 利用方法

| **Method** | **HTTP request**                               | **Description** |
| ---------- | ---------------------------------------------- | --------------- |
|            | **GET** /admin/itemtypes/{ITEMTYPE\_ID}/render | アイテムを検索する       |

パスパラメータ

| **GET** /admin/itemtypes/{ITEMTYPE\_ID}/render |     |             |
| ---------------------------------------------- | --- | ----------- |
| パラメータ                                          | 値   | 説明          |
| ITEMTYPE\_ID                                   | int | インデックスIDを指定 |

レスポンス例：

<table>
<thead>
<tr class="header">
<th><strong>レスポンス例</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>/api/index/?q=9</strong></td>
</tr>
<tr class="even">
<td><p>{</p>
<p>"edit_notes":{</p>
<p>"item_1617186331708":"",</p>
<p>"item_1617186419668":"",</p>
<p>"item_1617258105262":"",</p>
<p>"item_1617605131499":""</p>
<p>},</p>
<p>"key_subproperty_languague":[</p>
<p>"item_1617186331708.subitem_1551255648112",</p>
<p>"item_1617186419668.givenNames.givenNameLang",</p>
<p>"item_1617186419668.familyNames.familyNameLang",</p>
<p>"item_1617186419668.creatorAffiliations.affiliationNames.affiliationNameLang",</p>
<p>"item_1617186419668.creatorNames.creatorNameLang",</p>
<p>"item_1617186419668.creatorAlternatives.creatorAlternativeLang"</p>
<p>],</p>
<p>"meta_fix":{</p>
<p>"pubdate":{</p>
<p>"input_type":"datetime",</p>
<p>"input_value":"",</p>
<p>"option":{</p>
<p>"crtf":false,</p>
<p>"hidden":false,</p>
<p>"multiple":false,</p>
<p>"required":true,</p>
<p>"showlist":false</p>
<p>},</p>
<p>"title":"PubDate",</p>
<p>"title_i18n":{</p>
<p>"en":"PubDate",</p>
<p>"ja":"公開日"</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>"meta_list":{</p>
<p>"item_1617186331708":{</p>
<p>"input_maxItems":"9999",</p>
<p>"input_minItems":"1",</p>
<p>"input_type":"cus_67",</p>
<p>"input_value":"",</p>
<p>"option":{</p>
<p>"crtf":true,</p>
<p>"hidden":false,</p>
<p>"multiple":true,</p>
<p>"oneline":false,</p>
<p>"required":true,</p>
<p>"showlist":true</p>
<p>},</p>
<p>"title":"Title",</p>
<p>"title_i18n":{</p>
<p>"en":"Title",</p>
<p>"ja":"タイトル"</p>
<p>}</p>
<p>},</p>
<p>"item_1617186419668":{</p>
<p>"input_maxItems":"9999",</p>
<p>"input_minItems":"1",</p>
<p>"input_type":"cus_60",</p>
<p>"input_value":"",</p>
<p>"option":{</p>
<p>"crtf":true,</p>
<p>"hidden":false,</p>
<p>"multiple":true,</p>
<p>"oneline":false,</p>
<p>"required":false,</p>
<p>"showlist":true</p>
<p>},</p>
<p>"title":"Creator",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator",</p>
<p>"ja":"作成者"</p>
<p>}</p>
<p>},</p>
<p>"item_1617258105262":{</p>
<p>"input_maxItems":"9999",</p>
<p>"input_minItems":"1",</p>
<p>"input_type":"cus_8",</p>
<p>"input_value":"",</p>
<p>"option":{</p>
<p>"crtf":false,</p>
<p>"hidden":false,</p>
<p>"multiple":false,</p>
<p>"oneline":false,</p>
<p>"required":true,</p>
<p>"showlist":false</p>
<p>},</p>
<p>"title":"Resource Type",</p>
<p>"title_i18n":{</p>
<p>"en":"Resource Type",</p>
<p>"ja":"資源タイプ"</p>
<p>}</p>
<p>},</p>
<p>"item_1617605131499":{</p>
<p>"input_maxItems":"9999",</p>
<p>"input_minItems":"1",</p>
<p>"input_type":"cus_65",</p>
<p>"input_value":"",</p>
<p>"option":{</p>
<p>"crtf":false,</p>
<p>"hidden":false,</p>
<p>"multiple":true,</p>
<p>"oneline":false,</p>
<p>"required":false,</p>
<p>"showlist":true</p>
<p>},</p>
<p>"title":"File",</p>
<p>"title_i18n":{</p>
<p>"en":"File",</p>
<p>"ja":"ファイル情報"</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>"meta_system":{</p>
<p>"system_file":{</p>
<p>"input_type":"cus_131",</p>
<p>"input_value":"",</p>
<p>"option":{</p>
<p>"crtf":false,</p>
<p>"hidden":true,</p>
<p>"multiple":false,</p>
<p>"oneline":false,</p>
<p>"required":false,</p>
<p>"showlist":false</p>
<p>},</p>
<p>"title":"File Information",</p>
<p>"title_i18n":{</p>
<p>"en":"File Information",</p>
<p>"ja":"ファイル情報"</p>
<p>}</p>
<p>},</p>
<p>"system_identifier_doi":{</p>
<p>"input_type":"cus_130",</p>
<p>"input_value":"",</p>
<p>"option":{</p>
<p>"crtf":false,</p>
<p>"hidden":true,</p>
<p>"multiple":false,</p>
<p>"oneline":false,</p>
<p>"required":false,</p>
<p>"showlist":false</p>
<p>},</p>
<p>"title":"Persistent Identifier(DOI)",</p>
<p>"title_i18n":{</p>
<p>"en":"Persistent Identifier(DOI)",</p>
<p>"ja":"永続識別子（DOI）"</p>
<p>}</p>
<p>},</p>
<p>"system_identifier_hdl":{</p>
<p>"input_type":"cus_130",</p>
<p>"input_value":"",</p>
<p>"option":{</p>
<p>"crtf":false,</p>
<p>"hidden":true,</p>
<p>"multiple":false,</p>
<p>"oneline":false,</p>
<p>"required":false,</p>
<p>"showlist":false</p>
<p>},</p>
<p>"title":"Persistent Identifier(HDL)",</p>
<p>"title_i18n":{</p>
<p>"en":"Persistent Identifier(HDL)",</p>
<p>"ja":"永続識別子（HDL）"</p>
<p>}</p>
<p>},</p>
<p>"system_identifier_uri":{</p>
<p>"input_type":"cus_130",</p>
<p>"input_value":"",</p>
<p>"option":{</p>
<p>"crtf":false,</p>
<p>"hidden":true,</p>
<p>"multiple":false,</p>
<p>"oneline":false,</p>
<p>"required":false,</p>
<p>"showlist":false</p>
<p>},</p>
<p>"title":"Persistent Identifier(URI)",</p>
<p>"title_i18n":{</p>
<p>"en":"Persistent Identifier(URI)",</p>
<p>"ja":"永続識別子（URI）"</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>"schemaeditor":{</p>
<p>"schema":{</p>
<p>"item_1617186331708":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"subitem_1551255647225":{</p>
<p>"format":"text",</p>
<p>"title":"Title",</p>
<p>"title_i18n":{</p>
<p>"en":"Title",</p>
<p>"ja":"タイトル"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"subitem_1551255648112":{</p>
<p>"currentEnum":[</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"Language",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"item_1617186419668":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"creatorAffiliations":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"affiliationNameIdentifiers":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"affiliationNameIdentifier":{</p>
<p>"format":"text",</p>
<p>"title":"所属機関識別子",</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name Identifier",</p>
<p>"ja":"所属機関識別子"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"affiliationNameIdentifierScheme":{</p>
<p>"currentEnum":[</p>
<p>"kakenhi",</p>
<p>"ISNI",</p>
<p>"Ringgold",</p>
<p>"GRID"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"kakenhi",</p>
<p>"ISNI",</p>
<p>"Ringgold",</p>
<p>"GRID"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"所属機関識別子スキーマ",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"affiliationNameIdentifierURI":{</p>
<p>"format":"text",</p>
<p>"title":"所属機関識別子URI",</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name Identifier URI",</p>
<p>"ja":"所属機関識別子URI"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"所属機関識別子",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"affiliationNames":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"affiliationName":{</p>
<p>"format":"text",</p>
<p>"title":"所属機関名",</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name",</p>
<p>"ja":"所属機関名"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"affiliationNameLang":{</p>
<p>"currentEnum":[</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"言語",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"所属機関名",</p>
<p>"type":"array"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者所属",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"creatorAlternatives":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"creatorAlternative":{</p>
<p>"format":"text",</p>
<p>"title":"別名",</p>
<p>"title_i18n":{</p>
<p>"en":"Alternative Name",</p>
<p>"ja":"別名"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"creatorAlternativeLang":{</p>
<p>"currentEnum":[</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"言語",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者別名",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"creatorMails":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"creatorMail":{</p>
<p>"format":"text",</p>
<p>"title":"メールアドレス",</p>
<p>"title_i18n":{</p>
<p>"en":"Email Address",</p>
<p>"ja":"メールアドレス"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者メールアドレス",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"creatorNames":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"creatorName":{</p>
<p>"format":"text",</p>
<p>"title":"姓名",</p>
<p>"title_i18n":{</p>
<p>"en":"Name",</p>
<p>"ja":"姓名"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"creatorNameLang":{</p>
<p>"currentEnum":[</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"言語",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者姓名",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"familyNames":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"familyName":{</p>
<p>"format":"text",</p>
<p>"title":"姓",</p>
<p>"title_i18n":{</p>
<p>"en":"Family Name",</p>
<p>"ja":"姓"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"familyNameLang":{</p>
<p>"currentEnum":[</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"言語",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者姓",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"givenNames":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"givenName":{</p>
<p>"format":"text",</p>
<p>"title":"名",</p>
<p>"title_i18n":{</p>
<p>"en":"Given Name",</p>
<p>"ja":"名"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"givenNameLang":{</p>
<p>"currentEnum":[</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"言語",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者名",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"iscreator":{</p>
<p>"format":"text",</p>
<p>"title":"iscreator",</p>
<p>"title_i18n":{</p>
<p>"en":"",</p>
<p>"ja":""</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"nameIdentifiers":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"nameIdentifier":{</p>
<p>"format":"text",</p>
<p>"title":"作成者識別子",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Identifier",</p>
<p>"ja":"作成者識別子"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"nameIdentifierScheme":{</p>
<p>"currentEnum":[</p>
<p>],</p>
<p>"enum":[</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"作成者識別子Scheme",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"nameIdentifierURI":{</p>
<p>"format":"text",</p>
<p>"title":"作成者識別子URI",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Identifier URI",</p>
<p>"ja":"作成者識別子URI"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者識別子",</p>
<p>"type":"array"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"item_1617258105262":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"resourcetype":{</p>
<p>"currentEnum":[</p>
<p>"conference paper",</p>
<p>"data paper",</p>
<p>"departmental bulletin paper",</p>
<p>"editorial",</p>
<p>"journal article",</p>
<p>"newspaper",</p>
<p>"periodical",</p>
<p>"review article",</p>
<p>"software paper",</p>
<p>"article",</p>
<p>"book",</p>
<p>"book part",</p>
<p>"cartographic material",</p>
<p>"map",</p>
<p>"conference object",</p>
<p>"conference proceedings",</p>
<p>"conference poster",</p>
<p>"aggregated data",</p>
<p>"clinical trial data",</p>
<p>"compiled data",</p>
<p>"encoded data",</p>
<p>"experimental data",</p>
<p>"genomic data",</p>
<p>"geospatial data",</p>
<p>"laboratory notebook",</p>
<p>"measurement and test data",</p>
<p>"observational data",</p>
<p>"recorded data",</p>
<p>"simulation data",</p>
<p>"survey data",</p>
<p>"dataset",</p>
<p>"interview",</p>
<p>"image",</p>
<p>"still image",</p>
<p>"moving image",</p>
<p>"video",</p>
<p>"lecture",</p>
<p>"patent",</p>
<p>"internal report",</p>
<p>"report",</p>
<p>"research report",</p>
<p>"technical report",</p>
<p>"policy report",</p>
<p>"report part",</p>
<p>"working paper",</p>
<p>"data management plan",</p>
<p>"sound",</p>
<p>"thesis",</p>
<p>"bachelor thesis",</p>
<p>"master thesis",</p>
<p>"doctoral thesis",</p>
<p>"interactive resource",</p>
<p>"learning object",</p>
<p>"manuscript",</p>
<p>"musical notation",</p>
<p>"research proposal",</p>
<p>"software",</p>
<p>"technical documentation",</p>
<p>"workflow",</p>
<p>"other"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"conference paper",</p>
<p>"data paper",</p>
<p>"departmental bulletin paper",</p>
<p>"editorial",</p>
<p>"journal article",</p>
<p>"newspaper",</p>
<p>"periodical",</p>
<p>"review article",</p>
<p>"software paper",</p>
<p>"article",</p>
<p>"book",</p>
<p>"book part",</p>
<p>"cartographic material",</p>
<p>"map",</p>
<p>"conference object",</p>
<p>"conference proceedings",</p>
<p>"conference poster",</p>
<p>"aggregated data",</p>
<p>"clinical trial data",</p>
<p>"compiled data",</p>
<p>"encoded data",</p>
<p>"experimental data",</p>
<p>"genomic data",</p>
<p>"geospatial data",</p>
<p>"laboratory notebook",</p>
<p>"measurement and test data",</p>
<p>"observational data",</p>
<p>"recorded data",</p>
<p>"simulation data",</p>
<p>"survey data",</p>
<p>"dataset",</p>
<p>"interview",</p>
<p>"image",</p>
<p>"still image",</p>
<p>"moving image",</p>
<p>"video",</p>
<p>"lecture",</p>
<p>"patent",</p>
<p>"internal report",</p>
<p>"report",</p>
<p>"research report",</p>
<p>"technical report",</p>
<p>"policy report",</p>
<p>"report part",</p>
<p>"working paper",</p>
<p>"data management plan",</p>
<p>"sound",</p>
<p>"thesis",</p>
<p>"bachelor thesis",</p>
<p>"master thesis",</p>
<p>"doctoral thesis",</p>
<p>"interactive resource",</p>
<p>"learning object",</p>
<p>"manuscript",</p>
<p>"musical notation",</p>
<p>"research proposal",</p>
<p>"software",</p>
<p>"technical documentation",</p>
<p>"workflow",</p>
<p>"other"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"資源タイプ",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"resourceuri":{</p>
<p>"format":"text",</p>
<p>"title":"資源タイプ識別子",</p>
<p>"title_i18n":{</p>
<p>"en":"Resource Type Identifier",</p>
<p>"ja":"資源タイプ識別子"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"item_1617605131499":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"accessrole":{</p>
<p>"enum":[</p>
<p>"open_access",</p>
<p>"open_date",</p>
<p>"open_login",</p>
<p>"open_no"</p>
<p>],</p>
<p>"format":"radios",</p>
<p>"title":"アクセス",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"date":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"dateType":{</p>
<p>"currentEnum":[</p>
<p>],</p>
<p>"enum":[</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"日付タイプ",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"dateValue":{</p>
<p>"format":"datetime",</p>
<p>"title":"日付",</p>
<p>"title_i18n":{</p>
<p>"en":"",</p>
<p>"ja":""</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"オープンアクセスの日付",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"displaytype":{</p>
<p>"currentEnum":[</p>
<p>"detail",</p>
<p>"simple",</p>
<p>"preview"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"detail",</p>
<p>"simple",</p>
<p>"preview"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"表示形式",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"fileDate":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"fileDateType":{</p>
<p>"currentEnum":[</p>
<p>"Accepted",</p>
<p>"Collected",</p>
<p>"Copyrighted",</p>
<p>"Created",</p>
<p>"Issued",</p>
<p>"Submitted",</p>
<p>"Updated",</p>
<p>"Valid"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"Accepted",</p>
<p>"Collected",</p>
<p>"Copyrighted",</p>
<p>"Created",</p>
<p>"Issued",</p>
<p>"Submitted",</p>
<p>"Updated",</p>
<p>"Valid"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"日付タイプ",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"fileDateValue":{</p>
<p>"format":"datetime",</p>
<p>"title":"日付",</p>
<p>"title_i18n":{</p>
<p>"en":"Date",</p>
<p>"ja":"日付"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"日付",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"filename":{</p>
<p>"format":"text",</p>
<p>"title":"表示名",</p>
<p>"title_i18n":{</p>
<p>"en":"FileName",</p>
<p>"ja":"表示名"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"filesize":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"value":{</p>
<p>"format":"text",</p>
<p>"title":"サイズ",</p>
<p>"title_i18n":{</p>
<p>"en":"Size",</p>
<p>"ja":"サイズ"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"サイズ",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"format":{</p>
<p>"format":"text",</p>
<p>"title":"フォーマット",</p>
<p>"title_i18n":{</p>
<p>"en":"Format",</p>
<p>"ja":"フォーマット"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"groups":{</p>
<p>"currentEnum":[</p>
<p>],</p>
<p>"enum":[</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"グループ",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"licensefree":{</p>
<p>"format":"textarea",</p>
<p>"title":"自由ライセンス",</p>
<p>"title_i18n":{</p>
<p>"en":"自由ライセンス",</p>
<p>"ja":"自由ライセンス"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"licensetype":{</p>
<p>"currentEnum":[</p>
<p>],</p>
<p>"enum":[</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"ライセンス",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"url":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"label":{</p>
<p>"format":"text",</p>
<p>"title":"ラベル",</p>
<p>"title_i18n":{</p>
<p>"en":"Label",</p>
<p>"ja":"ラベル"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"objectType":{</p>
<p>"currentEnum":[</p>
<p>"abstract",</p>
<p>"summary",</p>
<p>"fulltext",</p>
<p>"thumbnail",</p>
<p>"other"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"abstract",</p>
<p>"summary",</p>
<p>"fulltext",</p>
<p>"thumbnail",</p>
<p>"other"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"オブジェクトタイプ",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"url":{</p>
<p>"format":"text",</p>
<p>"title":"本文URL",</p>
<p>"title_i18n":{</p>
<p>"en":"Text URL",</p>
<p>"ja":"本文URL"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"title":"本文URL",</p>
<p>"type":"object"</p>
<p>},</p>
<p>"version":{</p>
<p>"format":"text",</p>
<p>"title":"バージョン情報",</p>
<p>"title_i18n":{</p>
<p>"en":"Version Information",</p>
<p>"ja":"バージョン情報"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>"table_row":[</p>
<p>"item_1617186331708",</p>
<p>"item_1617186419668",</p>
<p>"item_1617258105262",</p>
<p>"item_1617605131499"</p>
<p>],</p>
<p>"table_row_map":{</p>
<p>"action":"upt",</p>
<p>"form":[</p>
<p>{</p>
<p>"format":"yyyy-MM-dd",</p>
<p>"key":"pubdate",</p>
<p>"required":true,</p>
<p>"templateUrl":"/static/templates/weko_deposit/datepicker.html",</p>
<p>"title":"PubDate",</p>
<p>"title_i18n":{</p>
<p>"en":"PubDate",</p>
<p>"ja":"公開日"</p>
<p>},</p>
<p>"type":"template"</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"item_1617186331708[].subitem_1551255647225",</p>
<p>"title":"Title",</p>
<p>"title_i18n":{</p>
<p>"en":"Title",</p>
<p>"ja":"タイトル"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Title",</p>
<p>"ja":"タイトル"</p>
<p>},</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617186331708[].subitem_1551255648112",</p>
<p>"title":"Language",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"ja",</p>
<p>"value":"ja"</p>
<p>},</p>
<p>{</p>
<p>"name":"ja-Kana",</p>
<p>"value":"ja-Kana"</p>
<p>},</p>
<p>{</p>
<p>"name":"ja-Latn",</p>
<p>"value":"ja-Latn"</p>
<p>},</p>
<p>{</p>
<p>"name":"en",</p>
<p>"value":"en"</p>
<p>},</p>
<p>{</p>
<p>"name":"fr",</p>
<p>"value":"fr"</p>
<p>},</p>
<p>{</p>
<p>"name":"it",</p>
<p>"value":"it"</p>
<p>},</p>
<p>{</p>
<p>"name":"de",</p>
<p>"value":"de"</p>
<p>},</p>
<p>{</p>
<p>"name":"es",</p>
<p>"value":"es"</p>
<p>},</p>
<p>{</p>
<p>"name":"zh-cn",</p>
<p>"value":"zh-cn"</p>
<p>},</p>
<p>{</p>
<p>"name":"zh-tw",</p>
<p>"value":"zh-tw"</p>
<p>},</p>
<p>{</p>
<p>"name":"ru",</p>
<p>"value":"ru"</p>
<p>},</p>
<p>{</p>
<p>"name":"la",</p>
<p>"value":"la"</p>
<p>},</p>
<p>{</p>
<p>"name":"ms",</p>
<p>"value":"ms"</p>
<p>},</p>
<p>{</p>
<p>"name":"eo",</p>
<p>"value":"eo"</p>
<p>},</p>
<p>{</p>
<p>"name":"ar",</p>
<p>"value":"ar"</p>
<p>},</p>
<p>{</p>
<p>"name":"el",</p>
<p>"value":"el"</p>
<p>},</p>
<p>{</p>
<p>"name":"ko",</p>
<p>"value":"ko"</p>
<p>}</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Language",</p>
<p>"ja":"言語"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Language",</p>
<p>"ja":"言語"</p>
<p>},</p>
<p>"type":"select"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617186331708",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"Title",</p>
<p>"title_i18n":{</p>
<p>"en":"Title",</p>
<p>"ja":"タイトル"</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"icon":"glyphicon glyphicon-search",</p>
<p>"key":"item_1617186419668[].authorInputButton",</p>
<p>"onClick":"searchAuthor('item_1617186419668', true, form)",</p>
<p>"style":"btn-default pull-right m-top-5",</p>
<p>"title":"著者DBから入力",</p>
<p>"type":"button"</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"item_1617186419668[].nameIdentifiers[].nameIdentifierScheme",</p>
<p>"title":"作成者識別子Scheme",</p>
<p>"titleMap":[</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Identifier Scheme",</p>
<p>"ja":"作成者識別子Scheme"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Creator Identifier Scheme",</p>
<p>"ja":"作成者識別子Scheme"</p>
<p>},</p>
<p>"type":"select"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617186419668[].nameIdentifiers[].nameIdentifierURI",</p>
<p>"title":"作成者識別子URI",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Identifier URI",</p>
<p>"ja":"作成者識別子URI"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Creator Identifier URI",</p>
<p>"ja":"作成者識別子URI"</p>
<p>},</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617186419668[].nameIdentifiers[].nameIdentifier",</p>
<p>"title":"作成者識別子",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Identifier",</p>
<p>"ja":"作成者識別子"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Creator Identifier",</p>
<p>"ja":"作成者識別子"</p>
<p>},</p>
<p>"type":"text"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617186419668[].nameIdentifiers",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"作成者識別子",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Identifier",</p>
<p>"ja":"作成者識別子"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Creator Identifier",</p>
<p>"ja":"作成者識別子"</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"item_1617186419668[].creatorNames[].creatorName",</p>
<p>"title":"姓名",</p>
<p>"title_i18n":{</p>
<p>"en":"Name",</p>
<p>"ja":"姓名"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Name",</p>
<p>"ja":"姓名"</p>
<p>},</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617186419668[].creatorNames[].creatorNameLang",</p>
<p>"title":"言語",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"ja",</p>
<p>"value":"ja"</p>
<p>},</p>
<p>{</p>
<p>"name":"ja-Kana",</p>
<p>"value":"ja-Kana"</p>
<p>},</p>
<p>{</p>
<p>"name":"ja-Latn",</p>
<p>"value":"ja-Latn"</p>
<p>},</p>
<p>{</p>
<p>"name":"en",</p>
<p>"value":"en"</p>
<p>},</p>
<p>{</p>
<p>"name":"fr",</p>
<p>"value":"fr"</p>
<p>},</p>
<p>{</p>
<p>"name":"it",</p>
<p>"value":"it"</p>
<p>},</p>
<p>{</p>
<p>"name":"de",</p>
<p>"value":"de"</p>
<p>},</p>
<p>{</p>
<p>"name":"es",</p>
<p>"value":"es"</p>
<p>},</p>
<p>{</p>
<p>"name":"zh-cn",</p>
<p>"value":"zh-cn"</p>
<p>},</p>
<p>{</p>
<p>"name":"zh-tw",</p>
<p>"value":"zh-tw"</p>
<p>},</p>
<p>{</p>
<p>"name":"ru",</p>
<p>"value":"ru"</p>
<p>},</p>
<p>{</p>
<p>"name":"la",</p>
<p>"value":"la"</p>
<p>},</p>
<p>{</p>
<p>"name":"ms",</p>
<p>"value":"ms"</p>
<p>},</p>
<p>{</p>
<p>"name":"eo",</p>
<p>"value":"eo"</p>
<p>},</p>
<p>{</p>
<p>"name":"ar",</p>
<p>"value":"ar"</p>
<p>},</p>
<p>{</p>
<p>"name":"el",</p>
<p>"value":"el"</p>
<p>},</p>
<p>{</p>
<p>"name":"ko",</p>
<p>"value":"ko"</p>
<p>}</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Language",</p>
<p>"ja":"言語"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Language",</p>
<p>"ja":"言語"</p>
<p>},</p>
<p>"type":"select"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617186419668[].creatorNames",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"作成者姓名",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Name",</p>
<p>"ja":"作成者姓名"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Creator Name",</p>
<p>"ja":"作成者姓名"</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"item_1617186419668[].familyNames[].familyName",</p>
<p>"title":"姓",</p>
<p>"title_i18n":{</p>
<p>"en":"Family Name",</p>
<p>"ja":"姓"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Family Name",</p>
<p>"ja":"姓"</p>
<p>},</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617186419668[].familyNames[].familyNameLang",</p>
<p>"title":"言語",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"ja",</p>
<p>"value":"ja"</p>
<p>},</p>
<p>{</p>
<p>"name":"ja-Kana",</p>
<p>"value":"ja-Kana"</p>
<p>},</p>
<p>{</p>
<p>"name":"ja-Latn",</p>
<p>"value":"ja-Latn"</p>
<p>},</p>
<p>{</p>
<p>"name":"en",</p>
<p>"value":"en"</p>
<p>},</p>
<p>{</p>
<p>"name":"fr",</p>
<p>"value":"fr"</p>
<p>},</p>
<p>{</p>
<p>"name":"it",</p>
<p>"value":"it"</p>
<p>},</p>
<p>{</p>
<p>"name":"de",</p>
<p>"value":"de"</p>
<p>},</p>
<p>{</p>
<p>"name":"es",</p>
<p>"value":"es"</p>
<p>},</p>
<p>{</p>
<p>"name":"zh-cn",</p>
<p>"value":"zh-cn"</p>
<p>},</p>
<p>{</p>
<p>"name":"zh-tw",</p>
<p>"value":"zh-tw"</p>
<p>},</p>
<p>{</p>
<p>"name":"ru",</p>
<p>"value":"ru"</p>
<p>},</p>
<p>{</p>
<p>"name":"la",</p>
<p>"value":"la"</p>
<p>},</p>
<p>{</p>
<p>"name":"ms",</p>
<p>"value":"ms"</p>
<p>},</p>
<p>{</p>
<p>"name":"eo",</p>
<p>"value":"eo"</p>
<p>},</p>
<p>{</p>
<p>"name":"ar",</p>
<p>"value":"ar"</p>
<p>},</p>
<p>{</p>
<p>"name":"el",</p>
<p>"value":"el"</p>
<p>},</p>
<p>{</p>
<p>"name":"ko",</p>
<p>"value":"ko"</p>
<p>}</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Language",</p>
<p>"ja":"言語"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Language",</p>
<p>"ja":"言語"</p>
<p>},</p>
<p>"type":"select"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617186419668[].familyNames",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"作成者姓",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Family Name",</p>
<p>"ja":"作成者姓"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Creator Family Name",</p>
<p>"ja":"作成者姓"</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"item_1617186419668[].givenNames[].givenName",</p>
<p>"title":"名",</p>
<p>"title_i18n":{</p>
<p>"en":"Given Name",</p>
<p>"ja":"名"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Given Name",</p>
<p>"ja":"名"</p>
<p>},</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617186419668[].givenNames[].givenNameLang",</p>
<p>"title":"言語",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"ja",</p>
<p>"value":"ja"</p>
<p>},</p>
<p>{</p>
<p>"name":"ja-Kana",</p>
<p>"value":"ja-Kana"</p>
<p>},</p>
<p>{</p>
<p>"name":"ja-Latn",</p>
<p>"value":"ja-Latn"</p>
<p>},</p>
<p>{</p>
<p>"name":"en",</p>
<p>"value":"en"</p>
<p>},</p>
<p>{</p>
<p>"name":"fr",</p>
<p>"value":"fr"</p>
<p>},</p>
<p>{</p>
<p>"name":"it",</p>
<p>"value":"it"</p>
<p>},</p>
<p>{</p>
<p>"name":"de",</p>
<p>"value":"de"</p>
<p>},</p>
<p>{</p>
<p>"name":"es",</p>
<p>"value":"es"</p>
<p>},</p>
<p>{</p>
<p>"name":"zh-cn",</p>
<p>"value":"zh-cn"</p>
<p>},</p>
<p>{</p>
<p>"name":"zh-tw",</p>
<p>"value":"zh-tw"</p>
<p>},</p>
<p>{</p>
<p>"name":"ru",</p>
<p>"value":"ru"</p>
<p>},</p>
<p>{</p>
<p>"name":"la",</p>
<p>"value":"la"</p>
<p>},</p>
<p>{</p>
<p>"name":"ms",</p>
<p>"value":"ms"</p>
<p>},</p>
<p>{</p>
<p>"name":"eo",</p>
<p>"value":"eo"</p>
<p>},</p>
<p>{</p>
<p>"name":"ar",</p>
<p>"value":"ar"</p>
<p>},</p>
<p>{</p>
<p>"name":"el",</p>
<p>"value":"el"</p>
<p>},</p>
<p>{</p>
<p>"name":"ko",</p>
<p>"value":"ko"</p>
<p>}</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Language",</p>
<p>"ja":"言語"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Language",</p>
<p>"ja":"言語"</p>
<p>},</p>
<p>"type":"select"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617186419668[].givenNames",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"作成者名",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Given Name",</p>
<p>"ja":"作成者名"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Creator Given Name",</p>
<p>"ja":"作成者名"</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"item_1617186419668[].creatorAlternatives[].creatorAlternative",</p>
<p>"title":"別名",</p>
<p>"title_i18n":{</p>
<p>"en":"Alternative Name",</p>
<p>"ja":"別名"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Alternative Name",</p>
<p>"ja":"別名"</p>
<p>},</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617186419668[].creatorAlternatives[].creatorAlternativeLang",</p>
<p>"title":"言語",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"ja",</p>
<p>"value":"ja"</p>
<p>},</p>
<p>{</p>
<p>"name":"ja-Kana",</p>
<p>"value":"ja-Kana"</p>
<p>},</p>
<p>{</p>
<p>"name":"ja-Latn",</p>
<p>"value":"ja-Latn"</p>
<p>},</p>
<p>{</p>
<p>"name":"en",</p>
<p>"value":"en"</p>
<p>},</p>
<p>{</p>
<p>"name":"fr",</p>
<p>"value":"fr"</p>
<p>},</p>
<p>{</p>
<p>"name":"it",</p>
<p>"value":"it"</p>
<p>},</p>
<p>{</p>
<p>"name":"de",</p>
<p>"value":"de"</p>
<p>},</p>
<p>{</p>
<p>"name":"es",</p>
<p>"value":"es"</p>
<p>},</p>
<p>{</p>
<p>"name":"zh-cn",</p>
<p>"value":"zh-cn"</p>
<p>},</p>
<p>{</p>
<p>"name":"zh-tw",</p>
<p>"value":"zh-tw"</p>
<p>},</p>
<p>{</p>
<p>"name":"ru",</p>
<p>"value":"ru"</p>
<p>},</p>
<p>{</p>
<p>"name":"la",</p>
<p>"value":"la"</p>
<p>},</p>
<p>{</p>
<p>"name":"ms",</p>
<p>"value":"ms"</p>
<p>},</p>
<p>{</p>
<p>"name":"eo",</p>
<p>"value":"eo"</p>
<p>},</p>
<p>{</p>
<p>"name":"ar",</p>
<p>"value":"ar"</p>
<p>},</p>
<p>{</p>
<p>"name":"el",</p>
<p>"value":"el"</p>
<p>},</p>
<p>{</p>
<p>"name":"ko",</p>
<p>"value":"ko"</p>
<p>}</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Language",</p>
<p>"ja":"言語"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Language",</p>
<p>"ja":"言語"</p>
<p>},</p>
<p>"type":"select"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617186419668[].creatorAlternatives",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"作成者別名",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Alternative Name",</p>
<p>"ja":"作成者別名"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Creator Alternative Name",</p>
<p>"ja":"作成者別名"</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"item_1617186419668[].creatorMails[].creatorMail",</p>
<p>"title":"メールアドレス",</p>
<p>"title_i18n":{</p>
<p>"en":"Email Address",</p>
<p>"ja":"メールアドレス"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Email Address",</p>
<p>"ja":"メールアドレス"</p>
<p>},</p>
<p>"type":"text"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617186419668[].creatorMails",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"作成者メールアドレス",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Email Address",</p>
<p>"ja":"作成者メールアレス"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Creator Email Address",</p>
<p>"ja":"作成者メールアレス"</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"item_1617186419668[].creatorAffiliations[].affiliationNameIdentifiers[].affiliationNameIdentifier",</p>
<p>"title":"所属機関識別子",</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name Identifier",</p>
<p>"ja":"所属機関識別子"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Affiliation Name Identifier",</p>
<p>"ja":"所属機関識別子"</p>
<p>},</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617186419668[].creatorAffiliations[].affiliationNameIdentifiers[].affiliationNameIdentifierScheme",</p>
<p>"title":"所属機関識別子スキーマ",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"kakenhi",</p>
<p>"value":"kakenhi"</p>
<p>},</p>
<p>{</p>
<p>"name":"ISNI",</p>
<p>"value":"ISNI"</p>
<p>},</p>
<p>{</p>
<p>"name":"Ringgold",</p>
<p>"value":"Ringgold"</p>
<p>},</p>
<p>{</p>
<p>"name":"GRID",</p>
<p>"value":"GRID"</p>
<p>}</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name Identifier Scheme",</p>
<p>"ja":"所属機関識別子スキーマ"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Affiliation Name Identifier Scheme",</p>
<p>"ja":"所属機関識別子スキーマ"</p>
<p>},</p>
<p>"type":"select"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617186419668[].creatorAffiliations[].affiliationNameIdentifiers[].affiliationNameIdentifierURI",</p>
<p>"title":"所属機関識別子URI",</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name Identifier URI",</p>
<p>"ja":"所属機関識別子URI"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Affiliation Name Identifier URI",</p>
<p>"ja":"所属機関識別子URI"</p>
<p>},</p>
<p>"type":"text"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617186419668[].creatorAffiliations[].affiliationNameIdentifiers",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"所属機関識別子",</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name Identifier",</p>
<p>"ja":"所属機関識別子"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Affiliation Name Identifier",</p>
<p>"ja":"所属機関識別子"</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"item_1617186419668[].creatorAffiliations[].affiliationNames[].affiliationName",</p>
<p>"title":"所属機関名",</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name",</p>
<p>"ja":"所属機関名"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Affiliation Name",</p>
<p>"ja":"所属機関名"</p>
<p>},</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617186419668[].creatorAffiliations[].affiliationNames[].affiliationNameLang",</p>
<p>"title":"言語",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"ja",</p>
<p>"value":"ja"</p>
<p>},</p>
<p>{</p>
<p>"name":"ja-Kana",</p>
<p>"value":"ja-Kana"</p>
<p>},</p>
<p>{</p>
<p>"name":"ja-Latn",</p>
<p>"value":"ja-Latn"</p>
<p>},</p>
<p>{</p>
<p>"name":"en",</p>
<p>"value":"en"</p>
<p>},</p>
<p>{</p>
<p>"name":"fr",</p>
<p>"value":"fr"</p>
<p>},</p>
<p>{</p>
<p>"name":"it",</p>
<p>"value":"it"</p>
<p>},</p>
<p>{</p>
<p>"name":"de",</p>
<p>"value":"de"</p>
<p>},</p>
<p>{</p>
<p>"name":"es",</p>
<p>"value":"es"</p>
<p>},</p>
<p>{</p>
<p>"name":"zh-cn",</p>
<p>"value":"zh-cn"</p>
<p>},</p>
<p>{</p>
<p>"name":"zh-tw",</p>
<p>"value":"zh-tw"</p>
<p>},</p>
<p>{</p>
<p>"name":"ru",</p>
<p>"value":"ru"</p>
<p>},</p>
<p>{</p>
<p>"name":"la",</p>
<p>"value":"la"</p>
<p>},</p>
<p>{</p>
<p>"name":"ms",</p>
<p>"value":"ms"</p>
<p>},</p>
<p>{</p>
<p>"name":"eo",</p>
<p>"value":"eo"</p>
<p>},</p>
<p>{</p>
<p>"name":"ar",</p>
<p>"value":"ar"</p>
<p>},</p>
<p>{</p>
<p>"name":"el",</p>
<p>"value":"el"</p>
<p>},</p>
<p>{</p>
<p>"name":"ko",</p>
<p>"value":"ko"</p>
<p>}</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Language",</p>
<p>"ja":"言語"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Language",</p>
<p>"ja":"言語"</p>
<p>},</p>
<p>"type":"select"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617186419668[].creatorAffiliations[].affiliationNames",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"所属機関名",</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name",</p>
<p>"ja":"所属機関名"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Affiliation Name",</p>
<p>"ja":"所属機関名"</p>
<p>}</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617186419668[].creatorAffiliations",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"作成者所属",</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name Identifier",</p>
<p>"ja":"作成者所属"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Affiliation Name Identifier",</p>
<p>"ja":"作成者所属"</p>
<p>}</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617186419668",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"Creator",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator",</p>
<p>"ja":"作成者"</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"item_1617258105262.resourcetype",</p>
<p>"onChange":"resourceTypeSelect()",</p>
<p>"title":"資源タイプ",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"conference paper",</p>
<p>"value":"conference paper"</p>
<p>},</p>
<p>{</p>
<p>"name":"data paper",</p>
<p>"value":"data paper"</p>
<p>},</p>
<p>{</p>
<p>"name":"departmental bulletin paper",</p>
<p>"value":"departmental bulletin paper"</p>
<p>},</p>
<p>{</p>
<p>"name":"editorial",</p>
<p>"value":"editorial"</p>
<p>},</p>
<p>{</p>
<p>"name":"journal article",</p>
<p>"value":"journal article"</p>
<p>},</p>
<p>{</p>
<p>"name":"newspaper",</p>
<p>"value":"newspaper"</p>
<p>},</p>
<p>{</p>
<p>"name":"periodical",</p>
<p>"value":"periodical"</p>
<p>},</p>
<p>{</p>
<p>"name":"review article",</p>
<p>"value":"review article"</p>
<p>},</p>
<p>{</p>
<p>"name":"software paper",</p>
<p>"value":"software paper"</p>
<p>},</p>
<p>{</p>
<p>"name":"article",</p>
<p>"value":"article"</p>
<p>},</p>
<p>{</p>
<p>"name":"book",</p>
<p>"value":"book"</p>
<p>},</p>
<p>{</p>
<p>"name":"book part",</p>
<p>"value":"book part"</p>
<p>},</p>
<p>{</p>
<p>"name":"cartographic material",</p>
<p>"value":"cartographic material"</p>
<p>},</p>
<p>{</p>
<p>"name":"map",</p>
<p>"value":"map"</p>
<p>},</p>
<p>{</p>
<p>"name":"conference object",</p>
<p>"value":"conference object"</p>
<p>},</p>
<p>{</p>
<p>"name":"conference proceedings",</p>
<p>"value":"conference proceedings"</p>
<p>},</p>
<p>{</p>
<p>"name":"conference poster",</p>
<p>"value":"conference poster"</p>
<p>},</p>
<p>{</p>
<p>"name":"aggregated data",</p>
<p>"value":"aggregated data"</p>
<p>},</p>
<p>{</p>
<p>"name":"clinical trial data",</p>
<p>"value":"clinical trial data"</p>
<p>},</p>
<p>{</p>
<p>"name":"compiled data",</p>
<p>"value":"compiled data"</p>
<p>},</p>
<p>{</p>
<p>"name":"encoded data",</p>
<p>"value":"encoded data"</p>
<p>},</p>
<p>{</p>
<p>"name":"experimental data",</p>
<p>"value":"experimental data"</p>
<p>},</p>
<p>{</p>
<p>"name":"genomic data",</p>
<p>"value":"genomic data"</p>
<p>},</p>
<p>{</p>
<p>"name":"geospatial data",</p>
<p>"value":"geospatial data"</p>
<p>},</p>
<p>{</p>
<p>"name":"laboratory notebook",</p>
<p>"value":"laboratory notebook"</p>
<p>},</p>
<p>{</p>
<p>"name":"measurement and test data",</p>
<p>"value":"measurement and test data"</p>
<p>},</p>
<p>{</p>
<p>"name":"observational data",</p>
<p>"value":"observational data"</p>
<p>},</p>
<p>{</p>
<p>"name":"recorded data",</p>
<p>"value":"recorded data"</p>
<p>},</p>
<p>{</p>
<p>"name":"simulation data",</p>
<p>"value":"simulation data"</p>
<p>},</p>
<p>{</p>
<p>"name":"survey data",</p>
<p>"value":"survey data"</p>
<p>},</p>
<p>{</p>
<p>"name":"dataset",</p>
<p>"value":"dataset"</p>
<p>},</p>
<p>{</p>
<p>"name":"interview",</p>
<p>"value":"interview"</p>
<p>},</p>
<p>{</p>
<p>"name":"image",</p>
<p>"value":"image"</p>
<p>},</p>
<p>{</p>
<p>"name":"still image",</p>
<p>"value":"still image"</p>
<p>},</p>
<p>{</p>
<p>"name":"moving image",</p>
<p>"value":"moving image"</p>
<p>},</p>
<p>{</p>
<p>"name":"video",</p>
<p>"value":"video"</p>
<p>},</p>
<p>{</p>
<p>"name":"lecture",</p>
<p>"value":"lecture"</p>
<p>},</p>
<p>{</p>
<p>"name":"patent",</p>
<p>"value":"patent"</p>
<p>},</p>
<p>{</p>
<p>"name":"internal report",</p>
<p>"value":"internal report"</p>
<p>},</p>
<p>{</p>
<p>"name":"report",</p>
<p>"value":"report"</p>
<p>},</p>
<p>{</p>
<p>"name":"research report",</p>
<p>"value":"research report"</p>
<p>},</p>
<p>{</p>
<p>"name":"technical report",</p>
<p>"value":"technical report"</p>
<p>},</p>
<p>{</p>
<p>"name":"policy report",</p>
<p>"value":"policy report"</p>
<p>},</p>
<p>{</p>
<p>"name":"report part",</p>
<p>"value":"report part"</p>
<p>},</p>
<p>{</p>
<p>"name":"working paper",</p>
<p>"value":"working paper"</p>
<p>},</p>
<p>{</p>
<p>"name":"data management plan",</p>
<p>"value":"data management plan"</p>
<p>},</p>
<p>{</p>
<p>"name":"sound",</p>
<p>"value":"sound"</p>
<p>},</p>
<p>{</p>
<p>"name":"thesis",</p>
<p>"value":"thesis"</p>
<p>},</p>
<p>{</p>
<p>"name":"bachelor thesis",</p>
<p>"value":"bachelor thesis"</p>
<p>},</p>
<p>{</p>
<p>"name":"master thesis",</p>
<p>"value":"master thesis"</p>
<p>},</p>
<p>{</p>
<p>"name":"doctoral thesis",</p>
<p>"value":"doctoral thesis"</p>
<p>},</p>
<p>{</p>
<p>"name":"interactive resource",</p>
<p>"value":"interactive resource"</p>
<p>},</p>
<p>{</p>
<p>"name":"learning object",</p>
<p>"value":"learning object"</p>
<p>},</p>
<p>{</p>
<p>"name":"manuscript",</p>
<p>"value":"manuscript"</p>
<p>},</p>
<p>{</p>
<p>"name":"musical notation",</p>
<p>"value":"musical notation"</p>
<p>},</p>
<p>{</p>
<p>"name":"research proposal",</p>
<p>"value":"research proposal"</p>
<p>},</p>
<p>{</p>
<p>"name":"software",</p>
<p>"value":"software"</p>
<p>},</p>
<p>{</p>
<p>"name":"technical documentation",</p>
<p>"value":"technical documentation"</p>
<p>},</p>
<p>{</p>
<p>"name":"workflow",</p>
<p>"value":"workflow"</p>
<p>},</p>
<p>{</p>
<p>"name":"other",</p>
<p>"value":"other"</p>
<p>}</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Resource Type",</p>
<p>"ja":"資源タイプ"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Resource Type",</p>
<p>"ja":"資源タイプ"</p>
<p>},</p>
<p>"type":"select"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617258105262.resourceuri",</p>
<p>"readonly":true,</p>
<p>"title":"資源タイプ識別子",</p>
<p>"title_i18n":{</p>
<p>"en":"Resource Type Identifier",</p>
<p>"ja":"資源タイプ識別子"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Resource Type Identifier",</p>
<p>"ja":"資源タイプ識別子"</p>
<p>},</p>
<p>"type":"text"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617258105262",</p>
<p>"title":"Resource Type",</p>
<p>"title_i18n":{</p>
<p>"en":"Resource Type",</p>
<p>"ja":"資源タイプ"</p>
<p>},</p>
<p>"type":"fieldset"</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"fieldHtmlClass":"file-name",</p>
<p>"key":"item_1617605131499[].filename",</p>
<p>"onChange":"fileNameSelect(this, form, modelValue)",</p>
<p>"templateUrl":"/static/templates/weko_deposit/datalist.html",</p>
<p>"title":"表示名",</p>
<p>"titleMap":[</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"FileName",</p>
<p>"ja":"表示名"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"FileName",</p>
<p>"ja":"表示名"</p>
<p>},</p>
<p>"type":"template"</p>
<p>},</p>
<p>{</p>
<p>"items":[</p>
<p>{</p>
<p>"disableSuccessState":true,</p>
<p>"feedback":false,</p>
<p>"fieldHtmlClass":"file-text-url",</p>
<p>"key":"item_1617605131499[].url.url",</p>
<p>"title":"本文URL",</p>
<p>"title_i18n":{</p>
<p>"en":"Text URL",</p>
<p>"ja":"本文URL"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Text URL",</p>
<p>"ja":"本文URL"</p>
<p>},</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"disableSuccessState":true,</p>
<p>"feedback":false,</p>
<p>"key":"item_1617605131499[].url.label",</p>
<p>"title":"ラベル",</p>
<p>"title_i18n":{</p>
<p>"en":"Label",</p>
<p>"ja":"ラベル"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Label",</p>
<p>"ja":"ラベル"</p>
<p>},</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"disableSuccessState":true,</p>
<p>"feedback":false,</p>
<p>"key":"item_1617605131499[].url.objectType",</p>
<p>"title":"オブジェクトタイプ",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"abstract",</p>
<p>"value":"abstract"</p>
<p>},</p>
<p>{</p>
<p>"name":"summary",</p>
<p>"value":"summary"</p>
<p>},</p>
<p>{</p>
<p>"name":"fulltext",</p>
<p>"value":"fulltext"</p>
<p>},</p>
<p>{</p>
<p>"name":"thumbnail",</p>
<p>"value":"thumbnail"</p>
<p>},</p>
<p>{</p>
<p>"name":"other",</p>
<p>"value":"other"</p>
<p>}</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Object Type",</p>
<p>"ja":"オブジェクトタイプ"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Object Type",</p>
<p>"ja":"オブジェクトタイプ"</p>
<p>},</p>
<p>"type":"select"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617605131499[].url",</p>
<p>"title":"本文URL",</p>
<p>"title_i18n":{</p>
<p>"en":"Text URL",</p>
<p>"ja":"本文URL"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Text URL",</p>
<p>"ja":"本文URL"</p>
<p>},</p>
<p>"type":"fieldset"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617605131499[].format",</p>
<p>"title":"フォーマット",</p>
<p>"title_i18n":{</p>
<p>"en":"Format",</p>
<p>"ja":"フォーマット"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Format",</p>
<p>"ja":"フォーマット"</p>
<p>},</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"item_1617605131499[].filesize[].value",</p>
<p>"title":"サイズ",</p>
<p>"title_i18n":{</p>
<p>"en":"Size",</p>
<p>"ja":"サイズ"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Size",</p>
<p>"ja":"サイズ"</p>
<p>},</p>
<p>"type":"text"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617605131499[].filesize",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"サイズ",</p>
<p>"title_i18n":{</p>
<p>"en":"Size",</p>
<p>"ja":"サイズ"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Size",</p>
<p>"ja":"サイズ"</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"item_1617605131499[].fileDate[].fileDateType",</p>
<p>"title":"日付タイプ",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"Accepted",</p>
<p>"value":"Accepted"</p>
<p>},</p>
<p>{</p>
<p>"name":"Collected",</p>
<p>"value":"Collected"</p>
<p>},</p>
<p>{</p>
<p>"name":"Copyrighted",</p>
<p>"value":"Copyrighted"</p>
<p>},</p>
<p>{</p>
<p>"name":"Created",</p>
<p>"value":"Created"</p>
<p>},</p>
<p>{</p>
<p>"name":"Issued",</p>
<p>"value":"Issued"</p>
<p>},</p>
<p>{</p>
<p>"name":"Submitted",</p>
<p>"value":"Submitted"</p>
<p>},</p>
<p>{</p>
<p>"name":"Updated",</p>
<p>"value":"Updated"</p>
<p>},</p>
<p>{</p>
<p>"name":"Valid",</p>
<p>"value":"Valid"</p>
<p>}</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Date Type",</p>
<p>"ja":"日付タイプ"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Date Type",</p>
<p>"ja":"日付タイプ"</p>
<p>},</p>
<p>"type":"select"</p>
<p>},</p>
<p>{</p>
<p>"format":"yyyy-MM-dd",</p>
<p>"key":"item_1617605131499[].fileDate[].fileDateValue",</p>
<p>"templateUrl":"/static/templates/weko_deposit/datepicker_multi_format.html",</p>
<p>"title":"日付",</p>
<p>"title_i18n":{</p>
<p>"en":"Date",</p>
<p>"ja":"日付"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Date",</p>
<p>"ja":"日付"</p>
<p>},</p>
<p>"type":"template"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617605131499[].fileDate",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"日付",</p>
<p>"title_i18n":{</p>
<p>"en":"Date",</p>
<p>"ja":"日付"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Date",</p>
<p>"ja":"日付"</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617605131499[].version",</p>
<p>"title":"バージョン情報",</p>
<p>"title_i18n":{</p>
<p>"en":"Version Information",</p>
<p>"ja":"バージョン情報"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Version Information",</p>
<p>"ja":"バージョン情報"</p>
<p>},</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617605131499[].displaytype",</p>
<p>"title":"表示形式",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"詳細表示",</p>
<p>"name_i18n":{</p>
<p>"en":"Detail",</p>
<p>"ja":"詳細表示"</p>
<p>},</p>
<p>"value":"detail"</p>
<p>},</p>
<p>{</p>
<p>"name":"簡易表示",</p>
<p>"name_i18n":{</p>
<p>"en":"Simple",</p>
<p>"ja":"簡易表示"</p>
<p>},</p>
<p>"value":"simple"</p>
<p>},</p>
<p>{</p>
<p>"name":"プレビュー",</p>
<p>"name_i18n":{</p>
<p>"en":"Preview",</p>
<p>"ja":"プレビュー"</p>
<p>},</p>
<p>"value":"preview"</p>
<p>}</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Preview",</p>
<p>"ja":"表示形式"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Preview",</p>
<p>"ja":"表示形式"</p>
<p>},</p>
<p>"type":"select"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617605131499[].licensetype",</p>
<p>"title":"ライセンス",</p>
<p>"titleMap":[</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"License",</p>
<p>"ja":"ライセンス"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"License",</p>
<p>"ja":"ライセンス"</p>
<p>},</p>
<p>"type":"select"</p>
<p>},</p>
<p>{</p>
<p>"condition":"model.item_1617605131499[arrayIndex].licensetype == 'license_free'",</p>
<p>"key":"item_1617605131499[].licensefree",</p>
<p>"notitle":true,</p>
<p>"title_i18n":{</p>
<p>"en":"自由ライセンス",</p>
<p>"ja":"自由ライセンス"</p>
<p>},</p>
<p>"type":"textarea"</p>
<p>},</p>
<p>{</p>
<p>"template":"&lt;div class='text-center' style='display:none;'&gt;&lt;a class='btn btn-primary' href='/ezas/pdf-detect-weko.html' target='_blank' role='button'&gt;{{ form.title }}&lt;/a&gt;&lt;/div&gt;",</p>
<p>"title":"剽窃チェック",</p>
<p>"title_i18n":{</p>
<p>"en":"Check Plagiarism",</p>
<p>"ja":"剽窃チェック"</p>
<p>},</p>
<p>"type":"template"</p>
<p>},</p>
<p>{</p>
<p>"key":"item_1617605131499[].accessrole",</p>
<p>"onChange":"accessRoleChange()",</p>
<p>"title":"アクセス",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"オープンアクセス",</p>
<p>"name_i18n":{</p>
<p>"en":"Open access",</p>
<p>"ja":"オープンアクセス"</p>
<p>},</p>
<p>"value":"open_access"</p>
<p>},</p>
<p>{</p>
<p>"name":"オープンアクセス日を指定する",</p>
<p>"name_i18n":{</p>
<p>"en":"Input Open Access Date",</p>
<p>"ja":"オープンアクセス日を指定する"</p>
<p>},</p>
<p>"value":"open_date"</p>
<p>},</p>
<p>{</p>
<p>"name":"ログインユーザのみ",</p>
<p>"name_i18n":{</p>
<p>"en":"Registered User Only",</p>
<p>"ja":"ログインユーザのみ"</p>
<p>},</p>
<p>"value":"open_login"</p>
<p>},</p>
<p>{</p>
<p>"name":"公開しない",</p>
<p>"name_i18n":{</p>
<p>"en":"Do not Publish",</p>
<p>"ja":"公開しない"</p>
<p>},</p>
<p>"value":"open_no"</p>
<p>}</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Access",</p>
<p>"ja":"アクセス"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Access",</p>
<p>"ja":"アクセス"</p>
<p>},</p>
<p>"type":"radios"</p>
<p>},</p>
<p>{</p>
<p>"condition":"model.item_1617605131499[arrayIndex].accessrole == 'open_date'",</p>
<p>"format":"yyyy-MM-dd",</p>
<p>"key":"item_1617605131499[].date[0].dateValue",</p>
<p>"templateUrl":"/static/templates/weko_deposit/datepicker.html",</p>
<p>"title":"公開日",</p>
<p>"title_i18n":{</p>
<p>"en":"Opendate",</p>
<p>"ja":"公開日"</p>
<p>},</p>
<p>"type":"template"</p>
<p>},</p>
<p>{</p>
<p>"condition":"model.item_1617605131499[arrayIndex].accessrole == 'open_login'",</p>
<p>"key":"item_1617605131499[].groups",</p>
<p>"title":"グループ",</p>
<p>"titleMap":[</p>
<p>],</p>
<p>"title_i18n":{</p>
<p>"en":"Group",</p>
<p>"ja":"グループ"</p>
<p>},</p>
<p>"title_i18n_temp":{</p>
<p>"en":"Group",</p>
<p>"ja":"グループ"</p>
<p>},</p>
<p>"type":"select"</p>
<p>}</p>
<p>],</p>
<p>"key":"item_1617605131499",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"File",</p>
<p>"title_i18n":{</p>
<p>"en":"File",</p>
<p>"ja":"ファイル情報"</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemidt_identifier",</p>
<p>"title":"SYSTEMIDT Identifier",</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemidt_identifier_type",</p>
<p>"title":"SYSTEMIDT Identifier Type",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"DOI",</p>
<p>"value":"DOI"</p>
<p>},</p>
<p>{</p>
<p>"name":"HDL",</p>
<p>"value":"HDL"</p>
<p>},</p>
<p>{</p>
<p>"name":"URI",</p>
<p>"value":"URI"</p>
<p>}</p>
<p>],</p>
<p>"type":"select"</p>
<p>}</p>
<p>],</p>
<p>"key":"system_identifier_doi",</p>
<p>"title":"Persistent Identifier(DOI)",</p>
<p>"title_i18n":{</p>
<p>"en":"Persistent Identifier(DOI)",</p>
<p>"ja":"永続識別子（DOI）"</p>
<p>},</p>
<p>"type":"fieldset"</p>
<p>},</p>
<p>{</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemidt_identifier",</p>
<p>"title":"SYSTEMIDT Identifier",</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemidt_identifier_type",</p>
<p>"title":"SYSTEMIDT Identifier Type",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"DOI",</p>
<p>"value":"DOI"</p>
<p>},</p>
<p>{</p>
<p>"name":"HDL",</p>
<p>"value":"HDL"</p>
<p>},</p>
<p>{</p>
<p>"name":"URI",</p>
<p>"value":"URI"</p>
<p>}</p>
<p>],</p>
<p>"type":"select"</p>
<p>}</p>
<p>],</p>
<p>"key":"system_identifier_hdl",</p>
<p>"title":"Persistent Identifier(HDL)",</p>
<p>"title_i18n":{</p>
<p>"en":"Persistent Identifier(HDL)",</p>
<p>"ja":"永続識別子（HDL）"</p>
<p>},</p>
<p>"type":"fieldset"</p>
<p>},</p>
<p>{</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemidt_identifier",</p>
<p>"title":"SYSTEMIDT Identifier",</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemidt_identifier_type",</p>
<p>"title":"SYSTEMIDT Identifier Type",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"DOI",</p>
<p>"value":"DOI"</p>
<p>},</p>
<p>{</p>
<p>"name":"HDL",</p>
<p>"value":"HDL"</p>
<p>},</p>
<p>{</p>
<p>"name":"URI",</p>
<p>"value":"URI"</p>
<p>}</p>
<p>],</p>
<p>"type":"select"</p>
<p>}</p>
<p>],</p>
<p>"key":"system_identifier_uri",</p>
<p>"title":"Persistent Identifier(URI)",</p>
<p>"title_i18n":{</p>
<p>"en":"Persistent Identifier(URI)",</p>
<p>"ja":"永続識別子（URI）"</p>
<p>},</p>
<p>"type":"fieldset"</p>
<p>},</p>
<p>{</p>
<p>"items":[</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemfile_filename[].subitem_systemfile_filename_label",</p>
<p>"title":"SYSTEMFILE Filename Label",</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemfile_filename[].subitem_systemfile_filename_type",</p>
<p>"title":"SYSTEMFILE Filename Type",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"Abstract",</p>
<p>"value":"Abstract"</p>
<p>},</p>
<p>{</p>
<p>"name":"Fulltext",</p>
<p>"value":"Fulltext"</p>
<p>},</p>
<p>{</p>
<p>"name":"Summary",</p>
<p>"value":"Summary"</p>
<p>},</p>
<p>{</p>
<p>"name":"Thumbnail",</p>
<p>"value":"Thumbnail"</p>
<p>},</p>
<p>{</p>
<p>"name":"Other",</p>
<p>"value":"Other"</p>
<p>}</p>
<p>],</p>
<p>"type":"select"</p>
<p>},</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemfile_filename[].subitem_systemfile_filename_uri",</p>
<p>"title":"SYSTEMFILE Filename URI",</p>
<p>"type":"text"</p>
<p>}</p>
<p>],</p>
<p>"key":"parentkey.subitem_systemfile_filename",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"SYSTEMFILE Filename"</p>
<p>},</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemfile_mimetype",</p>
<p>"title":"SYSTEMFILE MimeType",</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemfile_size",</p>
<p>"title":"SYSTEMFILE Size",</p>
<p>"type":"text"</p>
<p>},</p>
<p>{</p>
<p>"add":"New",</p>
<p>"items":[</p>
<p>{</p>
<p>"format":"yyyy-MM-dd",</p>
<p>"key":"parentkey.subitem_systemfile_datetime[].subitem_systemfile_datetime_date",</p>
<p>"templateUrl":"/static/templates/weko_deposit/datepicker.html",</p>
<p>"title":"SYSTEMFILE DateTime Date",</p>
<p>"type":"template"</p>
<p>},</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemfile_datetime[].subitem_systemfile_datetime_type",</p>
<p>"title":"SYSTEMFILE DateTime Type",</p>
<p>"titleMap":[</p>
<p>{</p>
<p>"name":"Accepted",</p>
<p>"value":"Accepted"</p>
<p>},</p>
<p>{</p>
<p>"name":"Available",</p>
<p>"value":"Available"</p>
<p>},</p>
<p>{</p>
<p>"name":"Collected",</p>
<p>"value":"Collected"</p>
<p>},</p>
<p>{</p>
<p>"name":"Copyrighted",</p>
<p>"value":"Copyrighted"</p>
<p>},</p>
<p>{</p>
<p>"name":"Created",</p>
<p>"value":"Created"</p>
<p>},</p>
<p>{</p>
<p>"name":"Issued",</p>
<p>"value":"Issued"</p>
<p>},</p>
<p>{</p>
<p>"name":"Submitted",</p>
<p>"value":"Submitted"</p>
<p>},</p>
<p>{</p>
<p>"name":"Updated",</p>
<p>"value":"Updated"</p>
<p>},</p>
<p>{</p>
<p>"name":"Valid",</p>
<p>"value":"Valid"</p>
<p>}</p>
<p>],</p>
<p>"type":"select"</p>
<p>}</p>
<p>],</p>
<p>"key":"parentkey.subitem_systemfile_datetime",</p>
<p>"style":{</p>
<p>"add":"btn-success"</p>
<p>},</p>
<p>"title":"SYSTEMFILE DateTime"</p>
<p>},</p>
<p>{</p>
<p>"key":"parentkey.subitem_systemfile_version",</p>
<p>"title":"SYSTEMFILE Version",</p>
<p>"type":"text"</p>
<p>}</p>
<p>],</p>
<p>"key":"system_file",</p>
<p>"title":"File Information",</p>
<p>"title_i18n":{</p>
<p>"en":"File Information",</p>
<p>"ja":"ファイル情報"</p>
<p>},</p>
<p>"type":"fieldset"</p>
<p>}</p>
<p>],</p>
<p>"mapping":{</p>
<p>"item_1617186331708":{</p>
<p>"display_lang_type":"",</p>
<p>"jpcoar_mapping":{</p>
<p>"title":{</p>
<p>"@attributes":{</p>
<p>"xml:lang":"subitem_1551255648112"</p>
<p>},</p>
<p>"@value":"subitem_1551255647225"</p>
<p>}</p>
<p>},</p>
<p>"jpcoar_v1_mapping":{</p>
<p>"title":{</p>
<p>"@attributes":{</p>
<p>"xml:lang":"subitem_1551255648112"</p>
<p>},</p>
<p>"@value":"subitem_1551255647225"</p>
<p>}</p>
<p>},</p>
<p>"junii2_mapping":"",</p>
<p>"lido_mapping":"",</p>
<p>"lom_mapping":"",</p>
<p>"oai_dc_mapping":{</p>
<p>"title":{</p>
<p>"@value":"subitem_1551255647225"</p>
<p>}</p>
<p>},</p>
<p>"spase_mapping":""</p>
<p>},</p>
<p>"item_1617186419668":{</p>
<p>"display_lang_type":"",</p>
<p>"jpcoar_mapping":{</p>
<p>"creator":{</p>
<p>"affiliation":{</p>
<p>"affiliationName":{</p>
<p>"@attributes":{</p>
<p>"xml:lang":"creatorAffiliations.affiliationNames.affiliationNameLang"</p>
<p>},</p>
<p>"@value":"creatorAffiliations.affiliationNames.affiliationName"</p>
<p>},</p>
<p>"nameIdentifier":{</p>
<p>"@attributes":{</p>
<p>"nameIdentifierScheme":"creatorAffiliations.affiliationNameIdentifiers.affiliationNameIdentifierScheme",</p>
<p>"nameIdentifierURI":"creatorAffiliations.affiliationNameIdentifiers.affiliationNameIdentifierURI"</p>
<p>},</p>
<p>"@value":"creatorAffiliations.affiliationNameIdentifiers.affiliationNameIdentifier"</p>
<p>}</p>
<p>},</p>
<p>"creatorAlternative":{</p>
<p>"@attributes":{</p>
<p>"xml:lang":"creatorAlternatives.creatorAlternativeLang"</p>
<p>},</p>
<p>"@value":"creatorAlternatives.creatorAlternative"</p>
<p>},</p>
<p>"creatorName":{</p>
<p>"@attributes":{</p>
<p>"xml:lang":"creatorNames.creatorNameLang"</p>
<p>},</p>
<p>"@value":"creatorNames.creatorName"</p>
<p>},</p>
<p>"familyName":{</p>
<p>"@attributes":{</p>
<p>"xml:lang":"familyNames.familyNameLang"</p>
<p>},</p>
<p>"@value":"familyNames.familyName"</p>
<p>},</p>
<p>"givenName":{</p>
<p>"@attributes":{</p>
<p>"xml:lang":"givenNames.givenNameLang"</p>
<p>},</p>
<p>"@value":"givenNames.givenName"</p>
<p>},</p>
<p>"nameIdentifier":{</p>
<p>"@attributes":{</p>
<p>"nameIdentifierScheme":"nameIdentifiers.nameIdentifierScheme",</p>
<p>"nameIdentifierURI":"nameIdentifiers.nameIdentifierURI"</p>
<p>},</p>
<p>"@value":"nameIdentifiers.nameIdentifier"</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>"jpcoar_v1_mapping":{</p>
<p>"creator":{</p>
<p>"affiliation":{</p>
<p>"affiliationName":{</p>
<p>"@attributes":{</p>
<p>"xml:lang":"creatorAffiliations.affiliationNames.affiliationNameLang"</p>
<p>},</p>
<p>"@value":"creatorAffiliations.affiliationNames.affiliationName"</p>
<p>},</p>
<p>"nameIdentifier":{</p>
<p>"@attributes":{</p>
<p>"nameIdentifierScheme":"creatorAffiliations.affiliationNameIdentifiers.affiliationNameIdentifierScheme",</p>
<p>"nameIdentifierURI":"creatorAffiliations.affiliationNameIdentifiers.affiliationNameIdentifierURI"</p>
<p>},</p>
<p>"@value":"creatorAffiliations.affiliationNameIdentifiers.affiliationNameIdentifier"</p>
<p>}</p>
<p>},</p>
<p>"creatorAlternative":{</p>
<p>"@attributes":{</p>
<p>"xml:lang":"creatorAlternatives.creatorAlternativeLang"</p>
<p>},</p>
<p>"@value":"creatorAlternatives.creatorAlternative"</p>
<p>},</p>
<p>"creatorName":{</p>
<p>"@attributes":{</p>
<p>"xml:lang":"creatorNames.creatorNameLang"</p>
<p>},</p>
<p>"@value":"creatorNames.creatorName"</p>
<p>},</p>
<p>"familyName":{</p>
<p>"@attributes":{</p>
<p>"xml:lang":"familyNames.familyNameLang"</p>
<p>},</p>
<p>"@value":"familyNames.familyName"</p>
<p>},</p>
<p>"givenName":{</p>
<p>"@attributes":{</p>
<p>"xml:lang":"givenNames.givenNameLang"</p>
<p>},</p>
<p>"@value":"givenNames.givenName"</p>
<p>},</p>
<p>"nameIdentifier":{</p>
<p>"@attributes":{</p>
<p>"nameIdentifierScheme":"nameIdentifiers.nameIdentifierScheme",</p>
<p>"nameIdentifierURI":"nameIdentifiers.nameIdentifierURI"</p>
<p>},</p>
<p>"@value":"nameIdentifiers.nameIdentifier"</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>"junii2_mapping":"",</p>
<p>"lido_mapping":"",</p>
<p>"lom_mapping":"",</p>
<p>"oai_dc_mapping":{</p>
<p>"creator":{</p>
<p>"@value":"creatorNames.creatorName,nameIdentifiers.nameIdentifier"</p>
<p>}</p>
<p>},</p>
<p>"spase_mapping":""</p>
<p>},</p>
<p>"item_1617258105262":{</p>
<p>"display_lang_type":"",</p>
<p>"jpcoar_mapping":{</p>
<p>"type":{</p>
<p>"@attributes":{</p>
<p>"rdf:resource":"resourceuri"</p>
<p>},</p>
<p>"@value":"resourcetype"</p>
<p>}</p>
<p>},</p>
<p>"jpcoar_v1_mapping":{</p>
<p>"type":{</p>
<p>"@attributes":{</p>
<p>"rdf:resource":"resourceuri"</p>
<p>},</p>
<p>"@value":"resourcetype"</p>
<p>}</p>
<p>},</p>
<p>"junii2_mapping":"",</p>
<p>"lido_mapping":"",</p>
<p>"lom_mapping":"",</p>
<p>"oai_dc_mapping":{</p>
<p>"description":{</p>
<p>"@value":"resourceuri"</p>
<p>}</p>
<p>},</p>
<p>"spase_mapping":""</p>
<p>},</p>
<p>"item_1617605131499":{</p>
<p>"display_lang_type":"",</p>
<p>"jpcoar_mapping":{</p>
<p>"file":{</p>
<p>"URI":{</p>
<p>"@attributes":{</p>
<p>"label":"url.label",</p>
<p>"objectType":"url.objectType"</p>
<p>},</p>
<p>"@value":"url.url"</p>
<p>},</p>
<p>"date":{</p>
<p>"@attributes":{</p>
<p>"dateType":"fileDate.fileDateType"</p>
<p>},</p>
<p>"@value":"fileDate.fileDateValue"</p>
<p>},</p>
<p>"extent":{</p>
<p>"@value":"filesize.value"</p>
<p>},</p>
<p>"mimeType":{</p>
<p>"@value":"format"</p>
<p>},</p>
<p>"version":{</p>
<p>"@value":"version"</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>"jpcoar_v1_mapping":{</p>
<p>"file":{</p>
<p>"URI":{</p>
<p>"@attributes":{</p>
<p>"label":"url.label",</p>
<p>"objectType":"url.objectType"</p>
<p>},</p>
<p>"@value":"url.url"</p>
<p>},</p>
<p>"date":{</p>
<p>"@attributes":{</p>
<p>"dateType":"fileDate.fileDateType"</p>
<p>},</p>
<p>"@value":"fileDate.fileDateValue"</p>
<p>},</p>
<p>"extent":{</p>
<p>"@value":"filesize.value"</p>
<p>},</p>
<p>"mimeType":{</p>
<p>"@value":"format"</p>
<p>},</p>
<p>"version":{</p>
<p>"@value":"version"</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>"junii2_mapping":"",</p>
<p>"lido_mapping":"",</p>
<p>"lom_mapping":"",</p>
<p>"oai_dc_mapping":"",</p>
<p>"spase_mapping":""</p>
<p>},</p>
<p>"pubdate":{</p>
<p>"display_lang_type":"",</p>
<p>"jpcoar_mapping":"",</p>
<p>"jpcoar_v1_mapping":"",</p>
<p>"junii2_mapping":"",</p>
<p>"lido_mapping":"",</p>
<p>"lom_mapping":"",</p>
<p>"oai_dc_mapping":"",</p>
<p>"spase_mapping":""</p>
<p>},</p>
<p>"system_file":{</p>
<p>"display_lang_type":"",</p>
<p>"jpcoar_mapping":{</p>
<p>"system_file":{</p>
<p>"URI":{</p>
<p>"@attributes":{</p>
<p>"label":"subitem_systemfile_filename_label",</p>
<p>"objectType":"subitem_systemfile_filename_type"</p>
<p>},</p>
<p>"@value":"subitem_systemfile_filename_uri"</p>
<p>},</p>
<p>"date":{</p>
<p>"@attributes":{</p>
<p>"dateType":"subitem_systemfile_datetime_type"</p>
<p>},</p>
<p>"@value":"subitem_systemfile_datetime_date"</p>
<p>},</p>
<p>"extent":{</p>
<p>"@value":"subitem_systemfile_size"</p>
<p>},</p>
<p>"mimeType":{</p>
<p>"@value":"subitem_systemfile_mimetype"</p>
<p>},</p>
<p>"version":{</p>
<p>"@value":"subitem_systemfile_version"</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>"jpcoar_v1_mapping":{</p>
<p>"system_file":{</p>
<p>"URI":{</p>
<p>"@attributes":{</p>
<p>"label":"subitem_systemfile_filename_label",</p>
<p>"objectType":"subitem_systemfile_filename_type"</p>
<p>},</p>
<p>"@value":"subitem_systemfile_filename_uri"</p>
<p>},</p>
<p>"date":{</p>
<p>"@attributes":{</p>
<p>"dateType":"subitem_systemfile_datetime_type"</p>
<p>},</p>
<p>"@value":"subitem_systemfile_datetime_date"</p>
<p>},</p>
<p>"extent":{</p>
<p>"@value":"subitem_systemfile_size"</p>
<p>},</p>
<p>"mimeType":{</p>
<p>"@value":"subitem_systemfile_mimetype"</p>
<p>},</p>
<p>"version":{</p>
<p>"@value":"subitem_systemfile_version"</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>"junii2_mapping":"",</p>
<p>"lido_mapping":"",</p>
<p>"lom_mapping":"",</p>
<p>"oai_dc_mapping":"",</p>
<p>"spase_mapping":""</p>
<p>},</p>
<p>"system_identifier_doi":{</p>
<p>"display_lang_type":"",</p>
<p>"jpcoar_mapping":{</p>
<p>"identifier":{</p>
<p>"@attributes":{</p>
<p>"identifierType":"subitem_systemidt_identifier_type"</p>
<p>},</p>
<p>"@value":"subitem_systemidt_identifier"</p>
<p>}</p>
<p>},</p>
<p>"jpcoar_v1_mapping":{</p>
<p>"identifier":{</p>
<p>"@attributes":{</p>
<p>"identifierType":"subitem_systemidt_identifier_type"</p>
<p>},</p>
<p>"@value":"subitem_systemidt_identifier"</p>
<p>}</p>
<p>},</p>
<p>"junii2_mapping":"",</p>
<p>"lido_mapping":"",</p>
<p>"lom_mapping":"",</p>
<p>"oai_dc_mapping":"",</p>
<p>"spase_mapping":""</p>
<p>},</p>
<p>"system_identifier_hdl":{</p>
<p>"display_lang_type":"",</p>
<p>"jpcoar_mapping":{</p>
<p>"identifier":{</p>
<p>"@attributes":{</p>
<p>"identifierType":"subitem_systemidt_identifier_type"</p>
<p>},</p>
<p>"@value":"subitem_systemidt_identifier"</p>
<p>}</p>
<p>},</p>
<p>"jpcoar_v1_mapping":{</p>
<p>"identifier":{</p>
<p>"@attributes":{</p>
<p>"identifierType":"subitem_systemidt_identifier_type"</p>
<p>},</p>
<p>"@value":"subitem_systemidt_identifier"</p>
<p>}</p>
<p>},</p>
<p>"junii2_mapping":"",</p>
<p>"lido_mapping":"",</p>
<p>"lom_mapping":"",</p>
<p>"oai_dc_mapping":"",</p>
<p>"spase_mapping":""</p>
<p>},</p>
<p>"system_identifier_uri":{</p>
<p>"display_lang_type":"",</p>
<p>"jpcoar_mapping":{</p>
<p>"identifier":{</p>
<p>"@attributes":{</p>
<p>"identifierType":"subitem_systemidt_identifier_type"</p>
<p>},</p>
<p>"@value":"subitem_systemidt_identifier"</p>
<p>}</p>
<p>},</p>
<p>"jpcoar_v1_mapping":{</p>
<p>"identifier":{</p>
<p>"@attributes":{</p>
<p>"identifierType":"subitem_systemidt_identifier_type"</p>
<p>},</p>
<p>"@value":"subitem_systemidt_identifier"</p>
<p>}</p>
<p>},</p>
<p>"junii2_mapping":"",</p>
<p>"lido_mapping":"",</p>
<p>"lom_mapping":"",</p>
<p>"oai_dc_mapping":"",</p>
<p>"spase_mapping":""</p>
<p>}</p>
<p>},</p>
<p>"name":"copy",</p>
<p>"schema":{</p>
<p>"$schema":"http://json-schema.org/draft-04/schema#",</p>
<p>"description":"",</p>
<p>"properties":{</p>
<p>"item_1617186331708":{</p>
<p>"items":{</p>
<p>"properties":{</p>
<p>"subitem_1551255647225":{</p>
<p>"format":"text",</p>
<p>"title":"Title",</p>
<p>"title_i18n":{</p>
<p>"en":"Title",</p>
<p>"ja":"タイトル"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"subitem_1551255648112":{</p>
<p>"currentEnum":[</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"Language",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"maxItems":"9999",</p>
<p>"minItems":"1",</p>
<p>"title":"Title",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"item_1617186419668":{</p>
<p>"items":{</p>
<p>"properties":{</p>
<p>"creatorAffiliations":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"affiliationNameIdentifiers":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"affiliationNameIdentifier":{</p>
<p>"format":"text",</p>
<p>"title":"所属機関識別子",</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name Identifier",</p>
<p>"ja":"所属機関識別子"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"affiliationNameIdentifierScheme":{</p>
<p>"currentEnum":[</p>
<p>"kakenhi",</p>
<p>"ISNI",</p>
<p>"Ringgold",</p>
<p>"GRID"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"kakenhi",</p>
<p>"ISNI",</p>
<p>"Ringgold",</p>
<p>"GRID"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"所属機関識別子スキーマ",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"affiliationNameIdentifierURI":{</p>
<p>"format":"text",</p>
<p>"title":"所属機関識別子URI",</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name Identifier URI",</p>
<p>"ja":"所属機関識別子URI"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"所属機関識別子",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"affiliationNames":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"affiliationName":{</p>
<p>"format":"text",</p>
<p>"title":"所属機関名",</p>
<p>"title_i18n":{</p>
<p>"en":"Affiliation Name",</p>
<p>"ja":"所属機関名"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"affiliationNameLang":{</p>
<p>"currentEnum":[</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"言語",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"所属機関名",</p>
<p>"type":"array"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者所属",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"creatorAlternatives":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"creatorAlternative":{</p>
<p>"format":"text",</p>
<p>"title":"別名",</p>
<p>"title_i18n":{</p>
<p>"en":"Alternative Name",</p>
<p>"ja":"別名"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"creatorAlternativeLang":{</p>
<p>"currentEnum":[</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"言語",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者別名",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"creatorMails":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"creatorMail":{</p>
<p>"format":"text",</p>
<p>"title":"メールアドレス",</p>
<p>"title_i18n":{</p>
<p>"en":"Email Address",</p>
<p>"ja":"メールアドレス"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者メールアドレス",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"creatorNames":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"creatorName":{</p>
<p>"format":"text",</p>
<p>"title":"姓名",</p>
<p>"title_i18n":{</p>
<p>"en":"Name",</p>
<p>"ja":"姓名"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"creatorNameLang":{</p>
<p>"currentEnum":[</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"言語",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者姓名",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"familyNames":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"familyName":{</p>
<p>"format":"text",</p>
<p>"title":"姓",</p>
<p>"title_i18n":{</p>
<p>"en":"Family Name",</p>
<p>"ja":"姓"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"familyNameLang":{</p>
<p>"currentEnum":[</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"言語",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者姓",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"givenNames":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"givenName":{</p>
<p>"format":"text",</p>
<p>"title":"名",</p>
<p>"title_i18n":{</p>
<p>"en":"Given Name",</p>
<p>"ja":"名"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"givenNameLang":{</p>
<p>"currentEnum":[</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"ja",</p>
<p>"ja-Kana",</p>
<p>"ja-Latn",</p>
<p>"en",</p>
<p>"fr",</p>
<p>"it",</p>
<p>"de",</p>
<p>"es",</p>
<p>"zh-cn",</p>
<p>"zh-tw",</p>
<p>"ru",</p>
<p>"la",</p>
<p>"ms",</p>
<p>"eo",</p>
<p>"ar",</p>
<p>"el",</p>
<p>"ko"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"言語",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者名",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"iscreator":{</p>
<p>"format":"text",</p>
<p>"title":"iscreator",</p>
<p>"title_i18n":{</p>
<p>"en":"",</p>
<p>"ja":""</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"nameIdentifiers":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"nameIdentifier":{</p>
<p>"format":"text",</p>
<p>"title":"作成者識別子",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Identifier",</p>
<p>"ja":"作成者識別子"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"nameIdentifierScheme":{</p>
<p>"currentEnum":[</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"作成者識別子Scheme",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"nameIdentifierURI":{</p>
<p>"format":"text",</p>
<p>"title":"作成者識別子URI",</p>
<p>"title_i18n":{</p>
<p>"en":"Creator Identifier URI",</p>
<p>"ja":"作成者識別子URI"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"作成者識別子",</p>
<p>"type":"array"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"maxItems":"9999",</p>
<p>"minItems":"1",</p>
<p>"title":"Creator",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"item_1617258105262":{</p>
<p>"properties":{</p>
<p>"resourcetype":{</p>
<p>"currentEnum":[</p>
<p>"conference paper",</p>
<p>"data paper",</p>
<p>"departmental bulletin paper",</p>
<p>"editorial",</p>
<p>"journal article",</p>
<p>"newspaper",</p>
<p>"periodical",</p>
<p>"review article",</p>
<p>"software paper",</p>
<p>"article",</p>
<p>"book",</p>
<p>"book part",</p>
<p>"cartographic material",</p>
<p>"map",</p>
<p>"conference object",</p>
<p>"conference proceedings",</p>
<p>"conference poster",</p>
<p>"aggregated data",</p>
<p>"clinical trial data",</p>
<p>"compiled data",</p>
<p>"encoded data",</p>
<p>"experimental data",</p>
<p>"genomic data",</p>
<p>"geospatial data",</p>
<p>"laboratory notebook",</p>
<p>"measurement and test data",</p>
<p>"observational data",</p>
<p>"recorded data",</p>
<p>"simulation data",</p>
<p>"survey data",</p>
<p>"dataset",</p>
<p>"interview",</p>
<p>"image",</p>
<p>"still image",</p>
<p>"moving image",</p>
<p>"video",</p>
<p>"lecture",</p>
<p>"patent",</p>
<p>"internal report",</p>
<p>"report",</p>
<p>"research report",</p>
<p>"technical report",</p>
<p>"policy report",</p>
<p>"report part",</p>
<p>"working paper",</p>
<p>"data management plan",</p>
<p>"sound",</p>
<p>"thesis",</p>
<p>"bachelor thesis",</p>
<p>"master thesis",</p>
<p>"doctoral thesis",</p>
<p>"interactive resource",</p>
<p>"learning object",</p>
<p>"manuscript",</p>
<p>"musical notation",</p>
<p>"research proposal",</p>
<p>"software",</p>
<p>"technical documentation",</p>
<p>"workflow",</p>
<p>"other"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"conference paper",</p>
<p>"data paper",</p>
<p>"departmental bulletin paper",</p>
<p>"editorial",</p>
<p>"journal article",</p>
<p>"newspaper",</p>
<p>"periodical",</p>
<p>"review article",</p>
<p>"software paper",</p>
<p>"article",</p>
<p>"book",</p>
<p>"book part",</p>
<p>"cartographic material",</p>
<p>"map",</p>
<p>"conference object",</p>
<p>"conference proceedings",</p>
<p>"conference poster",</p>
<p>"aggregated data",</p>
<p>"clinical trial data",</p>
<p>"compiled data",</p>
<p>"encoded data",</p>
<p>"experimental data",</p>
<p>"genomic data",</p>
<p>"geospatial data",</p>
<p>"laboratory notebook",</p>
<p>"measurement and test data",</p>
<p>"observational data",</p>
<p>"recorded data",</p>
<p>"simulation data",</p>
<p>"survey data",</p>
<p>"dataset",</p>
<p>"interview",</p>
<p>"image",</p>
<p>"still image",</p>
<p>"moving image",</p>
<p>"video",</p>
<p>"lecture",</p>
<p>"patent",</p>
<p>"internal report",</p>
<p>"report",</p>
<p>"research report",</p>
<p>"technical report",</p>
<p>"policy report",</p>
<p>"report part",</p>
<p>"working paper",</p>
<p>"data management plan",</p>
<p>"sound",</p>
<p>"thesis",</p>
<p>"bachelor thesis",</p>
<p>"master thesis",</p>
<p>"doctoral thesis",</p>
<p>"interactive resource",</p>
<p>"learning object",</p>
<p>"manuscript",</p>
<p>"musical notation",</p>
<p>"research proposal",</p>
<p>"software",</p>
<p>"technical documentation",</p>
<p>"workflow",</p>
<p>"other"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"資源タイプ",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"resourceuri":{</p>
<p>"format":"text",</p>
<p>"title":"資源タイプ識別子",</p>
<p>"title_i18n":{</p>
<p>"en":"Resource Type Identifier",</p>
<p>"ja":"資源タイプ識別子"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"title":"Resource Type",</p>
<p>"type":"object"</p>
<p>},</p>
<p>"item_1617605131499":{</p>
<p>"items":{</p>
<p>"properties":{</p>
<p>"accessrole":{</p>
<p>"enum":[</p>
<p>"open_access",</p>
<p>"open_date",</p>
<p>"open_login",</p>
<p>"open_no"</p>
<p>],</p>
<p>"format":"radios",</p>
<p>"title":"アクセス",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"date":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"dateType":{</p>
<p>"currentEnum":[</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"日付タイプ",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"dateValue":{</p>
<p>"format":"datetime",</p>
<p>"title":"日付",</p>
<p>"title_i18n":{</p>
<p>"en":"",</p>
<p>"ja":""</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"オープンアクセスの日付",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"displaytype":{</p>
<p>"currentEnum":[</p>
<p>"detail",</p>
<p>"simple",</p>
<p>"preview"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"detail",</p>
<p>"simple",</p>
<p>"preview"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"表示形式",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"fileDate":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"fileDateType":{</p>
<p>"currentEnum":[</p>
<p>"Accepted",</p>
<p>"Collected",</p>
<p>"Copyrighted",</p>
<p>"Created",</p>
<p>"Issued",</p>
<p>"Submitted",</p>
<p>"Updated",</p>
<p>"Valid"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"Accepted",</p>
<p>"Collected",</p>
<p>"Copyrighted",</p>
<p>"Created",</p>
<p>"Issued",</p>
<p>"Submitted",</p>
<p>"Updated",</p>
<p>"Valid"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"日付タイプ",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"fileDateValue":{</p>
<p>"format":"datetime",</p>
<p>"title":"日付",</p>
<p>"title_i18n":{</p>
<p>"en":"Date",</p>
<p>"ja":"日付"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"日付",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"filename":{</p>
<p>"format":"text",</p>
<p>"title":"表示名",</p>
<p>"title_i18n":{</p>
<p>"en":"FileName",</p>
<p>"ja":"表示名"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"filesize":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"value":{</p>
<p>"format":"text",</p>
<p>"title":"サイズ",</p>
<p>"title_i18n":{</p>
<p>"en":"Size",</p>
<p>"ja":"サイズ"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"サイズ",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"format":{</p>
<p>"format":"text",</p>
<p>"title":"フォーマット",</p>
<p>"title_i18n":{</p>
<p>"en":"Format",</p>
<p>"ja":"フォーマット"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"groups":{</p>
<p>"currentEnum":[</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"グループ",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"licensefree":{</p>
<p>"format":"textarea",</p>
<p>"title":"自由ライセンス",</p>
<p>"title_i18n":{</p>
<p>"en":"自由ライセンス",</p>
<p>"ja":"自由ライセンス"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"licensetype":{</p>
<p>"currentEnum":[</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"ライセンス",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"url":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"label":{</p>
<p>"format":"text",</p>
<p>"title":"ラベル",</p>
<p>"title_i18n":{</p>
<p>"en":"Label",</p>
<p>"ja":"ラベル"</p>
<p>},</p>
<p>"type":"string"</p>
<p>},</p>
<p>"objectType":{</p>
<p>"currentEnum":[</p>
<p>"abstract",</p>
<p>"summary",</p>
<p>"fulltext",</p>
<p>"thumbnail",</p>
<p>"other"</p>
<p>],</p>
<p>"enum":[</p>
<p>null,</p>
<p>"abstract",</p>
<p>"summary",</p>
<p>"fulltext",</p>
<p>"thumbnail",</p>
<p>"other"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"オブジェクトタイプ",</p>
<p>"type":[</p>
<p>"null",</p>
<p>"string"</p>
<p>]</p>
<p>},</p>
<p>"url":{</p>
<p>"format":"text",</p>
<p>"title":"本文URL",</p>
<p>"title_i18n":{</p>
<p>"en":"Text URL",</p>
<p>"ja":"本文URL"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"title":"本文URL",</p>
<p>"type":"object"</p>
<p>},</p>
<p>"version":{</p>
<p>"format":"text",</p>
<p>"title":"バージョン情報",</p>
<p>"title_i18n":{</p>
<p>"en":"Version Information",</p>
<p>"ja":"バージョン情報"</p>
<p>},</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"maxItems":"9999",</p>
<p>"minItems":"1",</p>
<p>"title":"File",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"pubdate":{</p>
<p>"format":"datetime",</p>
<p>"title":"PubDate",</p>
<p>"type":"string"</p>
<p>},</p>
<p>"system_file":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"subitem_systemfile_datetime":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"subitem_systemfile_datetime_date":{</p>
<p>"format":"datetime",</p>
<p>"title":"SYSTEMFILE DateTime Date",</p>
<p>"type":"string"</p>
<p>},</p>
<p>"subitem_systemfile_datetime_type":{</p>
<p>"enum":[</p>
<p>"Accepted",</p>
<p>"Available",</p>
<p>"Collected",</p>
<p>"Copyrighted",</p>
<p>"Created",</p>
<p>"Issued",</p>
<p>"Submitted",</p>
<p>"Updated",</p>
<p>"Valid"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"SYSTEMFILE DateTime Type",</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"SYSTEMFILE DateTime",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"subitem_systemfile_filename":{</p>
<p>"format":"array",</p>
<p>"items":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"subitem_systemfile_filename_label":{</p>
<p>"format":"text",</p>
<p>"title":"SYSTEMFILE Filename Label",</p>
<p>"type":"string"</p>
<p>},</p>
<p>"subitem_systemfile_filename_type":{</p>
<p>"enum":[</p>
<p>"Abstract",</p>
<p>"Fulltext",</p>
<p>"Summary",</p>
<p>"Thumbnail",</p>
<p>"Other"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"SYSTEMFILE Filename Type",</p>
<p>"type":"string"</p>
<p>},</p>
<p>"subitem_systemfile_filename_uri":{</p>
<p>"format":"text",</p>
<p>"title":"SYSTEMFILE Filename URI",</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"type":"object"</p>
<p>},</p>
<p>"title":"SYSTEMFILE Filename",</p>
<p>"type":"array"</p>
<p>},</p>
<p>"subitem_systemfile_mimetype":{</p>
<p>"format":"text",</p>
<p>"title":"SYSTEMFILE MimeType",</p>
<p>"type":"string"</p>
<p>},</p>
<p>"subitem_systemfile_size":{</p>
<p>"format":"text",</p>
<p>"title":"SYSTEMFILE Size",</p>
<p>"type":"string"</p>
<p>},</p>
<p>"subitem_systemfile_version":{</p>
<p>"format":"text",</p>
<p>"title":"SYSTEMFILE Version",</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"system_prop":true,</p>
<p>"title":"File Information",</p>
<p>"type":"object"</p>
<p>},</p>
<p>"system_identifier_doi":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"subitem_systemidt_identifier":{</p>
<p>"format":"text",</p>
<p>"title":"SYSTEMIDT Identifier",</p>
<p>"type":"string"</p>
<p>},</p>
<p>"subitem_systemidt_identifier_type":{</p>
<p>"enum":[</p>
<p>"DOI",</p>
<p>"HDL",</p>
<p>"URI"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"SYSTEMIDT Identifier Type",</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"system_prop":true,</p>
<p>"title":"Persistent Identifier(DOI)",</p>
<p>"type":"object"</p>
<p>},</p>
<p>"system_identifier_hdl":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"subitem_systemidt_identifier":{</p>
<p>"format":"text",</p>
<p>"title":"SYSTEMIDT Identifier",</p>
<p>"type":"string"</p>
<p>},</p>
<p>"subitem_systemidt_identifier_type":{</p>
<p>"enum":[</p>
<p>"DOI",</p>
<p>"HDL",</p>
<p>"URI"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"SYSTEMIDT Identifier Type",</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"system_prop":true,</p>
<p>"title":"Persistent Identifier(HDL)",</p>
<p>"type":"object"</p>
<p>},</p>
<p>"system_identifier_uri":{</p>
<p>"format":"object",</p>
<p>"properties":{</p>
<p>"subitem_systemidt_identifier":{</p>
<p>"format":"text",</p>
<p>"title":"SYSTEMIDT Identifier",</p>
<p>"type":"string"</p>
<p>},</p>
<p>"subitem_systemidt_identifier_type":{</p>
<p>"enum":[</p>
<p>"DOI",</p>
<p>"HDL",</p>
<p>"URI"</p>
<p>],</p>
<p>"format":"select",</p>
<p>"title":"SYSTEMIDT Identifier Type",</p>
<p>"type":"string"</p>
<p>}</p>
<p>},</p>
<p>"system_prop":true,</p>
<p>"title":"Persistent Identifier(URI)",</p>
<p>"type":"object"</p>
<p>}</p>
<p>},</p>
<p>"required":[</p>
<p>"pubdate",</p>
<p>"item_1617186331708",</p>
<p>"item_1617258105262"</p>
<p>],</p>
<p>"type":"object"</p>
<p>}</p>
<p>},</p>
<p>"upload_file":false</p>
<p>}</p></td>
</tr>
</tbody>
</table>

  - 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

  - 機能内容

  - 関連モジュール

  - 処理概要

  - 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/11/14</p>
</blockquote></td>
<td>V0.9.27</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

# 

# データ構造

1.  ## アイテムタイプ
    
   
### Schema

  - > 目的・用途

他のウェブアプリがweko3のリソースにアクセスできるようAPI利用を承認することを目的としている。

  - > 利用方法

API-8-5の機能を用いて、OAuthアプリケーション、またはトークンを登録する。その後、設定された値を利用してAPI接続の設定を行う。

  - > 機能内容

/items/jsonschema/{item type id}

  - > 関連モジュール

<!-- end list -->

  - > Invenio\_oaiserver

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

## モジュール、ライブラリ

# その他

## モジュール、ライブラリ

利用モジュール、ライブラリは以下のとおり

  - invenioモジュール（<https://github.com/RCOSDP/weko/blob/hfix/packages-invenio.txt>）

  - wekoモジュール（<https://github.com/RCOSDP/weko/blob/v0.9.22/requirements-weko-modules.txt>）

  - パッケージ（<https://github.com/RCOSDP/weko/blob/v0.9.22/packages.txt>）

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

## コンフィグ

1.優先度

invenio.cfg(instans.cfg) \> config.py(各モジュール)

2.invenio.cfg

  - webコンテナビルド時にinstance.cfgから invenio.cfg([コンフィグ一覧](https://redmine.devops.rcos.nii.ac.jp/attachments/26751/invenio_cfg.xlsx) )が生成される。
    
      - instance.cfg: <https://github.com/RCOSDP/weko/blob/v0.9.22/scripts/instance.cfg>

  - 各configのパラメータについて、以下のパラメータが「invenio.cfg」にてオーバーライド可能である。

> TEMPLATES\_AUTO\_RELOAD
> 
> SQLALCHEMY\_DATABASE\_URI
> 
> SQLALCHEMY\_TRACK\_MODIFICATIONS
> 
> DB\_POOL\_CLASS
> 
> COLLECT\_STORAGE
> 
> INDEXER\_BULK\_REQUEST\_TIMEOUT
> 
> CACHE\_TYPE
> 
> CACHE\_REDIS\_HOST
> 
> CACHE\_REDIS\_URL
> 
> ACCOUNTS\_SESSION\_REDIS\_URL
> 
> BROKER\_URL
> 
> CELERY\_BROKER\_URL
> 
> CELERY\_RESULT\_BACKEND
> 
> CELERY\_BEAT\_SCHEDULE
> 
> SEARCH\_ELASTIC\_HOSTS
> 
> SEARCH\_INDEX\_PREFIX
> 
> JSONSCHEMAS\_ENDPOINT
> 
> JSONSCHEMAS\_HOST
> 
> OAISERVER\_REPOSITORY\_NAME
> 
> OAISERVER\_RECORD\_INDEX
> 
> OAISERVER\_ID\_PREFIX
> 
> APP\_DEFAULT\_SECURE\_HEADERS
> 
> SESSION\_COOKIE\_DOMAIN
> 
> SESSION\_COOKIE\_SAMESITE
> 
> SESSION\_COOKIE\_SECURE
> 
> BABEL\_DEFAULT\_LOCALE
> 
> BABEL\_DEFAULT\_LANGUAGE
> 
> I18N\_LANGUAGES
> 
> I18N\_TRANSLATIONS\_PATHS
> 
> SECURITY\_EMAIL\_SENDER
> 
> THEME\_MATHJAX\_CDN
> 
> FILES\_REST\_STORAGE\_FACTORY
> 
> S3\_ACCCESS\_KEY\_ID
> 
> S3\_SECRECT\_ACCESS\_KEY
> 
> S3\_SEND\_FILE\_DIRECTLY
> 
> S3\_ENDPOINT\_URL
> 
> FILES\_REST\_LOCATION\_TYPE\_LIST
> 
> WEKO\_JUPYTERHUB\_ENABLE
> 
> WEKO\_JUPYTERHUB\_URL
> 
> THEME\_SITENAME
> 
> THEME\_SITEURL
> 
> WEKO\_RECORDS\_UI\_LICENSE\_ICON\_LOCATION
> 
> WEKO\_RECORDS\_UI\_LICENSE\_ICON\_PDF\_LOCATION
> 
> WEKO\_RECORDS\_UI\_LICENSE\_DICT
> 
> WEKO\_ACCOUNTS\_SHIB\_LOGIN\_ENABLED
> 
> WEKO\_ACCOUNTS\_SHIB\_IDP\_LOGIN\_URL
> 
> WEKO\_ACCOUNTS\_SSO\_ATTRIBUTE\_MAP
> 
> WEKO\_ACCOUNTS\_SHIB\_IDP\_LOGIN\_ENABLED
> 
> WEKO\_ACCOUNTS\_SHIB\_DP\_LOGIN\_DIRECTLY\_ENABLED
> 
> WEKO\_ACCOUNTS\_SHIB\_INST\_LOGIN\_DIRECTLY\_ENABLED
> 
> WEKO\_ITEMTYPES\_UI\_UPGRADE\_VERSION\_ENABLED
> 
> WEKO\_WORKFLOW\_MAIL\_TEMPLATE\_FOLDER\_PATH
> 
> WEKO\_WORKFLOW\_ACCESS\_ACTIVITY\_URL
> 
> WEKO\_WORKFLOW\_USAGE\_REPORT\_ACTIVITY\_URL
> 
> WEKO\_WORKFLOW\_APPROVE\_DONE
> 
> WEKO\_WORKFLOW\_APPROVE\_REJECTED
> 
> WEKO\_WORKFLOW\_REQUEST\_APPROVAL
> 
> WEKO\_WORKFLOW\_REQUEST\_FOR\_REGISTER\_USAGE\_REPORT
> 
> WEKO\_WORKFLOW\_USAGE\_REPORT\_WORKFLOW\_NAME
> 
> WEKO\_RECORDS\_UI\_SECRET\_KEY
> 
> WEKO\_ITEMS\_UI\_HIDE\_AUTO\_FILL\_METADATA

3.config.py

<table>
<thead>
<tr class="header">
<th><blockquote>
<p>モジュール</p>
</blockquote></th>
<th>configuration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>invenio-accounts</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-accounts/invenio_accounts/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-accounts/invenio_accounts/config.py</a></td>
</tr>
<tr class="even">
<td>invenio-communities</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-communities/invenio_communities/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-communities/invenio_communities/config.py</a></td>
</tr>
<tr class="odd">
<td>invenio-db</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-db/invenio_db/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-db/invenio_db/config.py</a></td>
</tr>
<tr class="even">
<td>invenio-deposit</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-deposit/invenio_deposit/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-deposit/invenio_deposit/config.py</a></td>
</tr>
<tr class="odd">
<td>invenio-files-rest</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-files-rest/invenio_files_rest/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-files-rest/invenio_files_rest/config.py</a></td>
</tr>
<tr class="even">
<td>invenio-iiif</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-iiif/invenio_iiif/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-iiif/invenio_iiif/config.py</a></td>
</tr>
<tr class="odd">
<td>invenio-indexer</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-indexer/invenio_indexer/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-indexer/invenio_indexer/config.py</a></td>
</tr>
<tr class="even">
<td>invenio-mail</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-mail/invenio_mail/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-mail/invenio_mail/config.py</a></td>
</tr>
<tr class="odd">
<td>invenio-oaiharvester</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-oaiharvester/invenio_oaiharvester/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-oaiharvester/invenio_oaiharvester/config.py</a></td>
</tr>
<tr class="even">
<td>invenio-oaiserver</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-oaiserver/invenio_oaiserver/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-oaiserver/invenio_oaiserver/config.py</a></td>
</tr>
<tr class="odd">
<td>invenio-oauth2server</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-oauth2server/invenio_oauth2server/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-oauth2server/invenio_oauth2server/config.py</a></td>
</tr>
<tr class="even">
<td>invenio-previewer</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-previewer/invenio_previewer/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-previewer/invenio_previewer/config.py</a></td>
</tr>
<tr class="odd">
<td>invenio-queues</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-queues/invenio_queues/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-queues/invenio_queues/config.py</a></td>
</tr>
<tr class="even">
<td>invenio-records</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-records/invenio_records/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-records/invenio_records/config.py</a></td>
</tr>
<tr class="odd">
<td>invenio-records-rest</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-records-rest/invenio_records_rest/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-records-rest/invenio_records_rest/config.py</a></td>
</tr>
<tr class="even">
<td>invenio-resourcesyncclient</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-resourcesyncclient/invenio_resourcesyncclient/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-resourcesyncclient/invenio_resourcesyncclient/config.py</a></td>
</tr>
<tr class="odd">
<td>invenio-resourcesyncserver</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-resourcesyncserver/invenio_resourcesyncserver/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-resourcesyncserver/invenio_resourcesyncserver/config.py</a></td>
</tr>
<tr class="even">
<td>invenio-s3</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-s3/invenio_s3/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-s3/invenio_s3/config.py</a></td>
</tr>
<tr class="odd">
<td>invenio-stats</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-stats/invenio_stats/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/invenio-stats/invenio_stats/config.py</a></td>
</tr>
<tr class="even">
<td>weko-accounts</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-accounts/weko_accounts/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-accounts/weko_accounts/config.py</a></td>
</tr>
<tr class="odd">
<td>weko-admin</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-admin/weko_admin/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-admin/weko_admin/config.py</a></td>
</tr>
<tr class="even">
<td>weko-authors</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-authors/weko_authors/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-authors/weko_authors/config.py</a></td>
</tr>
<tr class="odd">
<td>weko-bulkupdate</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-bulkupdate/weko_bulkupdate/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-bulkupdate/weko_bulkupdate/config.py</a></td>
</tr>
<tr class="even">
<td>weko-deposit</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-deposit/weko_deposit/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-deposit/weko_deposit/config.py</a></td>
</tr>
<tr class="odd">
<td>weko-gridlayout</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-gridlayout/weko_gridlayout/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-gridlayout/weko_gridlayout/config.py</a></td>
</tr>
<tr class="even">
<td>weko-groups</td>
<td>config.py無し</td>
</tr>
<tr class="odd">
<td>weko-handle</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-handle/weko_handle/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-handle/weko_handle/config.py</a></td>
</tr>
<tr class="even">
<td>weko-index-tree</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-index-tree/weko_index_tree/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-index-tree/weko_index_tree/config.py</a></td>
</tr>
<tr class="odd">
<td>weko-indextree-journal</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-indextree-journal/weko_indextree_journal/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-indextree-journal/weko_indextree_journal/config.py</a></td>
</tr>
<tr class="even">
<td>weko-items-autofill</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-items-autofill/weko_items_autofill/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-items-autofill/weko_items_autofill/config.py</a></td>
</tr>
<tr class="odd">
<td>weko-items-ui</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-items-ui/weko_items_ui/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-items-ui/weko_items_ui/config.py</a></td>
</tr>
<tr class="even">
<td>weko-itemtypes-ui</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-itemtypes-ui/weko_itemtypes_ui/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-itemtypes-ui/weko_itemtypes_ui/config.py</a></td>
</tr>
<tr class="odd">
<td>weko-logging</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-logging/weko_logging/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-logging/weko_logging/config.py</a></td>
</tr>
<tr class="even">
<td>weko-plugins</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-plugins/weko_plugins/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-plugins/weko_plugins/config.py</a></td>
</tr>
<tr class="odd">
<td>weko-records</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-records/weko_records/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-records/weko_records/config.py</a></td>
</tr>
<tr class="even">
<td>weko-records-ui</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-records-ui/weko_records_ui/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-records-ui/weko_records_ui/config.py</a></td>
</tr>
<tr class="odd">
<td>weko-redis</td>
<td>config.py無し</td>
</tr>
<tr class="even">
<td>weko-schema-ui</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-schema-ui/weko_schema_ui/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-schema-ui/weko_schema_ui/config.py</a></td>
</tr>
<tr class="odd">
<td>weko-search-ui</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-search-ui/weko_search_ui/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-search-ui/weko_search_ui/config.py</a></td>
</tr>
<tr class="even">
<td>weko-sitemap</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-sitemap/weko_sitemap/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-sitemap/weko_sitemap/config.py</a></td>
</tr>
<tr class="odd">
<td>weko-theme</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-theme/weko_theme/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-theme/weko_theme/config.py</a></td>
</tr>
<tr class="even">
<td>weko-user-profiles</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-user-profiles/weko_user_profiles/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-user-profiles/weko_user_profiles/config.py</a></td>
</tr>
<tr class="odd">
<td>weko-workflow</td>
<td><a href="https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-workflow/weko_workflow/config.py">https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-workflow/weko_workflow/config.py</a></td>
</tr>
</tbody>
</table>

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

## DB

  - 以下のテーブル定義書を参照。
    
      - <https://rcosms-my.sharepoint.com/:x:/g/personal/hayashi_rcosms_onmicrosoft_com/EWhQWKgVVz5Ji7mhWAopjkkBh7rlApLCcDcYCI1t9vPCgw?e=yghIXB>

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   



##   

## celery タスク

  - 定期実行するCeleryタスクはinstance.cfg(invenio.cfg)のCELERY\_BEAT\_SCHEDULE にて定義する。

> CELERY\_BEAT\_SCHEDULE = {
> 
> \# Stats
> 
> 'stats-process-events': {
> 
> 'task': 'invenio\_stats.tasks.process\_events',
> 
> 'schedule': timedelta(minutes=1),
> 
> 'args': \[('celery-task', 'item-create', 'top-view', 'record-view', 'file-download', 'file-preview', 'search')\],
> 
> },
> 
> 'stats-aggregate-events': {
> 
> 'task': 'invenio\_stats.tasks.aggregate\_events',
> 
> 'schedule': timedelta(days=1),
> 
> 'args': \[('celery-task-agg', 'file-download-agg', 'file-preview-agg', 'item-create-agg', 'record-view-agg', 'search-agg', 'top-view-agg')\],
> 
> },
> 
> \# WEKO-indextree-journal-export
> 
> 'indextree-journal-export-journal': {
> 
> 'task': 'weko\_indextree\_journal.tasks.export\_journal\_task',
> 
> 'schedule': timedelta(days=1),
> 
> 'args': \[('p\_path')\],
> 
> },
> 
> 'admin-send-report-emails': {
> 
> 'task': 'weko\_admin.tasks.check\_send\_all\_reports',
> 
> 'schedule': timedelta(days=1, minutes=0, hours=0),
> 
> 'args': \[\],
> 
> },
> 
> 'harvest-check-schedules': {
> 
> 'task': 'invenio\_oaiharvester.tasks.check\_schedules\_and\_run',
> 
> 'schedule': crontab(hour=0, minute=0, day\_of\_week='\*'),
> 
> 'args': \[\],
> 
> },
> 
> 'send-feedback-mail-schedules': {
> 
> 'task': 'weko\_admin.tasks.send\_feedback\_mail',
> 
> 'schedule': crontab(day\_of\_month='1', hour=0, minute=0),
> 
> 'args': \[\],
> 
> },
> 
> 'send\_storage\_alert\_mail': {
> 
> 'task': 'invenio\_files\_rest.tasks.check\_send\_alert\_mail',
> 
> 'schedule': timedelta(days=1, minutes=0, hours=0),
> 
> 'args': \[\],
> 
> },
> 
> 'send\_site\_access\_mail': {
> 
> 'task': 'weko\_admin.tasks.check\_send\_site\_access\_report',
> 
> 'schedule': timedelta(days=1, minutes=0, hours=0),
> 
> 'args': \[\],
> 
> },
> 
> 'remove\_preview\_pdf': {
> 
> 'task': 'invenio\_files\_rest.tasks.check\_file\_storage\_time',
> 
> 'schedule': timedelta(days=0, minutes=0, hours=1),
> 
> 'args': \[\],
> 
> },
> 
> 'update\_sitemap': {
> 
> 'task': 'weko\_sitemap.tasks.update\_sitemap',
> 
> 'schedule': timedelta(days=3, minutes=0, hours=0),
> 
> 'args': \[\],
> 
> },
> 
> 'resync': {
> 
> 'task': 'invenio\_resourcesyncclient.tasks.run\_sync\_auto',
> 
> 'schedule': crontab(hour=0, minute=0),
> 
> },
> 
> \# Execute cancel\_usage\_report\_activities daily at midnight
> 
> 'cancel\_usage\_report\_activities': {
> 
> 'task': 'weko\_workflow.tasks.cancel\_expired\_usage\_report\_activities',
> 
> 'schedule': crontab(minute=0, hour=0),
> 
> },
> 
> 'clean\_temp\_info': {
> 
> 'task': 'weko\_admin.tasks.clean\_temp\_info',
> 
> 'schedule': timedelta(hours=1),
> 
> 'args': \[\],
> 
> },
> 
> }

docker-compose -f docker-compose2.yml exec --user root web celery -A invenio_app.celery call weko_admin.tasks.send_feedback_mail
4f30e29f-f217-4103-8ddf-e7cd1159b36a

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

  - ###   

## ログ

  - > ログレベルの定義

| **レベル**  | **内容例**                      | **発生時に必要な対処例**                          |
| -------- | ---------------------------- | --------------------------------------- |
| CRITICAL | ・システムの継続運用が不可能なレベル           | ・発生時は24時間体制での初動が必要                      |
|          | ・ユーザーデータを破壊し続けるレベル           | ・24時間SMO/PMOへのエスカレーションが必要               |
| ERROR    | ・システムは継続運用可能だが特定の機能でエラーが発生   | ・営業時間外でもベストエフォートでの事象確認が必要               |
|          | ・ユーザーデータ破壊の可能性は低い            | ・営業時間外に発生した場合、詳細調査・対応・エスカレーションは翌営業時間に実施 |
| WARNING  | ・システムは継続運用可能かつエラーがあっても代替機能あり | ・営業時間内で事象を確認、対処方法を検討                    |
|          | ・ユーザーデータは破壊しない               |                                         |
| INFO     | ・システム稼動状況、非同期処理の開始終了状況など     | ・特に対処不要                                 |
|          | ・ユーザーオペレーションのイベントログ          | ・運用状況、ユーザー利用状況の確認などで定期的に集計              |
| DEBUG    | ・基本的に本番運用では出力しなくて良い情報。       | ・対処不要                                   |
|          | ・開発、運用テスト時に必要な情報             |                                         |

  - > ログ機能

<!-- end list -->

  - invenio-stats によるログ設定手順は、  
    別紙「Precedure\_of\_implementing\_file-download\_function\_V1.02.xlsx」を参照

  - CELERY SCHEDULE 設定  
    [https://github.com/RCOSDP/weko/blob/develop/scripts/instance.cfghttps://github.com/RCOSDP/weko/blob/v0.9.22/scripts/instance.cfg\#L70](https://github.com/RCOSDP/weko/blob/v0.9.22/scripts/instance.cfg#L70)  
    のCELERY\_BEAT\_SCHEDULE に、以下のように追加する

> CELERY\_BEAT\_SCHEDULE = {
> 
> \# Stats
> 
> 'stats-process-events': {
> 
> 'task': 'invenio\_stats.tasks.process\_events',
> 
> 'schedule': timedelta(minutes=1),
> 
> 'args': \[('celery-task', 'item-create', 'top-view', 'record-view', 'file-download', 'file-preview', 'search')\],
> 
> },

  - 各種ログはelasticsearchに格納されており、インデックスを指定して取得することができる
    
      - インデックスについては[その他-4: elasticsearch](#elasticsearch)を参照
    
      - 生データである「events-stats-{ログの種類}」から、統計情報「stats-{ログの種類}」を作成している

  - celery-task ログ
    
      - http://{Elasticsearch:port} /{stats-celery-task のインデックス}/\_search?pretty

> {
> 
> "took" : 6,
> 
> "timed\_out" : false,
> 
> "\_shards" : {
> 
> "total" : 5,
> 
> "successful" : 5,
> 
> "skipped" : 0,
> 
> "failed" : 0
> 
> },
> 
> "hits" : {
> 
> "total" : 1,
> 
> "max\_score" : 1.0,
> 
> "hits" : \[
> 
> {
> 
> "\_index" : "tenant1-stats-celery-task-000001",
> 
> "\_type" : "celery-task-day-aggregation",
> 
> "\_id" : "7b2c80be-4058-360f-a247-d228118032d2",
> 
> "\_score" : 1.0,
> 
> "\_source" : {
> 
> "timestamp" : "2023-05-10T00:00:00",
> 
> "unique\_id" : "7b2c80be-4058-360f-a247-d228118032d2",
> 
> "count" : 1,
> 
> "unique\_count" : 1,
> 
> "volume" : 0.0,
> 
> "task\_id" : "21c1fc79-9f16-4f5d-85d6-c556074a5db3",
> 
> "task\_name" : "harvest",
> 
> "task\_state" : "SUCCESS",
> 
> "start\_time" : "2023-05-10T09:36:35",
> 
> "end\_time" : "2023-05-10T00:36:37",
> 
> "total\_records" : 0,
> 
> "repository\_name" : "weko",
> 
> "execution\_time" : "-1 day, 15:00:02.734294"
> 
> }
> 
> }
> 
> \]
> 
> }
> 
> }

  - file-download ログ
    
      - http://{Elasticsearch:port} /{ stats-file-download のインデックス}/\_search?pretty

> {
> 
> "took" : 2,
> 
> "timed\_out" : false,
> 
> "\_shards" : {
> 
> "total" : 5,
> 
> "successful" : 5,
> 
> "skipped" : 0,
> 
> "failed" : 0
> 
> },
> 
> "hits" : {
> 
> "total" : 32,
> 
> "max\_score" : 1.0,
> 
> "hits" : \[
> 
> {
> 
> "\_index" : "tenant1-stats-file-download-000001",
> 
> "\_type" : "file-download-day-aggregation",
> 
> "\_id" : "b72c0fab-9215-3a8d-9ba1-bbae7162ea68",
> 
> "\_score" : 1.0,
> 
> "\_source" : {
> 
> "timestamp" : "2023-05-11T00:00:00",
> 
> "unique\_id" : "b72c0fab-9215-3a8d-9ba1-bbae7162ea68",
> 
> "count" : 1,
> 
> "unique\_count" : 1,
> 
> "volume" : 42786.0,
> 
> "country" : null,
> 
> "item\_id" : "4",
> 
> "item\_title" : "テストアイテム壱",
> 
> "file\_key" : "2.2.png",
> 
> "bucket\_id" : "c6202711-3af2-4ca1-943a-a14584b131a9",
> 
> "file\_id" : "fc178212-279a-49cd-ba8e-2ccbe8bc1a33",
> 
> "root\_file\_id" : "fc178212-279a-49cd-ba8e-2ccbe8bc1a33",
> 
> "accessrole" : "open\_access",
> 
> "userrole" : "System Administrator",
> 
> "index\_list" : "テストインデックス１",
> 
> "is\_billing\_item" : false,
> 
> "billing\_file\_price" : "",
> 
> "user\_group\_names" : "",
> 
> "site\_license\_name" : "",
> 
> "site\_license\_flag" : false,
> 
> "cur\_user\_id" : 1,
> 
> "hostname" : "None",
> 
> "remote\_addr" : "192.168.56.1"
> 
> }
> 
> },...
> 
> \]
> 
> }
> 
> }

  - file-preview ログ
    
      - http://{Elasticsearch:port} /{ stats- file-preview のインデックス}/\_search?pretty

> {
> 
> "took" : 1,
> 
> "timed\_out" : false,
> 
> "\_shards" : {
> 
> "total" : 5,
> 
> "successful" : 5,
> 
> "skipped" : 0,
> 
> "failed" : 0
> 
> },
> 
> "hits" : {
> 
> "total" : 1,
> 
> "max\_score" : 1.0,
> 
> "hits" : \[
> 
> {
> 
> "\_index" : "tenant1-stats-file-preview-000001",
> 
> "\_type" : "file-preview-day-aggregation",
> 
> "\_id" : "d665fc18-c050-3868-ae6f-45daaa06495d",
> 
> "\_score" : 1.0,
> 
> "\_source" : {
> 
> "timestamp" : "2023-07-15T00:00:00",
> 
> "unique\_id" : "d665fc18-c050-3868-ae6f-45daaa06495d",
> 
> "count" : 1,
> 
> "unique\_count" : 1,
> 
> "volume" : 42786.0,
> 
> "country" : null,
> 
> "item\_id" : "4",
> 
> "item\_title" : "テストアイテム壱",
> 
> "file\_key" : "2.2.png",
> 
> "bucket\_id" : "c88e1450-e3d2-4f33-8970-176f9d659410",
> 
> "file\_id" : "fc178212-279a-49cd-ba8e-2ccbe8bc1a33",
> 
> "root\_file\_id" : "fc178212-279a-49cd-ba8e-2ccbe8bc1a33",
> 
> "accessrole" : "open\_login",
> 
> "userrole" : "System Administrator",
> 
> "index\_list" : "テストインデックス１",
> 
> "is\_billing\_item" : false,
> 
> "billing\_file\_price" : "",
> 
> "user\_group\_names" : "テストグループ",
> 
> "site\_license\_name" : "",
> 
> "site\_license\_flag" : false,
> 
> "cur\_user\_id" : 1,
> 
> "hostname" : "None",
> 
> "remote\_addr" : "192.168.56.1"
> 
> }
> 
> }
> 
> \]
> 
> }
> 
> }

  - item-create ログ
    
      - http://{Elasticsearch:port} /{ stats-item-create のインデックス}/\_search?pretty

> {
> 
> "took" : 3,
> 
> "timed\_out" : false,
> 
> "\_shards" : {
> 
> "total" : 5,
> 
> "successful" : 5,
> 
> "skipped" : 0,
> 
> "failed" : 0
> 
> },
> 
> "hits" : {
> 
> "total" : 42,
> 
> "max\_score" : 1.0,
> 
> "hits" : \[
> 
> {
> 
> "\_index" : "tenant1-stats-item-create-000001",
> 
> "\_type" : "item-create-day-aggregation",
> 
> "\_id" : "item\_create\_11",
> 
> "\_score" : 1.0,
> 
> "\_source" : {
> 
> "timestamp" : "2023-06-09T00:00:00",
> 
> "unique\_id" : "item\_create\_11",
> 
> "count" : 1,
> 
> "unique\_count" : 1,
> 
> "country" : null,
> 
> "hostname" : "None",
> 
> "cur\_user\_id" : 1,
> 
> "remote\_addr" : "192.168.56.1",
> 
> "pid\_type" : "recid",
> 
> "pid\_value" : "11",
> 
> "record\_name" : ""
> 
> }
> 
> },...
> 
> \]
> 
> }
> 
> }

  - record-view ログ
    
      - http://{Elasticsearch:port} /{ stats-record-view のインデックス}/\_search?pretty

> {
> 
> "took" : 3,
> 
> "timed\_out" : false,
> 
> "\_shards" : {
> 
> "total" : 5,
> 
> "successful" : 5,
> 
> "skipped" : 0,
> 
> "failed" : 0
> 
> },
> 
> "hits" : {
> 
> "total" : 185,
> 
> "max\_score" : 1.0,
> 
> "hits" : \[
> 
> {
> 
> "\_index" : "tenant1-stats-record-view-000001",
> 
> "\_type" : "record-view-day-aggregation",
> 
> "\_id" : "8eefc281-f477-3639-9475-1d2b2621d33f",
> 
> "\_score" : 1.0,
> 
> "\_source" : {
> 
> "timestamp" : "2023-06-09T00:00:00",
> 
> "unique\_id" : "8eefc281-f477-3639-9475-1d2b2621d33f",
> 
> "count" : 2,
> 
> "unique\_count" : 1,
> 
> "country" : null,
> 
> "hostname" : "None",
> 
> "remote\_addr" : "192.168.56.1",
> 
> "record\_id" : "9b4bb507-3a6a-4eeb-8f82-300c2b0a6302",
> 
> "record\_name" : "テストアイテム03",
> 
> "record\_index\_names" : "テストインデックス１",
> 
> "pid\_type" : "recid",
> 
> "pid\_value" : "3",
> 
> "cur\_user\_id" : "1",
> 
> "site\_license\_name" : "",
> 
> "site\_license\_flag" : false
> 
> }
> 
> },...
> 
> \]
> 
> }
> 
> }

  - search ログ
    
      - http://{Elasticsearch:port} /{ stats-search のインデックス}/\_search?pretty

> {
> 
> "took" : 2,
> 
> "timed\_out" : false,
> 
> "\_shards" : {
> 
> "total" : 5,
> 
> "successful" : 5,
> 
> "skipped" : 0,
> 
> "failed" : 0
> 
> },
> 
> "hits" : {
> 
> "total" : 11,
> 
> "max\_score" : 1.0,
> 
> "hits" : \[
> 
> {
> 
> "\_index" : "tenant1-stats-search-000001",
> 
> "\_type" : "search-day-aggregation",
> 
> "\_id" : "1ef1be2d-9261-3182-91b6-a878ac568e83",
> 
> "\_score" : 1.0,
> 
> "\_source" : {
> 
> "timestamp" : "2023-07-07T00:00:00",
> 
> "unique\_id" : "1ef1be2d-9261-3182-91b6-a878ac568e83",
> 
> "count" : 1,
> 
> "unique\_count" : 1,
> 
> "country" : null,
> 
> "referrer" : "https://192.168.56.103/",
> 
> "search\_key" : "0718",
> 
> "search\_type" : "0",
> 
> "site\_license\_name" : "",
> 
> "site\_license\_flag" : false
> 
> }
> 
> },...
> 
> \]
> 
> }
> 
> }

  - top-view ログ
    
      - http://{Elasticsearch:port} /{ stats-top-view のインデックス}/\_search?pretty

> {
> 
> "took" : 1,
> 
> "timed\_out" : false,
> 
> "\_shards" : {
> 
> "total" : 5,
> 
> "successful" : 5,
> 
> "skipped" : 0,
> 
> "failed" : 0
> 
> },
> 
> "hits" : {
> 
> "total" : 562,
> 
> "max\_score" : 1.0,
> 
> "hits" : \[
> 
> {
> 
> "\_index" : "tenant1-stats-top-view-000001",
> 
> "\_type" : "top-view-day-aggregation",
> 
> "\_id" : "3569afb4-53bd-3ef6-823d-e864be85faee",
> 
> "\_score" : 1.0,
> 
> "\_source" : {
> 
> "timestamp" : "2023-05-09T00:00:00",
> 
> "unique\_id" : "3569afb4-53bd-3ef6-823d-e864be85faee",
> 
> "count" : 10,
> 
> "unique\_count" : 1,
> 
> "country" : null,
> 
> "hostname" : "None",
> 
> "remote\_addr" : "192.168.56.1",
> 
> "site\_license\_name" : "",
> 
> "site\_license\_flag" : false
> 
> }
> 
> },...
> 
> \]
> 
> }
> 
> }

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

  - ###   

## セッション管理

  - invenioモジュールを利用しており、サーバ側のセッション管理、セッションアクティビティの追跡が可能。詳細なドキュメントは[invenio-accounts](https://github.com/inveniosoftware/invenio-accounts#invenio-accounts) で入手可能。

  - 一括登録画面のセッション維持期間のみカスタマイズ可能。設定WEKO\_ADMIN\_IMPORT\_PAGE\_LIFETIMEに秒数を設定する（デフォルトは12時間）。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
<tr class="even">
<td><blockquote>
<p>2023/11/11</p>
</blockquote></td>
<td>V0.9.27</td>
<td>V0.9.27追加機能</td>
</tr>
</tbody>
</table>

##   

## API Endpoint

invenio では、UI とAPI　のアプリケーションが２つあり（※）、統合して実行している。  
各アプリケーションに含まれるエンドポイントは以下を参照のこと。  
（invenioコマンドで取得できるエンドポイント一覧はUI部分のみ。APIはinvenio-baseをデバックして確認）

1.  UI \[https://rcosms-my.sharepoint.com/:x:/g/personal/hayashi\_rcosms\_onmicrosoft\_com/ESFoWv7Q-LlLu2KJbQQyXBQBA2wOZ-3aFba9XQQRRsxMaA?e=FhDHyj\]

2.  API　\[<https://rcosms-my.sharepoint.com/:x:/g/personal/hayashi_rcosms_onmicrosoft_com/EcR8uA8LSs5HtNFUrGgSmaIBULWfZ6yznzAMd6hIhqZlaw?e=l7Jvgg>\]

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

## Shibboleth対応

1\. Shibboleth IdPからの属性情報に基づき、ユーザへのロール割り当てをする

  - Idpから取得した属性情報は、以下の設定に従ってWEKOに渡される
    
      - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/nginx/login.php#L16-L20>
    
      - 「$\_SERVER\[Idp側での属性名\]」で渡された情報を「$post\_args\[WEKO側での属性名\]」として受け取る

  - 認証時にIdPより取得した属性情報に基づきログインユーザに対してロール割り当てを行う
    
      - IdP属性情報は以下とする
        
          - ロール：wekoSocietyAffiliation
    
      - IdP属性値に対するロール割り当ては以下とする
        
          - 「管理者」→システム管理者ロール'System Administrator'
        
          - 「図書館員」→リポジトリ管理者ロール'Repository Administrator'
        
          - 「教員」→一般利用者ロール'Contributor'
        
          - 「教官」→一般利用者ロール'Contributor'
    
      - 上記のIdP属性値とロールとの対応は、以下のコンフィグで設定する
        
          - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-accounts/weko_accounts/config.py#L77-L82>
        
          - 設定キー：WEKO\_ACCOUNTS\_SHIB\_ROLE\_RELATION
    
      - IdP属性値がconfigに含まれないロールであった場合は、ロールを持たないユーザとなる

2\. Shibboleth IdPからの属性情報に基づき、サイトライセンス機能を制御する

  - 認証時にIdPより取得した属性情報に基づきログインユーザに対してサイトライセンス制御を行う
    
      - IdP属性情報は以下とする
        
          - サイトライセンス：wekoSiteUserWithinIpRange
    
      - IdP属性値に対するサイトライセンスは以下とする
        
          - "False"の場合は以下のエラーメッセージを表示し、ログイン不可とする  
            　JP: ログインに失敗しました。  
            　EN: Failed to login.

3\. Shibbolethでのアカウント情報(ロール含む)の利用

  - シボレス経由でログインする都度、シボレス属性値をWEKO3のユーザ情報に反映
    
      - SHIB\_ATTR\_USER\_NAME は、invenio の仕様でユニークである必要がある。
    
      - SHIB\_ATTR\_ROLE\_AUTHORITY\_NAMEについて、ロールの紐づけをconfig で指定できるものとし、configに含まれないロールであった場合は、WEKOのロールとしては設定しない
        
          - SHIB\_ATTR\_ROLE\_AUTHORITY\_NAMEに複数属性が含まれている場合は，複数ロールの割当を行えるようにする。（複数属性が含まれている場合は属性値を半角セミコロン「;」で区切られている）

  - シボレスユーザの紐づけキー
    
      - SHIB\_ATTR\_EPPNとする
    
      - 存在しない場合は、かわりにSHIB\_ATTR\_USER\_NAMEを利用することができる
    
      - SHIB\_ATTR\_USER\_NAMEを利用するかどうかは、以下のconfigで指定する
        
          - パス：<https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-accounts/weko_accounts/config.py#L97>
        
          - 設定キー：WEKO\_ACCOUNTS\_SHIB\_ALLOW\_USERNAME\_INST\_EPPN

4\. 実装

  - weko\_accounts.views. shib\_sp\_login関数によって、IdPからのリクエストを処理する
    
      - リクエストにSHIB\_ATTR\_SESSION\_IDが含まれず、以下のコンフィグWEKO\_ACCOUNTS\_SHIB\_LOGIN\_ENABLEDがfalseの場合はエラーとしてWEKOのログイン画面に遷移する
        
          - > パス（instance.cfg）：  
            > <https://github.com/RCOSDP/weko/blob/v0.9.22/scripts/instance.cfg#L436>
        
          - パス（config.py）：  
            <https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-accounts/weko_accounts/config.py#L29>
    
      - weko\_accounts.utils. parse\_attributes関数によってリクエストの内容を確認し、必須の項目が含まれない場合はエラーとしてWEKOのログイン画面に遷移する
        
          - 必須項目は以下のコンフィグで設定する
            
              - > パス（instance.cfg）：  
                > <https://github.com/RCOSDP/weko/blob/v0.9.22/scripts/instance.cfg#L442-L448>
            
              - パス（config.py）：  
                <https://github.com/RCOSDP/weko/blob/v0.9.22/modules/weko-accounts/weko_accounts/config.py#L64-L74>
            
              - 設定キー：WEKO\_ACCOUNTS\_SSO\_ATTRIBUTE\_MAP
    
      - リクエストの内容にSHIB\_ATTR\_EPPNが含まれず、かわりにSHIB\_ATTR\_USER\_NAMEを利用しない設定である場合はエラーとしてWEKOのログイン画面に遷移する
    
      - セッション情報はRedisに保存する
        
          - キーは、以下のコンフィグの値にログイン画面での入力値SHIB\_ATTR\_SESSION\_IDを加えたものを用いる
            
              - パス：<https://github.com/RCOSDP/weko/blob/13c305a3048309dbda87a614ffedac18423820aa/modules/weko-accounts/weko_accounts/config.py#L32>
            
              - 設定キー：WEKO\_ACCOUNTS\_SHIB\_CACHE\_PREFIX
    
      - リクエストの内容をもとに、shibboleth\_userテーブルからSHIB\_ATTR\_EPPNまたはSHIB\_ATTR\_USER\_NAMEを使用してレコードの存在を確認する

  - 上記の処理で、shibboleth\_userテーブルにレコードが存在する場合は、weko\_accounts.views.shib\_auto\_login関数で続きの処理を行う
    
      - リクエストのSHIB\_ATTR\_SESSION\_IDとsession\['shib\_session\_id'\]のどちらかに情報がある場合は、ログインする
        
          - リクエストにSHIB\_ATTR\_SESSION\_IDが含まれず、session\['shib\_session\_id'\]に情報がある場合は、weko\_accounts.api.ShibUser.new\_relation\_infoメソッドによってshibboleth\_userテーブルにレコードを作成する
            
              - あわせて、userprofiles\_userprofileテーブルに以下の内容でレコードを作成する
                
                  - user\_id：shibboleth\_userテーブルに作成するレコードのidフィールドと同じ
                
                  - timezone：コンフィグのデフォルト値
                
                  - language：コンフィグのデフォルト値
                
                  - username：shibboleth\_userテーブルに作成するレコードのshib\_user\_nameフィールドと同じ
        
          - レコード作成の有無にかかわらず、weko\_accounts.api.ShibUser. check\_inメソッドの中で、ロールの割り当てを行う
    
      - 上記以外の場合は、WEKOのログイン画面に遷移する

  - shibboleth\_userテーブルにレコードが存在しなかった場合は、weko\_accounts.views.shib\_login関数でID選択画面に遷移する
    
      - 登録済みのIDでログインする場合は、weko\_accounts.views.confirm\_user関数で続きの処理を行う
        
          - リクエストに、有効なWEKOアカウントとパスワードが含まれない場合は、WEKOのログイン画面に遷移する
        
          - リクエストのWEKOアカウントのメールアドレスを使用して、shibboleth\_userテーブルにレコードを作成する
        
          - weko\_accounts.api.ShibUser. check\_inメソッドの中で、ロールの割り当てを行う
        
          - ログインする
    
      - 新規IDでログインする場合は、weko\_accounts.views.shib\_auto\_login関数でログインする

  - shibboleth\_userテーブルにレコードを作成する場合は、あわせてユーザ関連テーブルも上書きする
    
      - 1\) シボレス属性値をshibboleth\_userテーブルに登録する
        
          - SHIB\_ATTR\_MAIL ⇒ shibboleth\_user.shib\_mail
        
          - SHIB\_ATTR\_USER\_NAME ⇒ shibboleth\_user.shib\_user\_name
        
          - SHIB\_ATTR\_ROLE\_AUTHORITY\_NAME ⇒shibboleth\_user.shib\_role\_authority\_name
    
      - 2\) shibboleth\_userテーブルから各テーブルに登録する
        
          - shibboleth\_user.shib\_mail ⇒ accounts\_user.email
        
          - shibboleth\_user.shib\_user\_name ⇒ userprofiles\_userprofile.username
        
          - shibboleth\_user.shib\_role\_authority\_name ⇒ accounts\_userrole.user\_id,role\_id
    
      - 1),2) どちらの登録の際も値のチェックは行わず、登録先の値を上書きする。

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

## ワークフロー連携

  - > 1\. WEB APIを用いてGakuNinRDMから登録対象データを受領する

<!-- end list -->

  - WEB APIを用いて「WEKO3の一括登録フォーマット※」を取得する（OAuth2による認証・認可を行う）
    
      - (※)WEKO3での一括登録フォーマット：　アイテムタイプ単位のTSV形式ファイルのzipファイル  
        今回の実証では、「デフォルトアイテムタイプ(フル)」を使用する

  - 接続および対象データの取得が行えない場合は、受付エラーとしてWEB APIでの受領に対してのエラーとして返す。（APIエラー、認証エラーを想定）

  - 「WEKO３の一括登録フォーマット」として対象データを受取れなかった場合は、フォーマットエラーとしてWEB APIの受領に対してのエラーとして返す。（フォーマット不正を想定）

  - 受け付けた「WEKO3の一括登録フォーマット」の対象データを保持する。（WEKO3のアクティビティ生成で利用する）

  - WEB APIを介した登録データの受付情報を記録する。
    
      - タイムスタンプ、接続者の情報を記録する。エラーがある場合はエラー情報を記録する。

<!-- end list -->

  - 詳細のシーケンス図は以下を参照  
    <https://redmine.devops.rcos.nii.ac.jp/attachments/25959/SequenceDiagram.xlsx>

> ![](media/media/image6.png)

  - > 2\. アイテム登録するフローを用意する

<!-- end list -->

  - WEB API経由で受け取る「一括登録フォーマット」でのアイテム情報を、ワークフローでアイテム登録をするためのフローを用意する。
    
      - 使用するアクションおよびアクション実施順序を確定させる。
    
      - アクションを定義しフローを作成する。フローは以下の通り。
        
        1.  Item Registration
        
        2.  Item Link
        
        3.  Identifier Grant
        
        4.  Approval

<!-- end list -->

  - > 3\. 一括登録フォーマットのアイテム情報からアイテムを登録する

<!-- end list -->

  - 一括登録フォーマットに従ったアイテム情報1件分からアイテムを登録する
    
      - アクティビティに関連付けられるアイテムを指定されるアイテムタイプから生成する
        
          - 一括登録フォーマットに従ったアイテム情報を登録する処理において行う事前チェックを実施する。
    
      - 事前チェックにてエラーが発生した場合は、アクティビティの作成を中止する
        
          - エラー情報を返す。
    
      - 事前チェックにてエラーがなかった場合に、アイテムを登録する。

<!-- end list -->

  - ワークフロー上はItemRegistrationで留めておく
    
      - 登録完了までいかず、途中からワークフローを再開できるようにする

<!-- end list -->

  - システム連携において、一括登録フォーマットのアイテム情報からアイテムの  
    メタデータ項目とインデックス情報を取り込んだアクティビティを生成する。

<!-- end list -->

  - 該当のアクティビティは、アクティビティ一覧にDoingの状態で表示され、クリックすることでItemRegistration画面のメタデータ入力画面が表示される。  
    （このとき、メタデータ項目が入力されている状態である）

<!-- end list -->

  - \[次へ\]でインデックス選択画面を表示した際も、取り込んだ該当のインデックスにチェックが付いている状態で保持されているものとする

**【補足】**

  - アイテムIDは指定をしても、値は無視して自動採番する

<!-- end list -->

  - > 4\. システムからAPIを経由したアイテム登録の実証

<!-- end list -->

  - WEB APIを用いて、アイテムを取得し、WEKO3のワークフローを通したアイテム登録の流れは以下の通り

4.1. OAuth2による認証・認可設定

  - 連携システムからのAPI接続にはOAuth2認証を用いるため、事前に接続用の認証トークンを生成する

  - API経由での登録アクティビティを利用するためのScopeとして、「user:activity」を用いる

  - Access Admin\> Profile　画面の "New token" ボタンを押下し、生成したいScopesの選択肢から「user:activity」Scopesにチェックを入れる

  - 生成したトークンをシステム側のAPIで利用する

> ![グラフィカル ユーザー インターフェイス, アプリケーション 自動的に生成された説明](media/media/image7.png)
> 
> ![グラフィカル ユーザー インターフェイス, テキスト, アプリケーション, メール, Web サイト 自動的に生成された説明](media/media/image8.png)

  - ※実証実験にあたっては、上記で発行したアクセストークンをPosmanツールに指定して利用

  - ※実証用のプログラムをマージ後にクリーンビルドせずに、既に稼働している環境に取り込む場合、以下の設定を行う必要がある

> \* Update folder permission:
> 
> \-----
> 
> 　sudo chown -R 1000:1000 ./modules/invenio-oauth2server/
> 
> 　sudo chown -R 1000:1000 ./modules/weko-workflow/
> 
> \-----
> 
> \* Reinstall module's packages:
> 
> \-----
> 
> 　docker-compose exec web pip install -e /code/modules/invenio-oauth2server
> 
> 　docker-compose exec web pip install -e /code/modules/weko-workflow
> 
> \-----
> 
> \* Restart docker:
> 
> \-----
> 
> 　docker-compose stop; docker-compose up -d
> 
> \-----
> 
> \* Rebuild bundle/static files:
> 
> \-----
> 
> 　docker-compose exec web invenio collect -v;docker-compose exec web invenio assets build
> 
> \-----

4.2. アイテム登録連携用API

  - 以下、3つのAPIを利用する
    
      - アイテム登録アクティビティの開始: POST /DepositActivity
    
      - 登録アクティビティの取得: GET /DepositActivity/{activityId}
        
          - 登録アクティビティの状態を取得する
    
      - 登録アクティビティのキャンセル: DELETE /DepositActivity/{activityId}
        
          - 登録したアクティビティを「強制終了」する

4.3. アイテム登録連携用APIで利用するワークフローおよびフロー

  - アクティビティの生成とworkflow\_idについて
    
      - 連携システム側からAPIでファイルを受け渡し、ワークフローのItemRegistration画面で留めておくためには1件ずつ、アクティビティを生成しておく必要がある
    
      - また、アクティビティ生成にあたっては、どのワークフローで登録するか、workflow\_idを指定する必要がある
    
      - 今回の実証では、以下の設定値として、configファイル指定(WEKO\_WORKFLOW\_GAKUNINRDM\_DATA)を行った

<!-- end list -->

  - **ワークフロー定義**
    
      - ワークフロー名称：「GRDM\_デフォルトワークフロー」
    
      - 'workflow\_id': -1,

![グラフィカル ユーザー インターフェイス, アプリケーション, Word, メール 自動的に生成された説明](media/media/image9.png)

  - **アイテムタイプ定義**
    
      - アイテムタイプは「デフォルトアイテムタイプ（フル）」を使用する

  - **フロー定義**
    
      - 使用するフローは以下の通りとする
        
          - フロー名称：「GRDM\_デフォルトフロー」
            
            1.  Start
            
            2.  Item Registration
            
            3.  Item Link
            
            4.  Identifier Grant
            
            5.  Approval
            
            6.  End

![グラフィカル ユーザー インターフェイス, アプリケーション, Teams 自動的に生成された説明](media/media/image10.png)

4.4. 一括登録フォーマットのアイテム情報からアイテムを登録する

  - 一括登録フォーマットに従ったアイテム情報1件分からアイテムを登録する

<!-- end list -->

1.  アクティビティに関連付けられるアイテムを指定されるアイテムタイプから生成する
    
      - 一括登録フォーマットに従ったアイテム情報を登録する処理において行う事前チェックを実施する
        
          - アイテムの一括登録(インポート)では、ItemRegistrationの後続の処理、ID・DOI付与全ての工程を行えるが、このワークフロー連携では、ワークフロー上はItemRegistrationで留めておく必要がある（登録完了までいかず、途中からワークフローを再開できるようにするため）
        
          - そのため、ワークフロー連携では一括登録フォーマットに従うものの、以下の項目は指定しても処理に利用しない
            
              - .id （アイテムID。IDが自動採番されるため、IDのチェックが不要。）
            
              - .uri　（アイテムのURI。IDが自動採番されるため、URIのチェックが不要。）
            
              - .edit\_mode （アクティビティの新規作成のため無視する。入力しなくてもエラーとならない）
            
              - .cnri　（ハンドル情報。ハンドル設定がONの場合、Item Registrationの「Next」ボタンを押下する際に自動申請されるため、設定が不要。）
            
              - .doi\_ra　（DOI情報。Item Registrationに止めるので、DOI情報のチェックが不要）
            
              - .doi　（DOI情報。Item Registrationに止めるので、DOI情報のチェックが不要）
            
              - .Identifier Registration　（ID登録、ID登録タイプ。DOI情報ですが、DOI付与しないため、無視する）

2.  事前チェックにてエラーが発生した場合は、アクティビティの作成を中止する
    
      - チェックエラー情報をログに記録する。（今回の実証ではチェック内容の詳細定義や、チェック結果の返戻実装は対象外）

![テキスト 自動的に生成された説明](media/media/image11.png)

3.  事前チェックにてエラーがなかった場合に、アイテムを登録する
    
      - 以下は、疑似的にPostmanツールを使用して、外部からAPIを叩いてみた内容

![コンピューターのスクリーンショット 自動的に生成された説明](media/media/image12.png)

  - 上記APIを叩くことで、WEKO側に新規のアイテム登録アクティビティを生成することができる

<!-- end list -->

  - > 更新履歴

| 日付 | GitHubコミットID                             | 更新内容 |
| -- | ---------------------------------------- | ---- |
|    | 353ba1deb094af5056a58bb40f07596b8e95a562 | 初版作成 |

##   

## ID体系

（１）アイテムタイプID

| **ID** | **説明**                                            |
| ------ | ------------------------------------------------- |
| 1～     | WEKO2で機関が独自に作成したアイテムタイプ。移行対象。△                    |
| 10001～ | WEKO2のデフォルトアイテムタイプ。移行対象。△                         |
| 20001～ | WEKO2のハーベスト用アイテムタイプ。移行対象。△                        |
| 30001～ | WEKO3のデフォルトアイテムタイプ。制限公開に利用する。                     |
| 40001～ | WEKO3でユーザがAdmin\>Item Types\>Metaで新規作成するアイテムタイプ。★ |

（２）プロパティID

| **ID** | **説明**                                            |
| ------ | ------------------------------------------------- |
| 1～     | WEKO3用の初期定義プロパティ。v0.9.22では1～191ある。                |
| 1001～  | 移行ツールで作成されたプロパティ。移行対象のアイテムタイプを構成。▲                |
| 30001～ | WEKO3のデフォルトプロパティ。制限公開に利用する。                       |
| 40001～ | WEKO3でユーザがAdmin\>ItemType\>Propertyで新規作成したプロパティ。★ |

△：移行ツールに関連。現在は移行元WEKO2で設定されているIDをそのまま移行している。現状でOK。  
▲：移行ツールに関連。移行ツールの対応が必要。  
★：移行ツール内で対応する。

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

## 解析基盤連携

  - > 目的・用途

本機能はリポジトリに公開されたデータを解析基盤で処理させるための機能である。

これによって、研究者がリポジトリに公開されたデータやプログラムを直接解析基盤で処理させることが可能となる。

  - > 利用方法

アイテム詳細画面で表示されるオンライン分析ボタンをクリックする。

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

## 制限公開機能

### アイテムタイプ管理（制限公開）

  - 制限公開機能に対して対応しているアイテムタイプは以下の通りである（日立納品時）
    
      - 「利用申請」
    
      - 「二段階利用申請」
    
      - 「利用報告-Data Usage Report」  
        これら3つのアイテムタイプの構成は以下の通りである

  - 制限公開アイテム登録用ファイル情報  
    制限公開機能を利用するには、「制限公開用のコンテンツファイル」が必要である
    
      - アイテム登録画面でファイルをアップロードすると、ファイル名を自動設定する
    
      - アップロードしたファイルのフォーマット・ファイルサイズをDBに格納する  
        \*\*Meta画面のAllow Multipleのオプションはオンに設定し非活性

<table>
<thead>
<tr class="header">
<th>プロパティ定義</th>
<th>備考</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>表示名</td>
<td>Text</td>
<td>-</td>
<td>-</td>
<td>ファイル名を登録する</td>
</tr>
<tr class="even">
<td>本文URL</td>
<td>Object</td>
<td>本文URL</td>
<td>Text</td>
<td>コンテンツファイルの格納先が自動で登録される<br />
コンテンツファイルが無い場合は手入力でURLを入力可能</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>ラベル</td>
<td>Text</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>オブジェクトタイプ</td>
<td>Select</td>
<td>選択肢<br />
　abstract/summary/fulltext/thumbnail/other　</td>
</tr>
<tr class="odd">
<td>フォーマット</td>
<td>Text</td>
<td>-</td>
<td>-</td>
<td>コンテンツファイルのMIMEタイプを取得して自動で登録される</td>
</tr>
<tr class="even">
<td>サイズ</td>
<td>List</td>
<td>サイズ</td>
<td>Text</td>
<td>コンテンツファイルのサイズを取得して自動で登録される</td>
</tr>
<tr class="odd">
<td>日付</td>
<td>List</td>
<td>日付</td>
<td>Datetime</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>日付タイプ</td>
<td>Select</td>
<td>選択肢<br />
　Accepted/Collected/Copyrighted /Issued/Submitted/Updated/Valid　</td>
</tr>
<tr class="odd">
<td>バージョン情報</td>
<td>Text</td>
<td>-</td>
<td>-</td>
<td></td>
</tr>
<tr class="even">
<td>表示形式</td>
<td>Select</td>
<td>-</td>
<td>-</td>
<td>detail/simple/preview</td>
</tr>
<tr class="odd">
<td>ライセンス</td>
<td>Select</td>
<td>-</td>
<td>-</td>
<td></td>
</tr>
<tr class="even">
<td>自由ライセンス</td>
<td>Textarea</td>
<td>-</td>
<td>-</td>
<td>"ライセンス"で"自由入力"を選択した場合に登録する</td>
</tr>
<tr class="odd">
<td>アクセス</td>
<td>Radios</td>
<td>-</td>
<td>-</td>
<td>オープンアクセス/オープンアクセス日を指定する/ログインユーザのみ/公開しない/制限公開（デフォルト）</td>
</tr>
<tr class="even">
<td>グループ</td>
<td>Select</td>
<td>-</td>
<td>-</td>
<td>"アクセス"で"ログインユーザのみ"を選択したときに登録する</td>
</tr>
<tr class="odd">
<td>公開日（オープンアクセスの日付）</td>
<td>List</td>
<td>日付</td>
<td>Datetime</td>
<td>"アクセス"で"オープンアクセス日を指定する"を選択したときに登録する</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>タイプ</td>
<td>Select</td>
<td>日付タイプは「Available」固定（Item Registration画面では入力エリアは存在しない）</td>
</tr>
<tr class="odd">
<td>データタイプ</td>
<td>Radios</td>
<td>-</td>
<td>-</td>
<td>"アクセス"で"ログインユーザのみ"を選択したときに登録するライフ/累積/組み合わせ分析l都道府県/地点情報</td>
</tr>
<tr class="even">
<td>提供方法</td>
<td>List</td>
<td>ロール</td>
<td>Select</td>
<td>"アクセス"で"制限公開"を選択したときに登録する/ Administration &gt;UserManagement&gt;Roleで管理しているロールと「非ログインユーザ（Guest）」をリストに表示する</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>ワークフロー</td>
<td>Select</td>
<td>Administration &gt;WorkFlow&gt;WorkFlow Listで管理しているワークフローのうち「制限公開フラグ」（関連ストーリー： <a href="https://redmine.devops.rcos.nii.ac.jp/issues/24080"><del>#24080</del></a>）が有効なものをリストに表示する</td>
</tr>
<tr class="even">
<td>利用規約</td>
<td>Select</td>
<td>-</td>
<td>-</td>
<td>"アクセス"で"制限公開"を選択したときに登録する。管理画面で登録した利用規約をリストで表示する。選択肢に「自由入力」を設ける</td>
</tr>
</tbody>
</table>

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

  - ###   

### アイテム詳細(制限公開)

  - コンテンツのアクセスを「制限公開」とした場合のアイテム詳細画面、ファイル詳細画面の処理
    
      - アクセスしているユーザーが管理者権限があるかどうかは、「\_\_check\_user\_permission」のメソッドでチェックする。V0.9.22現在、システム管理者・リポジトリ管理者・コミュニティ管理者が管理者権限ありとして扱われている。

  - 管理者権限をもつユーザに対して、アイテム詳細画面、ファイル詳細画面に、ファイルの情報を取得し、ダウンロードできる

  - 権限がないユーザに対して、アイテム詳細画面に「アクセス制限」（英「Restricted Access」）と表示する。ファイル情報のリンクは不活性とし、ファイル詳細画面の「Action」にダウンロードボタンのかわりに「申請」ボタンを表示し、コンテンツ登録時に設定した「提供方法：ロール」のロールに一致するユーザーは「申請」ボタンをクリックことで以下の利用申請を実施することができる
    
      - 「提供方法：ロール」を「非ログインユーザ」とした場合、ログインしていないユーザは「申請」ボタンをクリックことで以下の利用申請を実施することができる

  - 制限公開用のコンテンツファイルでの提供方法に一致しないユーザが「申請」ボタンを押下した場合はモーダルで警告メッセージを表示する
    
      - 警告メッセージ：
        
          - 日本語：「このデータは利用できません（権限がないため）。」
        
          - 英語：「This data is not available for this user.」

  - コンテンツのアクセスを「制限公開」とした場合のコンテンツファイルのアクセス制御
    
      - アクセスしているユーザーが管理者権限があるかどうかは、「\_\_check\_user\_permission」のメソッドでチェックする
        
          - アクセス権限をもつユーザの場合（管理者・アイテム登録者・代理投稿者）
            
              - DLのURLを入力：　"Permission required"を表示する  
                ※入力するURLは登録者(Contributor)以上がボタンを押下したときのURL( } )とする
            
              - Informatonボタン押下：　"Permission required"を表示する
            
              - Informaton画面のURLを入力：　"Permission required"を表示する
        
          - 権限のないログインユーザの場合（「提供方法：ロール」の設定にかかわらず）
            
              - DLのURLを入力：　"Permission required"を表示する  
                ※入力するURLは登録者(Contributor)以上がボタンを押下したときのURL( } )とする
            
              - Informatonボタン押下：　"Permission required"を表示する
            
              - Informaton画面のURLを入力：　"Permission required"を表示する
        
          - 非ログインユーザの場合（「提供方法：ロール」の設定にかかわらず）
            
              - DLのURLを入力：　ログイン要求をする  
                ※入力するURLは登録者(Contributor)以上がボタンを押下したときのURL( } )とする
            
              - Informatonボタン押下：ログイン要求をする
            
              - Informaton画面のURLを入力：ログイン要求をする

  - 利用申請①:利用規約への同意
    
      - 提供方法に一致するユーザーがアイテム詳細画面の「申請」ボタンを押下した際に利用申請設定時に設定されている利用規約をモーダル画面に表示する
        
          - 利用規約について
            
              - 利用規約文表示エリア上部に「利用規約」を固定で表示する
            
              - 「利用規約に同意する」ラベルクリック時もチェックボックスのオンオフができるようにする
            
              - 「利用規約に同意する」チェックボックスのチェック/非チェックが、「次へ」ボタンが活性/非活性と連動する

  - 利用申請②：利用規約画面での「次へ」ボタンを押下した際の挙動
    
      - 「非ログインユーザ」で設定される場合、メールアドレスが入力できるモーダル画面が表示される
        
          - 受信したメール文のリンクをクリックするとワークフローに定義されているアクション画面（アイテム登録画面など）に遷移する
        
          - リンクはランダムなURLとトークン値から構成し、両者が一致した場合に利用登録ワークフローへのリンクとして機能する
    
      - 「 提供方法：ロール」で設定される場合、指定されたワークフローの画面に遷移する

  - 利用申請③：ワークフロー終了後の挙動
    
      - アイテム詳細画面の「申請」ボタンから起動したワークフローが「作業済み(Done)」となった際にダウンロード用のURIをメールで通知する。リンクの有効期限とダウンロード回数は【Administration \> Setting \> Restricted Access画面】での「コンテンツファイルのダウンロード」(Content File Download)エリアで設定される
    
      - ダウンロードのリンクへアクセスする時、リンクの有効期限とダウンロード回数が超えない場合、コンテンツファイルがダウンロードできる。ダウンロード回数（残り回数）がカウントダウンされる
        
          - 有効期限を超過した場合、エラーメッセージが表示される
            
              - 日本語：「ダウンロード有効期限を超過しています。」
            
              - 英語：「 The expiration date for download has been exceeded. 」
        
          - ダウンロード回数を超過した場合、エラーメッセージが表示される
            
              - 日本語：「ダウンロード上限回数を超過しています。」
            
              - 英語：「 The download limit has been exceeded. 」
        
          - 登録時にアイテムを制限公開としていたが、途中で非公開/削除した場合、DL期間内でもファイルはダウンロードできない
        
          - 登録時に指定したインデックスを非公開に変更した場合、DL期間内でもファイルはダウンロードできなくなる

  - 利用申請④：データダウンロード後の挙動
    
      - 利用申請が承認された制限公開コンテンツファイルを最初にダウンロードした際に、ダウンロードしたユーザのメールアドレスに向けて「利用報告の登録のお願い」メールを通知する。メールには利用報告ワークフローアクティビティの登録URLリンクが掲載されており、URLリンクから遷移する登録画面から利用報告を登録できる。
        
          - ゲストユーザーの利用報告WFに対して、リンクの有効期限は【Administration \> Setting \> Restricted Access画面】での「利用報告ワークフローへのアクセス」(Usage Report Workflow Access)エリアで設定できる

<!-- end list -->

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

  - ###   

### ワークフロー管理（制限公開）

  - フロー:　Flow List
    
      - 【Admin \> WorkFlow \> Flow List画面】から利用申請フローを登録することができる
        
          - 現在利用申請フローとして動作が保証されているのは以下の2つである。
            
              - 利用申請： 　\[Start\]-\[Item Resistration\]-\[Approval(1)\]-\[End\]
            
              - 二段階利用申請：　\[Start\]-\[Item Resistration\]-\[Approval(1)\]-\[Approval(2)\]-\[End\]
            
              - 利用登録： 　\[Start\]-\[Item Resistration\]-\[End\]
            
              - 利用規約のみ： 　\[Start\] -\[End\]
        
          - 利用登録は、Approvalを承認扱いでスキップする利用申請。利用規約のみは、申請なしでそのまま制限公開のコンテンツファイルをダウンロードできる。
        
          - 利用報告フローは以下の通り定義している。
            
              - 利用報告： 　\[Start\]-\[Item Resistration\]-\[Approval(1)\]-\[End\]
    
      - 「Action Role」カラムに、アクションを実行するロールを限定できる
        
          - 「Action Role」プルダウンを選択する。「Action Role」プルダウンでの選択肢は現在システムに設定されたロールである
        
          - 「Deny」チェックボックスにチェックを入れる場合、選択されているロールが実施不可とする
    
      - 「Action User」カラムに、アクションを実行するユーザーを限定できる
        
          - 「Action User」プルダウンを選択する。「Action User」プルダウンでの選択肢は現在システムに登録されたユーザーである
            
              - 「Approval」アクションに対して
                
                  - 選択肢はシステムに登録しているユーザーと、「プロパティを指定」(Specify Property)である
                    
                      - 「プロパティを指定」(Specify Property)を選択した場合、「プロパティを指定する」(Specify Property)モーダル画面を表示する。当該画面でプロパティを選択する
                    
                      - モーダル画面には、プロパティ定義に「"approval":true」キーワードを持つプロパティ名を表示する
                    
                      - モーダルに表示しているプロパティを選択して「設定」(Setting)ボタンを押すことで、プロパティを指定できる
                    
                      - 「閉じる」（Close）ボタンを押すと、モーダルを閉じる
                
                  - 「Item Resistration」アクションの以下チェックボックスにチェックを入れることで、管理者画面で登録したメールを自動送信することができる
                    
                      - チェックボックス：「Send an email to the registrant」  
                        Item Resistration登録完了時に、登録者にリマインドメールを送信する  
                        **\*\***\*チェックボックスをクリックすると、チェックボックス下のリストボックスが活性する。
                        
                          - リストボックスから、【Admin \> 設定 \> メールテンプレート】で登録したメールのタイトルを選択することができる。
                
                  - 「Approval」アクションごとに以下チェックボックスにチェックを入れることで、管理者画面で登録したメールを自動送信することができる
                    
                      - チェックボックス
                        
                          - 「承認依頼通知メール」（Approval Request Notification Email）  
                            Approvalフロー遷移時に、設定した承認者に承認を依頼するメールを送信する
                        
                          - 「承認却下通知メール」（Approval Rejection Notification Email）  
                            Approvalフローにて承認者が却下を行った場合、登録者に承認者が却下された旨を通知するメールを送信する
                        
                          - 「承認通知メール」（Approval Notification Email）  
                            Approvalフローにて承認者が承認を行った場合、登録者に承認者が承認された旨を通知するメールを送信する
                    
                      - チェックボックスをクリックすると、チェックボックス下のリストボックスが活性する。
                        
                          - リストボックスから、【Admin \> 設定 \> メールテンプレート】で登録したメールのタイトルを選択することができる。
        
          - 「Deny」チェックボックスにチェックを入れる場合、選択されているユーザーが実施不可とする
    
      - 「Change Order」カラムにアクションの順序を設定できる  
        一番上の項目は、［↑］ボタンが無効になる。一番下の項目は、［↓］ボタンが無効になる
    
      - 画面の下部に表示されている［保存］を押すと、フローを保存し、メッセージを一覧画面の上部に表示する  
        メッセージ：「Updated flow action successfully」

  - ワークフロー:　WorkFlow List
    
      - 【Admin \> WorkFlow \> WorkFlow List画面】に登録されたワークフローが一覧に表示される
        
          - 制限公開機能を利用するためには、「利用報告/Data Usage Report」という名前のワークフローを用意しておく必要がある
            
              - 「利用報告/Data Usage Report」の推奨設定は以下のとおり  
                ワークフロー: 利用報告/Data Usage Report  
                フロー：利用報告  
                アイテムタイプ：利用報告  
                制限公開フラグ：チェックしない  
                GakuNinRDM Flag：チェックしない  
                登録インデックスの指定：利用報告（インデックスにて登録）  
                表示/非表示：利用者が自分でワークフローを作成させないために、「提供方法：ロール」にて設定したロールは非表示とするのが望ましい。
        
          - 利用申請用のワークフローの推奨設定は以下のとおり
            
              - 利用申請  
                ワークフロー: 利用申請  
                フロー：利用報申請  
                アイテムタイプ：利用申請  
                制限公開フラグ：チェックする  
                GakuNinRDM Flag：チェックしない  
                登録インデックスの指定：利用申請（インデックスにて登録）
            
              - 表示/非表示  
                　表示：System Administrator, Repository Administrator  
                　非表示：Contributor,Community Administrator
            
              - 二段階利用申請  
                ワークフロー: 二段階利用申請  
                フロー：二段階利用申請  
                アイテムタイプ：二段階利用申請  
                制限公開フラグ：チェックする  
                GakuNinRDM Flag：チェックしない  
                登録インデックスの指定：利用申請（インデックスにて登録)
            
              - 
              - 
表示/非表示 　

> 表示：System Administrator, Repository Administrator  
> 　 非表示：Contributor,Community Administrator

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2024/01/19</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

##   

### メールテンプレート

※v0.9.22現在、未実装。今後リリースの予定

  - 使用している画面  
    【Admin \> Setting \> メールテンプレート】：自動送信メールのタイトル、文面を設定する画面である

  - 自動送信メールの内容を設定する

  - 【Admin \> Setting \> メールテンプレート】に送信元の情報を設定する
    
      - 「Mail Template」にてメール文面の設定をする
    
      - 送信者は「設定」-\[メール送信\]-\[Mail Setting\]で設定したユーザー

設定項目は以下の2つである

  - Subject：メールタイトル

  - (メール内容）：メール内容

デフォルトで以下のメールが設定されており、それぞれ制限公開機能で用いる自動送信メールに関係している

*① 非ログインユーザに利用申請ワークフローURLを送信する  
Subject: 利用申請登録のご案内／Register Application for Use  
本文:  
\[restricted\_site\_name\_ja\]です。  
下記のリンクにアクセスしていただき、利用申請の登録を行ってください。*

*\[url\_guest\_user\]*

*このメールは自動送信されているので返信しないでください。  
お問い合わせは下記までお願いします。また、このメールに心当たりのない方は、\[restricted\_site\_name\_ja\]までご連絡ください。*

*\[restricted\_site\_name\_ja\]：\[restricted\_site\_url\]  
問い合わせ窓口：\[restricted\_site\_mail\]*

*This is a message from \[restricted\_site\_name\_en\].  
Please access the link below and register your Application.*

*\[url\_guest\_user\]*

*Please do not reply to this email as it has been sent automatically.  
Please direct all inquiries to the following address.  
Also, if you received this message in error, please notify \[restricted\_site\_name\_en\].*

*\[restricted\_site\_name\_en\]：\[restricted\_site\_url\]  
E-mail：\[restricted\_site\_mail\]*

*② 利用者に対して、利用申請登録のリマインドを行う  
Subject: データ利用申請の受付のお知らせ／Your Application was Received  
本文:  
\[restricted\_institution\_name\_ja\]です。  
\[restricted\_site\_name\_ja\]をご利用いただいて、ありがとうございます。*

*下記の利用申請を受け付けました。*

*申請番号： \[restricted\_activity\_id\]  
登録者名： \[restricted\_fullname\]  
メールアドレス： \[restricted\_mail\_address\]  
所属機関：\[restricted\_university\_institution\]  
研究題目：\[restricted\_research\_title\]  
申請データ：\[restricted\_data\_name\]  
申請年月日：\[restricted\_application\_date\]*

*\[restricted\_institution\_name\_ja\]で審査しますので、結果の連絡をお待ちください。*

*このメールは自動送信されているので返信しないでください。  
お問い合わせは下記までお願いします。また、このメールに心当たりのない方は、\[restricted\_institution\_name\_ja\]までご連絡ください。*

*\[restricted\_site\_name\_ja\]：\[restricted\_site\_url\]  
問い合わせ窓口：\[restricted\_site\_mail\]*

*Dear \[restricted\_fullname\],*

*This is a message from \[restricted\_institution\_name\_en\].  
Thank you for using \[restricted\_site\_name\_en\].*

*We received the below application:*

*Application No.：\[restricted\_activity\_id\]  
Name：\[restricted\_fullname\]  
E-mail：\[restricted\_mail\_address\]  
Affiliation：\[restricted\_university\_institution\]  
Title of research：\[restricted\_research\_title\]  
Dataset requested ：\[restricted\_data\_name\]  
Application date：\[restricted\_application\_date\]*

*You will be notified once the application is approved.*

*Please do not reply to this email as it has been sent automatically.  
Please direct all inquiries to the following address.  
Also, if you received this message in error, please notify \[restricted\_institution\_name\_en\].*

*\[restricted\_site\_name\_en\]：\[restricted\_site\_url\]  
E-mail：\[restricted\_site\_mail\]*

*③ 承認者に対して、利用申請の承認の依頼を行う  
Subject: 利用申請の承認のお願い／Request for Approval of Application for Use  
本文:  
\[restricted\_site\_name\_ja\]です。下記の方から利用申請がありました。*

*申請番号： \[restricted\_activity\_id\]  
登録者名： \[restricted\_fullname\]  
メールアドレス： \[restricted\_mail\_address\]  
所属機関：\[restricted\_university\_institution\]  
研究題目：\[restricted\_research\_title\]  
申請データ：\[restricted\_data\_name\]  
申請年月日：\[restricted\_application\_date\]*

*\[restricted\_site\_name\_ja\]（\[restricted\_site\_url\]）にアクセスしていただき、画面左上からログインしていただけますと、「ワークフロー」タブが現れます。ここから上記の申請内容をご確認ください。「承認」または「却下」のボタンをクリックしてください。*

*このメールに心当たりのない方は、\[restricted\_site\_name\_ja\] までご連絡ください。*

*\[restricted\_site\_name\_ja\]：\[restricted\_site\_url\]  
問い合わせ窓口：\[restricted\_site\_mail\]*

*This is a message from \[restricted\_site\_name\_en\].  
We received the below application.*

*Application No.：\[restricted\_activity\_id\]  
Name：\[restricted\_fullname\]  
E-mail：\[restricted\_mail\_address\]  
Affiliation：\[restricted\_university\_institution\]  
Title of research：\[restricted\_research\_title\]  
Dataset requested ：\[restricted\_data\_name\]  
Application date：\[restricted\_application\_date\]*

*Please access \[restricted\_site\_name\_en\]（\[restricted\_site\_url\]） and log in from the upper left corner of the screen, and the \[Workflow\] tab will appear. From here, please confirm the above application by clicking on “approve” or “reject”.*

*If you received this message in error, please notify the \[restricted\_site\_name\_en\]*

*\[restricted\_site\_name\_en\]：\[restricted\_site\_url\]  
E-mail：\[restricted\_site\_mail\]*

*④ 申請者に対して、利用申請が承認されたことを伝え、ダウンロードリンクを送付する  
Subject: 利用申請の承認のお知らせ／Your application was approved  
本文:  
\[restricted\_site\_name\_ja\]です。*

*下記の利用申請を承認しました。*

*申請番号： \[restricted\_activity\_id\]  
登録者名： \[restricted\_fullname\]  
メールアドレス： \[restricted\_mail\_address\]  
所属機関：\[restricted\_university\_institution\]  
研究題目：\[restricted\_research\_title\]  
申請データ：\[restricted\_data\_name\]  
申請年月日：\[restricted\_application\_date\]*

*データは、下記アドレスよりダウンロードすることができます。*

*\[restricted\_download\_link\]*

*当日より\[restricted\_expiration\_date\]\[restricted\_expiration\_date\_ja\]日後まで有効です。ダウンロード期限を過ぎると、再申請が必要です。*

*このメールは自動送信されているので返信しないでください。  
このメールに心当たりのない方は、\[restricted\_site\_name\_ja\]までご連絡ください。*

*\[restricted\_site\_name\_ja\]：\[restricted\_site\_url\]  
問い合わせ窓口：\[restricted\_site\_mail\]*

*This is a message from \[restricted\_site\_name\_en\].  
Your application below has been approved.*

*Application No.：\[restricted\_activity\_id\]  
Name：\[restricted\_fullname\]  
E-mail：\[restricted\_mail\_address\]  
Affiliation：\[restricted\_university\_institution\]  
Title of research：\[restricted\_research\_title\]  
Dataset requested ：\[restricted\_data\_name\]  
Application date：\[restricted\_application\_date\]*

*The data can be downloaded from the address below.*

*\[restricted\_download\_link\]*

*It is valid from that day until the day after \[restricted\_expiration\_date\]\[restricted\_expiration\_date\_en\]. You will need to resubmit your application once the link becomes unavailable.*

*Please do not reply to this email as it has been sent automatically.  
If you received this message in error, please notify the \[restricted\_site\_name\_en\].*

*\[restricted\_site\_name\_en\]：\[restricted\_site\_url\]  
E-mail：\[restricted\_site\_mail\]*

*⑤ 申請者に対して、利用申請が却下されたことを伝える  
Subject: 利用申請の審査結果について／The results of the review of your application  
本文:  
\[restricted\_site\_name\_ja\]です。*

*下記の利用申請を却下しました。*

*申請番号： \[restricted\_activity\_id\]  
登録者名： \[restricted\_fullname\]  
メールアドレス： \[restricted\_mail\_address\]  
所属機関：\[restricted\_university\_institution\]  
研究題目：\[restricted\_research\_title\]  
申請データ：\[restricted\_data\_name\]  
申請年月日：\[restricted\_application\_date\]*

*このメールは自動送信されているので返信しないでください。  
お問い合わせは下記までお願いします。また、このメールに心当たりのない方は、\[restricted\_site\_name\_ja\] までご連絡ください。*

*\[restricted\_site\_name\_ja\]：\[restricted\_site\_url\]  
問い合わせ窓口：\[restricted\_site\_mail\]*

*This is a message from \[restricted\_site\_name\_en\].  
Your application below has been rejected.*

*Application No.：\[restricted\_activity\_id\]  
Name：\[restricted\_fullname\]  
E-mail：\[restricted\_mail\_address\]  
Affiliation：\[restricted\_university\_institution\]  
Title of research：\[restricted\_research\_title\]  
Dataset requested ：\[restricted\_data\_name\]  
Application date：\[restricted\_application\_date\]*

*Please do not reply to this email as it has been sent automatically.  
Please direct all inquiries to the following address.  
Also, if you received this message in error, please notify \[restricted\_site\_name\_en\].*

*\[restricted\_site\_name\_en\]：\[restricted\_site\_url\]  
E-mail：\[restricted\_site\_mail\]*

*⑥ DLリンクをクリックし、DLした申請者に対して利用報告のアドレスが送付される  
Subject: 利用報告の登録のお願い／Request for register Data Usage Report  
本文:  
\[restricted\_site\_name\_ja\]です。  
下記で申請いただいデータについてダウンロードされたことを確認しました。*

*申請番号： \[restricted\_usage\_activity\_id\]  
登録者名： \[restricted\_fullname\]  
メールアドレス： \[restricted\_mail\_address\]  
所属機関：\[restricted\_university\_institution\]  
研究題目：\[restricted\_research\_title\]  
申請データ：\[restricted\_data\_name\]  
申請年月日：\[restricted\_application\_date\]*

*ダウンロードしたデータについて、下記のリンクから利用報告の登録をお願いします。*

*\[usage\_report\_url\]*

*このメールは自動送信されているので返信しないでください。  
お問い合わせは下記までお願いします。また、このメールに心当たりのない方は、\[restricted\_site\_name\_ja\]までご連絡ください。*

*\[restricted\_site\_name\_ja\]：\[restricted\_site\_url\]  
問い合わせ窓口：\[restricted\_site\_mail\]*

*This is a message from \[restricted\_site\_name\_en\].  
We have confirmed that the dataset which you registered at below has been downloaded.*

*Application No.：\[restricted\_usage\_activity\_id\]  
Name：\[restricted\_fullname\]  
E-mail：\[restricted\_mail\_address\]  
Affiliation：\[restricted\_university\_institution\]  
Title of research：\[restricted\_research\_title\]  
Dataset requested ：\[restricted\_data\_name\]  
Application date：\[restricted\_application\_date\]*

*For the downloaded data, please register the Data Usage Report by the link below.*

*\[usage\_report\_url\]*

*Please do not reply to this email as it has been sent automatically.  
Please direct all inquiries to the following address.  
Also, if you received this message in error, please notify \[restricted\_site\_name\_en\].*

*\[restricted\_site\_name\_en\]：\[restricted\_site\_url\]*

*E-mail：\[restricted\_site\_mail\]*

*⑦ 管理者画面より、申請者に対して利用報告のリマインドを行う  
Subject: 利用報告の登録のお願い／Request for register Data Usage Report  
本文:  
\[restricted\_site\_name\_ja\]です。  
現時点で、下記の利用報告が登録されていません*

*報告番号：\[restricted\_activity\_id\]  
登録者名：\[restricted\_fullname\]  
メールアドレス：\[restricted\_mail\_address\]  
所属機関：\[restricted\_university\_institution\]  
利用データ：\[restricted\_data\_name\]  
データダウンロード日：\[data\_download\_date\]*

*下記のリンクから利用報告の登録をお願いします。*

*\[usage\_report\_url\]*

*このメールは自動送信されているので返信しないでください。  
お問い合わせは下記までお願いします。また、このメールに心当たりのない方は、\[restricted\_site\_name\_ja\]までご連絡ください。*

*\[restricted\_site\_name\_ja\]：\[restricted\_site\_url\]  
問い合わせ窓口：\[restricted\_site\_mail\]*

*This is a message from \[restricted\_site\_name\_en\].  
At this time, the Data Usage Report below has not been registered.*

*Usage Report No.：\[restricted\_activity\_id\]  
Name：\[restricted\_fullname\]  
E-mail：\[restricted\_mail\_address\]  
Affiliation：\[restricted\_university\_institution\]  
Usage Dataset：\[restricted\_data\_name\]  
Download date：\[data\_download\_date\]*

*Please register the Data Usage Report from the link below.*

*\[usage\_report\_url\]*

*Please do not reply to this email as it has been sent automatically.  
Please direct all inquiries to the following address.  
Also, if you received this message in error, please notify \[restricted\_site\_name\_en\].*

*\[restricted\_site\_name\_en\]：\[restricted\_site\_url\]  
E-mail：\[restricted\_site\_mail\]*

  - > 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2023/08/31</p>
</blockquote></td>
<td>353ba1deb094af5056a58bb40f07596b8e95a562</td>
<td>初版作成</td>
</tr>
</tbody>
</table>

## ツール

  - > 目的・用途

> 本機能はアップデート等によるデータ修正を行うことを目的に提供される。

  - > 利用方法

Invenio shell からの実行を想定している。

